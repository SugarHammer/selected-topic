!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("mapbox-gl")):"function"==typeof define&&define.amd?define(["exports","mapbox-gl"],t):t((e=e||self).L7={},e.mapboxgl)}(this,(function(e,t){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var n={},r={},i=function(e){return r[e]},a=function(e,t){r[e]=t},o=function(e,t){n[e]=t},s={},u={};function l(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function c(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function h(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function f(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":function(e){return e<0?"-"+h(-e,6):e>9999?"+"+h(e,6):h(e,4)}(e.getUTCFullYear())+"-"+h(e.getUTCMonth()+1,2)+"-"+h(e.getUTCDate(),2)+(i?"T"+h(t,2)+":"+h(n,2)+":"+h(r,2)+"."+h(i,3)+"Z":r?"T"+h(t,2)+":"+h(n,2)+":"+h(r,2)+"Z":n||t?"T"+h(t,2)+":"+h(n,2)+"Z":"")}var p=function(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],a=e.length,o=0,l=0,c=a<=0,h=!1;function f(){if(c)return u;if(h)return h=!1,s;var t,r,i=o;if(34===e.charCodeAt(i)){for(;o++<a&&34!==e.charCodeAt(o)||34===e.charCodeAt(++o););return(t=o)>=a?c=!0:10===(r=e.charCodeAt(o++))?h=!0:13===r&&(h=!0,10===e.charCodeAt(o)&&++o),e.slice(i+1,t-1).replace(/""/g,'"')}for(;o<a;){if(10===(r=e.charCodeAt(t=o++)))h=!0;else if(13===r)h=!0,10===e.charCodeAt(o)&&++o;else if(r!==n)continue;return e.slice(i,t)}return c=!0,e.slice(i,a)}for(10===e.charCodeAt(a-1)&&--a,13===e.charCodeAt(a-1)&&--a;(r=f())!==u;){for(var p=[];r!==s&&r!==u;)p.push(r),r=f();t&&null==(p=t(p,l++))||i.push(p)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return o(t[e])})).join(e)}))}function a(t){return t.map(o).join(e)}function o(e){return null==e?"":e instanceof Date?f(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,a=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=l(e);return function(r,i){return t(n(r),i,e)}}(e,t):l(e)}));return a.columns=i||[],a},parseRows:r,format:function(t,n){return null==n&&(n=c(t)),[n.map(o).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=c(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(a).join("\n")},formatRow:a,formatValue:o}}(",").parse;function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function y(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){m(a,r,i,o,s,"next",e)}function s(e){m(a,r,i,o,s,"throw",e)}o(void 0)}))}}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e,t,n){return t&&b(e.prototype,t),n&&b(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function S(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&T(e,t)}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function M(e,t,n){return(M=A()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&T(i,n.prototype),i}).apply(null,arguments)}function w(e){var t="function"==typeof Map?new Map:void 0;return(w=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return M(e,arguments,C(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),T(r,e)})(e)}function k(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return O(e)}function R(e){var t=A();return function(){var n,r=C(e);if(t){var i=C(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return P(this,n)}}function L(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=C(e)););return e}function I(){return(I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=L(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}}).apply(this,arguments)}function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}(e,t)||F(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e){return function(e){if(Array.isArray(e))return B(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||F(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){if(e){if("string"==typeof e)return B(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?B(e,t):void 0}}function B(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function U(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=F(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function z(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function j(e,t,n,r,i){var a={};return Object.keys(r).forEach((function(e){a[e]=r[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),a),i&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}var V="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function G(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function H(e,t){return e(t={exports:{}},t.exports),t.exports}var W,X,Y=function(e){return e&&e.Math==Math&&e},Z=Y("object"==typeof globalThis&&globalThis)||Y("object"==typeof window&&window)||Y("object"==typeof self&&self)||Y("object"==typeof V&&V)||function(){return this}()||Function("return this")(),q=Object.defineProperty,K=function(e,t){try{q(Z,e,{value:t,configurable:!0,writable:!0})}catch(n){Z[e]=t}return t},Q=Z["__core-js_shared__"]||K("__core-js_shared__",{}),J=H((function(e){(e.exports=function(e,t){return Q[e]||(Q[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.21.1",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.21.1/LICENSE",source:"https://github.com/zloirock/core-js"})})),$=function(e){try{return!!e()}catch(e){return!0}},ee=!$((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),te=Function.prototype,ne=te.bind,re=te.call,ie=ee&&ne.bind(re,re),ae=ee?function(e){return e&&ie(e)}:function(e){return e&&function(){return re.apply(e,arguments)}},oe=Z.TypeError,se=function(e){if(null==e)throw oe("Can't call method on "+e);return e},ue=Z.Object,le=function(e){return ue(se(e))},ce=ae({}.hasOwnProperty),he=Object.hasOwn||function(e,t){return ce(le(e),t)},fe=0,pe=Math.random(),de=ae(1..toString),ve=function(e){return"Symbol("+(void 0===e?"":e)+")_"+de(++fe+pe,36)},ge=function(e){return"function"==typeof e},me=function(e){return ge(e)?e:void 0},ye=function(e,t){return arguments.length<2?me(Z[e]):Z[e]&&Z[e][t]},_e=ye("navigator","userAgent")||"",be=Z.process,xe=Z.Deno,Ee=be&&be.versions||xe&&xe.version,Se=Ee&&Ee.v8;Se&&(X=(W=Se.split("."))[0]>0&&W[0]<4?1:+(W[0]+W[1])),!X&&_e&&(!(W=_e.match(/Edge\/(\d+)/))||W[1]>=74)&&(W=_e.match(/Chrome\/(\d+)/))&&(X=+W[1]);var Ce=X,Te=!!Object.getOwnPropertySymbols&&!$((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ce&&Ce<41})),Ae=Te&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Me=J("wks"),we=Z.Symbol,ke=we&&we.for,Oe=Ae?we:we&&we.withoutSetter||ve,Pe=function(e){if(!he(Me,e)||!Te&&"string"!=typeof Me[e]){var t="Symbol."+e;Te&&he(we,e)?Me[e]=we[e]:Me[e]=Ae&&ke?ke(t):Oe(t)}return Me[e]},Re={};Re[Pe("toStringTag")]="z";var Le="[object z]"===String(Re),Ie=!$((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),Ne=function(e){return"object"==typeof e?null!==e:ge(e)},De=Z.document,Fe=Ne(De)&&Ne(De.createElement),Be=function(e){return Fe?De.createElement(e):{}},Ue=!Ie&&!$((function(){return 7!=Object.defineProperty(Be("div"),"a",{get:function(){return 7}}).a})),ze=Ie&&$((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),je=Z.String,Ve=Z.TypeError,Ge=function(e){if(Ne(e))return e;throw Ve(je(e)+" is not an object")},He=Function.prototype.call,We=ee?He.bind(He):function(){return He.apply(He,arguments)},Xe=ae({}.isPrototypeOf),Ye=Z.Object,Ze=Ae?function(e){return"symbol"==typeof e}:function(e){var t=ye("Symbol");return ge(t)&&Xe(t.prototype,Ye(e))},qe=Z.String,Ke=function(e){try{return qe(e)}catch(e){return"Object"}},Qe=Z.TypeError,Je=function(e){if(ge(e))return e;throw Qe(Ke(e)+" is not a function")},$e=function(e,t){var n=e[t];return null==n?void 0:Je(n)},et=Z.TypeError,tt=Z.TypeError,nt=Pe("toPrimitive"),rt=function(e,t){if(!Ne(e)||Ze(e))return e;var n,r=$e(e,nt);if(r){if(void 0===t&&(t="default"),n=We(r,e,t),!Ne(n)||Ze(n))return n;throw tt("Can't convert object to primitive value")}return void 0===t&&(t="number"),function(e,t){var n,r;if("string"===t&&ge(n=e.toString)&&!Ne(r=We(n,e)))return r;if(ge(n=e.valueOf)&&!Ne(r=We(n,e)))return r;if("string"!==t&&ge(n=e.toString)&&!Ne(r=We(n,e)))return r;throw et("Can't convert object to primitive value")}(e,t)},it=function(e){var t=rt(e,"string");return Ze(t)?t:t+""},at=Z.TypeError,ot=Object.defineProperty,st=Object.getOwnPropertyDescriptor,ut={f:Ie?ze?function(e,t,n){if(Ge(e),t=it(t),Ge(n),"function"==typeof e&&"prototype"===t&&"value"in n&&"writable"in n&&!n.writable){var r=st(e,t);r&&r.writable&&(e[t]=n.value,n={configurable:"configurable"in n?n.configurable:r.configurable,enumerable:"enumerable"in n?n.enumerable:r.enumerable,writable:!1})}return ot(e,t,n)}:ot:function(e,t,n){if(Ge(e),t=it(t),Ge(n),Ue)try{return ot(e,t,n)}catch(e){}if("get"in n||"set"in n)throw at("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},lt=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},ct=Ie?function(e,t,n){return ut.f(e,t,lt(1,n))}:function(e,t,n){return e[t]=n,e},ht=ae(Function.toString);ge(Q.inspectSource)||(Q.inspectSource=function(e){return ht(e)});var ft,pt,dt,vt=Q.inspectSource,gt=Z.WeakMap,mt=ge(gt)&&/native code/.test(vt(gt)),yt=J("keys"),_t=function(e){return yt[e]||(yt[e]=ve(e))},bt={},xt=Z.TypeError,Et=Z.WeakMap;if(mt||Q.state){var St=Q.state||(Q.state=new Et),Ct=ae(St.get),Tt=ae(St.has),At=ae(St.set);ft=function(e,t){if(Tt(St,e))throw new xt("Object already initialized");return t.facade=e,At(St,e,t),t},pt=function(e){return Ct(St,e)||{}},dt=function(e){return Tt(St,e)}}else{var Mt=_t("state");bt[Mt]=!0,ft=function(e,t){if(he(e,Mt))throw new xt("Object already initialized");return t.facade=e,ct(e,Mt,t),t},pt=function(e){return he(e,Mt)?e[Mt]:{}},dt=function(e){return he(e,Mt)}}var wt={set:ft,get:pt,has:dt,enforce:function(e){return dt(e)?pt(e):ft(e,{})},getterFor:function(e){return function(t){var n;if(!Ne(t)||(n=pt(t)).type!==e)throw xt("Incompatible receiver, "+e+" required");return n}}},kt=Function.prototype,Ot=Ie&&Object.getOwnPropertyDescriptor,Pt=he(kt,"name"),Rt={EXISTS:Pt,PROPER:Pt&&"something"===function(){}.name,CONFIGURABLE:Pt&&(!Ie||Ie&&Ot(kt,"name").configurable)},Lt=H((function(e){var t=Rt.CONFIGURABLE,n=wt.get,r=wt.enforce,i=String(String).split("String");(e.exports=function(e,n,a,o){var s,u=!!o&&!!o.unsafe,l=!!o&&!!o.enumerable,c=!!o&&!!o.noTargetGet,h=o&&void 0!==o.name?o.name:n;ge(a)&&("Symbol("===String(h).slice(0,7)&&(h="["+String(h).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!he(a,"name")||t&&a.name!==h)&&ct(a,"name",h),(s=r(a)).source||(s.source=i.join("string"==typeof h?h:""))),e!==Z?(u?!c&&e[n]&&(l=!0):delete e[n],l?e[n]=a:ct(e,n,a)):l?e[n]=a:K(n,a)})(Function.prototype,"toString",(function(){return ge(this)&&n(this).source||vt(this)}))})),It=ae({}.toString),Nt=ae("".slice),Dt=function(e){return Nt(It(e),8,-1)},Ft=Pe("toStringTag"),Bt=Z.Object,Ut="Arguments"==Dt(function(){return arguments}()),zt=Le?Dt:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Bt(e),Ft))?n:Ut?Dt(t):"Object"==(r=Dt(t))&&ge(t.callee)?"Arguments":r},jt=Le?{}.toString:function(){return"[object "+zt(this)+"]"};Le||Lt(Object.prototype,"toString",jt,{unsafe:!0});var Vt={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Gt=Be("span").classList,Ht=Gt&&Gt.constructor&&Gt.constructor.prototype,Wt=Ht===Object.prototype?void 0:Ht,Xt=ae(ae.bind),Yt=function(e,t){return Je(e),void 0===t?e:ee?Xt(e,t):function(){return e.apply(t,arguments)}},Zt=Z.Object,qt=ae("".split),Kt=$((function(){return!Zt("z").propertyIsEnumerable(0)}))?function(e){return"String"==Dt(e)?qt(e,""):Zt(e)}:Zt,Qt=Math.ceil,Jt=Math.floor,$t=function(e){var t=+e;return t!=t||0===t?0:(t>0?Jt:Qt)(t)},en=Math.min,tn=function(e){return e>0?en($t(e),9007199254740991):0},nn=function(e){return tn(e.length)},rn=Array.isArray||function(e){return"Array"==Dt(e)},an=function(){},on=[],sn=ye("Reflect","construct"),un=/^\s*(?:class|function)\b/,ln=ae(un.exec),cn=!un.exec(an),hn=function(e){if(!ge(e))return!1;try{return sn(an,on,e),!0}catch(e){return!1}},fn=function(e){if(!ge(e))return!1;switch(zt(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return cn||!!ln(un,vt(e))}catch(e){return!0}};fn.sham=!0;var pn=!sn||$((function(){var e;return hn(hn.call)||!hn(Object)||!hn((function(){e=!0}))||e}))?fn:hn,dn=Pe("species"),vn=Z.Array,gn=function(e,t){return new(function(e){var t;return rn(e)&&(t=e.constructor,(pn(t)&&(t===vn||rn(t.prototype))||Ne(t)&&null===(t=t[dn]))&&(t=void 0)),void 0===t?vn:t}(e))(0===t?0:t)},mn=ae([].push),yn=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,a=6==e,o=7==e,s=5==e||a;return function(u,l,c,h){for(var f,p,d=le(u),v=Kt(d),g=Yt(l,c),m=nn(v),y=0,_=h||gn,b=t?_(u,m):n||o?_(u,0):void 0;m>y;y++)if((s||y in v)&&(p=g(f=v[y],y,d),e))if(t)b[y]=p;else if(p)switch(e){case 3:return!0;case 5:return f;case 6:return y;case 2:mn(b,f)}else switch(e){case 4:return!1;case 7:mn(b,f)}return a?-1:r||i?i:b}},_n={forEach:yn(0),map:yn(1),filter:yn(2),some:yn(3),every:yn(4),find:yn(5),findIndex:yn(6),filterReject:yn(7)},bn=function(e,t){var n=[][e];return!!n&&$((function(){n.call(null,t||function(){return 1},1)}))},xn=_n.forEach,En=bn("forEach")?[].forEach:function(e){return xn(this,e,arguments.length>1?arguments[1]:void 0)},Sn=function(e){if(e&&e.forEach!==En)try{ct(e,"forEach",En)}catch(t){e.forEach=En}};for(var Cn in Vt)Vt[Cn]&&Sn(Z[Cn]&&Z[Cn].prototype);Sn(Wt);var Tn={}.propertyIsEnumerable,An=Object.getOwnPropertyDescriptor,Mn={f:An&&!Tn.call({1:2},1)?function(e){var t=An(this,e);return!!t&&t.enumerable}:Tn},wn=function(e){return Kt(se(e))},kn=Object.getOwnPropertyDescriptor,On={f:Ie?kn:function(e,t){if(e=wn(e),t=it(t),Ue)try{return kn(e,t)}catch(e){}if(he(e,t))return lt(!We(Mn.f,e,t),e[t])}},Pn=Math.max,Rn=Math.min,Ln=function(e,t){var n=$t(e);return n<0?Pn(n+t,0):Rn(n,t)},In=function(e){return function(t,n,r){var i,a=wn(t),o=nn(a),s=Ln(r,o);if(e&&n!=n){for(;o>s;)if((i=a[s++])!=i)return!0}else for(;o>s;s++)if((e||s in a)&&a[s]===n)return e||s||0;return!e&&-1}},Nn={includes:In(!0),indexOf:In(!1)},Dn=Nn.indexOf,Fn=ae([].push),Bn=function(e,t){var n,r=wn(e),i=0,a=[];for(n in r)!he(bt,n)&&he(r,n)&&Fn(a,n);for(;t.length>i;)he(r,n=t[i++])&&(~Dn(a,n)||Fn(a,n));return a},Un=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],zn=Un.concat("length","prototype"),jn={f:Object.getOwnPropertyNames||function(e){return Bn(e,zn)}},Vn={f:Object.getOwnPropertySymbols},Gn=ae([].concat),Hn=ye("Reflect","ownKeys")||function(e){var t=jn.f(Ge(e)),n=Vn.f;return n?Gn(t,n(e)):t},Wn=function(e,t,n){for(var r=Hn(t),i=ut.f,a=On.f,o=0;o<r.length;o++){var s=r[o];he(e,s)||n&&he(n,s)||i(e,s,a(t,s))}},Xn=/#|\.prototype\./,Yn=function(e,t){var n=qn[Zn(e)];return n==Qn||n!=Kn&&(ge(t)?$(t):!!t)},Zn=Yn.normalize=function(e){return String(e).replace(Xn,".").toLowerCase()},qn=Yn.data={},Kn=Yn.NATIVE="N",Qn=Yn.POLYFILL="P",Jn=Yn,$n=On.f,er=function(e,t){var n,r,i,a,o,s=e.target,u=e.global,l=e.stat;if(n=u?Z:l?Z[s]||K(s,{}):(Z[s]||{}).prototype)for(r in t){if(a=t[r],i=e.noTargetGet?(o=$n(n,r))&&o.value:n[r],!Jn(u?r:s+(l?".":"#")+r,e.forced)&&void 0!==i){if(typeof a==typeof i)continue;Wn(a,i)}(e.sham||i&&i.sham)&&ct(a,"sham",!0),Lt(n,r,a,e)}},tr=Pe("species"),nr=function(e){return Ce>=51||!$((function(){var t=[];return(t.constructor={})[tr]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},rr=_n.map,ir=nr("map");er({target:"Array",proto:!0,forced:!ir},{map:function(e){return rr(this,e,arguments.length>1?arguments[1]:void 0)}});var ar=6378137;function or(e){var t=0;if(e&&e.length>0){t+=Math.abs(sr(e[0]));for(var n=1;n<e.length;n++)t-=Math.abs(sr(e[n]))}return t}function sr(e){var t,n,r,i,a,o,s=0,u=e.length;if(u>2){for(o=0;o<u;o++)o===u-2?(r=u-2,i=u-1,a=0):o===u-1?(r=u-1,i=0,a=1):(r=o,i=o+1,a=o+2),t=e[r],n=e[i],s+=(ur(e[a][0])-ur(t[0]))*Math.sin(ur(n[1]));s=s*ar*ar/2}return s}function ur(e){return e*Math.PI/180}var lr={geometry:function e(t){var n,r=0;switch(t.type){case"Polygon":return or(t.coordinates);case"MultiPolygon":for(n=0;n<t.coordinates.length;n++)r+=or(t.coordinates[n]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<t.geometries.length;n++)r+=e(t.geometries[n]);return r}},ring:sr},cr=function e(t,n){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.map(hr(e,n)),t;case"GeometryCollection":return t.geometries=t.geometries.map(hr(e,n)),t;case"Feature":return t.geometry=e(t.geometry,n),t;case"Polygon":case"MultiPolygon":return function(e,t){"Polygon"===e.type?e.coordinates=fr(e.coordinates,t):"MultiPolygon"===e.type&&(e.coordinates=e.coordinates.map(hr(fr,t)));return e}(t,n);default:return t}};function hr(e,t){return function(n){return e(n,t)}}function fr(e,t){t=!!t,e[0]=pr(e[0],t);for(var n=1;n<e.length;n++)e[n]=pr(e[n],!t);return e}function pr(e,t){return function(e){return lr.ring(e)>=0}(e)===t?e:e.reverse()}function dr(e,t){var n=t.x,r=t.y,i=t.x1,a=t.y1,o=t.coordinates,s=[];return e.forEach((function(e,t){var u=[];(n&&r&&(u=[parseFloat(e[n]),parseFloat(e[r])]),n&&r&&i&&a)&&(u=[[parseFloat(e[n]),parseFloat(e[r])],[parseFloat(e[i]),parseFloat(e[a])]]);if(o){var l="Polygon";Array.isArray(o[0])||(l="Point"),Array.isArray(o[0])&&!Array.isArray(o[0][0])&&(l="LineString");var c={type:l,coordinates:D(e[o])};cr(c,!0),u=c.coordinates}var h=v(v({},e),{},{_id:t,coordinates:u});s.push(h)})),{dataArray:s}}var vr=_n.filter,gr=nr("filter");er({target:"Array",proto:!0,forced:!gr},{filter:function(e){return vr(this,e,arguments.length>1?arguments[1]:void 0)}});var mr={centimeters:637100880,centimetres:637100880,degrees:6371008.8/111325,feet:20902260.511392,inches:6371008.8*39.37,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:6371008.8/1852,radians:1,yards:6371008.8*1.0936};function yr(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function _r(e){return e%360*Math.PI/180}function br(e,t){!function(e,t){var n,r,i,a,o,s,u,l,c,h,f=0,p="FeatureCollection"===e.type,d="Feature"===e.type,v=p?e.features.length:1;for(n=0;n<v;n++){for(s=p?e.features[n].geometry:d?e.geometry:e,l=p?e.features[n].properties:d?e.properties:{},c=p?e.features[n].bbox:d?e.bbox:void 0,h=p?e.features[n].id:d?e.id:void 0,o=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<o;i++)if(null!==(a=u?s.geometries[i]:s))switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(a,f,l,c,h))return!1;break;case"GeometryCollection":for(r=0;r<a.geometries.length;r++)if(!1===t(a.geometries[r],f,l,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,f,l,c,h))return!1;f++}}(e,(function(e,n,r,i,a){var o,s=null===e?null:e.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==t(yr(e,r,{bbox:i,id:a}),n,0)&&void 0}switch(s){case"MultiPoint":o="Point";break;case"MultiLineString":o="LineString";break;case"MultiPolygon":o="Polygon"}for(var u=0;u<e.coordinates.length;u++){var l=e.coordinates[u];if(!1===t(yr({type:o,coordinates:l},r),n,u))return!1}}))}var xr=Z.Promise,Er=function(e,t,n){for(var r in t)Lt(e,r,t[r],n);return e},Sr=Z.String,Cr=Z.TypeError,Tr=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=ae(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return Ge(n),function(e){if("object"==typeof e||ge(e))return e;throw Cr("Can't set "+Sr(e)+" as a prototype")}(r),t?e(n,r):n.__proto__=r,n}}():void 0),Ar=ut.f,Mr=Pe("toStringTag"),wr=function(e,t,n){e&&!n&&(e=e.prototype),e&&!he(e,Mr)&&Ar(e,Mr,{configurable:!0,value:t})},kr=Pe("species"),Or=function(e){var t=ye(e),n=ut.f;Ie&&t&&!t[kr]&&n(t,kr,{configurable:!0,get:function(){return this}})},Pr=Z.TypeError,Rr=function(e,t){if(Xe(t,e))return e;throw Pr("Incorrect invocation")},Lr={},Ir=Pe("iterator"),Nr=Array.prototype,Dr=function(e){return void 0!==e&&(Lr.Array===e||Nr[Ir]===e)},Fr=Pe("iterator"),Br=function(e){if(null!=e)return $e(e,Fr)||$e(e,"@@iterator")||Lr[zt(e)]},Ur=Z.TypeError,zr=function(e,t){var n=arguments.length<2?Br(e):t;if(Je(n))return Ge(We(n,e));throw Ur(Ke(e)+" is not iterable")},jr=function(e,t,n){var r,i;Ge(e);try{if(!(r=$e(e,"return"))){if("throw"===t)throw n;return n}r=We(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return Ge(r),n},Vr=Z.TypeError,Gr=function(e,t){this.stopped=e,this.result=t},Hr=Gr.prototype,Wr=function(e,t,n){var r,i,a,o,s,u,l,c=n&&n.that,h=!(!n||!n.AS_ENTRIES),f=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),d=Yt(t,c),v=function(e){return r&&jr(r,"normal",e),new Gr(!0,e)},g=function(e){return h?(Ge(e),p?d(e[0],e[1],v):d(e[0],e[1])):p?d(e,v):d(e)};if(f)r=e;else{if(!(i=Br(e)))throw Vr(Ke(e)+" is not iterable");if(Dr(i)){for(a=0,o=nn(e);o>a;a++)if((s=g(e[a]))&&Xe(Hr,s))return s;return new Gr(!1)}r=zr(e,i)}for(u=r.next;!(l=We(u,r)).done;){try{s=g(l.value)}catch(e){jr(r,"throw",e)}if("object"==typeof s&&s&&Xe(Hr,s))return s}return new Gr(!1)},Xr=Pe("iterator"),Yr=!1;try{var Zr=0,qr={next:function(){return{done:!!Zr++}},return:function(){Yr=!0}};qr[Xr]=function(){return this},Array.from(qr,(function(){throw 2}))}catch(e){}var Kr,Qr,Jr,$r,ei=function(e,t){if(!t&&!Yr)return!1;var n=!1;try{var r={};r[Xr]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},ti=Z.TypeError,ni=function(e){if(pn(e))return e;throw ti(Ke(e)+" is not a constructor")},ri=Pe("species"),ii=function(e,t){var n,r=Ge(e).constructor;return void 0===r||null==(n=Ge(r)[ri])?t:ni(n)},ai=Function.prototype,oi=ai.apply,si=ai.call,ui="object"==typeof Reflect&&Reflect.apply||(ee?si.bind(oi):function(){return si.apply(oi,arguments)}),li=ye("document","documentElement"),ci=ae([].slice),hi=Z.TypeError,fi=function(e,t){if(e<t)throw hi("Not enough arguments");return e},pi=/(?:ipad|iphone|ipod).*applewebkit/i.test(_e),di="process"==Dt(Z.process),vi=Z.setImmediate,gi=Z.clearImmediate,mi=Z.process,yi=Z.Dispatch,_i=Z.Function,bi=Z.MessageChannel,xi=Z.String,Ei=0,Si={};try{Kr=Z.location}catch(e){}var Ci=function(e){if(he(Si,e)){var t=Si[e];delete Si[e],t()}},Ti=function(e){return function(){Ci(e)}},Ai=function(e){Ci(e.data)},Mi=function(e){Z.postMessage(xi(e),Kr.protocol+"//"+Kr.host)};vi&&gi||(vi=function(e){fi(arguments.length,1);var t=ge(e)?e:_i(e),n=ci(arguments,1);return Si[++Ei]=function(){ui(t,void 0,n)},Qr(Ei),Ei},gi=function(e){delete Si[e]},di?Qr=function(e){mi.nextTick(Ti(e))}:yi&&yi.now?Qr=function(e){yi.now(Ti(e))}:bi&&!pi?($r=(Jr=new bi).port2,Jr.port1.onmessage=Ai,Qr=Yt($r.postMessage,$r)):Z.addEventListener&&ge(Z.postMessage)&&!Z.importScripts&&Kr&&"file:"!==Kr.protocol&&!$(Mi)?(Qr=Mi,Z.addEventListener("message",Ai,!1)):Qr="onreadystatechange"in Be("script")?function(e){li.appendChild(Be("script")).onreadystatechange=function(){li.removeChild(this),Ci(e)}}:function(e){setTimeout(Ti(e),0)});var wi,ki,Oi,Pi,Ri,Li,Ii,Ni,Di={set:vi,clear:gi},Fi=/ipad|iphone|ipod/i.test(_e)&&void 0!==Z.Pebble,Bi=/web0s(?!.*chrome)/i.test(_e),Ui=On.f,zi=Di.set,ji=Z.MutationObserver||Z.WebKitMutationObserver,Vi=Z.document,Gi=Z.process,Hi=Z.Promise,Wi=Ui(Z,"queueMicrotask"),Xi=Wi&&Wi.value;Xi||(wi=function(){var e,t;for(di&&(e=Gi.domain)&&e.exit();ki;){t=ki.fn,ki=ki.next;try{t()}catch(e){throw ki?Pi():Oi=void 0,e}}Oi=void 0,e&&e.enter()},pi||di||Bi||!ji||!Vi?!Fi&&Hi&&Hi.resolve?((Ii=Hi.resolve(void 0)).constructor=Hi,Ni=Yt(Ii.then,Ii),Pi=function(){Ni(wi)}):di?Pi=function(){Gi.nextTick(wi)}:(zi=Yt(zi,Z),Pi=function(){zi(wi)}):(Ri=!0,Li=Vi.createTextNode(""),new ji(wi).observe(Li,{characterData:!0}),Pi=function(){Li.data=Ri=!Ri}));var Yi=Xi||function(e){var t={fn:e,next:void 0};Oi&&(Oi.next=t),ki||(ki=t,Pi()),Oi=t},Zi=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=Je(t),this.reject=Je(n)},qi={f:function(e){return new Zi(e)}},Ki=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Qi=function(){this.head=null,this.tail=null};Qi.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var Ji,$i,ea,ta,na=Qi,ra="object"==typeof window,ia=Di.set,aa=Pe("species"),oa="Promise",sa=wt.getterFor(oa),ua=wt.set,la=wt.getterFor(oa),ca=xr&&xr.prototype,ha=xr,fa=ca,pa=Z.TypeError,da=Z.document,va=Z.process,ga=qi.f,ma=ga,ya=!!(da&&da.createEvent&&Z.dispatchEvent),_a=ge(Z.PromiseRejectionEvent),ba=!1,xa=Jn(oa,(function(){var e=vt(ha),t=e!==String(ha);if(!t&&66===Ce)return!0;if(Ce>=51&&/native code/.test(e))return!1;var n=new ha((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(n.constructor={})[aa]=r,!(ba=n.then((function(){}))instanceof r)||!t&&ra&&!_a})),Ea=xa||!ei((function(e){ha.all(e).catch((function(){}))})),Sa=function(e){var t;return!(!Ne(e)||!ge(t=e.then))&&t},Ca=function(e,t){var n,r,i,a=t.value,o=1==t.state,s=o?e.ok:e.fail,u=e.resolve,l=e.reject,c=e.domain;try{s?(o||(2===t.rejection&&ka(t),t.rejection=1),!0===s?n=a:(c&&c.enter(),n=s(a),c&&(c.exit(),i=!0)),n===e.promise?l(pa("Promise-chain cycle")):(r=Sa(n))?We(r,n,u,l):u(n)):l(a)}catch(e){c&&!i&&c.exit(),l(e)}},Ta=function(e,t){e.notified||(e.notified=!0,Yi((function(){for(var n,r=e.reactions;n=r.get();)Ca(n,e);e.notified=!1,t&&!e.rejection&&Ma(e)})))},Aa=function(e,t,n){var r,i;ya?((r=da.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Z.dispatchEvent(r)):r={promise:t,reason:n},!_a&&(i=Z["on"+e])?i(r):"unhandledrejection"===e&&function(e,t){var n=Z.console;n&&n.error&&(1==arguments.length?n.error(e):n.error(e,t))}("Unhandled promise rejection",n)},Ma=function(e){We(ia,Z,(function(){var t,n=e.facade,r=e.value;if(wa(e)&&(t=Ki((function(){di?va.emit("unhandledRejection",r,n):Aa("unhandledrejection",n,r)})),e.rejection=di||wa(e)?2:1,t.error))throw t.value}))},wa=function(e){return 1!==e.rejection&&!e.parent},ka=function(e){We(ia,Z,(function(){var t=e.facade;di?va.emit("rejectionHandled",t):Aa("rejectionhandled",t,e.value)}))},Oa=function(e,t,n){return function(r){e(t,r,n)}},Pa=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,Ta(e,!0))},Ra=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw pa("Promise can't be resolved itself");var r=Sa(t);r?Yi((function(){var n={done:!1};try{We(r,t,Oa(Ra,n,e),Oa(Pa,n,e))}catch(t){Pa(n,t,e)}})):(e.value=t,e.state=1,Ta(e,!1))}catch(t){Pa({done:!1},t,e)}}};if(xa&&(fa=(ha=function(e){Rr(this,fa),Je(e),We(Ji,this);var t=sa(this);try{e(Oa(Ra,t),Oa(Pa,t))}catch(e){Pa(t,e)}}).prototype,(Ji=function(e){ua(this,{type:oa,done:!1,notified:!1,parent:!1,reactions:new na,rejection:!1,state:0,value:void 0})}).prototype=Er(fa,{then:function(e,t){var n=la(this),r=ga(ii(this,ha));return n.parent=!0,r.ok=!ge(e)||e,r.fail=ge(t)&&t,r.domain=di?va.domain:void 0,0==n.state?n.reactions.add(r):Yi((function(){Ca(r,n)})),r.promise},catch:function(e){return this.then(void 0,e)}}),$i=function(){var e=new Ji,t=sa(e);this.promise=e,this.resolve=Oa(Ra,t),this.reject=Oa(Pa,t)},qi.f=ga=function(e){return e===ha||e===ea?new $i(e):ma(e)},ge(xr)&&ca!==Object.prototype)){ta=ca.then,ba||(Lt(ca,"then",(function(e,t){var n=this;return new ha((function(e,t){We(ta,n,e,t)})).then(e,t)}),{unsafe:!0}),Lt(ca,"catch",fa.catch,{unsafe:!0}));try{delete ca.constructor}catch(e){}Tr&&Tr(ca,fa)}er({global:!0,wrap:!0,forced:xa},{Promise:ha}),wr(ha,oa,!1),Or(oa),ea=ye(oa),er({target:oa,stat:!0,forced:xa},{reject:function(e){var t=ga(this);return We(t.reject,void 0,e),t.promise}}),er({target:oa,stat:!0,forced:xa},{resolve:function(e){return function(e,t){if(Ge(e),Ne(t)&&t.constructor===e)return t;var n=qi.f(e);return(0,n.resolve)(t),n.promise}(this,e)}}),er({target:oa,stat:!0,forced:Ea},{all:function(e){var t=this,n=ga(t),r=n.resolve,i=n.reject,a=Ki((function(){var n=Je(t.resolve),a=[],o=0,s=1;Wr(e,(function(e){var u=o++,l=!1;s++,We(n,t,e).then((function(e){l||(l=!0,a[u]=e,--s||r(a))}),i)})),--s||r(a)}));return a.error&&i(a.value),n.promise},race:function(e){var t=this,n=ga(t),r=n.reject,i=Ki((function(){var i=Je(t.resolve);Wr(e,(function(e){We(i,t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var La=Z.String,Ia=function(e){if("Symbol"===zt(e))throw TypeError("Cannot convert a Symbol value to a string");return La(e)},Na=function(){var e=Ge(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},Da=Rt.PROPER,Fa=RegExp.prototype,Ba=Fa.toString,Ua=ae(Na),za=$((function(){return"/a/b"!=Ba.call({source:"a",flags:"b"})})),ja=Da&&"toString"!=Ba.name;(za||ja)&&Lt(RegExp.prototype,"toString",(function(){var e=Ge(this),t=Ia(e.source),n=e.flags;return"/"+t+"/"+Ia(void 0===n&&Xe(Fa,e)&&!("flags"in Fa)?Ua(e):n)}),{unsafe:!0});var Va,Ga="\t\n\v\f\r                　\u2028\u2029\ufeff",Ha=ae("".replace),Wa="["+Ga+"]",Xa=RegExp("^"+Wa+Wa+"*"),Ya=RegExp(Wa+Wa+"*$"),Za=function(e){return function(t){var n=Ia(se(t));return 1&e&&(n=Ha(n,Xa,"")),2&e&&(n=Ha(n,Ya,"")),n}},qa={start:Za(1),end:Za(2),trim:Za(3)},Ka=Rt.PROPER,Qa=qa.trim;er({target:"String",proto:!0,forced:(Va="trim",$((function(){return!!Ga[Va]()||"​᠎"!=="​᠎"[Va]()||Ka&&Ga[Va].name!==Va})))},{trim:function(){return Qa(this)}});var Ja,$a=Z.RegExp,eo=$((function(){var e=$a("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),to=eo||$((function(){return!$a("a","y").sticky})),no={BROKEN_CARET:eo||$((function(){var e=$a("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),MISSED_STICKY:to,UNSUPPORTED_Y:eo},ro=Object.keys||function(e){return Bn(e,Un)},io={f:Ie&&!ze?Object.defineProperties:function(e,t){Ge(e);for(var n,r=wn(t),i=ro(t),a=i.length,o=0;a>o;)ut.f(e,n=i[o++],r[n]);return e}},ao=_t("IE_PROTO"),oo=function(){},so=function(e){return"<script>"+e+"<\/script>"},uo=function(e){e.write(so("")),e.close();var t=e.parentWindow.Object;return e=null,t},lo=function(){try{Ja=new ActiveXObject("htmlfile")}catch(e){}var e,t;lo="undefined"!=typeof document?document.domain&&Ja?uo(Ja):((t=Be("iframe")).style.display="none",li.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(so("document.F=Object")),e.close(),e.F):uo(Ja);for(var n=Un.length;n--;)delete lo.prototype[Un[n]];return lo()};bt[ao]=!0;var co=Object.create||function(e,t){var n;return null!==e?(oo.prototype=Ge(e),n=new oo,oo.prototype=null,n[ao]=e):n=lo(),void 0===t?n:io.f(n,t)},ho=Z.RegExp,fo=$((function(){var e=ho(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),po=Z.RegExp,vo=$((function(){var e=po("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),go=wt.get,mo=J("native-string-replace",String.prototype.replace),yo=RegExp.prototype.exec,_o=yo,bo=ae("".charAt),xo=ae("".indexOf),Eo=ae("".replace),So=ae("".slice),Co=function(){var e=/a/,t=/b*/g;return We(yo,e,"a"),We(yo,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),To=no.BROKEN_CARET,Ao=void 0!==/()??/.exec("")[1];(Co||Ao||To||fo||vo)&&(_o=function(e){var t,n,r,i,a,o,s,u=this,l=go(u),c=Ia(e),h=l.raw;if(h)return h.lastIndex=u.lastIndex,t=We(_o,h,c),u.lastIndex=h.lastIndex,t;var f=l.groups,p=To&&u.sticky,d=We(Na,u),v=u.source,g=0,m=c;if(p&&(d=Eo(d,"y",""),-1===xo(d,"g")&&(d+="g"),m=So(c,u.lastIndex),u.lastIndex>0&&(!u.multiline||u.multiline&&"\n"!==bo(c,u.lastIndex-1))&&(v="(?: "+v+")",m=" "+m,g++),n=new RegExp("^(?:"+v+")",d)),Ao&&(n=new RegExp("^"+v+"$(?!\\s)",d)),Co&&(r=u.lastIndex),i=We(yo,p?n:u,m),p?i?(i.input=So(i.input,g),i[0]=So(i[0],g),i.index=u.lastIndex,u.lastIndex+=i[0].length):u.lastIndex=0:Co&&i&&(u.lastIndex=u.global?i.index+i[0].length:r),Ao&&i&&i.length>1&&We(mo,i[0],n,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(i[a]=void 0)})),i&&f)for(i.groups=o=co(null),a=0;a<f.length;a++)o[(s=f[a])[0]]=i[s[1]];return i});var Mo=_o;er({target:"RegExp",proto:!0,forced:/./.exec!==Mo},{exec:Mo});var wo=Pe("species"),ko=RegExp.prototype,Oo=function(e,t,n,r){var i=Pe(e),a=!$((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),o=a&&!$((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[wo]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!a||!o||n){var s=ae(/./[i]),u=t(i,""[e],(function(e,t,n,r,i){var o=ae(e),u=t.exec;return u===Mo||u===ko.exec?a&&!i?{done:!0,value:s(t,n,r)}:{done:!0,value:o(n,t,r)}:{done:!1}}));Lt(String.prototype,e,u[0]),Lt(ko,i,u[1])}r&&ct(ko[i],"sham",!0)},Po=ae("".charAt),Ro=ae("".charCodeAt),Lo=ae("".slice),Io=function(e){return function(t,n){var r,i,a=Ia(se(t)),o=$t(n),s=a.length;return o<0||o>=s?e?"":void 0:(r=Ro(a,o))<55296||r>56319||o+1===s||(i=Ro(a,o+1))<56320||i>57343?e?Po(a,o):r:e?Lo(a,o,o+2):i-56320+(r-55296<<10)+65536}},No={codeAt:Io(!1),charAt:Io(!0)},Do=No.charAt,Fo=function(e,t,n){return t+(n?Do(e,t).length:1)},Bo=Math.floor,Uo=ae("".charAt),zo=ae("".replace),jo=ae("".slice),Vo=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Go=/\$([$&'`]|\d{1,2})/g,Ho=function(e,t,n,r,i,a){var o=n+e.length,s=r.length,u=Go;return void 0!==i&&(i=le(i),u=Vo),zo(a,u,(function(a,u){var l;switch(Uo(u,0)){case"$":return"$";case"&":return e;case"`":return jo(t,0,n);case"'":return jo(t,o);case"<":l=i[jo(u,1,-1)];break;default:var c=+u;if(0===c)return a;if(c>s){var h=Bo(c/10);return 0===h?a:h<=s?void 0===r[h-1]?Uo(u,1):r[h-1]+Uo(u,1):a}l=r[c-1]}return void 0===l?"":l}))},Wo=Z.TypeError,Xo=function(e,t){var n=e.exec;if(ge(n)){var r=We(n,e,t);return null!==r&&Ge(r),r}if("RegExp"===Dt(e))return We(Mo,e,t);throw Wo("RegExp#exec called on incompatible receiver")},Yo=Pe("replace"),Zo=Math.max,qo=Math.min,Ko=ae([].concat),Qo=ae([].push),Jo=ae("".indexOf),$o=ae("".slice),es="$0"==="a".replace(/./,"$0"),ts=!!/./[Yo]&&""===/./[Yo]("a","$0");Oo("replace",(function(e,t,n){var r=ts?"$":"$0";return[function(e,n){var r=se(this),i=null==e?void 0:$e(e,Yo);return i?We(i,e,r,n):We(t,Ia(r),e,n)},function(e,i){var a=Ge(this),o=Ia(e);if("string"==typeof i&&-1===Jo(i,r)&&-1===Jo(i,"$<")){var s=n(t,a,o,i);if(s.done)return s.value}var u=ge(i);u||(i=Ia(i));var l=a.global;if(l){var c=a.unicode;a.lastIndex=0}for(var h=[];;){var f=Xo(a,o);if(null===f)break;if(Qo(h,f),!l)break;""===Ia(f[0])&&(a.lastIndex=Fo(o,tn(a.lastIndex),c))}for(var p,d="",v=0,g=0;g<h.length;g++){for(var m=Ia((f=h[g])[0]),y=Zo(qo($t(f.index),o.length),0),_=[],b=1;b<f.length;b++)Qo(_,void 0===(p=f[b])?p:String(p));var x=f.groups;if(u){var E=Ko([m],_,y,o);void 0!==x&&Qo(E,x);var S=Ia(ui(i,void 0,E))}else S=Ho(m,o,y,_,x,i);y>=v&&(d+=$o(o,v,y)+S,v=y+m.length)}return d+$o(o,v)}]}),!!$((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!es||ts);var ns=Pe("match"),rs=function(e){var t;return Ne(e)&&(void 0!==(t=e[ns])?!!t:"RegExp"==Dt(e))},is=function(e,t,n){var r=it(t);r in e?ut.f(e,r,lt(0,n)):e[r]=n},as=Z.Array,os=Math.max,ss=function(e,t,n){for(var r=nn(e),i=Ln(t,r),a=Ln(void 0===n?r:n,r),o=as(os(a-i,0)),s=0;i<a;i++,s++)is(o,s,e[i]);return o.length=s,o},us=no.UNSUPPORTED_Y,ls=Math.min,cs=[].push,hs=ae(/./.exec),fs=ae(cs),ps=ae("".slice);Oo("split",(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=Ia(se(this)),i=void 0===n?4294967295:n>>>0;if(0===i)return[];if(void 0===e)return[r];if(!rs(e))return We(t,r,e,i);for(var a,o,s,u=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),c=0,h=new RegExp(e.source,l+"g");(a=We(Mo,h,r))&&!((o=h.lastIndex)>c&&(fs(u,ps(r,c,a.index)),a.length>1&&a.index<r.length&&ui(cs,u,ss(a,1)),s=a[0].length,c=o,u.length>=i));)h.lastIndex===a.index&&h.lastIndex++;return c===r.length?!s&&hs(h,"")||fs(u,""):fs(u,ps(r,c)),u.length>i?ss(u,0,i):u}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:We(t,this,e,n)}:t,[function(t,n){var i=se(this),a=null==t?void 0:$e(t,e);return a?We(a,t,i,n):We(r,Ia(i),t,n)},function(e,i){var a=Ge(this),o=Ia(e),s=n(r,a,o,i,r!==t);if(s.done)return s.value;var u=ii(a,RegExp),l=a.unicode,c=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(us?"g":"y"),h=new u(us?"^(?:"+a.source+")":a,c),f=void 0===i?4294967295:i>>>0;if(0===f)return[];if(0===o.length)return null===Xo(h,o)?[o]:[];for(var p=0,d=0,v=[];d<o.length;){h.lastIndex=us?0:d;var g,m=Xo(h,us?ps(o,d):o);if(null===m||(g=ls(tn(h.lastIndex+(us?d:0)),o.length))===p)d=Fo(o,d,l);else{if(fs(v,ps(o,p,d)),v.length===f)return v;for(var y=1;y<=m.length-1;y++)if(fs(v,m[y]),v.length===f)return v;d=p=g}}return fs(v,ps(o,p)),v}]}),!!$((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),us);var ds=function(e,t,n){var r,i;return Tr&&ge(r=t.constructor)&&r!==n&&Ne(i=r.prototype)&&i!==n.prototype&&Tr(e,i),e},vs=ut.f,gs=jn.f,ms=wt.enforce,ys=Pe("match"),_s=Z.RegExp,bs=_s.prototype,xs=Z.SyntaxError,Es=ae(Na),Ss=ae(bs.exec),Cs=ae("".charAt),Ts=ae("".replace),As=ae("".indexOf),Ms=ae("".slice),ws=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,ks=/a/g,Os=/a/g,Ps=new _s(ks)!==ks,Rs=no.MISSED_STICKY,Ls=no.UNSUPPORTED_Y,Is=Ie&&(!Ps||Rs||fo||vo||$((function(){return Os[ys]=!1,_s(ks)!=ks||_s(Os)==Os||"/a/i"!=_s(ks,"i")})));if(Jn("RegExp",Is)){for(var Ns=function(e,t){var n,r,i,a,o,s,u=Xe(bs,this),l=rs(e),c=void 0===t,h=[],f=e;if(!u&&l&&c&&e.constructor===Ns)return e;if((l||Xe(bs,e))&&(e=e.source,c&&(t="flags"in f?f.flags:Es(f))),e=void 0===e?"":Ia(e),t=void 0===t?"":Ia(t),f=e,fo&&"dotAll"in ks&&(r=!!t&&As(t,"s")>-1)&&(t=Ts(t,/s/g,"")),n=t,Rs&&"sticky"in ks&&(i=!!t&&As(t,"y")>-1)&&Ls&&(t=Ts(t,/y/g,"")),vo&&(e=(a=function(e){for(var t,n=e.length,r=0,i="",a=[],o={},s=!1,u=!1,l=0,c="";r<=n;r++){if("\\"===(t=Cs(e,r)))t+=Cs(e,++r);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:Ss(ws,Ms(e,r+1))&&(r+=2,u=!0),i+=t,l++;continue;case">"===t&&u:if(""===c||he(o,c))throw new xs("Invalid capture group name");o[c]=!0,a[a.length]=[c,l],u=!1,c="";continue}u?c+=t:i+=t}return[i,a]}(e))[0],h=a[1]),o=ds(_s(e,t),u?this:bs,Ns),(r||i||h.length)&&(s=ms(o),r&&(s.dotAll=!0,s.raw=Ns(function(e){for(var t,n=e.length,r=0,i="",a=!1;r<=n;r++)"\\"!==(t=Cs(e,r))?a||"."!==t?("["===t?a=!0:"]"===t&&(a=!1),i+=t):i+="[\\s\\S]":i+=t+Cs(e,++r);return i}(e),n)),i&&(s.sticky=!0),h.length&&(s.groups=h)),e!==f)try{ct(o,"source",""===f?"(?:)":f)}catch(e){}return o},Ds=function(e){e in Ns||vs(Ns,e,{configurable:!0,get:function(){return _s[e]},set:function(t){_s[e]=t}})},Fs=gs(_s),Bs=0;Fs.length>Bs;)Ds(Fs[Bs++]);bs.constructor=Ns,Ns.prototype=bs,Lt(Z,"RegExp",Ns)}Or("RegExp");var Us=ae([].join),zs=Kt!=Object,js=bn("join",",");er({target:"Array",proto:!0,forced:zs||!js},{join:function(e){return Us(wn(this),void 0===e?",":e)}});var Vs=Pe("unscopables"),Gs=Array.prototype;null==Gs[Vs]&&ut.f(Gs,Vs,{configurable:!0,value:co(null)});var Hs=function(e){Gs[Vs][e]=!0},Ws=_n.find,Xs=!0;"find"in[]&&Array(1).find((function(){Xs=!1})),er({target:"Array",proto:!0,forced:Xs},{find:function(e){return Ws(this,e,arguments.length>1?arguments[1]:void 0)}}),Hs("find");var Ys=Rt.EXISTS,Zs=ut.f,qs=Function.prototype,Ks=ae(qs.toString),Qs=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,Js=ae(Qs.exec);Ie&&!Ys&&Zs(qs,"name",{configurable:!0,get:function(){try{return Js(Qs,Ks(this))[1]}catch(e){return""}}});var $s=nr("slice"),eu=Pe("species"),tu=Z.Array,nu=Math.max;er({target:"Array",proto:!0,forced:!$s},{slice:function(e,t){var n,r,i,a=wn(this),o=nn(a),s=Ln(e,o),u=Ln(void 0===t?o:t,o);if(rn(a)&&(n=a.constructor,(pn(n)&&(n===tu||rn(n.prototype))||Ne(n)&&null===(n=n[eu]))&&(n=void 0),n===tu||void 0===n))return ci(a,s,u);for(r=new(void 0===n?tu:n)(nu(u-s,0)),i=0;s<u;s++,i++)s in a&&is(r,i,a[s]);return r.length=i,r}});var ru="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function iu(e){this.message=e}function au(e){for(var t,n,r,i,a="",o=0,s=(e=String(e)).length%3;o<e.length;){if((n=e.charCodeAt(o++))>255||(r=e.charCodeAt(o++))>255||(i=e.charCodeAt(o++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");a+=ru.charAt((t=n<<16|r<<8|i)>>18&63)+ru.charAt(t>>12&63)+ru.charAt(t>>6&63)+ru.charAt(63&t)}return s?a.slice(0,s-3)+"===".substring(s):a}iu.prototype=new Error,iu.prototype.name="InvalidCharacterError";var ou,su=function(){function e(t,n){_(this,e),this.buffers=t,this.type=n}return x(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(e,t,n){throw new Error("not implemented")}}]),e}();ou="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(e){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(e){return null},clearMeasures:function(e){return null},clearMarks:function(e){return null},measure:function(e,t,n){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(e){return!0},Event:function(e,t){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window;var uu="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:ou.devicePixelRatio,lu=nr("splice"),cu=Z.TypeError,hu=Math.max,fu=Math.min;er({target:"Array",proto:!0,forced:!lu},{splice:function(e,t){var n,r,i,a,o,s,u=le(this),l=nn(u),c=Ln(e,l),h=arguments.length;if(0===h?n=r=0:1===h?(n=0,r=l-c):(n=h-2,r=fu(hu($t(t),0),l-c)),l+n-r>9007199254740991)throw cu("Maximum allowed length exceeded");for(i=gn(u,r),a=0;a<r;a++)(o=c+a)in u&&is(i,a,u[o]);if(i.length=r,n<r){for(a=c;a<l-r;a++)s=a+n,(o=a+r)in u?u[s]=u[o]:delete u[s];for(a=l;a>l-r+n;a--)delete u[a-1]}else if(n>r)for(a=l-r;a>c;a--)s=a+n-1,(o=a+r-1)in u?u[s]=u[o]:delete u[s];for(a=0;a<n;a++)u[a+c]=arguments[a+2];return u.length=l-r+n,i}});var pu=x((function e(t,n){_(this,e),E(this,"cancelBubble",void 0),E(this,"cancelable",void 0),E(this,"target",void 0),E(this,"currentTarget",void 0),E(this,"preventDefault",void 0),E(this,"stopPropagation",void 0),E(this,"type",void 0),E(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=t,this.timeStamp=Date.now()})),du=Object.assign,vu=Object.defineProperty,gu=ae([].concat),mu=!du||$((function(){if(Ie&&1!==du({b:1},du(vu({},"a",{enumerable:!0,get:function(){vu(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=du({},e)[n]||"abcdefghijklmnopqrst"!=ro(du({},t)).join("")}))?function(e,t){for(var n=le(e),r=arguments.length,i=1,a=Vn.f,o=Mn.f;r>i;)for(var s,u=Kt(arguments[i++]),l=a?gu(ro(u),a(u)):ro(u),c=l.length,h=0;c>h;)s=l[h++],Ie&&!We(o,u,s)||(n[s]=u[s]);return n}:du;er({target:"Object",stat:!0,forced:Object.assign!==mu},{assign:mu});var yu=_n.findIndex,_u=!0;"findIndex"in[]&&Array(1).findIndex((function(){_u=!1})),er({target:"Array",proto:!0,forced:_u},{findIndex:function(e){return yu(this,e,arguments.length>1?arguments[1]:void 0)}}),Hs("findIndex");var bu,xu,Eu,Su=!$((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Cu=_t("IE_PROTO"),Tu=Z.Object,Au=Tu.prototype,Mu=Su?Tu.getPrototypeOf:function(e){var t=le(e);if(he(t,Cu))return t[Cu];var n=t.constructor;return ge(n)&&t instanceof n?n.prototype:t instanceof Tu?Au:null},wu=Pe("iterator"),ku=!1;[].keys&&("next"in(Eu=[].keys())?(xu=Mu(Mu(Eu)))!==Object.prototype&&(bu=xu):ku=!0),(null==bu||$((function(){var e={};return bu[wu].call(e)!==e})))&&(bu={}),ge(bu[wu])||Lt(bu,wu,(function(){return this}));var Ou={IteratorPrototype:bu,BUGGY_SAFARI_ITERATORS:ku},Pu=Ou.IteratorPrototype,Ru=function(){return this},Lu=function(e,t,n,r){var i=t+" Iterator";return e.prototype=co(Pu,{next:lt(+!r,n)}),wr(e,i,!1),Lr[i]=Ru,e},Iu=Rt.PROPER,Nu=Rt.CONFIGURABLE,Du=Ou.IteratorPrototype,Fu=Ou.BUGGY_SAFARI_ITERATORS,Bu=Pe("iterator"),Uu=function(){return this},zu=function(e,t,n,r,i,a,o){Lu(n,t,r);var s,u,l,c=function(e){if(e===i&&v)return v;if(!Fu&&e in p)return p[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},h=t+" Iterator",f=!1,p=e.prototype,d=p[Bu]||p["@@iterator"]||i&&p[i],v=!Fu&&d||c(i),g="Array"==t&&p.entries||d;if(g&&(s=Mu(g.call(new e)))!==Object.prototype&&s.next&&(Mu(s)!==Du&&(Tr?Tr(s,Du):ge(s[Bu])||Lt(s,Bu,Uu)),wr(s,h,!0)),Iu&&"values"==i&&d&&"values"!==d.name&&(Nu?ct(p,"name","values"):(f=!0,v=function(){return We(d,this)})),i)if(u={values:c("values"),keys:a?v:c("keys"),entries:c("entries")},o)for(l in u)(Fu||f||!(l in p))&&Lt(p,l,u[l]);else er({target:t,proto:!0,forced:Fu||f},u);return p[Bu]!==v&&Lt(p,Bu,v,{name:i}),Lr[t]=v,u},ju=ut.f,Vu=wt.set,Gu=wt.getterFor("Array Iterator"),Hu=zu(Array,"Array",(function(e,t){Vu(this,{type:"Array Iterator",target:wn(e),index:0,kind:t})}),(function(){var e=Gu(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values"),Wu=Lr.Arguments=Lr.Array;if(Hs("keys"),Hs("values"),Hs("entries"),Ie&&"values"!==Wu.name)try{ju(Wu,"name",{value:"values"})}catch(e){}var Xu=No.charAt,Yu=wt.set,Zu=wt.getterFor("String Iterator");zu(String,"String",(function(e){Yu(this,{type:"String Iterator",string:Ia(e),index:0})}),(function(){var e,t=Zu(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=Xu(n,r),t.index+=e.length,{value:e,done:!1})}));var qu=jn.f,Ku="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Qu={f:function(e){return Ku&&"Window"==Dt(e)?function(e){try{return qu(e)}catch(e){return ss(Ku)}}(e):qu(wn(e))}},Ju=$((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),$u=Object.isExtensible,el=$((function(){$u(1)}))||Ju?function(e){return!!Ne(e)&&((!Ju||"ArrayBuffer"!=Dt(e))&&(!$u||$u(e)))}:$u,tl=!$((function(){return Object.isExtensible(Object.preventExtensions({}))})),nl=H((function(e){var t=ut.f,n=!1,r=ve("meta"),i=0,a=function(e){t(e,r,{value:{objectID:"O"+i++,weakData:{}}})},o=e.exports={enable:function(){o.enable=function(){},n=!0;var e=jn.f,t=ae([].splice),i={};i[r]=1,e(i).length&&(jn.f=function(n){for(var i=e(n),a=0,o=i.length;a<o;a++)if(i[a]===r){t(i,a,1);break}return i},er({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Qu.f}))},fastKey:function(e,t){if(!Ne(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!he(e,r)){if(!el(e))return"F";if(!t)return"E";a(e)}return e[r].objectID},getWeakData:function(e,t){if(!he(e,r)){if(!el(e))return!0;if(!t)return!1;a(e)}return e[r].weakData},onFreeze:function(e){return tl&&n&&el(e)&&!he(e,r)&&a(e),e}};bt[r]=!0})),rl=(nl.enable,nl.fastKey,nl.getWeakData,nl.onFreeze,function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),a=r?"set":"add",o=Z[e],s=o&&o.prototype,u=o,l={},c=function(e){var t=ae(s[e]);Lt(s,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!Ne(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return i&&!Ne(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!Ne(e))&&t(this,0===e?0:e)}:function(e,n){return t(this,0===e?0:e,n),this})};if(Jn(e,!ge(o)||!(i||s.forEach&&!$((function(){(new o).entries().next()})))))u=n.getConstructor(t,e,r,a),nl.enable();else if(Jn(e,!0)){var h=new u,f=h[a](i?{}:-0,1)!=h,p=$((function(){h.has(1)})),d=ei((function(e){new o(e)})),v=!i&&$((function(){for(var e=new o,t=5;t--;)e[a](t,t);return!e.has(-0)}));d||((u=t((function(e,t){Rr(e,s);var n=ds(new o,e,u);return null!=t&&Wr(t,n[a],{that:n,AS_ENTRIES:r}),n}))).prototype=s,s.constructor=u),(p||v)&&(c("delete"),c("has"),r&&c("get")),(v||f)&&c(a),i&&s.clear&&delete s.clear}return l[e]=u,er({global:!0,forced:u!=o},l),wr(u,e),i||n.setStrong(u,e,r),u}),il=nl.getWeakData,al=wt.set,ol=wt.getterFor,sl=_n.find,ul=_n.findIndex,ll=ae([].splice),cl=0,hl=function(e){return e.frozen||(e.frozen=new fl)},fl=function(){this.entries=[]},pl=function(e,t){return sl(e.entries,(function(e){return e[0]===t}))};fl.prototype={get:function(e){var t=pl(this,e);if(t)return t[1]},has:function(e){return!!pl(this,e)},set:function(e,t){var n=pl(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=ul(this.entries,(function(t){return t[0]===e}));return~t&&ll(this.entries,t,1),!!~t}};var dl,vl={getConstructor:function(e,t,n,r){var i=e((function(e,i){Rr(e,a),al(e,{type:t,id:cl++,frozen:void 0}),null!=i&&Wr(i,e[r],{that:e,AS_ENTRIES:n})})),a=i.prototype,o=ol(t),s=function(e,t,n){var r=o(e),i=il(Ge(t),!0);return!0===i?hl(r).set(t,n):i[r.id]=n,e};return Er(a,{delete:function(e){var t=o(this);if(!Ne(e))return!1;var n=il(e);return!0===n?hl(t).delete(e):n&&he(n,t.id)&&delete n[t.id]},has:function(e){var t=o(this);if(!Ne(e))return!1;var n=il(e);return!0===n?hl(t).has(e):n&&he(n,t.id)}}),Er(a,n?{get:function(e){var t=o(this);if(Ne(e)){var n=il(e);return!0===n?hl(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return s(this,e,t)}}:{add:function(e){return s(this,e,!0)}}),i}},gl=wt.enforce,ml=!Z.ActiveXObject&&"ActiveXObject"in Z,yl=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},_l=rl("WeakMap",yl,vl);if(mt&&ml){dl=vl.getConstructor(yl,"WeakMap",!0),nl.enable();var bl=_l.prototype,xl=ae(bl.delete),El=ae(bl.has),Sl=ae(bl.get),Cl=ae(bl.set);Er(bl,{delete:function(e){if(Ne(e)&&!el(e)){var t=gl(this);return t.frozen||(t.frozen=new dl),xl(this,e)||t.frozen.delete(e)}return xl(this,e)},has:function(e){if(Ne(e)&&!el(e)){var t=gl(this);return t.frozen||(t.frozen=new dl),El(this,e)||t.frozen.has(e)}return El(this,e)},get:function(e){if(Ne(e)&&!el(e)){var t=gl(this);return t.frozen||(t.frozen=new dl),El(this,e)?Sl(this,e):t.frozen.get(e)}return Sl(this,e)},set:function(e,t){if(Ne(e)&&!el(e)){var n=gl(this);n.frozen||(n.frozen=new dl),El(this,e)?Cl(this,e,t):n.frozen.set(e,t)}else Cl(this,e,t);return this}})}var Tl=Pe("iterator"),Al=Pe("toStringTag"),Ml=Hu.values,wl=function(e,t){if(e){if(e[Tl]!==Ml)try{ct(e,Tl,Ml)}catch(t){e[Tl]=Ml}if(e[Al]||ct(e,Al,t),Vt[t])for(var n in Hu)if(e[n]!==Hu[n])try{ct(e,n,Hu[n])}catch(t){e[n]=Hu[n]}}};for(var kl in Vt)wl(Z[kl]&&Z[kl].prototype,kl);wl(Wt,"DOMTokenList");var Ol,Pl,Rl,Ll,Il=new WeakMap,Nl=function(){function e(){_(this,e),Il.set(this,{})}return x(e,[{key:"addEventListener",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Il.get(this);r||(r={}),r[e]||(r[e]=[]),r[e].push(t),Il.set(this,r),n.capture,n.once,n.passive}},{key:"removeEventListener",value:function(e,t){var n=Il.get(this);if(n){var r=n[e];if(r&&r.length>0)for(var i=r.length;i--;i>0)if(r[i]===t){r.splice(i,1);break}}}},{key:"dispatchEvent",value:function(e){var t=Il.get(this)[e.type];if(t){var n,r=U(t);try{for(r.s();!(n=r.n()).done;){(0,n.value)(e)}}catch(e){r.e(e)}finally{r.f()}}}}]),e}(),Dl=function(e){S(n,e);var t=R(n);function n(){var e;return _(this,n),E(O(e=t.call(this)),"childNodes",void 0),e.childNodes=[],e}return x(n,[{key:"appendChild",value:function(e){this.childNodes.push(e)}},{key:"cloneNode",value:function(){var e=Object.create(this);return Object.assign(e,this),e}},{key:"removeChild",value:function(e){var t=this.childNodes.findIndex((function(t){return t===e}));return t>-1?this.childNodes.splice(t,1):null}}]),n}(Nl),Fl=function(e){S(n,e);var t=R(n);function n(){var e;return _(this,n),E(O(e=t.call(this)),"className",void 0),E(O(e),"children",void 0),e.className="",e.children=[],e}return x(n,[{key:"setAttribute",value:function(e,t){this[e]=t}},{key:"getAttribute",value:function(e){return this[e]}},{key:"setAttributeNS",value:function(e,t){this[e]=t}},{key:"getAttributeNS",value:function(e){return this[e]}}]),n}(Dl);if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Bl=my.getSystemInfoSync();Ol=Bl.screenWidth,Pl=Bl.screenHeight,Rl=Bl.windowWidth,Ll=Bl.windowHeight}else{var Ul=ou.innerWidth,zl=ou.innerHeight;Ol=Ul,Pl=zl,Rl=Ul,Ll=zl}var jl={width:Ol,height:Pl,availWidth:Rl,availHeight:Ll,availLeft:0,availTop:0},Vl=jl.availWidth,Gl=jl.availHeight,Hl={style:[]};function Wl(e,t){var n,r;"parentNode"in e||(n=0===t?function(){return null}:1===t?function(){return Hl}:function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:n}));"parentElement"in e||(r=0===t?function(){return null}:1===t?function(){return Hl}:function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:r}))}function Xl(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:Vl+"px",height:Gl+"px",margin:"0px",padding:"0px"})}function Yl(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=Vl,e.clientHeight=Gl),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function Zl(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=Vl,e.offsetHeight=Gl)}function ql(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=Vl,e.scrollHeight=Gl)}function Kl(e){var t=function(){return!0};e.classList=[],e.classList.add=t,e.classList.remove=t,e.classList.contains=t,e.classList.toggle=t}function Ql(){}var Jl=function(e){S(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0;return _(this,n),E(O(e=t.call(this)),"className",void 0),E(O(e),"children",void 0),E(O(e),"focus",void 0),E(O(e),"blur",void 0),E(O(e),"insertBefore",void 0),E(O(e),"appendChild",void 0),E(O(e),"removeChild",void 0),E(O(e),"remove",void 0),E(O(e),"innerHTML",void 0),E(O(e),"tagName",void 0),e.className="",e.children=[],e.focus=Ql,e.blur=Ql,e.insertBefore=Ql,e.appendChild=Ql,e.removeChild=Ql,e.remove=Ql,e.innerHTML="",e.tagName=r.toUpperCase(),Wl(O(e),i),Xl(O(e)),Kl(O(e)),Yl(O(e)),Zl(O(e)),ql(O(e)),e}return x(n)}(Fl),$l=function(e){S(n,e);var t=R(n);function n(e){return _(this,n),t.call(this,e)}return x(n,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),n}(Jl),ec=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.call(this,"video")}return x(n)}($l),tc={};function nc(){return tc}var rc=x((function e(){_(this,e);var t=nc(),n=t.createImage&&t.createImage()||{};return"tagName"in n||(n.tagName="IMG",n.__proto__=e.prototype),Wl(n),Kl(n),Object.assign(n,{addEventListener:function(e,t){n["on".concat(e)]=t.bind(n)},removeEventListener:function(e){n["on".concat(e)]=null}}),n})),ic={href:"",protocol:"",host:""},ac=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.call(this,"body",0)}return x(n,[{key:"addEventListener",value:function(e,t){}},{key:"removeEventListener",value:function(e,t,n){}},{key:"dispatchEvent",value:function(e){}}]),n}(Jl),oc=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.call(this,"html",0)}return x(n,[{key:"addEventListener",value:function(e,t){}},{key:"removeEventListener",value:function(e,t){}},{key:"dispatchEvent",value:function(e){}}]),n}(Jl),sc={},uc={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:ic,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(e){return"canvas"===(e=e.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===e?new rc:"video"===e?new ec:new Jl(e)},createElementNS:function(e,t){return this.createElement(t)},createTextNode:function(e){return e},getElementById:function(e){return null},getElementsByTagName:function(e){return e=e.toLowerCase(),[]},getElementsByTagNameNS:function(e,t){return this.getElementsByTagName(t)},getElementsByName:function(e){return[]},querySelector:function(e){return null},querySelectorAll:function(e){return[]},addEventListener:function(e,t,n){sc[e]||(sc[e]=[]),sc[e].push(t)},removeEventListener:function(e,t){var n=sc[e];if(n&&n.length>0)for(var r=n.length;r--;r>0)if(n[r]===t){n.splice(r,1);break}},dispatchEvent:function(e){var t=e.type,n=sc[t];if(n)for(var r=0;r<n.length;r++)n[r](e);e.target&&"function"==typeof e.target["on"+t]&&e.target["on"+t](e)},createEvent:function(e){return new pu(e)}};uc.documentElement=new oc,uc.head=new Jl("head"),uc.body=new ac;var lc,cc,hc,fc=Object,pc="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,dc=ut.f,vc=Z.Int8Array,gc=vc&&vc.prototype,mc=Z.Uint8ClampedArray,yc=mc&&mc.prototype,_c=vc&&Mu(vc),bc=gc&&Mu(gc),xc=Object.prototype,Ec=Z.TypeError,Sc=Pe("toStringTag"),Cc=ve("TYPED_ARRAY_TAG"),Tc=ve("TYPED_ARRAY_CONSTRUCTOR"),Ac=pc&&!!Tr&&"Opera"!==zt(Z.opera),Mc=!1,wc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},kc={BigInt64Array:8,BigUint64Array:8},Oc=function(e){if(!Ne(e))return!1;var t=zt(e);return he(wc,t)||he(kc,t)};for(lc in wc)(hc=(cc=Z[lc])&&cc.prototype)?ct(hc,Tc,cc):Ac=!1;for(lc in kc)(hc=(cc=Z[lc])&&cc.prototype)&&ct(hc,Tc,cc);if((!Ac||!ge(_c)||_c===Function.prototype)&&(_c=function(){throw Ec("Incorrect invocation")},Ac))for(lc in wc)Z[lc]&&Tr(Z[lc],_c);if((!Ac||!bc||bc===xc)&&(bc=_c.prototype,Ac))for(lc in wc)Z[lc]&&Tr(Z[lc].prototype,bc);if(Ac&&Mu(yc)!==bc&&Tr(yc,bc),Ie&&!he(bc,Sc))for(lc in Mc=!0,dc(bc,Sc,{get:function(){return Ne(this)?this[Cc]:void 0}}),wc)Z[lc]&&ct(Z[lc],Cc,lc);var Pc={NATIVE_ARRAY_BUFFER_VIEWS:Ac,TYPED_ARRAY_CONSTRUCTOR:Tc,TYPED_ARRAY_TAG:Mc&&Cc,aTypedArray:function(e){if(Oc(e))return e;throw Ec("Target is not a typed array")},aTypedArrayConstructor:function(e){if(ge(e)&&(!Tr||Xe(_c,e)))return e;throw Ec(Ke(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n,r){if(Ie){if(n)for(var i in wc){var a=Z[i];if(a&&he(a.prototype,e))try{delete a.prototype[e]}catch(n){try{a.prototype[e]=t}catch(e){}}}bc[e]&&!n||Lt(bc,e,n?t:Ac&&gc[e]||t,r)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(Ie){if(Tr){if(n)for(r in wc)if((i=Z[r])&&he(i,e))try{delete i[e]}catch(e){}if(_c[e]&&!n)return;try{return Lt(_c,e,n?t:Ac&&_c[e]||t)}catch(e){}}for(r in wc)!(i=Z[r])||i[e]&&!n||Lt(i,e,t)}},isView:function(e){if(!Ne(e))return!1;var t=zt(e);return"DataView"===t||he(wc,t)||he(kc,t)},isTypedArray:Oc,TypedArray:_c,TypedArrayPrototype:bc},Rc=Pc.NATIVE_ARRAY_BUFFER_VIEWS,Lc=Z.ArrayBuffer,Ic=Z.Int8Array,Nc=!Rc||!$((function(){Ic(1)}))||!$((function(){new Ic(-1)}))||!ei((function(e){new Ic,new Ic(null),new Ic(1.5),new Ic(e)}),!0)||$((function(){return 1!==new Ic(new Lc(2),1,void 0).length})),Dc=Z.RangeError,Fc=function(e){if(void 0===e)return 0;var t=$t(e),n=tn(t);if(t!==n)throw Dc("Wrong length or index");return n},Bc=Z.Array,Uc=Math.abs,zc=Math.pow,jc=Math.floor,Vc=Math.log,Gc=Math.LN2,Hc=function(e,t,n){var r,i,a,o=Bc(n),s=8*n-t-1,u=(1<<s)-1,l=u>>1,c=23===t?zc(2,-24)-zc(2,-77):0,h=e<0||0===e&&1/e<0?1:0,f=0;for((e=Uc(e))!=e||e===1/0?(i=e!=e?1:0,r=u):(r=jc(Vc(e)/Gc),e*(a=zc(2,-r))<1&&(r--,a*=2),(e+=r+l>=1?c/a:c*zc(2,1-l))*a>=2&&(r++,a/=2),r+l>=u?(i=0,r=u):r+l>=1?(i=(e*a-1)*zc(2,t),r+=l):(i=e*zc(2,l-1)*zc(2,t),r=0));t>=8;)o[f++]=255&i,i/=256,t-=8;for(r=r<<t|i,s+=t;s>0;)o[f++]=255&r,r/=256,s-=8;return o[--f]|=128*h,o},Wc=function(e,t){var n,r=e.length,i=8*r-t-1,a=(1<<i)-1,o=a>>1,s=i-7,u=r-1,l=e[u--],c=127&l;for(l>>=7;s>0;)c=256*c+e[u--],s-=8;for(n=c&(1<<-s)-1,c>>=-s,s+=t;s>0;)n=256*n+e[u--],s-=8;if(0===c)c=1-o;else{if(c===a)return n?NaN:l?-1/0:1/0;n+=zc(2,t),c-=o}return(l?-1:1)*n*zc(2,c-t)},Xc=function(e){for(var t=le(this),n=nn(t),r=arguments.length,i=Ln(r>1?arguments[1]:void 0,n),a=r>2?arguments[2]:void 0,o=void 0===a?n:Ln(a,n);o>i;)t[i++]=e;return t},Yc=jn.f,Zc=ut.f,qc=Rt.PROPER,Kc=Rt.CONFIGURABLE,Qc=wt.get,Jc=wt.set,$c=Z.ArrayBuffer,eh=$c,th=eh&&eh.prototype,nh=Z.DataView,rh=nh&&nh.prototype,ih=Object.prototype,ah=Z.Array,oh=Z.RangeError,sh=ae(Xc),uh=ae([].reverse),lh=Hc,ch=Wc,hh=function(e){return[255&e]},fh=function(e){return[255&e,e>>8&255]},ph=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},dh=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},vh=function(e){return lh(e,23,4)},gh=function(e){return lh(e,52,8)},mh=function(e,t){Zc(e.prototype,t,{get:function(){return Qc(this)[t]}})},yh=function(e,t,n,r){var i=Fc(n),a=Qc(e);if(i+t>a.byteLength)throw oh("Wrong index");var o=Qc(a.buffer).bytes,s=i+a.byteOffset,u=ss(o,s,s+t);return r?u:uh(u)},_h=function(e,t,n,r,i,a){var o=Fc(n),s=Qc(e);if(o+t>s.byteLength)throw oh("Wrong index");for(var u=Qc(s.buffer).bytes,l=o+s.byteOffset,c=r(+i),h=0;h<t;h++)u[l+h]=c[a?h:t-h-1]};if(pc){var bh=qc&&"ArrayBuffer"!==$c.name;if($((function(){$c(1)}))&&$((function(){new $c(-1)}))&&!$((function(){return new $c,new $c(1.5),new $c(NaN),bh&&!Kc})))bh&&Kc&&ct($c,"name","ArrayBuffer");else{(eh=function(e){return Rr(this,th),new $c(Fc(e))}).prototype=th;for(var xh,Eh=Yc($c),Sh=0;Eh.length>Sh;)(xh=Eh[Sh++])in eh||ct(eh,xh,$c[xh]);th.constructor=eh}Tr&&Mu(rh)!==ih&&Tr(rh,ih);var Ch=new nh(new eh(2)),Th=ae(rh.setInt8);Ch.setInt8(0,2147483648),Ch.setInt8(1,2147483649),!Ch.getInt8(0)&&Ch.getInt8(1)||Er(rh,{setInt8:function(e,t){Th(this,e,t<<24>>24)},setUint8:function(e,t){Th(this,e,t<<24>>24)}},{unsafe:!0})}else th=(eh=function(e){Rr(this,th);var t=Fc(e);Jc(this,{bytes:sh(ah(t),0),byteLength:t}),Ie||(this.byteLength=t)}).prototype,rh=(nh=function(e,t,n){Rr(this,rh),Rr(e,th);var r=Qc(e).byteLength,i=$t(t);if(i<0||i>r)throw oh("Wrong offset");if(i+(n=void 0===n?r-i:tn(n))>r)throw oh("Wrong length");Jc(this,{buffer:e,byteLength:n,byteOffset:i}),Ie||(this.buffer=e,this.byteLength=n,this.byteOffset=i)}).prototype,Ie&&(mh(eh,"byteLength"),mh(nh,"buffer"),mh(nh,"byteLength"),mh(nh,"byteOffset")),Er(rh,{getInt8:function(e){return yh(this,1,e)[0]<<24>>24},getUint8:function(e){return yh(this,1,e)[0]},getInt16:function(e){var t=yh(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=yh(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return dh(yh(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return dh(yh(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return ch(yh(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return ch(yh(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){_h(this,1,e,hh,t)},setUint8:function(e,t){_h(this,1,e,hh,t)},setInt16:function(e,t){_h(this,2,e,fh,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){_h(this,2,e,fh,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){_h(this,4,e,ph,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){_h(this,4,e,ph,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){_h(this,4,e,vh,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){_h(this,8,e,gh,t,arguments.length>2?arguments[2]:void 0)}});wr(eh,"ArrayBuffer"),wr(nh,"DataView");var Ah={ArrayBuffer:eh,DataView:nh},Mh=Math.floor,wh=Number.isInteger||function(e){return!Ne(e)&&isFinite(e)&&Mh(e)===e},kh=Z.RangeError,Oh=Z.RangeError,Ph=function(e,t){var n=function(e){var t=$t(e);if(t<0)throw kh("The argument can't be less than 0");return t}(e);if(n%t)throw Oh("Wrong offset");return n},Rh=Pc.aTypedArrayConstructor,Lh=function(e){var t,n,r,i,a,o,s=ni(this),u=le(e),l=arguments.length,c=l>1?arguments[1]:void 0,h=void 0!==c,f=Br(u);if(f&&!Dr(f))for(o=(a=zr(u,f)).next,u=[];!(i=We(o,a)).done;)u.push(i.value);for(h&&l>2&&(c=Yt(c,arguments[2])),n=nn(u),r=new(Rh(s))(n),t=0;n>t;t++)r[t]=h?c(u[t],t):u[t];return r},Ih=H((function(e){var t=jn.f,n=_n.forEach,r=wt.get,i=wt.set,a=ut.f,o=On.f,s=Math.round,u=Z.RangeError,l=Ah.ArrayBuffer,c=l.prototype,h=Ah.DataView,f=Pc.NATIVE_ARRAY_BUFFER_VIEWS,p=Pc.TYPED_ARRAY_CONSTRUCTOR,d=Pc.TYPED_ARRAY_TAG,v=Pc.TypedArray,g=Pc.TypedArrayPrototype,m=Pc.aTypedArrayConstructor,y=Pc.isTypedArray,_=function(e,t){m(e);for(var n=0,r=t.length,i=new e(r);r>n;)i[n]=t[n++];return i},b=function(e,t){a(e,t,{get:function(){return r(this)[t]}})},x=function(e){var t;return Xe(c,e)||"ArrayBuffer"==(t=zt(e))||"SharedArrayBuffer"==t},E=function(e,t){return y(e)&&!Ze(t)&&t in e&&wh(+t)&&t>=0},S=function(e,t){return t=it(t),E(e,t)?lt(2,e[t]):o(e,t)},C=function(e,t,n){return t=it(t),!(E(e,t)&&Ne(n)&&he(n,"value"))||he(n,"get")||he(n,"set")||n.configurable||he(n,"writable")&&!n.writable||he(n,"enumerable")&&!n.enumerable?a(e,t,n):(e[t]=n.value,e)};Ie?(f||(On.f=S,ut.f=C,b(g,"buffer"),b(g,"byteOffset"),b(g,"byteLength"),b(g,"length")),er({target:"Object",stat:!0,forced:!f},{getOwnPropertyDescriptor:S,defineProperty:C}),e.exports=function(e,o,c){var m=e.match(/\d+$/)[0]/8,b=e+(c?"Clamped":"")+"Array",E="get"+e,S="set"+e,C=Z[b],T=C,A=T&&T.prototype,M={},w=function(e,t){a(e,t,{get:function(){return function(e,t){var n=r(e);return n.view[E](t*m+n.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,n){var i=r(e);c&&(n=(n=s(n))<0?0:n>255?255:255&n),i.view[S](t*m+i.byteOffset,n,!0)}(this,t,e)},enumerable:!0})};f?Nc&&(T=o((function(e,t,n,r){return Rr(e,A),ds(Ne(t)?x(t)?void 0!==r?new C(t,Ph(n,m),r):void 0!==n?new C(t,Ph(n,m)):new C(t):y(t)?_(T,t):We(Lh,T,t):new C(Fc(t)),e,T)})),Tr&&Tr(T,v),n(t(C),(function(e){e in T||ct(T,e,C[e])})),T.prototype=A):(T=o((function(e,t,n,r){Rr(e,A);var a,o,s,c=0,f=0;if(Ne(t)){if(!x(t))return y(t)?_(T,t):We(Lh,T,t);a=t,f=Ph(n,m);var p=t.byteLength;if(void 0===r){if(p%m)throw u("Wrong length");if((o=p-f)<0)throw u("Wrong length")}else if((o=tn(r)*m)+f>p)throw u("Wrong length");s=o/m}else s=Fc(t),a=new l(o=s*m);for(i(e,{buffer:a,byteOffset:f,byteLength:o,length:s,view:new h(a)});c<s;)w(e,c++)})),Tr&&Tr(T,v),A=T.prototype=co(g)),A.constructor!==T&&ct(A,"constructor",T),ct(A,p,T),d&&ct(A,d,b),M[b]=T,er({global:!0,forced:T!=C,sham:!f},M),"BYTES_PER_ELEMENT"in T||ct(T,"BYTES_PER_ELEMENT",m),"BYTES_PER_ELEMENT"in A||ct(A,"BYTES_PER_ELEMENT",m),Or(b)}):e.exports=function(){}}));Ih("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}),!0);var Nh=Math.min,Dh=ae([].copyWithin||function(e,t){var n=le(this),r=nn(n),i=Ln(e,r),a=Ln(t,r),o=arguments.length>2?arguments[2]:void 0,s=Nh((void 0===o?r:Ln(o,r))-a,r-i),u=1;for(a<i&&i<a+s&&(u=-1,a+=s-1,i+=s-1);s-- >0;)a in n?n[i]=n[a]:delete n[i],i+=u,a+=u;return n}),Fh=Pc.aTypedArray;(0,Pc.exportTypedArrayMethod)("copyWithin",(function(e,t){return Dh(Fh(this),e,t,arguments.length>2?arguments[2]:void 0)}));var Bh=_n.every,Uh=Pc.aTypedArray;(0,Pc.exportTypedArrayMethod)("every",(function(e){return Bh(Uh(this),e,arguments.length>1?arguments[1]:void 0)}));var zh=Pc.aTypedArray;(0,Pc.exportTypedArrayMethod)("fill",(function(e){var t=arguments.length;return We(Xc,zh(this),e,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}));var jh=Pc.TYPED_ARRAY_CONSTRUCTOR,Vh=Pc.aTypedArrayConstructor,Gh=function(e){return Vh(ii(e,e[jh]))},Hh=function(e,t){return function(e,t){for(var n=0,r=nn(t),i=new e(r);r>n;)i[n]=t[n++];return i}(Gh(e),t)},Wh=_n.filter,Xh=Pc.aTypedArray;(0,Pc.exportTypedArrayMethod)("filter",(function(e){var t=Wh(Xh(this),e,arguments.length>1?arguments[1]:void 0);return Hh(this,t)}));var Yh=_n.find,Zh=Pc.aTypedArray;(0,Pc.exportTypedArrayMethod)("find",(function(e){return Yh(Zh(this),e,arguments.length>1?arguments[1]:void 0)}));var qh=_n.findIndex,Kh=Pc.aTypedArray;(0,Pc.exportTypedArrayMethod)("findIndex",(function(e){return qh(Kh(this),e,arguments.length>1?arguments[1]:void 0)}));var Qh=_n.forEach,Jh=Pc.aTypedArray;(0,Pc.exportTypedArrayMethod)("forEach",(function(e){Qh(Jh(this),e,arguments.length>1?arguments[1]:void 0)}));var $h=Nn.includes,ef=Pc.aTypedArray;(0,Pc.exportTypedArrayMethod)("includes",(function(e){return $h(ef(this),e,arguments.length>1?arguments[1]:void 0)}));var tf=Nn.indexOf,nf=Pc.aTypedArray;(0,Pc.exportTypedArrayMethod)("indexOf",(function(e){return tf(nf(this),e,arguments.length>1?arguments[1]:void 0)}));var rf=Pe("iterator"),af=Z.Uint8Array,of=ae(Hu.values),sf=ae(Hu.keys),uf=ae(Hu.entries),lf=Pc.aTypedArray,cf=Pc.exportTypedArrayMethod,hf=af&&af.prototype,ff=!$((function(){hf[rf].call([1])})),pf=!!hf&&hf.values&&hf[rf]===hf.values&&"values"===hf.values.name,df=function(){return of(lf(this))};cf("entries",(function(){return uf(lf(this))}),ff),cf("keys",(function(){return sf(lf(this))}),ff),cf("values",df,ff||!pf,{name:"values"}),cf(rf,df,ff||!pf,{name:"values"});var vf=Pc.aTypedArray,gf=Pc.exportTypedArrayMethod,mf=ae([].join);gf("join",(function(e){return mf(vf(this),e)}));var yf=Math.min,_f=[].lastIndexOf,bf=!!_f&&1/[1].lastIndexOf(1,-0)<0,xf=bn("lastIndexOf"),Ef=bf||!xf?function(e){if(bf)return ui(_f,this,arguments)||0;var t=wn(this),n=nn(t),r=n-1;for(arguments.length>1&&(r=yf(r,$t(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}:_f,Sf=Pc.aTypedArray;(0,Pc.exportTypedArrayMethod)("lastIndexOf",(function(e){var t=arguments.length;return ui(Ef,Sf(this),t>1?[e,arguments[1]]:[e])}));var Cf=_n.map,Tf=Pc.aTypedArray;(0,Pc.exportTypedArrayMethod)("map",(function(e){return Cf(Tf(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(Gh(e))(t)}))}));var Af=Z.TypeError,Mf=function(e){return function(t,n,r,i){Je(n);var a=le(t),o=Kt(a),s=nn(a),u=e?s-1:0,l=e?-1:1;if(r<2)for(;;){if(u in o){i=o[u],u+=l;break}if(u+=l,e?u<0:s<=u)throw Af("Reduce of empty array with no initial value")}for(;e?u>=0:s>u;u+=l)u in o&&(i=n(i,o[u],u,a));return i}},wf={left:Mf(!1),right:Mf(!0)},kf=wf.left,Of=Pc.aTypedArray;(0,Pc.exportTypedArrayMethod)("reduce",(function(e){var t=arguments.length;return kf(Of(this),e,t,t>1?arguments[1]:void 0)}));var Pf=wf.right,Rf=Pc.aTypedArray;(0,Pc.exportTypedArrayMethod)("reduceRight",(function(e){var t=arguments.length;return Pf(Rf(this),e,t,t>1?arguments[1]:void 0)}));var Lf=Pc.aTypedArray,If=Pc.exportTypedArrayMethod,Nf=Math.floor;If("reverse",(function(){for(var e,t=Lf(this).length,n=Nf(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this}));var Df=Z.RangeError,Ff=Z.Int8Array,Bf=Ff&&Ff.prototype,Uf=Bf&&Bf.set,zf=Pc.aTypedArray,jf=Pc.exportTypedArrayMethod,Vf=!$((function(){var e=new Uint8ClampedArray(2);return We(Uf,e,{length:1,0:3},1),3!==e[1]})),Gf=Vf&&Pc.NATIVE_ARRAY_BUFFER_VIEWS&&$((function(){var e=new Ff(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));jf("set",(function(e){zf(this);var t=Ph(arguments.length>1?arguments[1]:void 0,1),n=le(e);if(Vf)return We(Uf,this,n,t);var r=this.length,i=nn(n),a=0;if(i+t>r)throw Df("Wrong length");for(;a<i;)this[t+a]=n[a++]}),!Vf||Gf);var Hf=Pc.aTypedArray;(0,Pc.exportTypedArrayMethod)("slice",(function(e,t){for(var n=ci(Hf(this),e,t),r=Gh(this),i=0,a=n.length,o=new r(a);a>i;)o[i]=n[i++];return o}),$((function(){new Int8Array(1).slice()})));var Wf=_n.some,Xf=Pc.aTypedArray;(0,Pc.exportTypedArrayMethod)("some",(function(e){return Wf(Xf(this),e,arguments.length>1?arguments[1]:void 0)}));var Yf=Math.floor,Zf=function(e,t){var n=e.length,r=Yf(n/2);return n<8?qf(e,t):Kf(e,Zf(ss(e,0,r),t),Zf(ss(e,r),t),t)},qf=function(e,t){for(var n,r,i=e.length,a=1;a<i;){for(r=a,n=e[a];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==a++&&(e[r]=n)}return e},Kf=function(e,t,n,r){for(var i=t.length,a=n.length,o=0,s=0;o<i||s<a;)e[o+s]=o<i&&s<a?r(t[o],n[s])<=0?t[o++]:n[s++]:o<i?t[o++]:n[s++];return e},Qf=Zf,Jf=_e.match(/firefox\/(\d+)/i),$f=!!Jf&&+Jf[1],ep=/MSIE|Trident/.test(_e),tp=_e.match(/AppleWebKit\/(\d+)\./),np=!!tp&&+tp[1],rp=Z.Array,ip=Pc.aTypedArray,ap=Pc.exportTypedArrayMethod,op=Z.Uint16Array,sp=op&&ae(op.prototype.sort),up=!(!sp||$((function(){sp(new op(2),null)}))&&$((function(){sp(new op(2),{})}))),lp=!!sp&&!$((function(){if(Ce)return Ce<74;if($f)return $f<67;if(ep)return!0;if(np)return np<602;var e,t,n=new op(516),r=rp(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,r[e]=e-2*t+3;for(sp(n,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==r[e])return!0}));ap("sort",(function(e){return void 0!==e&&Je(e),lp?sp(this,e):Qf(ip(this),function(e){return function(t,n){return void 0!==e?+e(t,n)||0:n!=n?-1:t!=t?1:0===t&&0===n?1/t>0&&1/n<0?1:-1:t>n}}(e))}),!lp||up);var cp=Pc.aTypedArray;(0,Pc.exportTypedArrayMethod)("subarray",(function(e,t){var n=cp(this),r=n.length,i=Ln(e,r);return new(Gh(n))(n.buffer,n.byteOffset+i*n.BYTES_PER_ELEMENT,tn((void 0===t?r:Ln(t,r))-i))}));var hp=Z.Int8Array,fp=Pc.aTypedArray,pp=Pc.exportTypedArrayMethod,dp=[].toLocaleString,vp=!!hp&&$((function(){dp.call(new hp(1))}));pp("toLocaleString",(function(){return ui(dp,vp?ci(fp(this)):fp(this),ci(arguments))}),$((function(){return[1,2].toLocaleString()!=new hp([1,2]).toLocaleString()}))||!$((function(){hp.prototype.toLocaleString.call([1,2])})));var gp=Pc.exportTypedArrayMethod,mp=Z.Uint8Array,yp=mp&&mp.prototype||{},_p=[].toString,bp=ae([].join);$((function(){_p.call({})}))&&(_p=function(){return bp(this)});var xp=yp.toString!=_p;gp("toString",_p,xp);var Ep=function(){function e(){_(this,e),E(this,"_w",void 0),E(this,"_h",void 0),E(this,"_data",void 0);var t=arguments.length;if(2===t){if("number"==typeof arguments[0]&&"number"==typeof arguments[1])return this._w=arguments[0],this._h=arguments[1],void(this._data=new Uint8ClampedArray(this._w*this._h*4))}else 3===t&&"object"===g(arguments[0])&&"number"==typeof arguments[1]&&"number"==typeof arguments[2]&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return x(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}();Oo("match",(function(e,t,n){return[function(t){var n=se(this),r=null==t?void 0:$e(t,e);return r?We(r,t,n):new RegExp(t)[e](Ia(n))},function(e){var r=Ge(this),i=Ia(e),a=n(t,r,i);if(a.done)return a.value;if(!r.global)return Xo(r,i);var o=r.unicode;r.lastIndex=0;for(var s,u=[],l=0;null!==(s=Xo(r,i));){var c=Ia(s[0]);u[l]=c,""===c&&(r.lastIndex=Fo(i,tn(r.lastIndex),o)),l++}return 0===l?null:u}]}));var Sp,Cp,Tp,Ap,Mp=Pe("isConcatSpreadable"),wp=Z.TypeError,kp=Ce>=51||!$((function(){var e=[];return e[Mp]=!1,e.concat()[0]!==e})),Op=nr("concat"),Pp=function(e){if(!Ne(e))return!1;var t=e[Mp];return void 0!==t?!!t:rn(e)};if(er({target:"Array",proto:!0,forced:!kp||!Op},{concat:function(e){var t,n,r,i,a,o=le(this),s=gn(o,0),u=0;for(t=-1,r=arguments.length;t<r;t++)if(Pp(a=-1===t?o:arguments[t])){if(u+(i=nn(a))>9007199254740991)throw wp("Maximum allowed index exceeded");for(n=0;n<i;n++,u++)n in a&&is(s,u,a[n])}else{if(u>=9007199254740991)throw wp("Maximum allowed index exceeded");is(s,u++,a)}return s.length=u,s}}),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Rp=my.getSystemInfoSync();Sp=Rp.system,Cp=Rp.platform,Tp=Rp.language}else{var Lp={versions:(Ap=ou.navigator.userAgent,{trident:Ap.indexOf("Trident")>-1,presto:Ap.indexOf("Presto")>-1,webKit:Ap.indexOf("AppleWebKit")>-1,gecko:Ap.indexOf("Gecko")>-1&&-1===Ap.indexOf("KHTML"),mobile:!!Ap.match(/AppleWebKit.*Mobile.*/),ios:!!Ap.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Ap.indexOf("Android")>-1||Ap.indexOf("Linux")>-1,iPhone:Ap.indexOf("iPhone")>-1,iPad:Ap.indexOf("iPad")>-1,webApp:-1===Ap.indexOf("Safari"),weixin:Ap.indexOf("MicroMessenger")>-1,qq:" qq"===Ap.match(/\sQQ/i)}),language:(ou.navigator.browserLanguage||ou.navigator.language).toLowerCase()};Lp.versions.android?Cp="android":Lp.versions.trident?Cp="IE":Lp.versions.presto?Cp="Opera":Lp.versions.webKit?Cp="webKit":Lp.versions.gecko?Cp="Firefox":Lp.versions.mobile?Cp="mobile":Lp.versions.ios?Cp="ios":Lp.versions.iPhone?Cp="iPhone":Lp.versions.iPad?Cp="ipad":Lp.versions.webApp?Cp="webApp":Lp.versions.weixin?Cp="weixin":Lp.versions.qq&&(Cp="qq"),Sp=ou.navigator.userAgent,Tp=Lp.language}var Ip=-1!==Sp.toLowerCase().indexOf("android")?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Np="Mozilla/5.0 (".concat(Ip,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Tp),Dp={platform:Cp,language:Tp,appVersion:"5.0 (".concat(Ip,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Np},Fp=0;Ih("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var Bp=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";_(this,e),E(this,"href",void 0),0!=t.indexOf("http://")&&0!=t.indexOf("https://")?this.href=n+t:this.href=t}return x(e,null,[{key:"createObjectURL",value:function(e){var t=e.buffers[0],n=e.type,r=function(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return au(t)}(t);return"data:".concat(n,";base64, ")+r}}]),e}();var Up=ut.f,zp=nl.fastKey,jp=wt.set,Vp=wt.getterFor,Gp={getConstructor:function(e,t,n,r){var i=e((function(e,i){Rr(e,a),jp(e,{type:t,index:co(null),first:void 0,last:void 0,size:0}),Ie||(e.size=0),null!=i&&Wr(i,e[r],{that:e,AS_ENTRIES:n})})),a=i.prototype,o=Vp(t),s=function(e,t,n){var r,i,a=o(e),s=u(e,t);return s?s.value=n:(a.last=s={index:i=zp(t,!0),key:t,value:n,previous:r=a.last,next:void 0,removed:!1},a.first||(a.first=s),r&&(r.next=s),Ie?a.size++:e.size++,"F"!==i&&(a.index[i]=s)),e},u=function(e,t){var n,r=o(e),i=zp(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n};return Er(a,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,Ie?e.size=0:this.size=0},delete:function(e){var t=o(this),n=u(this,e);if(n){var r=n.next,i=n.previous;delete t.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),t.first==n&&(t.first=r),t.last==n&&(t.last=i),Ie?t.size--:this.size--}return!!n},forEach:function(e){for(var t,n=o(this),r=Yt(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!u(this,e)}}),Er(a,n?{get:function(e){var t=u(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),Ie&&Up(a,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=Vp(t),a=Vp(r);zu(e,t,(function(e,t){jp(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=a(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),Or(t)}};rl("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Gp);var Hp=$((function(){ro(1)}));er({target:"Object",stat:!0,forced:Hp},{keys:function(e){return ro(le(e))}});var Wp=new Map,Xp=new Map,Yp=new Map,Zp=function(e){S(n,e);var t=R(n);function n(){var e;return _(this,n),E(O(e=t.call(this)),"onabort",void 0),E(O(e),"onerror",void 0),E(O(e),"onload",void 0),E(O(e),"onloadstart",void 0),E(O(e),"onprogress",void 0),E(O(e),"ontimeout",void 0),E(O(e),"onloadend",void 0),E(O(e),"onreadystatechange",void 0),E(O(e),"readyState",void 0),E(O(e),"response",void 0),E(O(e),"responseText",void 0),E(O(e),"_responseType",void 0),E(O(e),"responseXML",void 0),E(O(e),"status",void 0),E(O(e),"statusText",void 0),E(O(e),"upload",void 0),E(O(e),"withCredentials",void 0),E(O(e),"timeout",void 0),E(O(e),"_url",void 0),E(O(e),"_method",void 0),e.onabort=null,e.onerror=null,e.onload=null,e.onloadstart=null,e.onprogress=null,e.ontimeout=null,e.onloadend=null,e.onreadystatechange=null,e.readyState=0,e.response=null,e.responseText=null,e._responseType="text",e.responseXML=null,e.status=0,e.statusText="",e.upload={},e.withCredentials=!1,Wp.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),e}return x(n,[{key:"responseType",set:function(e){this._responseType=e}},{key:"abort",value:function(){var e=Yp.get("requestTask");e&&e.abort()}},{key:"getAllResponseHeaders",value:function(){var e=Xp.get("responseHeader");return Object.keys(e).map((function(t){return"".concat(t,": ").concat(e[t])})).join("\n")}},{key:"getResponseHeader",value:function(e){return Xp.get("responseHeader")[e]}},{key:"open",value:function(e,t,n){this._method=e,this._url=t}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(e,t){var n=Wp.get("requestHeader");n[e]=t,Wp.set("requestHeader",n)}},{key:"addEventListener",value:function(e,t){var n=this;"function"==typeof t&&(this["on"+e]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.target=e.target||n,t.call(n,e)})}},{key:"removeEventListener",value:function(e,t){this["on"+e]===t&&(this["on"+e]=null)}}]),n}(Nl);E(Zp,"UNSEND",void 0),E(Zp,"OPENED",void 0),E(Zp,"HEADERS_RECEIVED",void 0),E(Zp,"LOADING",void 0),E(Zp,"DONE",void 0),Zp.UNSEND=0,Zp.OPENED=1,Zp.HEADERS_RECEIVED=2,Zp.LOADING=3,Zp.DONE=4;var qp=function(e){S(n,e);var t=R(n);function n(e){var r;return _(this,n),E(O(r=t.call(this,e)),"touches",void 0),E(O(r),"targetTouches",void 0),E(O(r),"changedTouches",void 0),r.touches=[],r.targetTouches=[],r.changedTouches=[],r.target=nc(),r.currentTarget=nc(),r}return x(n)}(pu);function Kp(e){var t=e||{},n=t.x,r=void 0===n?0:n,i=t.y,a=void 0===i?0:i,o=t.clientX,s=void 0===o?0:o,u=t.clientY,l=void 0===u?0:u;-1!==Object.keys(e).indexOf("x")?(e.pageX=e.clientX=r,e.pageY=e.clientY=a):(e.x=s,e.y=l)}function Qp(e){return function(t){var n=new qp(e);n.changedTouches=t.changedTouches,n.touches=t.touches,n.targetTouches=Array.prototype.slice.call(t.touches),n.timeStamp=t.timeStamp,n.changedTouches.forEach((function(e){return Kp(e)})),n.touches.forEach((function(e){return Kp(e)})),n.targetTouches.forEach((function(e){return Kp(e)})),uc.dispatchEvent(n)}}var Jp,$p=Qp("touchstart"),ed=Qp("touchmove"),td=Qp("touchend"),nd=(Jp="mapCameaParams",function(e){e.type=Jp,uc.dispatchEvent(e)}),rd=function(e){S(n,e);var t=R(n);function n(e){var r;return _(this,n),E(O(r=t.call(this,e)),"buttons",void 0),E(O(r),"which",void 0),E(O(r),"pointerId",void 0),E(O(r),"bubbles",void 0),E(O(r),"button",void 0),E(O(r),"width",void 0),E(O(r),"height",void 0),E(O(r),"pressure",void 0),E(O(r),"isPrimary",void 0),E(O(r),"pointerType",void 0),E(O(r),"altKey",void 0),E(O(r),"ctrlKey",void 0),E(O(r),"metaKey",void 0),E(O(r),"shiftKey",void 0),r.target=nc(),r.currentTarget=nc(),r}return x(n)}(pu),id=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],ad=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0];function od(e,t,n){for(var r=new rd(e),i=0;i<id.length;i++){var a=id[i];r[a]=t[a]||ad[i]}return r.type=e,r.target=nc(),r.currentTarget=nc(),r.buttons=function(e){var t=0;"touchstart"!==e&&"touchmove"!==e&&"pointerdown"!==e&&"pointermove"!==e||(t=1);return t}(e),r.which=r.buttons,r.pointerId=(t.identifier||0)+2,r.bubbles=!0,r.cancelable=!0,r.button=0,r.width=2*(t.radiusX||.5),r.height=2*(t.radiusY||.5),r.pressure=t.force||.5,r.isPrimary=function(e){return sd===e.identifier}(t),r.pointerType="touch",r.altKey=n.altKey,r.ctrlKey=n.ctrlKey,r.metaKey=n.metaKey,r.shiftKey=n.shiftKey,n.preventDefault&&(r.preventDefault=function(){n.preventDefault()}),r}var sd=null;function ud(e){null===sd&&(sd=e.identifier)}function ld(e){sd===e.identifier&&(sd=null)}function cd(e){return function(t){for(var n=t.changedTouches,r=0;r<n.length;r++){var i=n[r];0===r&&"pointerdown"===e?ud(i):"pointerup"!==e&&"pointercancel"!==e||ld(i);var a=od(e,i,t);uc.dispatchEvent(a)}}}var hd=cd("pointerdown"),fd=cd("pointermove"),pd=cd("pointerup");function dd(e){return function(t){t.type=e,uc.dispatchEvent(t)}}var vd=dd("mousedown"),gd=dd("mousemove"),md=dd("mouseup"),yd="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,_d="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),bd=yd||_d,xd={atob:function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new iu("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,i="",a=0,o=0;r=t.charAt(o++);~r&&(n=a%4?64*n+r:r,a++%4)?i+=String.fromCharCode(255&n>>(-2*a&6)):0)r=ru.indexOf(r);return i},btoa:au,devicePixelRatio:uu,Blob:su,document:uc,Element:Fl,Event:pu,EventTarget:Nl,HTMLCanvasElement:fc,HTMLElement:Jl,HTMLMediaElement:$l,HTMLVideoElement:ec,Image:rc,ImageData:Ep,navigator:Dp,Node:Dl,requestAnimationFrame:function(e){var t=nc();return t.requestAnimationFrame?t.requestAnimationFrame(e):function(e){var t=Date.now(),n=Math.max(Fp+23,t);return setTimeout((function(){e(Fp=n)}),n-t)}(e)},cancelAnimationFrame:function(e){var t=nc();return t.cancelAnimationFrame?t.cancelAnimationFrame(e):clearTimeout(e)},screen:jl,XMLHttpRequest:Zp,performance:{mark:function(e){return null},clearMeasures:function(e){return null},clearMarks:function(e){return null},measure:function(e,t,n){return{duration:0}},now:function(){}},URL:Bp,WebGLRenderingContext:{GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:0x10000000000000000,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},WebGL2RenderingContext:{},addEventListener:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};uc.addEventListener(e,t,n)},removeEventListener:function(e,t,n){uc.removeEventListener(e,t)},dispatchEvent:function(e){uc.dispatchEvent(e)},innerWidth:jl.availWidth,innerHeight:jl.availHeight,setTimeout:setTimeout,clearTimeout:clearTimeout,setInterval:setInterval,clearInterval:clearInterval},Ed=bd?xd:ou,Sd=bd?Zp:ou.XMLHttpRequest,Cd=bd?ic:ou.location;function Td(e){var t=e;return"string"==typeof e&&(t=Ed.document.getElementById(e)),t}function Ad(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Md(e){return Ad(e).split(/\s+/)}function wd(e,t,n){var r=Ed.document.createElement(e);return r.className=t||"",n&&n.appendChild(r),r}function kd(e){var t=e.parentNode;t&&t.removeChild(e)}function Od(e,t){if(void 0!==e.classList)for(var n=Md(t),r=0,i=n.length;r<i;r++)e.classList.add(n[r]);else if(!Rd(e,t)){var a=Id(e);Ld(e,(a?a+" ":"")+t)}}function Pd(e,t){void 0!==e.classList?e.classList.remove(t):Ld(e,Ad((" "+Id(e)+" ").replace(" "+t+" "," ")))}function Rd(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=Id(e);return n.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)}function Ld(e,t){e instanceof HTMLElement?e.className=t:e.className.baseVal=t}function Id(e){return e instanceof SVGElement&&(e=e.correspondingElement),void 0===e.className.baseVal?e.className:e.className.baseVal}function Nd(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Dd=function(e){var t,n,r=null==Ed||null===(t=Ed.document)||void 0===t||null===(n=t.documentElement)||void 0===n?void 0:n.style;if(!r)return e[0];for(var i in e)if(e[i]&&e[i]in r)return e[i];return e[0]}(["transform","WebkitTransform"]);function Fd(e,t){e.style[Dd]=t}function Bd(){if("function"==typeof Event)Ed.dispatchEvent(new Event("resize"));else{var e=Ed.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,Ed,0),Ed.dispatchEvent(e)}}function Ud(){var e,t=Ed.document.querySelector('meta[name="viewport"]');if(!t)return 1;var n=(null===(e=t.content)||void 0===e?void 0:e.split(",")).find((function(e){var t=N(e.split("="),2),n=t[0];t[1];return"initial-scale"===n}));return n?1*n.split("=")[1]:1}var zd=Ud()<1?1:Ed.devicePixelRatio,jd=Object.freeze({__proto__:null,getContainer:Td,trim:Ad,splitWords:Md,create:wd,remove:kd,addClass:Od,removeClass:Pd,hasClass:Rd,setClass:Ld,getClass:Id,empty:Nd,setTransform:Fd,triggerResize:Bd,printCanvas:function(e){var t=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log("%c\n",t.join(""))},getViewPortScale:Ud,DPR:zd}),Vd=function(e){S(n,e);var t=R(n);function n(e,r,i){var a;return _(this,n),E(O(a=t.call(this,e)),"status",void 0),E(O(a),"url",void 0),a.status=r,a.url=i,a.name=a.constructor.name,a.message=e,a}return x(n,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),n}(w(Error));function Gd(e){var t=new Sd;for(var n in t.open("GET",e.url,!0),e.headers)e.headers.hasOwnProperty(n)&&t.setRequestHeader(n,e.headers[n]);return t.withCredentials="include"===e.credentials,t}var Hd=function(e,t){var n=Gd(e);return n.responseType="arraybuffer",n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){var r=n.response;if(0===r.byteLength&&200===n.status)return t(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?t(null,{data:r,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):t(new Vd(n.statusText,n.status,e.url))},n.send(),n},Wd=function(e,t){return Hd(e,(function(e,n){if(e)t(e);else if(n){var r=new Ed.Image;r.crossOrigin="anonymous";var i=Ed.URL||Ed.webkitURL;r.onload=function(){t(null,r),i.revokeObjectURL(r.src)};var a=new Ed.Blob([new Uint8Array(n.data)],{type:"image/png"});r.src=n.data.byteLength?i.createObjectURL(a):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}}))},Xd=ae(1..valueOf),Yd=jn.f,Zd=On.f,qd=ut.f,Kd=qa.trim,Qd=Z.Number,Jd=Qd.prototype,$d=Z.TypeError,ev=ae("".slice),tv=ae("".charCodeAt),nv=function(e){var t=rt(e,"number");return"bigint"==typeof t?t:rv(t)},rv=function(e){var t,n,r,i,a,o,s,u,l=rt(e,"number");if(Ze(l))throw $d("Cannot convert a Symbol value to a number");if("string"==typeof l&&l.length>2)if(l=Kd(l),43===(t=tv(l,0))||45===t){if(88===(n=tv(l,2))||120===n)return NaN}else if(48===t){switch(tv(l,1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+l}for(o=(a=ev(l,2)).length,s=0;s<o;s++)if((u=tv(a,s))<48||u>i)return NaN;return parseInt(a,r)}return+l};if(Jn("Number",!Qd(" 0o1")||!Qd("0b1")||Qd("+0x1"))){for(var iv,av=function(e){var t=arguments.length<1?0:Qd(nv(e)),n=this;return Xe(Jd,n)&&$((function(){Xd(n)}))?ds(Object(t),n,av):t},ov=Ie?Yd(Qd):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),sv=0;ov.length>sv;sv++)he(Qd,iv=ov[sv])&&!he(av,iv)&&qd(av,iv,Zd(Qd,iv));av.prototype=Jd,Jd.constructor=av,Lt(Z,"Number",av)}var uv=Z.RangeError,lv=function(e){var t=Ia(se(this)),n="",r=$t(e);if(r<0||r==1/0)throw uv("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n},cv=Z.RangeError,hv=Z.String,fv=Math.floor,pv=ae(lv),dv=ae("".slice),vv=ae(1..toFixed),gv=function(e,t,n){return 0===t?n:t%2==1?gv(e,t-1,n*e):gv(e*e,t/2,n)},mv=function(e,t,n){for(var r=-1,i=n;++r<6;)i+=t*e[r],e[r]=i%1e7,i=fv(i/1e7)},yv=function(e,t){for(var n=6,r=0;--n>=0;)r+=e[n],e[n]=fv(r/t),r=r%t*1e7},_v=function(e){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==e[t]){var r=hv(e[t]);n=""===n?r:n+pv("0",7-r.length)+r}return n},bv=$((function(){return"0.000"!==vv(8e-5,3)||"1"!==vv(.9,0)||"1.25"!==vv(1.255,2)||"1000000000000000128"!==vv(0xde0b6b3a7640080,0)}))||!$((function(){vv({})}));er({target:"Number",proto:!0,forced:bv},{toFixed:function(e){var t,n,r,i,a=Xd(this),o=$t(e),s=[0,0,0,0,0,0],u="",l="0";if(o<0||o>20)throw cv("Incorrect fraction digits");if(a!=a)return"NaN";if(a<=-1e21||a>=1e21)return hv(a);if(a<0&&(u="-",a=-a),a>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(a*gv(2,69,1))-69)<0?a*gv(2,-t,1):a/gv(2,t,1),n*=4503599627370496,(t=52-t)>0){for(mv(s,0,n),r=o;r>=7;)mv(s,1e7,0),r-=7;for(mv(s,gv(10,r,1),0),r=t-1;r>=23;)yv(s,1<<23),r-=23;yv(s,1<<r),mv(s,1,1),yv(s,2),l=_v(s)}else mv(s,0,n),mv(s,1<<-t,0),l=_v(s)+pv("0",o);return l=o>0?u+((i=l.length)<=o?"0."+pv("0",o-i)+l:dv(l,0,i-o)+"."+dv(l,i-o)):u+l}});var xv=2*Math.PI*6378137/2;function Ev(e){var t=[1/0,1/0,-1/0,-1/0];return e.forEach((function(e){var n=e.coordinates;!function e(t,n){Array.isArray(n[0])?n.forEach((function(n){e(t,n)})):(t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1]));return t}(t,n)})),t}function Sv(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{enable:!0,decimal:1},r=(e=Av(e,t))[0],i=e[1],a=r*xv/180,o=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return o=o*xv/180,n.enable&&(a=Number(a.toFixed(n.decimal)),o=Number(o.toFixed(n.decimal))),3===e.length?[a,o,e[2]]:[a,o]}function Cv(e){if(null==e)throw new Error("lng is required");return(e>180||e<-180)&&((e%=360)>180&&(e=-360+e),e<-180&&(e=360+e),0===e&&(e=0)),e}function Tv(e){if(null==e)throw new Error("lat is required");return(e>90||e<-90)&&((e%=180)>90&&(e=-180+e),e<-90&&(e=180+e),0===e&&(e=0)),e}function Av(e,t){if(!1===t)return e;var n=Cv(e[0]),r=Tv(e[1]);return r>85&&(r=85),r<-85&&(r=-85),3===e.length?[n,r,e[2]]:[n,r]}function Mv(e){var t=Math.max(Math.min(85.0511287798,e[1]),-85.0511287798),n=Math.PI/180,r=e[0]*n,i=t*n;i=Math.log(Math.tan(Math.PI/4+i/2));return r=(256<<20)*(.5/Math.PI*r+.5),i=(256<<20)*(-.5/Math.PI*i+(n=.5)),[Math.floor(r),Math.floor(i)]}function wv(e,t,n){var r=_r(t[1]-e[1]),i=_r(t[0]-e[0]),a=_r(e[1]),o=_r(t[1]),s=Math.pow(Math.sin(r/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(o);return function(e,t){void 0===t&&(t="kilometers");var n=mr[t];if(!n)throw new Error(t+" units is invalid");return e*n}(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters")}function kv(e,t){var n=Math.abs(e[1][1]-e[0][1])*t,r=Math.abs(e[1][0]-e[0][0])*t;return[[e[0][0]-r,e[0][1]-n],[e[1][0]+r,e[1][1]+n]]}function Ov(e,t){return e[0][0]<=t[0][0]&&e[0][1]<=t[0][1]&&e[1][0]>=t[1][0]&&e[1][1]>=t[1][1]}function Pv(e){return[[e[0],e[1]],[e[2],e[3]]]}function Rv(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function Lv(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Iv(e,t){return t[0]>0?t[1]>0?90-180*Math.atan(t[1]/t[0])/Math.PI:90+180*Math.atan(-t[1]/t[0])/Math.PI:t[1]<0?90-180*Math.atan(t[1]/t[0])/Math.PI+180:270+180*Math.atan(t[1]/-t[0])/Math.PI}var Nv=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;_(this,e),E(this,"limit",void 0),E(this,"cache",void 0),E(this,"destroy",void 0),E(this,"order",void 0),this.limit=t,this.destroy=n||this.defaultDestroy,this.order=[],this.clear()}return x(e,[{key:"clear",value:function(){var e=this;this.order.forEach((function(t){e.delete(t)})),this.cache={},this.order=[]}},{key:"get",value:function(e){var t=this.cache[e];return t&&(this.deleteOrder(e),this.appendOrder(e)),t}},{key:"set",value:function(e,t){this.cache[e]?(this.delete(e),this.cache[e]=t,this.appendOrder(e)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[e]=t,this.appendOrder(e))}},{key:"delete",value:function(e){var t=this.cache[e];t&&(this.deleteCache(e),this.deleteOrder(e),this.destroy(t,e))}},{key:"deleteCache",value:function(e){delete this.cache[e]}},{key:"deleteOrder",value:function(e){var t=this.order.findIndex((function(t){return t===e}));t>=0&&this.order.splice(t,1)}},{key:"appendOrder",value:function(e){this.order.push(e)}},{key:"defaultDestroy",value:function(e,t){return null}}]),e}();function Dv(e,t){e.forEach((function(e){t[e]&&(t[e]=t[e].bind(t))}))}var Fv=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;_(this,e),E(this,"duration",16),E(this,"timestamp",(new Date).getTime()),this.duration=t}return x(e,[{key:"run",value:function(e){var t=(new Date).getTime(),n=t-this.timestamp;this.timestamp=t,n>=this.duration&&e()}}]),e}();function Bv(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Uv(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function zv(){}var jv,Vv="\\s*([+-]?\\d+)\\s*",Gv="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Hv="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Wv=/^#([0-9a-f]{3,8})$/,Xv=new RegExp("^rgb\\("+[Vv,Vv,Vv]+"\\)$"),Yv=new RegExp("^rgb\\("+[Hv,Hv,Hv]+"\\)$"),Zv=new RegExp("^rgba\\("+[Vv,Vv,Vv,Gv]+"\\)$"),qv=new RegExp("^rgba\\("+[Hv,Hv,Hv,Gv]+"\\)$"),Kv=new RegExp("^hsl\\("+[Gv,Hv,Hv]+"\\)$"),Qv=new RegExp("^hsla\\("+[Gv,Hv,Hv,Gv]+"\\)$"),Jv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function $v(){return this.rgb().formatHex()}function eg(){return this.rgb().formatRgb()}function tg(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Wv.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?ng(t):3===n?new og(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?rg(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?rg(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Xv.exec(e))?new og(t[1],t[2],t[3],1):(t=Yv.exec(e))?new og(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Zv.exec(e))?rg(t[1],t[2],t[3],t[4]):(t=qv.exec(e))?rg(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Kv.exec(e))?cg(t[1],t[2]/100,t[3]/100,1):(t=Qv.exec(e))?cg(t[1],t[2]/100,t[3]/100,t[4]):Jv.hasOwnProperty(e)?ng(Jv[e]):"transparent"===e?new og(NaN,NaN,NaN,0):null}function ng(e){return new og(e>>16&255,e>>8&255,255&e,1)}function rg(e,t,n,r){return r<=0&&(e=t=n=NaN),new og(e,t,n,r)}function ig(e){return e instanceof zv||(e=tg(e)),e?new og((e=e.rgb()).r,e.g,e.b,e.opacity):new og}function ag(e,t,n,r){return 1===arguments.length?ig(e):new og(e,t,n,null==r?1:r)}function og(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function sg(){return"#"+lg(this.r)+lg(this.g)+lg(this.b)}function ug(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function lg(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function cg(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new fg(e,t,n,r)}function hg(e){if(e instanceof fg)return new fg(e.h,e.s,e.l,e.opacity);if(e instanceof zv||(e=tg(e)),!e)return new fg;if(e instanceof fg)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,u=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=u<.5?a+i:2-a-i,o*=60):s=u>0&&u<1?0:o,new fg(o,s,u,e.opacity)}function fg(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function pg(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function dg(e){return"string"==typeof e&&!!tg(e)}function vg(e){var t=tg(e),n=[0,0,0,0];return null!=t&&(n[0]=t.r/255,n[1]=t.g/255,n[2]=t.b/255,n[3]=t.opacity),n}function gg(e){return(e&&e[0])+256*(e&&e[1])+65536*(e&&e[2])-1}function mg(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function yg(e){var t=Ed.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r=n.createLinearGradient(0,0,256,1),i=null,a=e.positions[0],o=e.positions[e.positions.length-1],s=0;s<e.colors.length;++s){var u=(e.positions[s]-a)/(o-a);r.addColorStop(u,e.colors[s])}if(n.fillStyle=r,n.fillRect(0,0,256,1),bd)return{data:i=new Uint8ClampedArray(n.getImageData(0,0,256,1).data),width:256,height:1};i=n.getImageData(0,0,256,1).data;for(var l=n.createImageData(256,1),c=0;c<l.data.length;c+=4)l.data[c+0]=i[c+0],l.data[c+1]=i[c+1],l.data[c+2]=i[c+2],l.data[c+3]=i[c+3];return l}Bv(zv,tg,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:$v,formatHex:$v,formatHsl:function(){return hg(this).formatHsl()},formatRgb:eg,toString:eg}),Bv(og,ag,Uv(zv,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new og(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new og(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:sg,formatHex:sg,formatRgb:ug,toString:ug})),Bv(fg,(function(e,t,n,r){return 1===arguments.length?hg(e):new fg(e,t,n,null==r?1:r)}),Uv(zv,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new fg(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new fg(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new og(pg(e>=240?e-240:e+120,i,r),pg(e,i,r),pg(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}})),(jv=e.anchorType||(e.anchorType={})).CENTER="center",jv.TOP="top",jv["TOP-LEFT"]="top-left",jv["TOP-RIGHT"]="top-right",jv.BOTTOM="bottom",jv["BOTTOM-LEFT"]="bottom-left",jv.LEFT="left",jv.RIGHT="right";var _g={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function bg(e,t,n){var r=e.classList;for(var i in _g)_g.hasOwnProperty(i)&&r.remove("l7-".concat(n,"-anchor-").concat(i));r.add("l7-".concat(n,"-anchor-").concat(t))}function xg(e,t){return{enable:e,mask:255,func:{cmp:514,ref:t?1:0,mask:255}}}var Eg=[],Sg=ae(Eg.sort),Cg=ae(Eg.push),Tg=$((function(){Eg.sort(void 0)})),Ag=$((function(){Eg.sort(null)})),Mg=bn("sort"),wg=!$((function(){if(Ce)return Ce<70;if(!($f&&$f>3)){if(ep)return!0;if(np)return np<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)Eg.push({k:t+r,v:n})}for(Eg.sort((function(e,t){return t.v-e.v})),r=0;r<Eg.length;r++)t=Eg[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));function kg(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return 1*t}function Og(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return 1*t}function Pg(e){if(0===e.length)return 0;for(var t=1*e[0],n=1;n<e.length;n++)t+=1*e[n];return t}function Rg(e){if(0===e.length)throw new Error("mean requires at least one data point");return Pg(e)/e.length}function Lg(e){if(0===e.length)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var t=e[0],n=NaN,r=0,i=1,a=1;a<e.length+1;a++)e[a]!==t?(i>r&&(r=i,n=t),i=1,t=e[a]):i++;return 1*n}er({target:"Array",proto:!0,forced:Tg||!Ag||!Mg||!wg},{sort:function(e){void 0!==e&&Je(e);var t=le(this);if(wg)return void 0===e?Sg(t):Sg(t,e);var n,r,i=[],a=nn(t);for(r=0;r<a;r++)r in t&&Cg(i,t[r]);for(Qf(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:Ia(t)>Ia(n)?1:-1}}(e)),n=i.length,r=0;r<n;)t[r]=i[r++];for(;r<a;)delete t[r++];return t}});var Ig={min:Og,max:kg,mean:Rg,sum:Pg,mode:Lg};function Ng(e,t){return e.map((function(e){return e[t]}))}function Dg(e,t){return Ig[e](t)}var Fg=Object.freeze({__proto__:null,sum:Pg,max:kg,min:Og,mean:Rg,mode:Lg,statMap:Ig,getColumn:Ng,getSatByColumn:Dg});function Bg(e,t){var n=t.extent,r=void 0===n?[121.168,30.2828,121.384,30.4219]:n,i=new Promise((function(t){!function(e,t){var n=e,r=[];if("string"==typeof n)Wd({url:n},(function(e,n){r.push(n),t(r)}));else{var i=n.length,a=0;n.forEach((function(e){Wd({url:e},(function(e,n){a++,r.push(n),a===i&&t(r)}))}))}}(e,(function(e){t(e)}))}));return{originData:e,images:i,_id:1,dataArray:[{_id:0,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]}}var Ug=function(e,t,n,r){try{return r?t(Ge(n)[0],n[1]):t(n)}catch(t){jr(e,"throw",t)}},zg=Z.Array,jg=function(e){var t=le(e),n=pn(this),r=arguments.length,i=r>1?arguments[1]:void 0,a=void 0!==i;a&&(i=Yt(i,r>2?arguments[2]:void 0));var o,s,u,l,c,h,f=Br(t),p=0;if(!f||this==zg&&Dr(f))for(o=nn(t),s=n?new this(o):zg(o);o>p;p++)h=a?i(t[p],p):t[p],is(s,p,h);else for(c=(l=zr(t,f)).next,s=n?new this:[];!(u=We(c,l)).done;p++)h=a?Ug(l,i,[u.value,p],!0):u.value,is(s,p,h);return s.length=p,s},Vg=!ei((function(e){Array.from(e)}));er({target:"Array",stat:!0,forced:Vg},{from:jg});var Gg=function(){this.__data__=[],this.size=0};var Hg=function(e,t){return e===t||e!=e&&t!=t};var Wg=function(e,t){for(var n=e.length;n--;)if(Hg(e[n][0],t))return n;return-1},Xg=Array.prototype.splice;var Yg=function(e){var t=this.__data__,n=Wg(t,e);return!(n<0)&&(n==t.length-1?t.pop():Xg.call(t,n,1),--this.size,!0)};var Zg=function(e){var t=this.__data__,n=Wg(t,e);return n<0?void 0:t[n][1]};var qg=function(e){return Wg(this.__data__,e)>-1};var Kg=function(e,t){var n=this.__data__,r=Wg(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function Qg(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Qg.prototype.clear=Gg,Qg.prototype.delete=Yg,Qg.prototype.get=Zg,Qg.prototype.has=qg,Qg.prototype.set=Kg;var Jg=Qg;var $g=function(){this.__data__=new Jg,this.size=0};var em=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};var tm=function(e){return this.__data__.get(e)};var nm=function(e){return this.__data__.has(e)},rm="object"==typeof V&&V&&V.Object===Object&&V,im="object"==typeof self&&self&&self.Object===Object&&self,am=rm||im||Function("return this")(),om=am.Symbol,sm=Object.prototype,um=sm.hasOwnProperty,lm=sm.toString,cm=om?om.toStringTag:void 0;var hm=function(e){var t=um.call(e,cm),n=e[cm];try{e[cm]=void 0;var r=!0}catch(e){}var i=lm.call(e);return r&&(t?e[cm]=n:delete e[cm]),i},fm=Object.prototype.toString;var pm=function(e){return fm.call(e)},dm=om?om.toStringTag:void 0;var vm=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":dm&&dm in Object(e)?hm(e):pm(e)};var gm=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var mm=function(e){if(!gm(e))return!1;var t=vm(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},ym=am["__core-js_shared__"],_m=function(){var e=/[^.]+$/.exec(ym&&ym.keys&&ym.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var bm=function(e){return!!_m&&_m in e},xm=Function.prototype.toString;var Em=function(e){if(null!=e){try{return xm.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Sm=/^\[object .+?Constructor\]$/,Cm=Function.prototype,Tm=Object.prototype,Am=Cm.toString,Mm=Tm.hasOwnProperty,wm=RegExp("^"+Am.call(Mm).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var km=function(e){return!(!gm(e)||bm(e))&&(mm(e)?wm:Sm).test(Em(e))};var Om=function(e,t){return null==e?void 0:e[t]};var Pm=function(e,t){var n=Om(e,t);return km(n)?n:void 0},Rm=Pm(am,"Map"),Lm=Pm(Object,"create");var Im=function(){this.__data__=Lm?Lm(null):{},this.size=0};var Nm=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Dm=Object.prototype.hasOwnProperty;var Fm=function(e){var t=this.__data__;if(Lm){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Dm.call(t,e)?t[e]:void 0},Bm=Object.prototype.hasOwnProperty;var Um=function(e){var t=this.__data__;return Lm?void 0!==t[e]:Bm.call(t,e)};var zm=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Lm&&void 0===t?"__lodash_hash_undefined__":t,this};function jm(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}jm.prototype.clear=Im,jm.prototype.delete=Nm,jm.prototype.get=Fm,jm.prototype.has=Um,jm.prototype.set=zm;var Vm=jm;var Gm=function(){this.size=0,this.__data__={hash:new Vm,map:new(Rm||Jg),string:new Vm}};var Hm=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var Wm=function(e,t){var n=e.__data__;return Hm(t)?n["string"==typeof t?"string":"hash"]:n.map};var Xm=function(e){var t=Wm(this,e).delete(e);return this.size-=t?1:0,t};var Ym=function(e){return Wm(this,e).get(e)};var Zm=function(e){return Wm(this,e).has(e)};var qm=function(e,t){var n=Wm(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function Km(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Km.prototype.clear=Gm,Km.prototype.delete=Xm,Km.prototype.get=Ym,Km.prototype.has=Zm,Km.prototype.set=qm;var Qm=Km;var Jm=function(e,t){var n=this.__data__;if(n instanceof Jg){var r=n.__data__;if(!Rm||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Qm(r)}return n.set(e,t),this.size=n.size,this};function $m(e){var t=this.__data__=new Jg(e);this.size=t.size}$m.prototype.clear=$g,$m.prototype.delete=em,$m.prototype.get=tm,$m.prototype.has=nm,$m.prototype.set=Jm;var ey=$m,ty=function(){try{var e=Pm(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();var ny=function(e,t,n){"__proto__"==t&&ty?ty(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var ry=function(e,t,n){(void 0!==n&&!Hg(e[t],n)||void 0===n&&!(t in e))&&ny(e,t,n)};var iy=function(e){return function(t,n,r){for(var i=-1,a=Object(t),o=r(t),s=o.length;s--;){var u=o[e?s:++i];if(!1===n(a[u],u,a))break}return t}}(),ay=H((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?am.Buffer:void 0,a=i?i.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=a?a(n):new e.constructor(n);return e.copy(r),r}})),oy=am.Uint8Array;var sy=function(e){var t=new e.constructor(e.byteLength);return new oy(t).set(new oy(e)),t};var uy=function(e,t){var n=t?sy(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};var ly=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t},cy=Object.create,hy=function(){function e(){}return function(t){if(!gm(t))return{};if(cy)return cy(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();var fy=function(e,t){return function(n){return e(t(n))}},py=fy(Object.getPrototypeOf,Object),dy=Object.prototype;var vy=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||dy)};var gy=function(e){return"function"!=typeof e.constructor||vy(e)?{}:hy(py(e))};var yy=function(e){return null!=e&&"object"==typeof e};var _y=function(e){return yy(e)&&"[object Arguments]"==vm(e)},by=Object.prototype,xy=by.hasOwnProperty,Ey=by.propertyIsEnumerable,Sy=_y(function(){return arguments}())?_y:function(e){return yy(e)&&xy.call(e,"callee")&&!Ey.call(e,"callee")},Cy=Array.isArray;var Ty=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var Ay=function(e){return null!=e&&Ty(e.length)&&!mm(e)};var My=function(e){return yy(e)&&Ay(e)};var wy=function(){return!1},ky=H((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n?am.Buffer:void 0,a=(i?i.isBuffer:void 0)||wy;e.exports=a})),Oy=Function.prototype,Py=Object.prototype,Ry=Oy.toString,Ly=Py.hasOwnProperty,Iy=Ry.call(Object);var Ny=function(e){if(!yy(e)||"[object Object]"!=vm(e))return!1;var t=py(e);if(null===t)return!0;var n=Ly.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Ry.call(n)==Iy},Dy={};Dy["[object Float32Array]"]=Dy["[object Float64Array]"]=Dy["[object Int8Array]"]=Dy["[object Int16Array]"]=Dy["[object Int32Array]"]=Dy["[object Uint8Array]"]=Dy["[object Uint8ClampedArray]"]=Dy["[object Uint16Array]"]=Dy["[object Uint32Array]"]=!0,Dy["[object Arguments]"]=Dy["[object Array]"]=Dy["[object ArrayBuffer]"]=Dy["[object Boolean]"]=Dy["[object DataView]"]=Dy["[object Date]"]=Dy["[object Error]"]=Dy["[object Function]"]=Dy["[object Map]"]=Dy["[object Number]"]=Dy["[object Object]"]=Dy["[object RegExp]"]=Dy["[object Set]"]=Dy["[object String]"]=Dy["[object WeakMap]"]=!1;var Fy=function(e){return yy(e)&&Ty(e.length)&&!!Dy[vm(e)]};var By=function(e){return function(t){return e(t)}},Uy=H((function(e,t){var n=t&&!t.nodeType&&t,r=n&&e&&!e.nodeType&&e,i=r&&r.exports===n&&rm.process,a=function(){try{var e=r&&r.require&&r.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=a})),zy=Uy&&Uy.isTypedArray,jy=zy?By(zy):Fy;var Vy=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},Gy=Object.prototype.hasOwnProperty;var Hy=function(e,t,n){var r=e[t];Gy.call(e,t)&&Hg(r,n)&&(void 0!==n||t in e)||ny(e,t,n)};var Wy=function(e,t,n,r){var i=!n;n||(n={});for(var a=-1,o=t.length;++a<o;){var s=t[a],u=r?r(n[s],e[s],s,n,e):void 0;void 0===u&&(u=e[s]),i?ny(n,s,u):Hy(n,s,u)}return n};var Xy=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r},Yy=/^(?:0|[1-9]\d*)$/;var Zy=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Yy.test(e))&&e>-1&&e%1==0&&e<t},qy=Object.prototype.hasOwnProperty;var Ky=function(e,t){var n=Cy(e),r=!n&&Sy(e),i=!n&&!r&&ky(e),a=!n&&!r&&!i&&jy(e),o=n||r||i||a,s=o?Xy(e.length,String):[],u=s.length;for(var l in e)!t&&!qy.call(e,l)||o&&("length"==l||i&&("offset"==l||"parent"==l)||a&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Zy(l,u))||s.push(l);return s};var Qy=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t},Jy=Object.prototype.hasOwnProperty;var $y=function(e){if(!gm(e))return Qy(e);var t=vy(e),n=[];for(var r in e)("constructor"!=r||!t&&Jy.call(e,r))&&n.push(r);return n};var e_=function(e){return Ay(e)?Ky(e,!0):$y(e)};var t_=function(e){return Wy(e,e_(e))};var n_=function(e,t,n,r,i,a,o){var s=Vy(e,n),u=Vy(t,n),l=o.get(u);if(l)ry(e,n,l);else{var c=a?a(s,u,n+"",e,t,o):void 0,h=void 0===c;if(h){var f=Cy(u),p=!f&&ky(u),d=!f&&!p&&jy(u);c=u,f||p||d?Cy(s)?c=s:My(s)?c=ly(s):p?(h=!1,c=ay(u,!0)):d?(h=!1,c=uy(u,!0)):c=[]:Ny(u)||Sy(u)?(c=s,Sy(s)?c=t_(s):gm(s)&&!mm(s)||(c=gy(u))):h=!1}h&&(o.set(u,c),i(c,u,r,a,o),o.delete(u)),ry(e,n,c)}};var r_=function e(t,n,r,i,a){t!==n&&iy(n,(function(o,s){if(a||(a=new ey),gm(o))n_(t,n,s,r,e,i,a);else{var u=i?i(Vy(t,s),o,s+"",t,n,a):void 0;void 0===u&&(u=o),ry(t,s,u)}}),e_)};var i_=function(e){return e};var a_=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},o_=Math.max;var s_=function(e,t,n){return t=o_(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,a=o_(r.length-t,0),o=Array(a);++i<a;)o[i]=r[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=r[i];return s[t]=n(o),a_(e,this,s)}};var u_=function(e){return function(){return e}},l_=ty?function(e,t){return ty(e,"toString",{configurable:!0,enumerable:!1,value:u_(t),writable:!0})}:i_,c_=Date.now;var h_=function(e){var t=0,n=0;return function(){var r=c_(),i=16-(r-n);if(n=r,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(l_);var f_=function(e,t){return h_(s_(e,t,i_),e+"")};var p_=function(e,t,n){if(!gm(n))return!1;var r=typeof t;return!!("number"==r?Ay(n)&&Zy(t,n.length):"string"==r&&t in n)&&Hg(n[t],e)};var d_=function(e){return f_((function(t,n){var r=-1,i=n.length,a=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(a=e.length>3&&"function"==typeof a?(i--,a):void 0,o&&p_(n[0],n[1],o)&&(a=i<3?void 0:a,i=1),t=Object(t);++r<i;){var s=n[r];s&&e(t,s,r,a)}return t}))},v_=d_((function(e,t,n,r){r_(e,t,n,r)}));var g_=function(e){return"string"==typeof e||!Cy(e)&&yy(e)&&"[object String]"==vm(e)};var m_=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e},y_=fy(Object.keys,Object),__=Object.prototype.hasOwnProperty;var b_=function(e){if(!vy(e))return y_(e);var t=[];for(var n in Object(e))__.call(e,n)&&"constructor"!=n&&t.push(n);return t};var x_=function(e){return Ay(e)?Ky(e):b_(e)};var E_=function(e,t){return e&&Wy(t,x_(t),e)};var S_=function(e,t){return e&&Wy(t,e_(t),e)};var C_=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,a=[];++n<r;){var o=e[n];t(o,n,e)&&(a[i++]=o)}return a};var T_=function(){return[]},A_=Object.prototype.propertyIsEnumerable,M_=Object.getOwnPropertySymbols,w_=M_?function(e){return null==e?[]:(e=Object(e),C_(M_(e),(function(t){return A_.call(e,t)})))}:T_;var k_=function(e,t){return Wy(e,w_(e),t)};var O_=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},P_=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)O_(t,w_(e)),e=py(e);return t}:T_;var R_=function(e,t){return Wy(e,P_(e),t)};var L_=function(e,t,n){var r=t(e);return Cy(e)?r:O_(r,n(e))};var I_=function(e){return L_(e,x_,w_)};var N_=function(e){return L_(e,e_,P_)},D_=Pm(am,"DataView"),F_=Pm(am,"Promise"),B_=Pm(am,"Set"),U_=Pm(am,"WeakMap"),z_=Em(D_),j_=Em(Rm),V_=Em(F_),G_=Em(B_),H_=Em(U_),W_=vm;(D_&&"[object DataView]"!=W_(new D_(new ArrayBuffer(1)))||Rm&&"[object Map]"!=W_(new Rm)||F_&&"[object Promise]"!=W_(F_.resolve())||B_&&"[object Set]"!=W_(new B_)||U_&&"[object WeakMap]"!=W_(new U_))&&(W_=function(e){var t=vm(e),n="[object Object]"==t?e.constructor:void 0,r=n?Em(n):"";if(r)switch(r){case z_:return"[object DataView]";case j_:return"[object Map]";case V_:return"[object Promise]";case G_:return"[object Set]";case H_:return"[object WeakMap]"}return t});var X_=W_,Y_=Object.prototype.hasOwnProperty;var Z_=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Y_.call(e,"index")&&(n.index=e.index,n.input=e.input),n};var q_=function(e,t){var n=t?sy(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},K_=/\w*$/;var Q_=function(e){var t=new e.constructor(e.source,K_.exec(e));return t.lastIndex=e.lastIndex,t},J_=om?om.prototype:void 0,$_=J_?J_.valueOf:void 0;var eb=function(e){return $_?Object($_.call(e)):{}};var tb=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return sy(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return q_(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return uy(e,n);case"[object Map]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return Q_(e);case"[object Set]":return new r;case"[object Symbol]":return eb(e)}};var nb=function(e){return yy(e)&&"[object Map]"==X_(e)},rb=Uy&&Uy.isMap,ib=rb?By(rb):nb;var ab=function(e){return yy(e)&&"[object Set]"==X_(e)},ob=Uy&&Uy.isSet,sb=ob?By(ob):ab,ub={};ub["[object Arguments]"]=ub["[object Array]"]=ub["[object ArrayBuffer]"]=ub["[object DataView]"]=ub["[object Boolean]"]=ub["[object Date]"]=ub["[object Float32Array]"]=ub["[object Float64Array]"]=ub["[object Int8Array]"]=ub["[object Int16Array]"]=ub["[object Int32Array]"]=ub["[object Map]"]=ub["[object Number]"]=ub["[object Object]"]=ub["[object RegExp]"]=ub["[object Set]"]=ub["[object String]"]=ub["[object Symbol]"]=ub["[object Uint8Array]"]=ub["[object Uint8ClampedArray]"]=ub["[object Uint16Array]"]=ub["[object Uint32Array]"]=!0,ub["[object Error]"]=ub["[object Function]"]=ub["[object WeakMap]"]=!1;var lb=function e(t,n,r,i,a,o){var s,u=1&n,l=2&n,c=4&n;if(r&&(s=a?r(t,i,a,o):r(t)),void 0!==s)return s;if(!gm(t))return t;var h=Cy(t);if(h){if(s=Z_(t),!u)return ly(t,s)}else{var f=X_(t),p="[object Function]"==f||"[object GeneratorFunction]"==f;if(ky(t))return ay(t,u);if("[object Object]"==f||"[object Arguments]"==f||p&&!a){if(s=l||p?{}:gy(t),!u)return l?R_(t,S_(s,t)):k_(t,E_(s,t))}else{if(!ub[f])return a?t:{};s=tb(t,f,u)}}o||(o=new ey);var d=o.get(t);if(d)return d;o.set(t,s),sb(t)?t.forEach((function(i){s.add(e(i,n,r,i,t,o))})):ib(t)&&t.forEach((function(i,a){s.set(a,e(i,n,r,a,t,o))}));var v=h?void 0:(c?l?N_:I_:l?e_:x_)(t);return m_(v||t,(function(i,a){v&&(i=t[a=i]),Hy(s,a,e(i,n,r,a,t,o))})),s};var cb=function(e){return lb(e,5)};
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */function hb(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function fb(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function pb(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function db(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function vb(e,t){return e(t={exports:{}},t.exports),t.exports}var gb=vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e&&"number"==typeof e.length&&e.length>=0&&e.length%1==0},e.exports=t.default}));db(gb);var mb=vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop();return e.call(this,t,r)}},e.exports=t.default}));db(mb);var yb=vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.fallback=a,t.wrap=o;var n,r=t.hasSetImmediate="function"==typeof setImmediate&&setImmediate,i=t.hasNextTick="object"==typeof process&&"function"==typeof process.nextTick;function a(e){setTimeout(e,0)}function o(e){return function(t){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return e((function(){return t.apply(void 0,n)}))}}n=r?setImmediate:i?process.nextTick:a,t.default=o(n)}));db(yb);yb.fallback,yb.wrap,yb.hasSetImmediate,yb.hasNextTick;var _b=vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,bb.isAsync)(e))return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop(),i=e.apply(this,t);return a(i,r)};return(0,n.default)((function(t,n){var r;try{r=e.apply(this,t)}catch(e){return n(e)}if(r&&"function"==typeof r.then)return a(r,n);n(null,r)}))};var n=i(mb),r=i(yb);function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return e.then((function(e){o(t,null,e)}),(function(e){o(t,e&&e.message?e:new Error(e))}))}function o(e,t,n){try{e(t,n)}catch(e){(0,r.default)((function(e){throw e}),e)}}e.exports=t.default}));db(_b);var bb=vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isAsyncIterable=t.isAsyncGenerator=t.isAsync=void 0;var n,r=(n=_b)&&n.__esModule?n:{default:n};function i(e){return"AsyncFunction"===e[Symbol.toStringTag]}t.default=function(e){if("function"!=typeof e)throw new Error("expected a function");return i(e)?(0,r.default)(e):e},t.isAsync=i,t.isAsyncGenerator=function(e){return"AsyncGenerator"===e[Symbol.toStringTag]},t.isAsyncIterable=function(e){return"function"==typeof e[Symbol.asyncIterator]}}));db(bb);bb.isAsyncIterable,bb.isAsyncGenerator,bb.isAsync;var xb=vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){void 0===t&&(t=e.length);if(!t)throw new Error("arity is undefined");function n(){for(var n=this,r=[],i=arguments.length;i--;)r[i]=arguments[i];return"function"==typeof r[t-1]?e.apply(this,r):new Promise((function(i,a){r[t-1]=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if(e)return a(e);i(t.length>1?t:t[0])},e.apply(n,r)}))}return Object.defineProperty(n,"name",{configurable:!0,value:"awaitable("+e.name+")"}),n},e.exports=t.default}));db(xb);var Eb=vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(gb),r=a(bb),i=a(xb);function a(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i){var a=(0,n.default)(t)?[]:{};e(t,(function(e,t,n){(0,r.default)(e)((function(e){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];r.length<2&&(r=r[0]),a[t]=r,n(e)}))}),(function(e){return i(e,a)}))}),3),e.exports=t.default}));db(Eb);var Sb=vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null!==e){var r=e;e=null,r.apply(this,t)}}return Object.assign(t,e),t},e.exports=t.default}));db(Sb);var Cb=vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e[Symbol.iterator]&&e[Symbol.iterator]()},e.exports=t.default}));db(Cb);var Tb=vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,n.default)(e))return function(e){var t=-1,n=e.length;return function(){return++t<n?{value:e[t],key:t}:null}}(e);var t=(0,r.default)(e);return t?function(e){var t=-1;return function(){var n=e.next();return n.done?null:(t++,{value:n.value,key:t})}}(t):function(e){var t=e?Object.keys(e):[],n=-1,r=t.length;return function(){var i=t[++n];return n<r?{value:e[i],key:i}:null}}(e)};var n=i(gb),r=i(Cb);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}));db(Tb);var Ab=vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null===e)throw new Error("Callback was already called.");var r=e;e=null,r.apply(this,t)}},e.exports=t.default}));db(Ab);var Mb=vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default={},e.exports=t.default}));db(Mb);var wb=vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i){var a=!1,o=!1,s=!1,u=0,l=0;function c(){u>=t||s||a||(s=!0,e.next().then((function(e){var t=e.value,r=e.done;if(!o&&!a){if(s=!1,r)return a=!0,void(u<=0&&i(null));u++,n(t,l,h),l++,c()}})).catch(f))}function h(e,t){if(u-=1,!o)return e?f(e):!1===e?(a=!0,void(o=!0)):t===r.default||a&&u<=0?(a=!0,i(null)):void c()}function f(e){o||(s=!1,a=!0,i(e))}c()};var n,r=(n=Mb)&&n.__esModule?n:{default:n};e.exports=t.default}));db(wb);var kb=vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=s(Sb),r=s(Tb),i=s(Ab),a=s(wb),o=s(Mb);function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){return function(t,s,u){if(u=(0,n.default)(u),e<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!t)return u(null);if((0,bb.isAsyncGenerator)(t))return(0,a.default)(t,e,s,u);if((0,bb.isAsyncIterable)(t))return(0,a.default)(t[Symbol.asyncIterator](),e,s,u);var l=(0,r.default)(t),c=!1,h=!1,f=0,p=!1;function d(e,t){if(!h)if(f-=1,e)c=!0,u(e);else if(!1===e)c=!0,h=!0;else{if(t===o.default||c&&f<=0)return c=!0,u(null);p||v()}}function v(){for(p=!0;f<e&&!c;){var t=l();if(null===t)return c=!0,void(f<=0&&u(null));f+=1,s(t.value,t.key,(0,i.default)(d))}p=!1}v()}},e.exports=t.default}));db(kb);var Ob=vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(kb),r=a(bb),i=a(xb);function a(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i,a){return(0,n.default)(t)(e,(0,r.default)(i),a)}),4),e.exports=t.default}));db(Ob);var Pb=vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(Ob),r=i(xb);function i(e){return e&&e.__esModule?e:{default:e}}t.default=(0,r.default)((function(e,t,r){return(0,n.default)(e,1,t,r)}),3),e.exports=t.default}));db(Pb);var Rb=db(vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,n.default)(r.default,e,t)};var n=i(Eb),r=i(Pb);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}))),Lb=function(){function e(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,Rb(this.tasks)},e.prototype.tap=function(e,t){var n=this;this.tasks.push((function(r){t.apply(void 0,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(pb(arguments[t]));return e}(n.args)),r(null,e)}))},e}(),Ib=vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=l(gb),r=l(Mb),i=l(Ob),a=l(Sb),o=l(Ab),s=l(bb),u=l(xb);function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n){n=(0,a.default)(n);var i=0,s=0,u=e.length,l=!1;function c(e,t){!1===e&&(l=!0),!0!==l&&(e?n(e):++s!==u&&t!==r.default||n(null))}for(0===u&&n(null);i<u;i++)t(e[i],i,(0,o.default)(c))}function h(e,t,n){return(0,i.default)(e,1/0,t,n)}t.default=(0,u.default)((function(e,t,r){return((0,n.default)(e)?c:h)(e,(0,s.default)(t),r)}),3),e.exports=t.default}));db(Ib);var Nb=db(vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,r.default)(n.default,e,t)};var n=i(Ib),r=i(Eb);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}))),Db=function(){function e(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];this.tasks=[]}return e.prototype.promise=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return Nb(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return hb(n,void 0,void 0,(function(){return fb(this,(function(n){switch(n.label){case 0:return[4,t()];case 1:return n.sent(),r(null,e),[2]}}))}))}))},e}(),Fb=db(vb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(Sb),r=o(Ab),i=o(bb),a=o(xb);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,a.default)((function(e,t){if(t=(0,n.default)(t),!Array.isArray(e))return t(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return t();var a=0;function o(t){(0,i.default)(e[a++]).apply(void 0,t.concat([(0,r.default)(s)]))}function s(n){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];if(!1!==n)return n||a===e.length?t.apply(void 0,[n].concat(r)):void o(r)}o([])})),e.exports=t.default}))),Bb=function(){function e(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];this.tasks=[]}return e.prototype.call=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return Fb(this.tasks)},e.prototype.tap=function(e,t){0===this.tasks.length?this.tasks.push((function(e){var n=t();e(!!n&&null,n)})):this.tasks.push((function(n,r){r(!!t()&&null,e)}))},e}(),Ub=function(){function e(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];this.tasks=[]}return e.prototype.call=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return Rb(this.tasks)},e.prototype.tap=function(e,t){this.tasks.push((function(n){n(t(),e)}))},e}(),zb=H((function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,r,a,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,a||e,o),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,o=new Array(a);i<a;i++)o[i]=r[i].fn;return o},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,a,o){var s=n?n+e:e;if(!this._events[s])return!1;var u,l,c=this._events[s],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,a),!0;case 6:return c.fn.call(c.context,t,r,i,a,o),!0}for(l=1,u=new Array(h-1);l<h;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var f,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),h){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,r);break;case 4:c[l].fn.call(c[l].context,t,r,i);break;default:if(!u)for(f=1,u=new Array(h-1);f<h;f++)u[f-1]=arguments[f];c[l].fn.apply(c[l].context,u)}}return!0},s.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||o(this,a);else{for(var u=0,l=[],c=s.length;u<c;u++)(s[u].fn!==t||i&&!s[u].once||r&&s[u].context!==r)&&l.push(s[u]);l.length?this._events[a]=1===l.length?l[0]:l:o(this,a)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&o(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s})),jb=zb.EventEmitter,Vb=H((function(e,t){e.exports=function(){function e(n,r,i,a,o,s){if(!(o-a<=i)){var u=a+o>>1;!function e(n,r,i,a,o,s){for(;o>a;){if(o-a>600){var u=o-a+1,l=i-a+1,c=Math.log(u),h=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*h*(u-h)/u)*(l-u/2<0?-1:1),p=Math.max(a,Math.floor(i-l*h/u+f)),d=Math.min(o,Math.floor(i+(u-l)*h/u+f));e(n,r,i,p,d,s)}var v=r[2*i+s],g=a,m=o;for(t(n,r,a,i),r[2*o+s]>v&&t(n,r,a,o);g<m;){for(t(n,r,g,m),g++,m--;r[2*g+s]<v;)g++;for(;r[2*m+s]>v;)m--}r[2*a+s]===v?t(n,r,a,m):(m++,t(n,r,m,o)),m<=i&&(a=m+1),i<=m&&(o=m-1)}}(n,r,u,a,o,s%2),e(n,r,i,a,u-1,s+1),e(n,r,i,u+1,o,s+1)}}function t(e,t,r,i){n(e,r,i),n(t,2*r,2*i),n(t,2*r+1,2*i+1)}function n(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function r(e,t,n,r){var i=e-n,a=t-r;return i*i+a*a}var i=function(e){return e[0]},a=function(e){return e[1]},o=function(t,n,r,o,s){void 0===n&&(n=i),void 0===r&&(r=a),void 0===o&&(o=64),void 0===s&&(s=Float64Array),this.nodeSize=o,this.points=t;for(var u=t.length<65536?Uint16Array:Uint32Array,l=this.ids=new u(t.length),c=this.coords=new s(2*t.length),h=0;h<t.length;h++)l[h]=h,c[2*h]=n(t[h]),c[2*h+1]=r(t[h]);e(l,c,o,0,l.length-1,0)};o.prototype.range=function(e,t,n,r){return function(e,t,n,r,i,a,o){for(var s,u,l=[0,e.length-1,0],c=[];l.length;){var h=l.pop(),f=l.pop(),p=l.pop();if(f-p<=o)for(var d=p;d<=f;d++)s=t[2*d],u=t[2*d+1],s>=n&&s<=i&&u>=r&&u<=a&&c.push(e[d]);else{var v=Math.floor((p+f)/2);s=t[2*v],u=t[2*v+1],s>=n&&s<=i&&u>=r&&u<=a&&c.push(e[v]);var g=(h+1)%2;(0===h?n<=s:r<=u)&&(l.push(p),l.push(v-1),l.push(g)),(0===h?i>=s:a>=u)&&(l.push(v+1),l.push(f),l.push(g))}}return c}(this.ids,this.coords,e,t,n,r,this.nodeSize)},o.prototype.within=function(e,t,n){return function(e,t,n,i,a,o){for(var s=[0,e.length-1,0],u=[],l=a*a;s.length;){var c=s.pop(),h=s.pop(),f=s.pop();if(h-f<=o)for(var p=f;p<=h;p++)r(t[2*p],t[2*p+1],n,i)<=l&&u.push(e[p]);else{var d=Math.floor((f+h)/2),v=t[2*d],g=t[2*d+1];r(v,g,n,i)<=l&&u.push(e[d]);var m=(c+1)%2;(0===c?n-a<=v:i-a<=g)&&(s.push(f),s.push(d-1),s.push(m)),(0===c?n+a>=v:i+a>=g)&&(s.push(d+1),s.push(h),s.push(m))}}return u}(this.ids,this.coords,e,t,n,this.nodeSize)};var s={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},u=Math.fround||function(e){return function(t){return e[0]=+t,e[0]}}(new Float32Array(1)),l=function(e){this.options=g(Object.create(s),e),this.trees=new Array(this.options.maxZoom+1)};function c(e,t,n,r,i){return{x:u(e),y:u(t),zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function h(e,t){var n=e.geometry.coordinates,r=n[0],i=n[1];return{x:u(d(r)),y:u(v(i)),zoom:1/0,index:t,parentId:-1}}function f(e){return{type:"Feature",id:e.id,properties:p(e),geometry:{type:"Point",coordinates:[(r=e.x,360*(r-.5)),(t=e.y,n=(180-360*t)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var t,n,r}function p(e){var t=e.numPoints,n=t>=1e4?Math.round(t/1e3)+"k":t>=1e3?Math.round(t/100)/10+"k":t;return g(g({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:n})}function d(e){return e/360+.5}function v(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function g(e,t){for(var n in t)e[n]=t[n];return e}function m(e){return e.x}function y(e){return e.y}return l.prototype.load=function(e){var t=this.options,n=t.log,r=t.minZoom,i=t.maxZoom,a=t.nodeSize;n&&console.time("total time");var s="prepare "+e.length+" points";n&&console.time(s),this.points=e;for(var u=[],l=0;l<e.length;l++)e[l].geometry&&u.push(h(e[l],l));this.trees[i+1]=new o(u,m,y,a,Float32Array),n&&console.timeEnd(s);for(var c=i;c>=r;c--){var f=+Date.now();u=this._cluster(u,c),this.trees[c]=new o(u,m,y,a,Float32Array),n&&console.log("z%d: %d clusters in %dms",c,u.length,+Date.now()-f)}return n&&console.timeEnd("total time"),this},l.prototype.getClusters=function(e,t){var n=((e[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[1])),i=180===e[2]?180:((e[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){var o=this.getClusters([n,r,180,a],t),s=this.getClusters([-180,r,i,a],t);return o.concat(s)}for(var u=this.trees[this._limitZoom(t)],l=[],c=0,h=u.range(d(n),v(a),d(i),v(r));c<h.length;c+=1){var p=h[c],g=u.points[p];l.push(g.numPoints?f(g):this.points[g.index])}return l},l.prototype.getChildren=function(e){var t=this._getOriginId(e),n=this._getOriginZoom(e),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var a=i.points[t];if(!a)throw new Error(r);for(var o=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,l=i.within(a.x,a.y,o);u<l.length;u+=1){var c=l[u],h=i.points[c];h.parentId===e&&s.push(h.numPoints?f(h):this.points[h.index])}if(0===s.length)throw new Error(r);return s},l.prototype.getLeaves=function(e,t,n){t=t||10,n=n||0;var r=[];return this._appendLeaves(r,e,t,n,0),r},l.prototype.getTile=function(e,t,n){var r=this.trees[this._limitZoom(e)],i=Math.pow(2,e),a=this.options,o=a.extent,s=a.radius/o,u=(n-s)/i,l=(n+1+s)/i,c={features:[]};return this._addTileFeatures(r.range((t-s)/i,u,(t+1+s)/i,l),r.points,t,n,i,c),0===t&&this._addTileFeatures(r.range(1-s/i,u,1,l),r.points,i,n,i,c),t===i-1&&this._addTileFeatures(r.range(0,u,s/i,l),r.points,-1,n,i,c),c.features.length?c:null},l.prototype.getClusterExpansionZoom=function(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t},l.prototype._appendLeaves=function(e,t,n,r,i){for(var a=0,o=this.getChildren(t);a<o.length;a+=1){var s=o[a],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(e,u.cluster_id,n,r,i):i<r?i++:e.push(s),e.length===n)break}return i},l.prototype._addTileFeatures=function(e,t,n,r,i,a){for(var o=0,s=e;o<s.length;o+=1){var u=t[s[o]],l=u.numPoints,c=void 0,h=void 0,f=void 0;if(l)c=p(u),h=u.x,f=u.y;else{var g=this.points[u.index];c=g.properties,h=d(g.geometry.coordinates[0]),f=v(g.geometry.coordinates[1])}var m={type:1,geometry:[[Math.round(this.options.extent*(h*i-n)),Math.round(this.options.extent*(f*i-r))]],tags:c},y=void 0;l?y=u.id:this.options.generateId?y=u.index:this.points[u.index].id&&(y=this.points[u.index].id),void 0!==y&&(m.id=y),a.features.push(m)}},l.prototype._limitZoom=function(e){return Math.max(this.options.minZoom,Math.min(+e,this.options.maxZoom+1))},l.prototype._cluster=function(e,t){for(var n=[],r=this.options,i=r.radius,a=r.extent,o=r.reduce,s=r.minPoints,u=i/(a*Math.pow(2,t)),l=0;l<e.length;l++){var h=e[l];if(!(h.zoom<=t)){h.zoom=t;for(var f=this.trees[t+1],p=f.within(h.x,h.y,u),d=h.numPoints||1,v=d,g=0,m=p;g<m.length;g+=1){var y=m[g],_=f.points[y];_.zoom>t&&(v+=_.numPoints||1)}if(v>d&&v>=s){for(var b=h.x*d,x=h.y*d,E=o&&d>1?this._map(h,!0):null,S=(l<<5)+(t+1)+this.points.length,C=0,T=p;C<T.length;C+=1){var A=T[C],M=f.points[A];if(!(M.zoom<=t)){M.zoom=t;var w=M.numPoints||1;b+=M.x*w,x+=M.y*w,M.parentId=S,o&&(E||(E=this._map(h,!0)),o(E,this._map(M)))}}h.parentId=S,n.push(c(b/v,x/v,S,v,E))}else if(n.push(h),v>1)for(var k=0,O=p;k<O.length;k+=1){var P=O[k],R=f.points[P];R.zoom<=t||(R.zoom=t,n.push(R))}}}return n},l.prototype._getOriginId=function(e){return e-this.points.length>>5},l.prototype._getOriginZoom=function(e){return(e-this.points.length)%32},l.prototype._map=function(e,t){if(e.numPoints)return t?g({},e.properties):e.properties;var n=this.points[e.index].properties,r=this.options.map(n);return t&&r===n?g({},r):r},l}()}));function Gb(e,t){var n=t.radius,r=void 0===n?40:n,i=t.maxZoom,a=void 0===i?18:i,o=t.minZoom,s=void 0===o?0:o,u=t.zoom,l=void 0===u?2:u;if(e.pointIndex){var c=e.pointIndex.getClusters(e.extent,Math.floor(l));return e.dataArray=c.map((function(e,t){return v({coordinates:e.geometry.coordinates,_id:t+1},e.properties)})),e}var h=new Vb({radius:r,minZoom:s,maxZoom:a}),f={type:"FeatureCollection",features:[]};return f.features=e.dataArray.map((function(e){return{type:"Feature",geometry:{type:"Point",coordinates:e.coordinates},properties:v({},e)}})),h.load(f.features),h}function Hb(e){if(0===e.length)return 0;for(var t,n=e[0],r=0,i=1;i<e.length;i++)t=n+1*e[i],Math.abs(n)>=Math.abs(e[i])?r+=n-t+e[i]:r+=e[i]-t+n,n=t;return n+1*r}var Wb={min:function(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return t},max:function(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return t},mean:function(e){if(0===e.length)throw new Error("mean requires at least one data point");return Hb(e)/e.length},sum:Hb};function Xb(e,t){if(Array.isArray(t))return t}var Yb=function(e){S(r,e);var t=R(r);function r(e,n){var i;return _(this,r),E(O(i=t.call(this)),"data",void 0),E(O(i),"extent",void 0),E(O(i),"hooks",{init:new Lb}),E(O(i),"parser",{type:"geojson"}),E(O(i),"transforms",[]),E(O(i),"cluster",!1),E(O(i),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),E(O(i),"mapService",void 0),E(O(i),"invalidExtent",!1),E(O(i),"dataArrayChanged",!1),E(O(i),"originData",void 0),E(O(i),"rawData",void 0),E(O(i),"cfg",{}),E(O(i),"clusterIndex",void 0),i.originData=e,i.initCfg(n),i.hooks.init.tap("parser",(function(){i.excuteParser()})),i.hooks.init.tap("cluster",(function(){i.initCluster()})),i.hooks.init.tap("transform",(function(){i.executeTrans()})),i.init(),i}return x(r,[{key:"setData",value:function(e,t){this.originData=e,this.dataArrayChanged=!1,this.initCfg(t),this.init(),this.emit("update")}},{key:"getClusters",value:function(e){return this.clusterIndex.getClusters(this.caculClusterExtent(2),e)}},{key:"getClustersLeaves",value:function(e){return this.clusterIndex.getLeaves(e,1/0)}},{key:"updateClusterData",value:function(e){var t=this,n=this.clusterOptions,r=n.method,a=void 0===r?"sum":r,o=n.field,s=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(e));this.clusterOptions.zoom=e,s.forEach((function(e){e.id||(e.properties.point_count=1)})),(o||mm(a))&&(s=s.map((function(e){var n=e.id;if(n){var r,i=t.clusterIndex.getLeaves(n,1/0).map((function(e){return e.properties}));if(g_(a)&&o){var s=function(e,t){return e.map((function(e){return 1*e[t]}))}(i,o);r=Wb[a](s)}mm(a)&&(r=a(i)),e.properties.stat=r}else e.properties.point_count=1;return e}))),this.data=i("geojson")({type:"FeatureCollection",features:s}),this.executeTrans()}},{key:"getFeatureById",value:function(e){var t=this.parser.type;if("geojson"!==(void 0===t?"geojson":t)||this.cluster)return e<this.data.dataArray.length?this.data.dataArray[e]:"null";var n=e<this.originData.features.length?this.originData.features[e]:"null",r=cb(n);if(0!==this.transforms.length||this.dataArrayChanged){var i=this.data.dataArray.find((function(t){return t._id===e}));r.properties=i}return r}},{key:"updateFeaturePropertiesById",value:function(e,t){this.data.dataArray=this.data.dataArray.map((function(n){return n._id===e?v(v({},n),t):n})),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(e,t){var n=this.data.dataArray.find((function(n){return n[e]===t}));return null==n?void 0:n._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(e){var t=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(t=kv(Pv(this.extent),e)),t[0].concat(t[1])}},{key:"initCfg",value:function(e){this.cfg=v_(this.cfg,e,Xb);var t=this.cfg;t&&(t.parser&&(this.parser=t.parser),t.transforms&&(this.transforms=t.transforms),this.cluster=t.cluster||!1,t.clusterOptions&&(this.cluster=!0,this.clusterOptions=v(v({},this.clusterOptions),t.clusterOptions)))}},{key:"excuteParser",value:function(){var e=this.parser,t=e.type||"geojson";if("imagetile"!==t){var n=i(t);this.data=n(this.originData,e),this.extent=Ev(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}else this.data={tileurl:this.originData,dataArray:[]}}},{key:"executeTrans",value:function(){var e=this;this.transforms.forEach((function(t){var r=function(e){return n[e]}(t.type)(e.data,t);Object.assign(e.data,r)}))}},{key:"initCluster",value:function(){if(this.cluster){var e=this.clusterOptions||{};this.clusterIndex=Gb(this.data,e)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(jb);var Zb=Z.isFinite,qb=Number.isFinite||function(e){return"number"==typeof e&&Zb(e)};er({target:"Number",stat:!0},{isFinite:qb});var Kb=wf.left,Qb=bn("reduce");er({target:"Array",proto:!0,forced:!Qb||!di&&Ce>79&&Ce<83},{reduce:function(e){var t=arguments.length;return Kb(this,e,t,t>1?arguments[1]:void 0)}});var Jb=Math.PI/3,$b=[0,Jb,2*Jb,3*Jb,4*Jb,5*Jb];function ex(e){return e[0]}function tx(e){return e[1]}a("geojson",(function(e,t){var n=[],r={};return e.features=e.features.filter((function(e){var t=e.geometry;return null!=e&&t&&t.type&&t.coordinates&&t.coordinates.length>0})),cr(e,!0),0===e.features.length?{dataArray:[],featureKeys:r}:(br(e,(function(e,t){var r=function(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}(e),i=t,a=v(v({},e.properties),{},{coordinates:r,_id:i});n.push(a)})),{dataArray:n,featureKeys:r})})),a("image",Bg),a("csv",(function(e,t){return dr(p(e),t)})),a("json",dr),a("raster",(function(e,t){var n=t.extent,r=t.width,i=t.height,a=t.min,o=t.max;return{_id:1,dataArray:[{_id:1,data:Array.from(e),width:r,height:i,min:a,max:o,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]}})),o("cluster",Gb),o("filter",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.filter(n)),e})),o("join",(function(e,t){var n=t.sourceField,r=t.targetField,i=t.data,a={};return i.forEach((function(e){a[e[n]]=e})),e.dataArray=e.dataArray.map((function(e){var t=e[r];return v(v({},e),a[t])})),e})),o("map",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.map(n)),e})),o("grid",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,a=i/(2*Math.PI*6378e3)*(256<<20)/2,o=function(e,t){var n,r,i=1/0,a=-1/0,o=U(e);try{for(o.s();!(r=o.n()).done;){var s=r.value;n=s.coordinates[1],Number.isFinite(n)&&(i=n<i?n:i,a=n>a?n:a)}}catch(e){o.e(e)}finally{o.f()}var u=function(e,t){var n=(i=e,i/6378e3*(180/Math.PI)),r=function(e,t){return t/6378e3*(180/Math.PI)/Math.cos(e*Math.PI/180)}(t,e);var i;return{yOffset:n,xOffset:r}}(t,(i+a)/2);if(u.xOffset<=0||u.yOffset<=0)return{gridHash:{},gridOffset:u};var l,c={},h=U(e);try{for(h.s();!(l=h.n()).done;){var f=l.value,p=f.coordinates[1],d=f.coordinates[0];if(Number.isFinite(p)&&Number.isFinite(d)){var v=Math.floor((p+90)/u.yOffset),g=Math.floor((d+180)/u.xOffset),m="".concat(v,"-").concat(g);c[m]=c[m]||{count:0,points:[]},c[m].count+=1,c[m].points.push(f)}}}catch(e){h.e(e)}finally{h.f()}return{gridHash:c,gridOffset:u}}(n,i);return{yOffset:a,xOffset:a,radius:a,type:"grid",dataArray:function(e,t,n){return Object.keys(e).reduce((function(r,i,a){var o=i.split("-"),s=parseInt(o[0],10),u=parseInt(o[1],10),l={};if(n.field&&n.method){var c=Ng(e[i].points,n.field);l[n.method]=Ig[n.method](c)}return Object.assign(l,{_id:a,coordinates:Mv([t.xOffset*(u+.5)-180,t.yOffset*(s+.5)-90]),rawData:e[i].points,count:e[i].count}),r.push(l),r}),[])}(o.gridHash,o.gridOffset,t)}})),o("hexagon",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,a=t.method,o=void 0===a?"sum":a,s=i/(2*Math.PI*6378e3)*(256<<20)/2,u=n.map((function(e){var t=N(Mv(e.coordinates),2),n=t[0],r=t[1];return v(v({},e),{},{coordinates:[n,r]})}));return{dataArray:function(){var e,t,n,r=0,i=0,a=1,o=1,s=ex,u=tx;function l(e){var r,i={},a=[],o=e.length;for(r=0;r<o;++r)if(!isNaN(c=+s.call(null,l=e[r],r,e))&&!isNaN(h=+u.call(null,l,r,e))){var l,c,h,f=Math.round(h/=n),p=Math.round(c=c/t-(1&f)/2),d=h-f;if(3*Math.abs(d)>1){var v=c-p,g=p+(c<p?-1:1)/2,m=f+(h<f?-1:1),y=c-g,_=h-m;v*v+d*d>y*y+_*_&&(p=g+(1&f?1:-1)/2,f=m)}var b=p+"-"+f,x=i[b];x?x.push(l):(a.push(x=i[b]=[l]),x.x=(p+(1&f)/2)*t,x.y=f*n)}return a}function c(e){var t=0,n=0;return $b.map((function(r){var i=Math.sin(r)*e,a=-Math.cos(r)*e,o=i-t,s=a-n;return t=i,n=a,[o,s]}))}return l.hexagon=function(t){return"m"+c(null==t?e:+t).join("l")+"z"},l.centers=function(){for(var s=[],u=Math.round(i/n),l=Math.round(r/t),c=u*n;c<o+e;c+=n,++u)for(var h=l*t+(1&u)*t/2;h<a+t/2;h+=t)s.push([h,c]);return s},l.mesh=function(){var t=c(e).slice(0,4).join("l");return l.centers().map((function(e){return"M"+e+"m"+t})).join("")},l.x=function(e){return arguments.length?(s=e,l):s},l.y=function(e){return arguments.length?(u=e,l):u},l.radius=function(r){return arguments.length?(t=2*(e=+r)*Math.sin(Jb),n=1.5*e,l):e},l.size=function(e){return arguments.length?(r=i=0,a=+e[0],o=+e[1],l):[a-r,o-i]},l.extent=function(e){return arguments.length?(r=+e[0][0],i=+e[0][1],a=+e[1][0],o=+e[1][1],l):[[r,i],[a,o]]},l.radius(1)}().radius(s).x((function(e){return e.coordinates[0]})).y((function(e){return e.coordinates[1]}))(u).map((function(e,n){var r;if(t.field&&o){var i=Ng(e,t.field);e[o]=Ig[o](i)}return E(r={},t.method,e[o]),E(r,"count",e.length),E(r,"rawData",e),E(r,"coordinates",[e.x,e.y]),E(r,"_id",n),r})),radius:s,xOffset:s,yOffset:s,type:"hexagon"}}));var nx,rx=[{lng1:100,lat1:30,lng2:130,lat2:30}],ix={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};!function(e){!function(t){var n="object"==typeof V?V:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),r=i(e);function i(e,t){return function(n,r){"function"!=typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}void 0===n.Reflect?n.Reflect=e:r=i(n.Reflect,r),function(e){var t=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,r=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",a="function"==typeof Object.create,o={__proto__:[]}instanceof Array,s=!a&&!o,u={create:a?function(){return R(Object.create(null))}:o?function(){return R({__proto__:null})}:function(){return R({})},has:s?function(e,n){return t.call(e,n)}:function(e,t){return t in e},get:s?function(e,n){return t.call(e,n)?e[n]:void 0}:function(e,t){return e[t]}},l=Object.getPrototypeOf(Function),c="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,h=c||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,a)},t.prototype.entries=function(){return new n(this._keys,this._values,o)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function a(e,t){return t}function o(e,t){return[e,t]}}():Map,f=c||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new h}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}():Set,p=new(c||"function"!=typeof WeakMap?function(){var e=u.create(),n=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var t;do{t="@@WeakMap@@"+o()}while(u.has(e,t));return e[t]=!0,t}function i(e,r){if(!t.call(e,n)){if(!r)return;Object.defineProperty(e,n,{value:u.create()})}return e[n]}function a(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function o(){var e=function(e){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):a(new Uint8Array(e),e):a(new Array(e),e)}(16);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var t="",n=0;n<16;++n){var r=e[n];4!==n&&6!==n&&8!==n||(t+="-"),r<16&&(t+="0"),t+=r.toString(16).toLowerCase()}return t}}():WeakMap);function d(e,t,n){var r=p.get(e);if(b(r)){if(!n)return;r=new h,p.set(e,r)}var i=r.get(t);if(b(i)){if(!n)return;i=new h,r.set(t,i)}return i}function v(e,t,n){var r=d(t,n,!1);return!b(r)&&!!r.has(e)}function g(e,t,n){var r=d(t,n,!1);if(!b(r))return r.get(e)}function m(e,t,n,r){d(n,r,!0).set(e,t)}function y(e,t){var n=[],r=d(e,t,!1);if(b(r))return n;for(var a=function(e){var t=w(e,i);if(!A(t))throw new TypeError;var n=t.call(e);if(!E(n))throw new TypeError;return n}(r.keys()),o=0;;){var s=k(a);if(!s)return n.length=o,n;var u=s.value;try{n[o]=u}catch(e){try{O(a)}finally{throw e}}o++}}function _(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function b(e){return void 0===e}function x(e){return null===e}function E(e){return"object"==typeof e?null!==e:"function"==typeof e}function S(e,t){switch(_(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",i=w(e,r);if(void 0!==i){var a=i.call(e,n);if(E(a))throw new TypeError;return a}return function(e,t){if("string"===t){var n=e.toString;if(A(n))if(!E(i=n.call(e)))return i;if(A(r=e.valueOf))if(!E(i=r.call(e)))return i}else{var r;if(A(r=e.valueOf))if(!E(i=r.call(e)))return i;var i,a=e.toString;if(A(a))if(!E(i=a.call(e)))return i}throw new TypeError}(e,"default"===n?"number":n)}function C(e){var t=S(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function T(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function A(e){return"function"==typeof e}function M(e){return"function"==typeof e}function w(e,t){var n=e[t];if(null!=n){if(!A(n))throw new TypeError;return n}}function k(e){var t=e.next();return!t.done&&t}function O(e){var t=e.return;t&&t.call(e)}function P(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===l)return t;if(t!==l)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!=typeof i||i===e?t:i}function R(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,n,r){if(b(n)){if(!T(e))throw new TypeError;if(!M(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!b(r)&&!x(r)){if(!M(r))throw new TypeError;t=r}}return t}(e,t)}if(!T(e))throw new TypeError;if(!E(t))throw new TypeError;if(!E(r)&&!b(r)&&!x(r))throw new TypeError;return x(r)&&(r=void 0),function(e,t,n,r){for(var i=e.length-1;i>=0;--i){var a=(0,e[i])(t,n,r);if(!b(a)&&!x(a)){if(!E(a))throw new TypeError;r=a}}return r}(e,t,n=C(n),r)})),e("metadata",(function(e,t){return function(n,r){if(!E(n))throw new TypeError;if(!b(r)&&!function(e){switch(_(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;m(e,t,n,r)}})),e("defineMetadata",(function(e,t,n,r){if(!E(n))throw new TypeError;return b(r)||(r=C(r)),m(e,t,n,r)})),e("hasMetadata",(function(e,t,n){if(!E(t))throw new TypeError;return b(n)||(n=C(n)),function e(t,n,r){if(v(t,n,r))return!0;var i=P(n);return!x(i)&&e(t,i,r)}(e,t,n)})),e("hasOwnMetadata",(function(e,t,n){if(!E(t))throw new TypeError;return b(n)||(n=C(n)),v(e,t,n)})),e("getMetadata",(function(e,t,n){if(!E(t))throw new TypeError;return b(n)||(n=C(n)),function e(t,n,r){if(v(t,n,r))return g(t,n,r);var i=P(n);return x(i)?void 0:e(t,i,r)}(e,t,n)})),e("getOwnMetadata",(function(e,t,n){if(!E(t))throw new TypeError;return b(n)||(n=C(n)),g(e,t,n)})),e("getMetadataKeys",(function(e,t){if(!E(e))throw new TypeError;return b(t)||(t=C(t)),function e(t,n){var r=y(t,n),i=P(t);if(null===i)return r;var a=e(i,n);if(a.length<=0)return r;if(r.length<=0)return a;for(var o=new f,s=[],u=0,l=r;u<l.length;u++){var c=l[u];o.has(c)||(o.add(c),s.push(c))}for(var h=0,p=a;h<p.length;h++){c=p[h];o.has(c)||(o.add(c),s.push(c))}return s}(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!E(e))throw new TypeError;return b(t)||(t=C(t)),y(e,t)})),e("deleteMetadata",(function(e,t,n){if(!E(t))throw new TypeError;b(n)||(n=C(n));var r=d(t,n,!1);if(b(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=p.get(t);return i.delete(n),i.size>0||p.delete(t),!0}))}(r)}()}(nx||(nx={}));var ax=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NON_CUSTOM_TAG_KEYS=t.POST_CONSTRUCT=t.DESIGN_PARAM_TYPES=t.PARAM_TYPES=t.TAGGED_PROP=t.TAGGED=t.MULTI_INJECT_TAG=t.INJECT_TAG=t.OPTIONAL_TAG=t.UNMANAGED_TAG=t.NAME_TAG=t.NAMED_TAG=void 0,t.NAMED_TAG="named",t.NAME_TAG="name",t.UNMANAGED_TAG="unmanaged",t.OPTIONAL_TAG="optional",t.INJECT_TAG="inject",t.MULTI_INJECT_TAG="multi_inject",t.TAGGED="inversify:tagged",t.TAGGED_PROP="inversify:tagged_props",t.PARAM_TYPES="inversify:paramtypes",t.DESIGN_PARAM_TYPES="design:paramtypes",t.POST_CONSTRUCT="post_construct",t.NON_CUSTOM_TAG_KEYS=[t.INJECT_TAG,t.MULTI_INJECT_TAG,t.NAME_TAG,t.UNMANAGED_TAG,t.NAMED_TAG,t.OPTIONAL_TAG]}));G(ax);ax.NON_CUSTOM_TAG_KEYS,ax.POST_CONSTRUCT,ax.DESIGN_PARAM_TYPES,ax.PARAM_TYPES,ax.TAGGED_PROP,ax.TAGGED,ax.MULTI_INJECT_TAG,ax.INJECT_TAG,ax.OPTIONAL_TAG,ax.UNMANAGED_TAG,ax.NAME_TAG,ax.NAMED_TAG;var ox=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TargetTypeEnum=t.BindingTypeEnum=t.BindingScopeEnum=void 0;t.BindingScopeEnum={Request:"Request",Singleton:"Singleton",Transient:"Transient"};t.BindingTypeEnum={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};t.TargetTypeEnum={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"}}));G(ox);ox.TargetTypeEnum,ox.BindingTypeEnum,ox.BindingScopeEnum;var sx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.id=void 0;var n=0;t.id=function(){return n++}}));G(sx);sx.id;var ux=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Binding=void 0;var n=function(){function e(e,t){this.id=sx.id(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=ox.BindingTypeEnum.Invalid,this.constraint=function(e){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===ox.BindingScopeEnum.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.cache=this.cache,t},e}();t.Binding=n}));G(ux);ux.Binding;var lx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.STACK_OVERFLOW=t.CIRCULAR_DEPENDENCY_IN_FACTORY=t.POST_CONSTRUCT_ERROR=t.MULTIPLE_POST_CONSTRUCT_METHODS=t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=t.ARGUMENTS_LENGTH_MISMATCH=t.INVALID_DECORATOR_OPERATION=t.INVALID_TO_SELF_VALUE=t.INVALID_FUNCTION_BINDING=t.INVALID_MIDDLEWARE_RETURN=t.NO_MORE_SNAPSHOTS_AVAILABLE=t.INVALID_BINDING_TYPE=t.NOT_IMPLEMENTED=t.CIRCULAR_DEPENDENCY=t.UNDEFINED_INJECT_ANNOTATION=t.MISSING_INJECT_ANNOTATION=t.MISSING_INJECTABLE_ANNOTATION=t.NOT_REGISTERED=t.CANNOT_UNBIND=t.AMBIGUOUS_MATCH=t.KEY_NOT_FOUND=t.NULL_ARGUMENT=t.DUPLICATED_METADATA=t.DUPLICATED_INJECTABLE_DECORATOR=void 0,t.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",t.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",t.NULL_ARGUMENT="NULL argument",t.KEY_NOT_FOUND="Key Not Found",t.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",t.CANNOT_UNBIND="Could not unbind serviceIdentifier:",t.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",t.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",t.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";t.UNDEFINED_INJECT_ANNOTATION=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},t.CIRCULAR_DEPENDENCY="Circular dependency found:",t.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",t.INVALID_BINDING_TYPE="Invalid binding type:",t.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",t.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",t.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",t.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",t.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";t.ARGUMENTS_LENGTH_MISMATCH=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+e[0]+" must be >= than the number of constructor arguments of its base class."},t.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",t.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",t.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",t.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",t.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";t.POST_CONSTRUCT_ERROR=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"@postConstruct error in class "+e[0]+": "+e[1]};t.CIRCULAR_DEPENDENCY_IN_FACTORY=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"It looks like there is a circular dependency in one of the '"+e[0]+"' bindings. Please investigate bindings withservice identifier '"+e[1]+"'."},t.STACK_OVERFLOW="Maximum call stack size exceeded"}));G(lx);lx.STACK_OVERFLOW,lx.CIRCULAR_DEPENDENCY_IN_FACTORY,lx.POST_CONSTRUCT_ERROR,lx.MULTIPLE_POST_CONSTRUCT_METHODS,lx.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK,lx.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE,lx.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE,lx.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT,lx.ARGUMENTS_LENGTH_MISMATCH,lx.INVALID_DECORATOR_OPERATION,lx.INVALID_TO_SELF_VALUE,lx.INVALID_FUNCTION_BINDING,lx.INVALID_MIDDLEWARE_RETURN,lx.NO_MORE_SNAPSHOTS_AVAILABLE,lx.INVALID_BINDING_TYPE,lx.NOT_IMPLEMENTED,lx.CIRCULAR_DEPENDENCY,lx.UNDEFINED_INJECT_ANNOTATION,lx.MISSING_INJECT_ANNOTATION,lx.MISSING_INJECTABLE_ANNOTATION,lx.NOT_REGISTERED,lx.CANNOT_UNBIND,lx.AMBIGUOUS_MATCH,lx.KEY_NOT_FOUND,lx.NULL_ARGUMENT,lx.DUPLICATED_METADATA,lx.DUPLICATED_INJECTABLE_DECORATOR;var cx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataReader=void 0;var n=function(){function e(){}return e.prototype.getConstructorMetadata=function(e){return{compilerGeneratedMetadata:Reflect.getMetadata(ax.PARAM_TYPES,e),userGeneratedMetadata:Reflect.getMetadata(ax.TAGGED,e)||{}}},e.prototype.getPropertiesMetadata=function(e){return Reflect.getMetadata(ax.TAGGED_PROP,e)||[]},e}();t.MetadataReader=n}));G(cx);cx.MetadataReader;var hx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingCount=void 0;t.BindingCount={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1}}));G(hx);hx.BindingCount;var fx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isStackOverflowExeption=void 0,t.isStackOverflowExeption=function(e){return e instanceof RangeError||e.message===lx.STACK_OVERFLOW}}));G(fx);fx.isStackOverflowExeption;var px=H((function(e,t){function n(e){return"function"==typeof e?e.name:"symbol"==typeof e?e.toString():e}function r(e){if(e.name)return e.name;var t=e.toString(),n=t.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+t}Object.defineProperty(t,"__esModule",{value:!0}),t.circularDependencyToException=t.listMetadataForTarget=t.listRegisteredBindingsForServiceIdentifier=t.getServiceIdentifierAsString=t.getFunctionName=void 0,t.getServiceIdentifierAsString=n,t.listRegisteredBindingsForServiceIdentifier=function(e,t,n){var i="",a=n(e,t);return 0!==a.length&&(i="\nRegistered bindings:",a.forEach((function(e){var t="Object";null!==e.implementationType&&(t=r(e.implementationType)),i=i+"\n "+t,e.constraint.metaData&&(i=i+" - "+e.constraint.metaData)}))),i},t.circularDependencyToException=function e(t){t.childRequests.forEach((function(t){if(function e(t,n){return null!==t.parentRequest&&(t.parentRequest.serviceIdentifier===n||e(t.parentRequest,n))}(t,t.serviceIdentifier)){var r=function(e){return function e(t,r){void 0===r&&(r=[]);var i=n(t.serviceIdentifier);return r.push(i),null!==t.parentRequest?e(t.parentRequest,r):r}(e).reverse().join(" --\x3e ")}(t);throw new Error(lx.CIRCULAR_DEPENDENCY+" "+r)}e(t)}))},t.listMetadataForTarget=function(e,t){if(t.isTagged()||t.isNamed()){var n="",r=t.getNamedTag(),i=t.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(e){n+=e.toString()+"\n"}))," "+e+"\n "+e+" - "+n}return" "+e},t.getFunctionName=r}));G(px);px.circularDependencyToException,px.listMetadataForTarget,px.listRegisteredBindingsForServiceIdentifier,px.getServiceIdentifierAsString,px.getFunctionName;var dx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;var n=function(){function e(e){this.id=sx.id(),this.container=e}return e.prototype.addPlan=function(e){this.plan=e},e.prototype.setCurrentRequest=function(e){this.currentRequest=e},e}();t.Context=n}));G(dx);dx.Context;var vx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var n=function(){function e(e,t){this.key=e,this.value=t}return e.prototype.toString=function(){return this.key===ax.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},e}();t.Metadata=n}));G(vx);vx.Metadata;var gx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Plan=void 0;var n=function(e,t){this.parentContext=e,this.rootRequest=t};t.Plan=n}));G(gx);gx.Plan;var mx=H((function(e,t){function n(e,t,n,r,i){var a={},o="number"==typeof i,s=void 0!==i&&o?i.toString():n;if(o&&void 0!==n)throw new Error(lx.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(e,t)&&(a=Reflect.getMetadata(e,t));var u=a[s];if(Array.isArray(u))for(var l=0,c=u;l<c.length;l++){var h=c[l];if(h.key===r.key)throw new Error(lx.DUPLICATED_METADATA+" "+h.key.toString())}else u=[];u.push(r),a[s]=u,Reflect.defineMetadata(e,a,t)}function r(e,t){Reflect.decorate(e,t)}function i(e,t){return function(n,r){t(n,r,e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.tagProperty=t.tagParameter=t.decorate=void 0,t.tagParameter=function(e,t,r,i){n(ax.TAGGED,e,t,i,r)},t.tagProperty=function(e,t,r){n(ax.TAGGED_PROP,e.constructor,t,r)},t.decorate=function(e,t,n){"number"==typeof n?r([i(n,e)],t):"string"==typeof n?Reflect.decorate([e],t,n):r([e],t)}}));G(mx);mx.tagProperty,mx.tagParameter,mx.decorate;var yx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.inject=t.LazyServiceIdentifer=void 0;var n=function(){function e(e){this._cb=e}return e.prototype.unwrap=function(){return this._cb()},e}();t.LazyServiceIdentifer=n,t.inject=function(e){return function(t,n,r){if(void 0===e)throw new Error(lx.UNDEFINED_INJECT_ANNOTATION(t.name));var i=new vx.Metadata(ax.INJECT_TAG,e);"number"==typeof r?mx.tagParameter(t,n,r,i):mx.tagProperty(t,n,i)}}}));G(yx);yx.inject,yx.LazyServiceIdentifer;var _x=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.QueryableString=void 0;var n=function(){function e(e){this.str=e}return e.prototype.startsWith=function(e){return 0===this.str.indexOf(e)},e.prototype.endsWith=function(e){var t,n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},e.prototype.contains=function(e){return-1!==this.str.indexOf(e)},e.prototype.equals=function(e){return this.str===e},e.prototype.value=function(){return this.str},e}();t.QueryableString=n}));G(_x);_x.QueryableString;var bx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Target=void 0;var n=function(){function e(e,t,n,r){this.id=sx.id(),this.type=e,this.serviceIdentifier=n,this.name=new _x.QueryableString(t||""),this.metadata=new Array;var i=null;"string"==typeof r?i=new vx.Metadata(ax.NAMED_TAG,r):r instanceof vx.Metadata&&(i=r),null!==i&&this.metadata.push(i)}return e.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){if(n[t].key===e)return!0}return!1},e.prototype.isArray=function(){return this.hasTag(ax.MULTI_INJECT_TAG)},e.prototype.matchesArray=function(e){return this.matchesTag(ax.MULTI_INJECT_TAG)(e)},e.prototype.isNamed=function(){return this.hasTag(ax.NAMED_TAG)},e.prototype.isTagged=function(){return this.metadata.some((function(e){return ax.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))}))},e.prototype.isOptional=function(){return this.matchesTag(ax.OPTIONAL_TAG)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(e){return e.key===ax.NAMED_TAG}))[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(e){return ax.NON_CUSTOM_TAG_KEYS.every((function(t){return e.key!==t}))})):null},e.prototype.matchesNamedTag=function(e){return this.matchesTag(ax.NAMED_TAG)(e)},e.prototype.matchesTag=function(e){var t=this;return function(n){for(var r=0,i=t.metadata;r<i.length;r++){var a=i[r];if(a.key===e&&a.value===n)return!0}return!1}},e}();t.Target=n}));G(bx);bx.Target;var xx=H((function(e,t){var n=V&&V.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};function r(e,t,r,o){var s=e.getConstructorMetadata(r),u=s.compilerGeneratedMetadata;if(void 0===u){var l=lx.MISSING_INJECTABLE_ANNOTATION+" "+t+".";throw new Error(l)}var c=s.userGeneratedMetadata,h=Object.keys(c),f=0===r.length&&h.length>0,p=h.length>r.length,d=function(e,t,n,r,a){for(var o=[],s=0;s<a;s++){var u=i(s,e,t,n,r);null!==u&&o.push(u)}return o}(o,t,u,c,f||p?h.length:r.length),v=function e(t,r){for(var i=t.getPropertiesMetadata(r),o=[],s=Object.keys(i),u=0,l=s;u<l.length;u++){var c=l[u],h=i[c],f=a(i[c]),p=f.targetName||c,d=f.inject||f.multiInject,v=new bx.Target(ox.TargetTypeEnum.ClassProperty,p,d);v.metadata=h,o.push(v)}var g=Object.getPrototypeOf(r.prototype).constructor;if(g!==Object){var m=e(t,g);o=n(n([],o),m)}return o}(e,r);return n(n([],d),v)}function i(e,t,n,r,i){var o=i[e.toString()]||[],s=a(o),u=!0!==s.unmanaged,l=r[e],c=s.inject||s.multiInject;if((l=c||l)instanceof yx.LazyServiceIdentifer&&(l=l.unwrap()),u){if(!t&&(l===Object||l===Function||void 0===l)){var h=lx.MISSING_INJECT_ANNOTATION+" argument "+e+" in class "+n+".";throw new Error(h)}var f=new bx.Target(ox.TargetTypeEnum.ConstructorArgument,s.targetName,l);return f.metadata=o,f}return null}function a(e){var t={};return e.forEach((function(e){t[e.key.toString()]=e.value})),{inject:t[ax.INJECT_TAG],multiInject:t[ax.MULTI_INJECT_TAG],targetName:t[ax.NAME_TAG],unmanaged:t[ax.UNMANAGED_TAG]}}Object.defineProperty(t,"__esModule",{value:!0}),t.getFunctionName=t.getBaseClassDependencyCount=t.getDependencies=void 0,Object.defineProperty(t,"getFunctionName",{enumerable:!0,get:function(){return px.getFunctionName}}),t.getDependencies=function(e,t){return r(e,px.getFunctionName(t),t,!1)},t.getBaseClassDependencyCount=function e(t,n){var i=Object.getPrototypeOf(n.prototype).constructor;if(i!==Object){var a=r(t,px.getFunctionName(i),i,!0),o=a.map((function(e){return e.metadata.filter((function(e){return e.key===ax.UNMANAGED_TAG}))})),s=[].concat.apply([],o).length,u=a.length-s;return u>0?u:e(t,i)}return 0}}));G(xx);xx.getFunctionName,xx.getBaseClassDependencyCount,xx.getDependencies;var Ex=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Request=void 0;var n=function(){function e(e,t,n,r,i){this.id=sx.id(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=i,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],this.requestScope=null===n?new Map:null}return e.prototype.addChildRequest=function(t,n,r){var i=new e(t,this.parentContext,this,n,r);return this.childRequests.push(i),i},e}();t.Request=n}));G(Ex);Ex.Request;var Sx=H((function(e,t){function n(e){return e._bindingDictionary}function r(e,t,n,r,i,a){var o=e?ax.MULTI_INJECT_TAG:ax.INJECT_TAG,s=new vx.Metadata(o,n),u=new bx.Target(t,r,n,s);if(void 0!==i){var l=new vx.Metadata(i,a);u.metadata.push(l)}return u}function i(e,t,n,r,i){var o=a(n.container,i.serviceIdentifier),s=[];return o.length===hx.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof i.serviceIdentifier&&e.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(i.serviceIdentifier).toSelf(),o=a(n.container,i.serviceIdentifier)),s=t?o:o.filter((function(e){var t=new Ex.Request(e.serviceIdentifier,n,r,e,i);return e.constraint(t)})),function(e,t,n,r){switch(t.length){case hx.BindingCount.NoBindingsAvailable:if(n.isOptional())return t;var i=px.getServiceIdentifierAsString(e),o=lx.NOT_REGISTERED;throw o+=px.listMetadataForTarget(i,n),o+=px.listRegisteredBindingsForServiceIdentifier(r,i,a),new Error(o);case hx.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return t;case hx.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return t;i=px.getServiceIdentifierAsString(e),o=lx.AMBIGUOUS_MATCH+" "+i;throw o+=px.listRegisteredBindingsForServiceIdentifier(r,i,a),new Error(o)}}(i.serviceIdentifier,s,i,n.container),s}function a(e,t){var r=[],i=n(e);return i.hasKey(t)?r=i.get(t):null!==e.parent&&(r=a(e.parent,t)),r}Object.defineProperty(t,"__esModule",{value:!0}),t.getBindingDictionary=t.createMockRequest=t.plan=void 0,t.getBindingDictionary=n,t.plan=function(e,t,n,a,o,s,u,l){void 0===l&&(l=!1);var c=new dx.Context(t),h=r(n,a,o,"",s,u);try{return function e(t,n,r,a,o,s){var u,l;if(null===o){u=i(t,n,a,null,s),l=new Ex.Request(r,a,null,u,s);var c=new gx.Plan(a,l);a.addPlan(c)}else u=i(t,n,a,o,s),l=o.addChildRequest(s.serviceIdentifier,u,s);u.forEach((function(n){var r=null;if(s.isArray())r=l.addChildRequest(n.serviceIdentifier,n,s);else{if(n.cache)return;r=l}if(n.type===ox.BindingTypeEnum.Instance&&null!==n.implementationType){var i=xx.getDependencies(t,n.implementationType);if(!a.container.options.skipBaseClassChecks){var o=xx.getBaseClassDependencyCount(t,n.implementationType);if(i.length<o){var u=lx.ARGUMENTS_LENGTH_MISMATCH(xx.getFunctionName(n.implementationType));throw new Error(u)}}i.forEach((function(n){e(t,!1,n.serviceIdentifier,a,r,n)}))}}))}(e,l,o,c,null,h),c}catch(e){throw fx.isStackOverflowExeption(e)&&c.plan&&px.circularDependencyToException(c.plan.rootRequest),e}},t.createMockRequest=function(e,t,n,r){var i=new bx.Target(ox.TargetTypeEnum.Variable,"",t,new vx.Metadata(n,r)),a=new dx.Context(e);return new Ex.Request(t,a,null,[],i)}}));G(Sx);Sx.getBindingDictionary,Sx.createMockRequest,Sx.plan;var Cx=H((function(e,t){var n=V&&V.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.resolveInstance=void 0,t.resolveInstance=function(e,t,r){var i,a,o=null;if(t.length>0){var s=t.filter((function(e){return null!==e.target&&e.target.type===ox.TargetTypeEnum.ConstructorArgument})).map(r);a=s,o=function(e,t,n){var r=t.filter((function(e){return null!==e.target&&e.target.type===ox.TargetTypeEnum.ClassProperty})),i=r.map(n);return r.forEach((function(t,n){var r;r=t.target.name.value();var a=i[n];e[r]=a})),e}(o=new((i=e).bind.apply(i,n([void 0],a))),t,r)}else o=new e;return function(e,t){if(Reflect.hasMetadata(ax.POST_CONSTRUCT,e)){var n=Reflect.getMetadata(ax.POST_CONSTRUCT,e);try{t[n.value]()}catch(t){throw new Error(lx.POST_CONSTRUCT_ERROR(e.name,t.message))}}}(e,o),o}}));G(Cx);Cx.resolveInstance;var Tx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.resolve=void 0;var n=function(e,t,n){try{return n()}catch(n){throw fx.isStackOverflowExeption(n)?new Error(lx.CIRCULAR_DEPENDENCY_IN_FACTORY(e,t.toString())):n}},r=function(e){return function(t){t.parentContext.setCurrentRequest(t);var i=t.bindings,a=t.childRequests,o=t.target&&t.target.isArray(),s=!(t.parentRequest&&t.parentRequest.target&&t.target&&t.parentRequest.target.matchesArray(t.target.serviceIdentifier));if(o&&s)return a.map((function(t){return r(e)(t)}));var u=null;if(!t.target.isOptional()||0!==i.length){var l=i[0],c=l.scope===ox.BindingScopeEnum.Singleton,h=l.scope===ox.BindingScopeEnum.Request;if(c&&l.activated)return l.cache;if(h&&null!==e&&e.has(l.id))return e.get(l.id);if(l.type===ox.BindingTypeEnum.ConstantValue)u=l.cache,l.activated=!0;else if(l.type===ox.BindingTypeEnum.Function)u=l.cache,l.activated=!0;else if(l.type===ox.BindingTypeEnum.Constructor)u=l.implementationType;else if(l.type===ox.BindingTypeEnum.DynamicValue&&null!==l.dynamicValue)u=n("toDynamicValue",l.serviceIdentifier,(function(){return l.dynamicValue(t.parentContext)}));else if(l.type===ox.BindingTypeEnum.Factory&&null!==l.factory)u=n("toFactory",l.serviceIdentifier,(function(){return l.factory(t.parentContext)}));else if(l.type===ox.BindingTypeEnum.Provider&&null!==l.provider)u=n("toProvider",l.serviceIdentifier,(function(){return l.provider(t.parentContext)}));else{if(l.type!==ox.BindingTypeEnum.Instance||null===l.implementationType){var f=px.getServiceIdentifierAsString(t.serviceIdentifier);throw new Error(lx.INVALID_BINDING_TYPE+" "+f)}u=Cx.resolveInstance(l.implementationType,a,r(e))}return"function"==typeof l.onActivation&&(u=l.onActivation(t.parentContext,u)),c&&(l.cache=u,l.activated=!0),h&&null!==e&&!e.has(l.id)&&e.set(l.id,u),u}}};t.resolve=function(e){return r(e.plan.rootRequest.requestScope)(e.plan.rootRequest)}}));G(Tx);Tx.resolve;var Ax=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.typeConstraint=t.namedConstraint=t.taggedConstraint=t.traverseAncerstors=void 0;var n=function(e,t){var r=e.parentRequest;return null!==r&&(!!t(r)||n(r,t))};t.traverseAncerstors=n;var r=function(e){return function(t){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(e)(t)};return n.metaData=new vx.Metadata(e,t),n}};t.taggedConstraint=r;var i=r(ax.NAMED_TAG);t.namedConstraint=i;t.typeConstraint=function(e){return function(t){var n=null;if(null!==t){if(n=t.bindings[0],"string"==typeof e)return n.serviceIdentifier===e;var r=t.bindings[0].implementationType;return e===r}return!1}}}));G(Ax);Ax.typeConstraint,Ax.namedConstraint,Ax.taggedConstraint,Ax.traverseAncerstors;var Mx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.when=function(e){return this._binding.constraint=e,new kx.BindingOnSyntax(this._binding)},e.prototype.whenTargetNamed=function(e){return this._binding.constraint=Ax.namedConstraint(e),new kx.BindingOnSyntax(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){return null!==e.target&&!e.target.isNamed()&&!e.target.isTagged()},new kx.BindingOnSyntax(this._binding)},e.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=Ax.taggedConstraint(e)(t),new kx.BindingOnSyntax(this._binding)},e.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return Ax.typeConstraint(e)(t.parentRequest)},new kx.BindingOnSyntax(this._binding)},e.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return Ax.namedConstraint(e)(t.parentRequest)},new kx.BindingOnSyntax(this._binding)},e.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return Ax.taggedConstraint(e)(t)(n.parentRequest)},new kx.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return Ax.traverseAncerstors(t,Ax.typeConstraint(e))},new kx.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return!Ax.traverseAncerstors(t,Ax.typeConstraint(e))},new kx.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return Ax.traverseAncerstors(t,Ax.namedConstraint(e))},new kx.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return!Ax.traverseAncerstors(t,Ax.namedConstraint(e))},new kx.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return Ax.traverseAncerstors(n,Ax.taggedConstraint(e)(t))},new kx.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return!Ax.traverseAncerstors(n,Ax.taggedConstraint(e)(t))},new kx.BindingOnSyntax(this._binding)},e.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return Ax.traverseAncerstors(t,e)},new kx.BindingOnSyntax(this._binding)},e.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return!Ax.traverseAncerstors(t,e)},new kx.BindingOnSyntax(this._binding)},e}();t.BindingWhenSyntax=n}));G(Mx);Mx.BindingWhenSyntax;var kx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingOnSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.onActivation=function(e){return this._binding.onActivation=e,new Mx.BindingWhenSyntax(this._binding)},e}();t.BindingOnSyntax=n}));G(kx);kx.BindingOnSyntax;var Ox=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingWhenOnSyntax=void 0;var n=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new Mx.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new kx.BindingOnSyntax(this._binding)}return e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingWhenOnSyntax=n}));G(Ox);Ox.BindingWhenOnSyntax;var Px=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.inRequestScope=function(){return this._binding.scope=ox.BindingScopeEnum.Request,new Ox.BindingWhenOnSyntax(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=ox.BindingScopeEnum.Singleton,new Ox.BindingWhenOnSyntax(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=ox.BindingScopeEnum.Transient,new Ox.BindingWhenOnSyntax(this._binding)},e}();t.BindingInSyntax=n}));G(Px);Px.BindingInSyntax;var Rx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingInWhenOnSyntax=void 0;var n=function(){function e(e){this._binding=e,this._bindingWhenSyntax=new Mx.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new kx.BindingOnSyntax(this._binding),this._bindingInSyntax=new Px.BindingInSyntax(e)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},e.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},e.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},e.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},e.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},e.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},e.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},e.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},e.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},e.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},e.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},e.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},e.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},e.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},e}();t.BindingInWhenOnSyntax=n}));G(Rx);Rx.BindingInWhenOnSyntax;var Lx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BindingToSyntax=void 0;var n=function(){function e(e){this._binding=e}return e.prototype.to=function(e){return this._binding.type=ox.BindingTypeEnum.Instance,this._binding.implementationType=e,new Rx.BindingInWhenOnSyntax(this._binding)},e.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw new Error(""+lx.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},e.prototype.toConstantValue=function(e){return this._binding.type=ox.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ox.BindingScopeEnum.Singleton,new Ox.BindingWhenOnSyntax(this._binding)},e.prototype.toDynamicValue=function(e){return this._binding.type=ox.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new Rx.BindingInWhenOnSyntax(this._binding)},e.prototype.toConstructor=function(e){return this._binding.type=ox.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=ox.BindingScopeEnum.Singleton,new Ox.BindingWhenOnSyntax(this._binding)},e.prototype.toFactory=function(e){return this._binding.type=ox.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=ox.BindingScopeEnum.Singleton,new Ox.BindingWhenOnSyntax(this._binding)},e.prototype.toFunction=function(e){if("function"!=typeof e)throw new Error(lx.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=ox.BindingTypeEnum.Function,this._binding.scope=ox.BindingScopeEnum.Singleton,t},e.prototype.toAutoFactory=function(e){return this._binding.type=ox.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(){return t.container.get(e)}},this._binding.scope=ox.BindingScopeEnum.Singleton,new Ox.BindingWhenOnSyntax(this._binding)},e.prototype.toProvider=function(e){return this._binding.type=ox.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=ox.BindingScopeEnum.Singleton,new Ox.BindingWhenOnSyntax(this._binding)},e.prototype.toService=function(e){this.toDynamicValue((function(t){return t.container.get(e)}))},e}();t.BindingToSyntax=n}));G(Lx);Lx.BindingToSyntax;var Ix=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ContainerSnapshot=void 0;var n=function(){function e(){}return e.of=function(t,n){var r=new e;return r.bindings=t,r.middleware=n,r},e}();t.ContainerSnapshot=n}));G(Ix);Ix.ContainerSnapshot;var Nx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Lookup=void 0;var n=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(e,t){if(null==e)throw new Error(lx.NULL_ARGUMENT);if(null==t)throw new Error(lx.NULL_ARGUMENT);var n=this._map.get(e);void 0!==n?(n.push(t),this._map.set(e,n)):this._map.set(e,[t])},e.prototype.get=function(e){if(null==e)throw new Error(lx.NULL_ARGUMENT);var t=this._map.get(e);if(void 0!==t)return t;throw new Error(lx.KEY_NOT_FOUND)},e.prototype.remove=function(e){if(null==e)throw new Error(lx.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(lx.KEY_NOT_FOUND)},e.prototype.removeByCondition=function(e){var t=this;this._map.forEach((function(n,r){var i=n.filter((function(t){return!e(t)}));i.length>0?t._map.set(r,i):t._map.delete(r)}))},e.prototype.hasKey=function(e){if(null==e)throw new Error(lx.NULL_ARGUMENT);return this._map.has(e)},e.prototype.clone=function(){var t=new e;return this._map.forEach((function(e,n){e.forEach((function(e){return t.add(n,e.clone())}))})),t},e.prototype.traverse=function(e){this._map.forEach((function(t,n){e(n,t)}))},e}();t.Lookup=n}));G(Nx);Nx.Lookup;var Dx=H((function(e,t){var n=V&&V.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},r=V&&V.__generator||function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},i=V&&V.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};Object.defineProperty(t,"__esModule",{value:!0}),t.Container=void 0;var a=function(){function e(e){this._appliedMiddleware=[];var t=e||{};if("object"!=typeof t)throw new Error(""+lx.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===t.defaultScope)t.defaultScope=ox.BindingScopeEnum.Transient;else if(t.defaultScope!==ox.BindingScopeEnum.Singleton&&t.defaultScope!==ox.BindingScopeEnum.Transient&&t.defaultScope!==ox.BindingScopeEnum.Request)throw new Error(""+lx.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===t.autoBindInjectable)t.autoBindInjectable=!1;else if("boolean"!=typeof t.autoBindInjectable)throw new Error(""+lx.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===t.skipBaseClassChecks)t.skipBaseClassChecks=!1;else if("boolean"!=typeof t.skipBaseClassChecks)throw new Error(""+lx.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=sx.id(),this._bindingDictionary=new Nx.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new cx.MetadataReader}return e.merge=function(t,n){for(var r=[],a=2;a<arguments.length;a++)r[a-2]=arguments[a];var o=new e,s=i([t,n],r).map((function(e){return Sx.getBindingDictionary(e)})),u=Sx.getBindingDictionary(o);function l(e,t){e.traverse((function(e,n){n.forEach((function(e){t.add(e.serviceIdentifier,e.clone())}))}))}return s.forEach((function(e){l(e,u)})),o},e.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=e;r<i.length;r++){var a=i[r],o=n(a.id);a.registry(o.bindFunction,o.unbindFunction,o.isboundFunction,o.rebindFunction)}},e.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(this,void 0,void 0,(function(){var t,n,i,a,o;return r(this,(function(r){switch(r.label){case 0:t=this._getContainerModuleHelpersFactory(),n=0,i=e,r.label=1;case 1:return n<i.length?(a=i[n],o=t(a.id),[4,a.registry(o.bindFunction,o.unbindFunction,o.isboundFunction,o.rebindFunction)]):[3,4];case 2:r.sent(),r.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(e){return function(t){return t.moduleId===e}};t.forEach((function(t){var n=r(t.id);e._bindingDictionary.removeByCondition(n)}))},e.prototype.bind=function(e){var t=this.options.defaultScope||ox.BindingScopeEnum.Transient,n=new ux.Binding(e,t);return this._bindingDictionary.add(e,n),new Lx.BindingToSyntax(n)},e.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},e.prototype.unbind=function(e){try{this._bindingDictionary.remove(e)}catch(t){throw new Error(lx.CANNOT_UNBIND+" "+px.getServiceIdentifierAsString(e))}},e.prototype.unbindAll=function(){this._bindingDictionary=new Nx.Lookup},e.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},e.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,ax.NAMED_TAG,t)},e.prototype.isBoundTagged=function(e,t,n){var r=!1;if(this._bindingDictionary.hasKey(e)){var i=this._bindingDictionary.get(e),a=Sx.createMockRequest(this,e,t,n);r=i.some((function(e){return e.constraint(a)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(e,t,n)),r},e.prototype.snapshot=function(){this._snapshots.push(Ix.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},e.prototype.restore=function(){var e=this._snapshots.pop();if(void 0===e)throw new Error(lx.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._middleware=e.middleware},e.prototype.createChild=function(t){var n=new e(t||this.options);return n.parent=this,n},e.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._appliedMiddleware=this._appliedMiddleware.concat(e);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce((function(e,t){return t(e)}),n)},e.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},e.prototype.get=function(e){return this._get(!1,!1,ox.TargetTypeEnum.Variable,e)},e.prototype.getTagged=function(e,t,n){return this._get(!1,!1,ox.TargetTypeEnum.Variable,e,t,n)},e.prototype.getNamed=function(e,t){return this.getTagged(e,ax.NAMED_TAG,t)},e.prototype.getAll=function(e){return this._get(!0,!0,ox.TargetTypeEnum.Variable,e)},e.prototype.getAllTagged=function(e,t,n){return this._get(!1,!0,ox.TargetTypeEnum.Variable,e,t,n)},e.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,ax.NAMED_TAG,t)},e.prototype.resolve=function(e){var t=this.createChild();return t.bind(e).toSelf(),this._appliedMiddleware.forEach((function(e){t.applyMiddleware(e)})),t.get(e)},e.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(e,t){e._binding.moduleId=t},n=function(n){return function(r){var i=e.rebind.bind(e)(r);return t(i,n),i}};return function(r){return{bindFunction:(i=r,function(n){var r=e.bind.bind(e)(n);return t(r,i),r}),isboundFunction:function(t){return e.isBound.bind(e)(t)},rebindFunction:n(r),unbindFunction:function(t){e.unbind.bind(e)(t)}};var i}},e.prototype._get=function(e,t,n,r,i,a){var o=null,s={avoidConstraints:e,contextInterceptor:function(e){return e},isMultiInject:t,key:i,serviceIdentifier:r,targetType:n,value:a};if(this._middleware){if(null==(o=this._middleware(s)))throw new Error(lx.INVALID_MIDDLEWARE_RETURN)}else o=this._planAndResolve()(s);return o},e.prototype._planAndResolve=function(){var e=this;return function(t){var n=Sx.plan(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);return n=t.contextInterceptor(n),Tx.resolve(n)}},e}();t.Container=a}));G(Dx);Dx.Container;var Fx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncContainerModule=t.ContainerModule=void 0;var n=function(e){this.id=sx.id(),this.registry=e};t.ContainerModule=n;var r=function(e){this.id=sx.id(),this.registry=e};t.AsyncContainerModule=r}));G(Fx);Fx.AsyncContainerModule,Fx.ContainerModule;var Bx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.injectable=void 0,t.injectable=function(){return function(e){if(Reflect.hasOwnMetadata(ax.PARAM_TYPES,e))throw new Error(lx.DUPLICATED_INJECTABLE_DECORATOR);var t=Reflect.getMetadata(ax.DESIGN_PARAM_TYPES,e)||[];return Reflect.defineMetadata(ax.PARAM_TYPES,t,e),e}}}));G(Bx);Bx.injectable;var Ux=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.tagged=void 0,t.tagged=function(e,t){return function(n,r,i){var a=new vx.Metadata(e,t);"number"==typeof i?mx.tagParameter(n,r,i,a):mx.tagProperty(n,r,a)}}}));G(Ux);Ux.tagged;var zx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.named=void 0,t.named=function(e){return function(t,n,r){var i=new vx.Metadata(ax.NAMED_TAG,e);"number"==typeof r?mx.tagParameter(t,n,r,i):mx.tagProperty(t,n,i)}}}));G(zx);zx.named;var jx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.optional=void 0,t.optional=function(){return function(e,t,n){var r=new vx.Metadata(ax.OPTIONAL_TAG,!0);"number"==typeof n?mx.tagParameter(e,t,n,r):mx.tagProperty(e,t,r)}}}));G(jx);jx.optional;var Vx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.unmanaged=void 0,t.unmanaged=function(){return function(e,t,n){var r=new vx.Metadata(ax.UNMANAGED_TAG,!0);mx.tagParameter(e,t,n,r)}}}));G(Vx);Vx.unmanaged;var Gx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.multiInject=void 0,t.multiInject=function(e){return function(t,n,r){var i=new vx.Metadata(ax.MULTI_INJECT_TAG,e);"number"==typeof r?mx.tagParameter(t,n,r,i):mx.tagProperty(t,n,i)}}}));G(Gx);Gx.multiInject;var Hx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.targetName=void 0,t.targetName=function(e){return function(t,n,r){var i=new vx.Metadata(ax.NAME_TAG,e);mx.tagParameter(t,n,r,i)}}}));G(Hx);Hx.targetName;var Wx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.postConstruct=void 0,t.postConstruct=function(){return function(e,t,n){var r=new vx.Metadata(ax.POST_CONSTRUCT,t);if(Reflect.hasOwnMetadata(ax.POST_CONSTRUCT,e.constructor))throw new Error(lx.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(ax.POST_CONSTRUCT,r,e.constructor)}}}));G(Wx);Wx.postConstruct;var Xx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=void 0;t.multiBindToService=function(e){return function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return e.bind(n).toService(t)}))}}}}));G(Xx);Xx.multiBindToService;var Yx=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.multiBindToService=t.getServiceIdentifierAsString=t.typeConstraint=t.namedConstraint=t.taggedConstraint=t.traverseAncerstors=t.decorate=t.id=t.MetadataReader=t.postConstruct=t.targetName=t.multiInject=t.unmanaged=t.optional=t.LazyServiceIdentifer=t.inject=t.named=t.tagged=t.injectable=t.ContainerModule=t.AsyncContainerModule=t.TargetTypeEnum=t.BindingTypeEnum=t.BindingScopeEnum=t.Container=t.METADATA_KEY=void 0,t.METADATA_KEY=ax,Object.defineProperty(t,"Container",{enumerable:!0,get:function(){return Dx.Container}}),Object.defineProperty(t,"BindingScopeEnum",{enumerable:!0,get:function(){return ox.BindingScopeEnum}}),Object.defineProperty(t,"BindingTypeEnum",{enumerable:!0,get:function(){return ox.BindingTypeEnum}}),Object.defineProperty(t,"TargetTypeEnum",{enumerable:!0,get:function(){return ox.TargetTypeEnum}}),Object.defineProperty(t,"AsyncContainerModule",{enumerable:!0,get:function(){return Fx.AsyncContainerModule}}),Object.defineProperty(t,"ContainerModule",{enumerable:!0,get:function(){return Fx.ContainerModule}}),Object.defineProperty(t,"injectable",{enumerable:!0,get:function(){return Bx.injectable}}),Object.defineProperty(t,"tagged",{enumerable:!0,get:function(){return Ux.tagged}}),Object.defineProperty(t,"named",{enumerable:!0,get:function(){return zx.named}}),Object.defineProperty(t,"inject",{enumerable:!0,get:function(){return yx.inject}}),Object.defineProperty(t,"LazyServiceIdentifer",{enumerable:!0,get:function(){return yx.LazyServiceIdentifer}}),Object.defineProperty(t,"optional",{enumerable:!0,get:function(){return jx.optional}}),Object.defineProperty(t,"unmanaged",{enumerable:!0,get:function(){return Vx.unmanaged}}),Object.defineProperty(t,"multiInject",{enumerable:!0,get:function(){return Gx.multiInject}}),Object.defineProperty(t,"targetName",{enumerable:!0,get:function(){return Hx.targetName}}),Object.defineProperty(t,"postConstruct",{enumerable:!0,get:function(){return Wx.postConstruct}}),Object.defineProperty(t,"MetadataReader",{enumerable:!0,get:function(){return cx.MetadataReader}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return sx.id}}),Object.defineProperty(t,"decorate",{enumerable:!0,get:function(){return mx.decorate}}),Object.defineProperty(t,"traverseAncerstors",{enumerable:!0,get:function(){return Ax.traverseAncerstors}}),Object.defineProperty(t,"taggedConstraint",{enumerable:!0,get:function(){return Ax.taggedConstraint}}),Object.defineProperty(t,"namedConstraint",{enumerable:!0,get:function(){return Ax.namedConstraint}}),Object.defineProperty(t,"typeConstraint",{enumerable:!0,get:function(){return Ax.typeConstraint}}),Object.defineProperty(t,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return px.getServiceIdentifierAsString}}),Object.defineProperty(t,"multiBindToService",{enumerable:!0,get:function(){return Xx.multiBindToService}})}));G(Yx);Yx.multiBindToService,Yx.getServiceIdentifierAsString,Yx.typeConstraint,Yx.namedConstraint,Yx.taggedConstraint,Yx.traverseAncerstors;var Zx=Yx.decorate,qx=(Yx.id,Yx.MetadataReader,Yx.postConstruct),Kx=(Yx.targetName,Yx.multiInject,Yx.unmanaged,Yx.optional,Yx.LazyServiceIdentifer,Yx.inject),Qx=(Yx.named,Yx.tagged,Yx.injectable),Jx=(Yx.ContainerModule,Yx.AsyncContainerModule,Yx.TargetTypeEnum,Yx.BindingTypeEnum,Yx.BindingScopeEnum,Yx.Container),$x=(Yx.METADATA_KEY,H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=Symbol.for("INJECTION");function r(e,t,r,i){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return i&&!Reflect.hasMetadata(n,this,t)&&Reflect.defineMetadata(n,r(),this,t),Reflect.hasMetadata(n,this,t)?Reflect.getMetadata(n,this,t):r()},set:function(e){Reflect.defineMetadata(n,e,this,t)}})}t.makePropertyInjectDecorator=function(e,t){return function(n){return function(i,a){r(i,a,(function(){return e.get(n)}),t)}}},t.makePropertyInjectNamedDecorator=function(e,t){return function(n,i){return function(a,o){r(a,o,(function(){return e.getNamed(n,i)}),t)}}},t.makePropertyInjectTaggedDecorator=function(e,t){return function(n,i,a){return function(o,s){r(o,s,(function(){return e.getTagged(n,i,a)}),t)}}},t.makePropertyMultiInjectDecorator=function(e,t){return function(n){return function(i,a){r(i,a,(function(){return e.getAll(n)}),t)}}}})));G($x);$x.makePropertyInjectDecorator,$x.makePropertyInjectNamedDecorator,$x.makePropertyInjectTaggedDecorator,$x.makePropertyMultiInjectDecorator;var eE=G(H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return void 0===t&&(t=!0),{lazyInject:$x.makePropertyInjectDecorator(e,t),lazyInjectNamed:$x.makePropertyInjectNamedDecorator(e,t),lazyInjectTagged:$x.makePropertyInjectTaggedDecorator(e,t),lazyMultiInject:$x.makePropertyMultiInjectDecorator(e,t)}}}))),tE={f:Pe},nE=Z,rE=ut.f,iE=_n.forEach,aE=_t("hidden"),oE=Pe("toPrimitive"),sE=wt.set,uE=wt.getterFor("Symbol"),lE=Object.prototype,cE=Z.Symbol,hE=cE&&cE.prototype,fE=Z.TypeError,pE=Z.QObject,dE=ye("JSON","stringify"),vE=On.f,gE=ut.f,mE=Qu.f,yE=Mn.f,_E=ae([].push),bE=J("symbols"),xE=J("op-symbols"),EE=J("string-to-symbol-registry"),SE=J("symbol-to-string-registry"),CE=J("wks"),TE=!pE||!pE.prototype||!pE.prototype.findChild,AE=Ie&&$((function(){return 7!=co(gE({},"a",{get:function(){return gE(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=vE(lE,t);r&&delete lE[t],gE(e,t,n),r&&e!==lE&&gE(lE,t,r)}:gE,ME=function(e,t){var n=bE[e]=co(hE);return sE(n,{type:"Symbol",tag:e,description:t}),Ie||(n.description=t),n},wE=function(e,t,n){e===lE&&wE(xE,t,n),Ge(e);var r=it(t);return Ge(n),he(bE,r)?(n.enumerable?(he(e,aE)&&e[aE][r]&&(e[aE][r]=!1),n=co(n,{enumerable:lt(0,!1)})):(he(e,aE)||gE(e,aE,lt(1,{})),e[aE][r]=!0),AE(e,r,n)):gE(e,r,n)},kE=function(e,t){Ge(e);var n=wn(t),r=ro(n).concat(LE(n));return iE(r,(function(t){Ie&&!We(OE,n,t)||wE(e,t,n[t])})),e},OE=function(e){var t=it(e),n=We(yE,this,t);return!(this===lE&&he(bE,t)&&!he(xE,t))&&(!(n||!he(this,t)||!he(bE,t)||he(this,aE)&&this[aE][t])||n)},PE=function(e,t){var n=wn(e),r=it(t);if(n!==lE||!he(bE,r)||he(xE,r)){var i=vE(n,r);return!i||!he(bE,r)||he(n,aE)&&n[aE][r]||(i.enumerable=!0),i}},RE=function(e){var t=mE(wn(e)),n=[];return iE(t,(function(e){he(bE,e)||he(bt,e)||_E(n,e)})),n},LE=function(e){var t=e===lE,n=mE(t?xE:wn(e)),r=[];return iE(n,(function(e){!he(bE,e)||t&&!he(lE,e)||_E(r,bE[e])})),r};if(Te||(hE=(cE=function(){if(Xe(hE,this))throw fE("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Ia(arguments[0]):void 0,t=ve(e),n=function(e){this===lE&&We(n,xE,e),he(this,aE)&&he(this[aE],t)&&(this[aE][t]=!1),AE(this,t,lt(1,e))};return Ie&&TE&&AE(lE,t,{configurable:!0,set:n}),ME(t,e)}).prototype,Lt(hE,"toString",(function(){return uE(this).tag})),Lt(cE,"withoutSetter",(function(e){return ME(ve(e),e)})),Mn.f=OE,ut.f=wE,io.f=kE,On.f=PE,jn.f=Qu.f=RE,Vn.f=LE,tE.f=function(e){return ME(Pe(e),e)},Ie&&(gE(hE,"description",{configurable:!0,get:function(){return uE(this).description}}),Lt(lE,"propertyIsEnumerable",OE,{unsafe:!0}))),er({global:!0,wrap:!0,forced:!Te,sham:!Te},{Symbol:cE}),iE(ro(CE),(function(e){!function(e){var t=nE.Symbol||(nE.Symbol={});he(t,e)||rE(t,e,{value:tE.f(e)})}(e)})),er({target:"Symbol",stat:!0,forced:!Te},{for:function(e){var t=Ia(e);if(he(EE,t))return EE[t];var n=cE(t);return EE[t]=n,SE[n]=t,n},keyFor:function(e){if(!Ze(e))throw fE(e+" is not a symbol");if(he(SE,e))return SE[e]},useSetter:function(){TE=!0},useSimple:function(){TE=!1}}),er({target:"Object",stat:!0,forced:!Te,sham:!Ie},{create:function(e,t){return void 0===t?co(e):kE(co(e),t)},defineProperty:wE,defineProperties:kE,getOwnPropertyDescriptor:PE}),er({target:"Object",stat:!0,forced:!Te},{getOwnPropertyNames:RE,getOwnPropertySymbols:LE}),er({target:"Object",stat:!0,forced:$((function(){Vn.f(1)}))},{getOwnPropertySymbols:function(e){return Vn.f(le(e))}}),dE){var IE=!Te||$((function(){var e=cE();return"[null]"!=dE([e])||"{}"!=dE({a:e})||"{}"!=dE(Object(e))}));er({target:"JSON",stat:!0,forced:IE},{stringify:function(e,t,n){var r=ci(arguments),i=t;if((Ne(t)||void 0!==e)&&!Ze(e))return rn(t)||(t=function(e,t){if(ge(i)&&(t=We(i,this,e,t)),!Ze(t))return t}),r[1]=t,ui(dE,null,r)}})}if(!hE[oE]){var NE=hE.valueOf;Lt(hE,oE,(function(e){return We(NE,this)}))}wr(cE,"Symbol"),bt[aE]=!0;var DE=ut.f,FE=Z.Symbol,BE=FE&&FE.prototype;if(Ie&&ge(FE)&&(!("description"in BE)||void 0!==FE().description)){var UE={},zE=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:Ia(arguments[0]),t=Xe(BE,this)?new FE(e):void 0===e?FE():FE(e);return""===e&&(UE[t]=!0),t};Wn(zE,FE),zE.prototype=BE,BE.constructor=zE;var jE="Symbol(test)"==String(FE("test")),VE=ae(BE.toString),GE=ae(BE.valueOf),HE=/^Symbol\((.*)\)[^)]+$/,WE=ae("".replace),XE=ae("".slice);DE(BE,"description",{configurable:!0,get:function(){var e=GE(this),t=VE(e);if(he(UE,e))return"";var n=jE?XE(t,7,-1):WE(t,HE,"$1");return""===n?void 0:n}}),er({global:!0,forced:!0},{Symbol:zE})}var YE={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")};rl("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Gp);var ZE=QE,qE=QE,KE=1e20;function QE(e,t,n,r,i,a){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=a||"normal",this.radius=n||8;var o=this.size=this.fontSize+2*this.buffer,s=o+2*this.buffer,u="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM;u?this.canvas=my.createOffscreenCanvas(o,o,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=u?Math.round(o/2*1):Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function JE(e,t,n,r,i,a){for(var o=0;o<t;o++)$E(e,o,t,n,r,i,a);for(var s=0;s<n;s++)$E(e,s*t,1,t,r,i,a)}function $E(e,t,n,r,i,a,o){var s,u,l,c;for(a[0]=0,o[0]=-KE,o[1]=KE,s=0;s<r;s++)i[s]=e[t+s*n];for(s=1,u=0,l=0;s<r;s++){do{c=a[u],l=(i[s]-i[c]+s*s-c*c)/(s-c)/2}while(l<=o[u]&&--u>-1);a[++u]=s,o[u]=l,o[u+1]=KE}for(s=0,u=0;s<r;s++){for(;o[u+1]<s;)u++;c=a[u],e[t+s*n]=i[c]+(s-c)*(s-c)}}QE.prototype._draw=function(e,t){var n,r,i,a,o,s,u,l,c,h=this.ctx.measureText(e),f=h.width,p=2*this.buffer;t&&this.useMetrics?(o=Math.floor(h.actualBoundingBoxAscent),l=this.buffer+Math.ceil(h.actualBoundingBoxAscent),s=this.buffer,u=this.buffer,n=(r=Math.min(this.size,Math.ceil(h.actualBoundingBoxRight-h.actualBoundingBoxLeft)))+p,i=(a=Math.min(this.size-s,Math.ceil(h.actualBoundingBoxAscent+h.actualBoundingBoxDescent)))+p,this.ctx.textBaseline="alphabetic"):(n=r=this.size,i=a=this.size,o=19*this.fontSize/24,s=u=0,l=this.middle,this.ctx.textBaseline="middle"),r&&a&&(this.ctx.clearRect(u,s,r,a),this.ctx.fillText(e,this.buffer,l),c=this.ctx.getImageData(u,s,r,a));var d=new Uint8ClampedArray(n*i);return function(e,t,n,r,i,a,o){a.fill(KE,0,t*n),o.fill(0,0,t*n);for(var s=(t-r)/2,u=0;u<i;u++)for(var l=0;l<r;l++){var c=(u+s)*t+l+s,h=e.data[4*(u*r+l)+3]/255;if(1===h)a[c]=0,o[c]=KE;else if(0===h)a[c]=KE,o[c]=0;else{var f=Math.max(0,.5-h),p=Math.max(0,h-.5);a[c]=f*f,o[c]=p*p}}}(c,n,i,r,a,this.gridOuter,this.gridInner),JE(this.gridOuter,n,i,this.f,this.v,this.z),JE(this.gridInner,n,i,this.f,this.v,this.z),function(e,t,n,r,i,a,o){for(var s=0;s<t*n;s++){var u=Math.sqrt(r[s])-Math.sqrt(i[s]);e[s]=Math.round(255-255*(u/a+o))}}(d,n,i,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:d,metrics:{width:r,height:a,sdfWidth:n,sdfHeight:i,top:o,left:0,advance:f}}},QE.prototype.draw=function(e){return this._draw(e,!1).data},QE.prototype.drawWithMetrics=function(e){return this._draw(e,!0)},ZE.default=qE;var eS=Math.log,tS=Math.LN2;er({target:"Math",stat:!0},{log2:function(e){return eS(e)/tS}});var nS;function rS(e,t,n){var r,i=U(t);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=a.icon,s=a.xOffset;e[o.id]=v(v({},o),{},{x:s,y:n,image:o.image,width:o.width,height:o.height})}}catch(e){i.e(e)}finally{i.f()}}function iS(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var aS=function(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}();function oS(e,t,n,r){e.font="".concat(r," ").concat(n,"px ").concat(t),e.fillStyle="black",e.textBaseline="middle"}function sS(e,t){for(var n=0;n<e.length;n++)t.data[4*n+3]=e[n]}var uS=Qx()(nS=function(){function e(){_(this,e),E(this,"fontAtlas",void 0),E(this,"iconFontMap",void 0),E(this,"iconFontGlyphs",{}),E(this,"fontOptions",void 0),E(this,"key",void 0),E(this,"cache",new Nv(3))}return x(e,[{key:"scale",get:function(){return 1}},{key:"canvas",get:function(){var e=this.cache.get(this.key);return e&&e.data}},{key:"mapping",get:function(){var e=this.cache.get(this.key);return e&&e.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:"sans-serif",fontWeight:"normal",characterSet:aS,fontSize:24,buffer:3,sdf:!0,cutoff:.25,radius:8,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(e){var t=this;e.forEach((function(e){t.iconFontGlyphs[e.name]=e.unicode}))}},{key:"addIconFont",value:function(e,t){this.iconFontMap.set(e,t)}},{key:"getIconFontKey",value:function(e){return this.iconFontMap.get(e)||e}},{key:"getGlyph",value:function(e){return this.iconFontGlyphs[e]?String.fromCharCode(parseInt(this.iconFontGlyphs[e],16)):""}},{key:"setFontOptions",value:function(e){this.fontOptions=v(v({},this.fontOptions),e),this.key=this.getKey();var t=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(!n||0!==t.length){var r=this.generateFontAtlas(this.key,t,n);this.fontAtlas=r,this.cache.set(this.key,r)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(e,t,n){var r=this.fontOptions,i=r.fontFamily,a=r.fontWeight,o=r.fontSize,s=r.buffer,u=r.sdf,l=r.radius,c=r.cutoff,h=r.iconfont,f=n&&n.data;f||((f=Ed.document.createElement("canvas")).width=1024);var p=f.getContext("2d");oS(p,i,o,a);var d=function(e){var t=e.characterSet,n=e.getFontWidth,r=e.fontHeight,i=e.buffer,a=e.maxCanvasWidth,o=e.mapping,s=void 0===o?{}:o,u=e.xOffset,l=void 0===u?0:u,c=e.yOffset,h=void 0===c?0:c,f=0,p=l;Array.from(t).forEach((function(e,t){if(!s[e]){var r=n(e,t);p+30>a&&(p=0,f++),s[e]={x:p,y:h+30*f,width:30,height:30,advance:r},p+=30}}));var d=r+2*i;return{mapping:s,xOffset:p,yOffset:h+f*d,canvasHeight:iS(h+(f+1)*d)}}(v({getFontWidth:function(e){return p.measureText(e).width},fontHeight:1*o,buffer:s,characterSet:t,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),g=d.mapping,m=d.canvasHeight,y=d.xOffset,_=d.yOffset,b=p.getImageData(0,0,f.width,f.height);if(f.height=m,p.putImageData(b,0,0),oS(p,i,o,a),u){var x,E=new ZE(o,s,l,c,i,a),S=p.getImageData(0,0,E.size,E.size),C=U(t);try{for(C.s();!(x=C.n()).done;){var T=x.value;if(h){var A=String.fromCharCode(parseInt(T.replace("&#x","").replace(";",""),16));sS(E.draw(A),S)}else sS(E.draw(T),S);p.putImageData(S,g[T].x,g[T].y)}}catch(e){C.e(e)}finally{C.f()}}else{var M,w=U(t);try{for(w.s();!(M=w.n()).done;){var k=M.value;p.fillText(k,g[k].x,g[k].y+1*o)}}catch(e){w.e(e)}finally{w.f()}}return{xOffset:y,yOffset:_,mapping:g,data:f,width:f.width,height:f.height}}},{key:"getKey",value:function(){return"key"}},{key:"getNewChars",value:function(e,t){var n=this.cache.get(e);if(!n)return t;var r=[],i=n.mapping,a=new Set(Object.keys(i));return new Set(t).forEach((function(e){a.has(e)||r.push(e)})),r}}]),e}())||nS,lS=Pe("iterator"),cS=!$((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[lS]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})),hS=/[^\0-\u007E]/,fS=/[.\u3002\uFF0E\uFF61]/g,pS="Overflow: input needs wider integers to process",dS=Z.RangeError,vS=ae(fS.exec),gS=Math.floor,mS=String.fromCharCode,yS=ae("".charCodeAt),_S=ae([].join),bS=ae([].push),xS=ae("".replace),ES=ae("".split),SS=ae("".toLowerCase),CS=function(e){return e+22+75*(e<26)},TS=function(e,t,n){var r=0;for(e=n?gS(e/700):e>>1,e+=gS(e/t);e>455;)e=gS(e/35),r+=36;return gS(r+36*e/(e+38))},AS=function(e){var t,n,r=[],i=(e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=yS(e,n++);if(i>=55296&&i<=56319&&n<r){var a=yS(e,n++);56320==(64512&a)?bS(t,((1023&i)<<10)+(1023&a)+65536):(bS(t,i),n--)}else bS(t,i)}return t}(e)).length,a=128,o=0,s=72;for(t=0;t<e.length;t++)(n=e[t])<128&&bS(r,mS(n));var u=r.length,l=u;for(u&&bS(r,"-");l<i;){var c=2147483647;for(t=0;t<e.length;t++)(n=e[t])>=a&&n<c&&(c=n);var h=l+1;if(c-a>gS((2147483647-o)/h))throw dS(pS);for(o+=(c-a)*h,a=c,t=0;t<e.length;t++){if((n=e[t])<a&&++o>2147483647)throw dS(pS);if(n==a){for(var f=o,p=36;;){var d=p<=s?1:p>=s+26?26:p-s;if(f<d)break;var v=f-d,g=36-d;bS(r,mS(CS(d+v%g))),f=gS(v/g),p+=36}bS(r,mS(CS(f))),s=TS(o,h,l==u),o=0,l++}}o++,a++}return _S(r,"")},MS=Pe("iterator"),wS=wt.set,kS=wt.getterFor("URLSearchParams"),OS=wt.getterFor("URLSearchParamsIterator"),PS=ye("fetch"),RS=ye("Request"),LS=ye("Headers"),IS=RS&&RS.prototype,NS=LS&&LS.prototype,DS=Z.RegExp,FS=Z.TypeError,BS=Z.decodeURIComponent,US=Z.encodeURIComponent,zS=ae("".charAt),jS=ae([].join),VS=ae([].push),GS=ae("".replace),HS=ae([].shift),WS=ae([].splice),XS=ae("".split),YS=ae("".slice),ZS=/\+/g,qS=Array(4),KS=function(e){return qS[e-1]||(qS[e-1]=DS("((?:%[\\da-f]{2}){"+e+"})","gi"))},QS=function(e){try{return BS(e)}catch(t){return e}},JS=function(e){var t=GS(e,ZS," "),n=4;try{return BS(t)}catch(e){for(;n;)t=GS(t,KS(n--),QS);return t}},$S=/[!'()~]|%20/g,eC={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},tC=function(e){return eC[e]},nC=function(e){return GS(US(e),$S,tC)},rC=Lu((function(e,t){wS(this,{type:"URLSearchParamsIterator",iterator:zr(kS(e).entries),kind:t})}),"Iterator",(function(){var e=OS(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n}),!0),iC=function(e){this.entries=[],this.url=null,void 0!==e&&(Ne(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===zS(e,0)?YS(e,1):e:Ia(e)))};iC.prototype={type:"URLSearchParams",bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,a,o,s,u=Br(e);if(u)for(n=(t=zr(e,u)).next;!(r=We(n,t)).done;){if(a=(i=zr(Ge(r.value))).next,(o=We(a,i)).done||(s=We(a,i)).done||!We(a,i).done)throw FS("Expected sequence with length 2");VS(this.entries,{key:Ia(o.value),value:Ia(s.value)})}else for(var l in e)he(e,l)&&VS(this.entries,{key:l,value:Ia(e[l])})},parseQuery:function(e){if(e)for(var t,n,r=XS(e,"&"),i=0;i<r.length;)(t=r[i++]).length&&(n=XS(t,"="),VS(this.entries,{key:JS(HS(n)),value:JS(jS(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],VS(n,nC(e.key)+"="+nC(e.value));return jS(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var aC=function(){Rr(this,oC);var e=arguments.length>0?arguments[0]:void 0;wS(this,new iC(e))},oC=aC.prototype;if(Er(oC,{append:function(e,t){fi(arguments.length,2);var n=kS(this);VS(n.entries,{key:Ia(e),value:Ia(t)}),n.updateURL()},delete:function(e){fi(arguments.length,1);for(var t=kS(this),n=t.entries,r=Ia(e),i=0;i<n.length;)n[i].key===r?WS(n,i,1):i++;t.updateURL()},get:function(e){fi(arguments.length,1);for(var t=kS(this).entries,n=Ia(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){fi(arguments.length,1);for(var t=kS(this).entries,n=Ia(e),r=[],i=0;i<t.length;i++)t[i].key===n&&VS(r,t[i].value);return r},has:function(e){fi(arguments.length,1);for(var t=kS(this).entries,n=Ia(e),r=0;r<t.length;)if(t[r++].key===n)return!0;return!1},set:function(e,t){fi(arguments.length,1);for(var n,r=kS(this),i=r.entries,a=!1,o=Ia(e),s=Ia(t),u=0;u<i.length;u++)(n=i[u]).key===o&&(a?WS(i,u--,1):(a=!0,n.value=s));a||VS(i,{key:o,value:s}),r.updateURL()},sort:function(){var e=kS(this);Qf(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=kS(this).entries,r=Yt(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new rC(this,"keys")},values:function(){return new rC(this,"values")},entries:function(){return new rC(this,"entries")}},{enumerable:!0}),Lt(oC,MS,oC.entries,{name:"entries"}),Lt(oC,"toString",(function(){return kS(this).serialize()}),{enumerable:!0}),wr(aC,"URLSearchParams"),er({global:!0,forced:!cS},{URLSearchParams:aC}),!cS&&ge(LS)){var sC=ae(NS.has),uC=ae(NS.set),lC=function(e){if(Ne(e)){var t,n=e.body;if("URLSearchParams"===zt(n))return t=e.headers?new LS(e.headers):new LS,sC(t,"content-type")||uC(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),co(e,{body:lt(0,Ia(n)),headers:lt(0,t)})}return e};if(ge(PS)&&er({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return PS(e,arguments.length>1?lC(arguments[1]):{})}}),ge(RS)){var cC=function(e){return Rr(this,IS),new RS(e,arguments.length>1?lC(arguments[1]):{})};IS.constructor=cC,cC.prototype=IS,er({global:!0,forced:!0},{Request:cC})}}var hC={URLSearchParams:aC,getState:kS},fC=io.f,pC=No.codeAt,dC=wt.set,vC=wt.getterFor("URL"),gC=hC.URLSearchParams,mC=hC.getState,yC=Z.URL,_C=Z.TypeError,bC=Z.parseInt,xC=Math.floor,EC=Math.pow,SC=ae("".charAt),CC=ae(/./.exec),TC=ae([].join),AC=ae(1..toString),MC=ae([].pop),wC=ae([].push),kC=ae("".replace),OC=ae([].shift),PC=ae("".split),RC=ae("".slice),LC=ae("".toLowerCase),IC=ae([].unshift),NC=/[a-z]/i,DC=/[\d+-.a-z]/i,FC=/\d/,BC=/^0x/i,UC=/^[0-7]+$/,zC=/^\d+$/,jC=/^[\da-f]+$/i,VC=/[\0\t\n\r #%/:<>?@[\\\]^|]/,GC=/[\0\t\n\r #/:<>?@[\\\]^|]/,HC=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,WC=/[\t\n\r]/g,XC=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)IC(t,e%256),e=xC(e/256);return TC(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,a=0;a<8;a++)0!==e[a]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=a),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=AC(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},YC={},ZC=mu({},YC,{" ":1,'"':1,"<":1,">":1,"`":1}),qC=mu({},ZC,{"#":1,"?":1,"{":1,"}":1}),KC=mu({},qC,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),QC=function(e,t){var n=pC(e,0);return n>32&&n<127&&!he(t,e)?e:encodeURIComponent(e)},JC={ftp:21,file:null,http:80,https:443,ws:80,wss:443},$C=function(e,t){var n;return 2==e.length&&CC(NC,SC(e,0))&&(":"==(n=SC(e,1))||!t&&"|"==n)},eT=function(e){var t;return e.length>1&&$C(RC(e,0,2))&&(2==e.length||"/"===(t=SC(e,2))||"\\"===t||"?"===t||"#"===t)},tT=function(e){return"."===e||"%2e"===LC(e)},nT={},rT={},iT={},aT={},oT={},sT={},uT={},lT={},cT={},hT={},fT={},pT={},dT={},vT={},gT={},mT={},yT={},_T={},bT={},xT={},ET={},ST=function(e,t,n){var r,i,a,o=Ia(e);if(t){if(i=this.parse(o))throw _C(i);this.searchParams=null}else{if(void 0!==n&&(r=new ST(n,!0)),i=this.parse(o,null,r))throw _C(i);(a=mC(new gC)).bindURL(this),this.searchParams=a}};ST.prototype={type:"URL",parse:function(e,t,n){var r,i,a,o,s,u=this,l=t||nT,c=0,h="",f=!1,p=!1,d=!1;for(e=Ia(e),t||(u.scheme="",u.username="",u.password="",u.host=null,u.port=null,u.path=[],u.query=null,u.fragment=null,u.cannotBeABaseURL=!1,e=kC(e,HC,"")),e=kC(e,WC,""),r=jg(e);c<=r.length;){switch(i=r[c],l){case nT:if(!i||!CC(NC,i)){if(t)return"Invalid scheme";l=iT;continue}h+=LC(i),l=rT;break;case rT:if(i&&(CC(DC,i)||"+"==i||"-"==i||"."==i))h+=LC(i);else{if(":"!=i){if(t)return"Invalid scheme";h="",l=iT,c=0;continue}if(t&&(u.isSpecial()!=he(JC,h)||"file"==h&&(u.includesCredentials()||null!==u.port)||"file"==u.scheme&&!u.host))return;if(u.scheme=h,t)return void(u.isSpecial()&&JC[u.scheme]==u.port&&(u.port=null));h="","file"==u.scheme?l=vT:u.isSpecial()&&n&&n.scheme==u.scheme?l=aT:u.isSpecial()?l=lT:"/"==r[c+1]?(l=oT,c++):(u.cannotBeABaseURL=!0,wC(u.path,""),l=bT)}break;case iT:if(!n||n.cannotBeABaseURL&&"#"!=i)return"Invalid scheme";if(n.cannotBeABaseURL&&"#"==i){u.scheme=n.scheme,u.path=ss(n.path),u.query=n.query,u.fragment="",u.cannotBeABaseURL=!0,l=ET;break}l="file"==n.scheme?vT:sT;continue;case aT:if("/"!=i||"/"!=r[c+1]){l=sT;continue}l=cT,c++;break;case oT:if("/"==i){l=hT;break}l=_T;continue;case sT:if(u.scheme=n.scheme,null==i)u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=ss(n.path),u.query=n.query;else if("/"==i||"\\"==i&&u.isSpecial())l=uT;else if("?"==i)u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=ss(n.path),u.query="",l=xT;else{if("#"!=i){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=ss(n.path),u.path.length--,l=_T;continue}u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=ss(n.path),u.query=n.query,u.fragment="",l=ET}break;case uT:if(!u.isSpecial()||"/"!=i&&"\\"!=i){if("/"!=i){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,l=_T;continue}l=hT}else l=cT;break;case lT:if(l=cT,"/"!=i||"/"!=SC(h,c+1))continue;c++;break;case cT:if("/"!=i&&"\\"!=i){l=hT;continue}break;case hT:if("@"==i){f&&(h="%40"+h),f=!0,a=jg(h);for(var v=0;v<a.length;v++){var g=a[v];if(":"!=g||d){var m=QC(g,KC);d?u.password+=m:u.username+=m}else d=!0}h=""}else if(null==i||"/"==i||"?"==i||"#"==i||"\\"==i&&u.isSpecial()){if(f&&""==h)return"Invalid authority";c-=jg(h).length+1,h="",l=fT}else h+=i;break;case fT:case pT:if(t&&"file"==u.scheme){l=mT;continue}if(":"!=i||p){if(null==i||"/"==i||"?"==i||"#"==i||"\\"==i&&u.isSpecial()){if(u.isSpecial()&&""==h)return"Invalid host";if(t&&""==h&&(u.includesCredentials()||null!==u.port))return;if(o=u.parseHost(h))return o;if(h="",l=yT,t)return;continue}"["==i?p=!0:"]"==i&&(p=!1),h+=i}else{if(""==h)return"Invalid host";if(o=u.parseHost(h))return o;if(h="",l=dT,t==pT)return}break;case dT:if(!CC(FC,i)){if(null==i||"/"==i||"?"==i||"#"==i||"\\"==i&&u.isSpecial()||t){if(""!=h){var y=bC(h,10);if(y>65535)return"Invalid port";u.port=u.isSpecial()&&y===JC[u.scheme]?null:y,h=""}if(t)return;l=yT;continue}return"Invalid port"}h+=i;break;case vT:if(u.scheme="file","/"==i||"\\"==i)l=gT;else{if(!n||"file"!=n.scheme){l=_T;continue}if(null==i)u.host=n.host,u.path=ss(n.path),u.query=n.query;else if("?"==i)u.host=n.host,u.path=ss(n.path),u.query="",l=xT;else{if("#"!=i){eT(TC(ss(r,c),""))||(u.host=n.host,u.path=ss(n.path),u.shortenPath()),l=_T;continue}u.host=n.host,u.path=ss(n.path),u.query=n.query,u.fragment="",l=ET}}break;case gT:if("/"==i||"\\"==i){l=mT;break}n&&"file"==n.scheme&&!eT(TC(ss(r,c),""))&&($C(n.path[0],!0)?wC(u.path,n.path[0]):u.host=n.host),l=_T;continue;case mT:if(null==i||"/"==i||"\\"==i||"?"==i||"#"==i){if(!t&&$C(h))l=_T;else if(""==h){if(u.host="",t)return;l=yT}else{if(o=u.parseHost(h))return o;if("localhost"==u.host&&(u.host=""),t)return;h="",l=yT}continue}h+=i;break;case yT:if(u.isSpecial()){if(l=_T,"/"!=i&&"\\"!=i)continue}else if(t||"?"!=i)if(t||"#"!=i){if(null!=i&&(l=_T,"/"!=i))continue}else u.fragment="",l=ET;else u.query="",l=xT;break;case _T:if(null==i||"/"==i||"\\"==i&&u.isSpecial()||!t&&("?"==i||"#"==i)){if(".."===(s=LC(s=h))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(u.shortenPath(),"/"==i||"\\"==i&&u.isSpecial()||wC(u.path,"")):tT(h)?"/"==i||"\\"==i&&u.isSpecial()||wC(u.path,""):("file"==u.scheme&&!u.path.length&&$C(h)&&(u.host&&(u.host=""),h=SC(h,0)+":"),wC(u.path,h)),h="","file"==u.scheme&&(null==i||"?"==i||"#"==i))for(;u.path.length>1&&""===u.path[0];)OC(u.path);"?"==i?(u.query="",l=xT):"#"==i&&(u.fragment="",l=ET)}else h+=QC(i,qC);break;case bT:"?"==i?(u.query="",l=xT):"#"==i?(u.fragment="",l=ET):null!=i&&(u.path[0]+=QC(i,YC));break;case xT:t||"#"!=i?null!=i&&("'"==i&&u.isSpecial()?u.query+="%27":u.query+="#"==i?"%23":QC(i,YC)):(u.fragment="",l=ET);break;case ET:null!=i&&(u.fragment+=QC(i,ZC))}c++}},parseHost:function(e){var t,n,r;if("["==SC(e,0)){if("]"!=SC(e,e.length-1))return"Invalid host";if(!(t=function(e){var t,n,r,i,a,o,s,u=[0,0,0,0,0,0,0,0],l=0,c=null,h=0,f=function(){return SC(e,h)};if(":"==f()){if(":"!=SC(e,1))return;h+=2,c=++l}for(;f();){if(8==l)return;if(":"!=f()){for(t=n=0;n<4&&CC(jC,f());)t=16*t+bC(f(),16),h++,n++;if("."==f()){if(0==n)return;if(h-=n,l>6)return;for(r=0;f();){if(i=null,r>0){if(!("."==f()&&r<4))return;h++}if(!CC(FC,f()))return;for(;CC(FC,f());){if(a=bC(f(),10),null===i)i=a;else{if(0==i)return;i=10*i+a}if(i>255)return;h++}u[l]=256*u[l]+i,2!=++r&&4!=r||l++}if(4!=r)return;break}if(":"==f()){if(h++,!f())return}else if(f())return;u[l++]=t}else{if(null!==c)return;h++,c=++l}}if(null!==c)for(o=l-c,l=7;0!=l&&o>0;)s=u[l],u[l--]=u[c+o-1],u[c+--o]=s;else if(8!=l)return;return u}(RC(e,1,-1))))return"Invalid host";this.host=t}else if(this.isSpecial()){if(e=function(e){var t,n,r=[],i=ES(xS(SS(e),fS,"."),".");for(t=0;t<i.length;t++)n=i[t],bS(r,vS(hS,n)?"xn--"+AS(n):n);return _S(r,".")}(e),CC(VC,e))return"Invalid host";if(null===(t=function(e){var t,n,r,i,a,o,s,u=PC(e,".");if(u.length&&""==u[u.length-1]&&u.length--,(t=u.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(i=u[r]))return e;if(a=10,i.length>1&&"0"==SC(i,0)&&(a=CC(BC,i)?16:8,i=RC(i,8==a?1:2)),""===i)o=0;else{if(!CC(10==a?zC:8==a?UC:jC,i))return e;o=bC(i,a)}wC(n,o)}for(r=0;r<t;r++)if(o=n[r],r==t-1){if(o>=EC(256,5-t))return null}else if(o>255)return null;for(s=MC(n),r=0;r<n.length;r++)s+=n[r]*EC(256,3-r);return s}(e)))return"Invalid host";this.host=t}else{if(CC(GC,e))return"Invalid host";for(t="",n=jg(e),r=0;r<n.length;r++)t+=QC(n[r],YC);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return he(JC,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&$C(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,a=e.port,o=e.path,s=e.query,u=e.fragment,l=t+":";return null!==i?(l+="//",e.includesCredentials()&&(l+=n+(r?":"+r:"")+"@"),l+=XC(i),null!==a&&(l+=":"+a)):"file"==t&&(l+="//"),l+=e.cannotBeABaseURL?o[0]:o.length?"/"+TC(o,"/"):"",null!==s&&(l+="?"+s),null!==u&&(l+="#"+u),l},setHref:function(e){var t=this.parse(e);if(t)throw _C(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new TT(e.path[0]).origin}catch(e){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+XC(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Ia(e)+":",nT)},getUsername:function(){return this.username},setUsername:function(e){var t=jg(Ia(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=QC(t[n],KC)}},getPassword:function(){return this.password},setPassword:function(e){var t=jg(Ia(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=QC(t[n],KC)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?XC(e):XC(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,fT)},getHostname:function(){var e=this.host;return null===e?"":XC(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,pT)},getPort:function(){var e=this.port;return null===e?"":Ia(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=Ia(e))?this.port=null:this.parse(e,dT))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+TC(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,yT))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=Ia(e))?this.query=null:("?"==SC(e,0)&&(e=RC(e,1)),this.query="",this.parse(e,xT)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=Ia(e))?("#"==SC(e,0)&&(e=RC(e,1)),this.fragment="",this.parse(e,ET)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var CT,TT=function(e){var t=Rr(this,AT),n=fi(arguments.length,1)>1?arguments[1]:void 0,r=dC(t,new ST(e,!1,n));Ie||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},AT=TT.prototype,MT=function(e,t){return{get:function(){return vC(this)[e]()},set:t&&function(e){return vC(this)[t](e)},configurable:!0,enumerable:!0}};if(Ie&&fC(AT,{href:MT("serialize","setHref"),origin:MT("getOrigin"),protocol:MT("getProtocol","setProtocol"),username:MT("getUsername","setUsername"),password:MT("getPassword","setPassword"),host:MT("getHost","setHost"),hostname:MT("getHostname","setHostname"),port:MT("getPort","setPort"),pathname:MT("getPathname","setPathname"),search:MT("getSearch","setSearch"),searchParams:MT("getSearchParams"),hash:MT("getHash","setHash")}),Lt(AT,"toJSON",(function(){return vC(this).serialize()}),{enumerable:!0}),Lt(AT,"toString",(function(){return vC(this).serialize()}),{enumerable:!0}),yC){var wT=yC.createObjectURL,kT=yC.revokeObjectURL;wT&&Lt(TT,"createObjectURL",Yt(wT,yC)),kT&&Lt(TT,"revokeObjectURL",Yt(kT,yC))}wr(TT,"URL"),er({global:!0,forced:!cS,sham:!Ie},{URL:TT});var OT=Qx()(CT=function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"canvasHeight",128),E(O(e),"texture",void 0),E(O(e),"canvas",void 0),E(O(e),"iconData",void 0),E(O(e),"iconMap",void 0),E(O(e),"ctx",void 0),E(O(e),"loadingImageCount",0),e}return x(n,[{key:"isLoading",value:function(){return 0===this.loadingImageCount}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=Ed.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(e,t){var n=this,r=new Image;if(this.loadingImageCount++,this.hasImage(e))throw new Error("Image Id already exists");this.iconData.push({id:e,size:64}),this.updateIconMap(),this.loadImage(t).then((function(t){r=t;var i=n.iconData.find((function(t){return t.id===e}));i&&(i.image=r,i.width=r.width,i.height=r.height),n.update()}))}},{key:"addImageMini",value:function(e,t,n){var r=this,i=n.getSceneConfig().canvas,a=i.createImage();if(this.loadingImageCount++,this.hasImage(e))throw new Error("Image Id already exists");this.iconData.push({id:e,size:64}),this.updateIconMap(),this.loadImageMini(t,i).then((function(t){a=t;var n=r.iconData.find((function(t){return t.id===e}));n&&(n.image=a,n.width=a.width,n.height=a.height),r.update()}))}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(e){return this.iconMap.hasOwnProperty(e)}},{key:"removeImage",value:function(e){this.hasImage(e)&&(this.iconData=this.iconData.filter((function(t){return t.id!==e})),delete this.iconMap[e],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(e){return new Promise((function(t,n){if(e instanceof HTMLImageElement)t(e);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t(r)},r.onerror=function(){n(new Error("Could not load image at "+e))},r.src=e instanceof File?URL.createObjectURL(e):e}}))}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,0===this.loadingImageCount&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var e=this;this.canvas.width=1024,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach((function(t){var n=e.iconMap[t],r=n.x,i=n.y,a=n.image,o=n.width,s=void 0===o?64:o,u=n.height,l=void 0===u?64:u,c=Math.max(s,l)/64,h=l/c,f=s/c;a&&e.ctx.drawImage(a,r+(64-f)/2,i+(64-h)/2,f,h)}))}},{key:"updateIconMap",value:function(){var e=function(e,t,n){var r,i=0,a=0,o=0,s=[],u={},l=U(e);try{for(l.s();!(r=l.n()).done;){var c=r.value;if(!u[c.id]){var h=c.size;i+h+t>n&&(rS(u,s,a),i=0,a=o+a+t,o=0,s=[]),s.push({icon:c,xOffset:i}),i=i+h+t,o=Math.max(o,h)}}}catch(e){l.e(e)}finally{l.f()}return s.length>0&&rS(u,s,a),{mapping:u,canvasHeight:iS(o+a+t)}}(this.iconData,3,1024),t=e.mapping,n=e.canvasHeight;this.iconMap=t,this.canvasHeight=n}},{key:"loadImageMini",value:function(e,t){return new Promise((function(n,r){var i=t.createImage();i.crossOrigin="anonymous",i.onload=function(){n(i)},i.onerror=function(){r(new Error("Could not load image at "+e))},i.src=e}))}}]),n}(jb))||CT,PT=1e-6,RT="undefined"!=typeof Float32Array?Float32Array:Array,LT=Math.random;function IT(){var e=new RT(16);return RT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function NT(e){var t=new RT(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function DT(e,t,n,r,i,a,o,s,u,l,c,h,f,p,d,v){var g=new RT(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=r,g[4]=i,g[5]=a,g[6]=o,g[7]=s,g[8]=u,g[9]=l,g[10]=c,g[11]=h,g[12]=f,g[13]=p,g[14]=d,g[15]=v,g}function FT(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function BT(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],p=t[11],d=t[12],v=t[13],g=t[14],m=t[15],y=n*s-r*o,_=n*u-i*o,b=n*l-a*o,x=r*u-i*s,E=r*l-a*s,S=i*l-a*u,C=c*v-h*d,T=c*g-f*d,A=c*m-p*d,M=h*g-f*v,w=h*m-p*v,k=f*m-p*g,O=y*k-_*w+b*M+x*A-E*T+S*C;return O?(O=1/O,e[0]=(s*k-u*w+l*M)*O,e[1]=(i*w-r*k-a*M)*O,e[2]=(v*S-g*E+m*x)*O,e[3]=(f*E-h*S-p*x)*O,e[4]=(u*A-o*k-l*T)*O,e[5]=(n*k-i*A+a*T)*O,e[6]=(g*b-d*S-m*_)*O,e[7]=(c*S-f*b+p*_)*O,e[8]=(o*w-s*A+l*C)*O,e[9]=(r*A-n*w-a*C)*O,e[10]=(d*E-v*b+m*y)*O,e[11]=(h*b-c*E-p*y)*O,e[12]=(s*T-o*M-u*C)*O,e[13]=(n*M-r*T+i*C)*O,e[14]=(v*_-d*x-g*y)*O,e[15]=(c*x-h*_+f*y)*O,e):null}function UT(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=t[9],p=t[10],d=t[11],v=t[12],g=t[13],m=t[14],y=t[15],_=n[0],b=n[1],x=n[2],E=n[3];return e[0]=_*r+b*s+x*h+E*v,e[1]=_*i+b*u+x*f+E*g,e[2]=_*a+b*l+x*p+E*m,e[3]=_*o+b*c+x*d+E*y,_=n[4],b=n[5],x=n[6],E=n[7],e[4]=_*r+b*s+x*h+E*v,e[5]=_*i+b*u+x*f+E*g,e[6]=_*a+b*l+x*p+E*m,e[7]=_*o+b*c+x*d+E*y,_=n[8],b=n[9],x=n[10],E=n[11],e[8]=_*r+b*s+x*h+E*v,e[9]=_*i+b*u+x*f+E*g,e[10]=_*a+b*l+x*p+E*m,e[11]=_*o+b*c+x*d+E*y,_=n[12],b=n[13],x=n[14],E=n[15],e[12]=_*r+b*s+x*h+E*v,e[13]=_*i+b*u+x*f+E*g,e[14]=_*a+b*l+x*p+E*m,e[15]=_*o+b*c+x*d+E*y,e}function zT(e,t,n){var r,i,a,o,s,u,l,c,h,f,p,d,v=n[0],g=n[1],m=n[2];return t===e?(e[12]=t[0]*v+t[4]*g+t[8]*m+t[12],e[13]=t[1]*v+t[5]*g+t[9]*m+t[13],e[14]=t[2]*v+t[6]*g+t[10]*m+t[14],e[15]=t[3]*v+t[7]*g+t[11]*m+t[15]):(r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=t[9],p=t[10],d=t[11],e[0]=r,e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=u,e[6]=l,e[7]=c,e[8]=h,e[9]=f,e[10]=p,e[11]=d,e[12]=r*v+s*g+h*m+t[12],e[13]=i*v+u*g+f*m+t[13],e[14]=a*v+l*g+p*m+t[14],e[15]=o*v+c*g+d*m+t[15]),e}function jT(e,t,n){var r=n[0],i=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function VT(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+l*r,e[5]=o*i+c*r,e[6]=s*i+h*r,e[7]=u*i+f*r,e[8]=l*i-a*r,e[9]=c*i-o*r,e[10]=h*i-s*r,e[11]=f*i-u*r,e}function GT(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],u=t[3],l=t[8],c=t[9],h=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-l*r,e[1]=o*i-c*r,e[2]=s*i-h*r,e[3]=u*i-f*r,e[8]=a*r+l*i,e[9]=o*r+c*i,e[10]=s*r+h*i,e[11]=u*r+f*i,e}function HT(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],u=t[3],l=t[4],c=t[5],h=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+l*r,e[1]=o*i+c*r,e[2]=s*i+h*r,e[3]=u*i+f*r,e[4]=l*i-a*r,e[5]=c*i-o*r,e[6]=h*i-s*r,e[7]=f*i-u*r,e}function WT(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function XT(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=r+r,u=i+i,l=a+a,c=r*s,h=r*u,f=r*l,p=i*u,d=i*l,v=a*l,g=o*s,m=o*u,y=o*l;return e[0]=1-(p+v),e[1]=h+y,e[2]=f-m,e[3]=0,e[4]=h-y,e[5]=1-(c+v),e[6]=d+g,e[7]=0,e[8]=f+m,e[9]=d-g,e[10]=1-(c+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function YT(e,t){var n=t[0],r=t[1],i=t[2],a=t[4],o=t[5],s=t[6],u=t[8],l=t[9],c=t[10];return e[0]=Math.hypot(n,r,i),e[1]=Math.hypot(a,o,s),e[2]=Math.hypot(u,l,c),e}function ZT(e,t,n,r,i){var a,o=1/Math.tan(t/2);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(a=1/(r-i),e[10]=(i+r)*a,e[14]=2*i*r*a):(e[10]=-1,e[14]=-2*r),e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var qT=ZT;function KT(e,t,n,r,i,a,o){var s=1/(t-n),u=1/(r-i),l=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(o+a)*l,e[15]=1,e}var QT=KT;function JT(e,t,n,r){var i,a,o,s,u,l,c,h,f,p,d=t[0],v=t[1],g=t[2],m=r[0],y=r[1],_=r[2],b=n[0],x=n[1],E=n[2];return Math.abs(d-b)<PT&&Math.abs(v-x)<PT&&Math.abs(g-E)<PT?FT(e):(c=d-b,h=v-x,f=g-E,i=y*(f*=p=1/Math.hypot(c,h,f))-_*(h*=p),a=_*(c*=p)-m*f,o=m*h-y*c,(p=Math.hypot(i,a,o))?(i*=p=1/p,a*=p,o*=p):(i=0,a=0,o=0),s=h*o-f*a,u=f*i-c*o,l=c*a-h*i,(p=Math.hypot(s,u,l))?(s*=p=1/p,u*=p,l*=p):(s=0,u=0,l=0),e[0]=i,e[1]=s,e[2]=c,e[3]=0,e[4]=a,e[5]=u,e[6]=h,e[7]=0,e[8]=o,e[9]=l,e[10]=f,e[11]=0,e[12]=-(i*d+a*v+o*g),e[13]=-(s*d+u*v+l*g),e[14]=-(c*d+h*v+f*g),e[15]=1,e)}function $T(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function eA(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],p=e[11],d=e[12],v=e[13],g=e[14],m=e[15],y=t[0],_=t[1],b=t[2],x=t[3],E=t[4],S=t[5],C=t[6],T=t[7],A=t[8],M=t[9],w=t[10],k=t[11],O=t[12],P=t[13],R=t[14],L=t[15];return Math.abs(n-y)<=PT*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-_)<=PT*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-b)<=PT*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(a-x)<=PT*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(o-E)<=PT*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(s-S)<=PT*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(u-C)<=PT*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(l-T)<=PT*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-A)<=PT*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(h-M)<=PT*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(f-w)<=PT*Math.max(1,Math.abs(f),Math.abs(w))&&Math.abs(p-k)<=PT*Math.max(1,Math.abs(p),Math.abs(k))&&Math.abs(d-O)<=PT*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(v-P)<=PT*Math.max(1,Math.abs(v),Math.abs(P))&&Math.abs(g-R)<=PT*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(m-L)<=PT*Math.max(1,Math.abs(m),Math.abs(L))}var tA=UT,nA=$T,rA=Object.freeze({__proto__:null,create:IT,clone:NT,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues:DT,set:function(e,t,n,r,i,a,o,s,u,l,c,h,f,p,d,v,g){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e[8]=l,e[9]=c,e[10]=h,e[11]=f,e[12]=p,e[13]=d,e[14]=v,e[15]=g,e},identity:FT,transpose:function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=i,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:BT,adjoint:function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],p=t[11],d=t[12],v=t[13],g=t[14],m=t[15];return e[0]=s*(f*m-p*g)-h*(u*m-l*g)+v*(u*p-l*f),e[1]=-(r*(f*m-p*g)-h*(i*m-a*g)+v*(i*p-a*f)),e[2]=r*(u*m-l*g)-s*(i*m-a*g)+v*(i*l-a*u),e[3]=-(r*(u*p-l*f)-s*(i*p-a*f)+h*(i*l-a*u)),e[4]=-(o*(f*m-p*g)-c*(u*m-l*g)+d*(u*p-l*f)),e[5]=n*(f*m-p*g)-c*(i*m-a*g)+d*(i*p-a*f),e[6]=-(n*(u*m-l*g)-o*(i*m-a*g)+d*(i*l-a*u)),e[7]=n*(u*p-l*f)-o*(i*p-a*f)+c*(i*l-a*u),e[8]=o*(h*m-p*v)-c*(s*m-l*v)+d*(s*p-l*h),e[9]=-(n*(h*m-p*v)-c*(r*m-a*v)+d*(r*p-a*h)),e[10]=n*(s*m-l*v)-o*(r*m-a*v)+d*(r*l-a*s),e[11]=-(n*(s*p-l*h)-o*(r*p-a*h)+c*(r*l-a*s)),e[12]=-(o*(h*g-f*v)-c*(s*g-u*v)+d*(s*f-u*h)),e[13]=n*(h*g-f*v)-c*(r*g-i*v)+d*(r*f-i*h),e[14]=-(n*(s*g-u*v)-o*(r*g-i*v)+d*(r*u-i*s)),e[15]=n*(s*f-u*h)-o*(r*f-i*h)+c*(r*u-i*s),e},determinant:function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],f=e[11],p=e[12],d=e[13],v=e[14],g=e[15];return(t*o-n*a)*(h*g-f*v)-(t*s-r*a)*(c*g-f*d)+(t*u-i*a)*(c*v-h*d)+(n*s-r*o)*(l*g-f*p)-(n*u-i*o)*(l*v-h*p)+(r*u-i*s)*(l*d-c*p)},multiply:UT,translate:zT,scale:jT,rotate:function(e,t,n,r){var i,a,o,s,u,l,c,h,f,p,d,v,g,m,y,_,b,x,E,S,C,T,A,M,w=r[0],k=r[1],O=r[2],P=Math.hypot(w,k,O);return P<PT?null:(w*=P=1/P,k*=P,O*=P,i=Math.sin(n),o=1-(a=Math.cos(n)),s=t[0],u=t[1],l=t[2],c=t[3],h=t[4],f=t[5],p=t[6],d=t[7],v=t[8],g=t[9],m=t[10],y=t[11],_=w*w*o+a,b=k*w*o+O*i,x=O*w*o-k*i,E=w*k*o-O*i,S=k*k*o+a,C=O*k*o+w*i,T=w*O*o+k*i,A=k*O*o-w*i,M=O*O*o+a,e[0]=s*_+h*b+v*x,e[1]=u*_+f*b+g*x,e[2]=l*_+p*b+m*x,e[3]=c*_+d*b+y*x,e[4]=s*E+h*S+v*C,e[5]=u*E+f*S+g*C,e[6]=l*E+p*S+m*C,e[7]=c*E+d*S+y*C,e[8]=s*T+h*A+v*M,e[9]=u*T+f*A+g*M,e[10]=l*T+p*A+m*M,e[11]=c*T+d*A+y*M,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},rotateX:VT,rotateY:GT,rotateZ:HT,fromTranslation:WT,fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotation:function(e,t,n){var r,i,a,o=n[0],s=n[1],u=n[2],l=Math.hypot(o,s,u);return l<PT?null:(o*=l=1/l,s*=l,u*=l,r=Math.sin(t),a=1-(i=Math.cos(t)),e[0]=o*o*a+i,e[1]=s*o*a+u*r,e[2]=u*o*a-s*r,e[3]=0,e[4]=o*s*a-u*r,e[5]=s*s*a+i,e[6]=u*s*a+o*r,e[7]=0,e[8]=o*u*a+s*r,e[9]=s*u*a-o*r,e[10]=u*u*a+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromXRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:XT,fromQuat2:function(e,t){var n=new RT(3),r=-t[0],i=-t[1],a=-t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=r*r+i*i+a*a+o*o;return h>0?(n[0]=2*(s*o+c*r+u*a-l*i)/h,n[1]=2*(u*o+c*i+l*r-s*a)/h,n[2]=2*(l*o+c*a+s*i-u*r)/h):(n[0]=2*(s*o+c*r+u*a-l*i),n[1]=2*(u*o+c*i+l*r-s*a),n[2]=2*(l*o+c*a+s*i-u*r)),XT(e,t,n),e},getTranslation:function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},getScaling:YT,getRotation:function(e,t){var n=new RT(3);YT(n,t);var r=1/n[0],i=1/n[1],a=1/n[2],o=t[0]*r,s=t[1]*i,u=t[2]*a,l=t[4]*r,c=t[5]*i,h=t[6]*a,f=t[8]*r,p=t[9]*i,d=t[10]*a,v=o+c+d,g=0;return v>0?(g=2*Math.sqrt(v+1),e[3]=.25*g,e[0]=(h-p)/g,e[1]=(f-u)/g,e[2]=(s-l)/g):o>c&&o>d?(g=2*Math.sqrt(1+o-c-d),e[3]=(h-p)/g,e[0]=.25*g,e[1]=(s+l)/g,e[2]=(f+u)/g):c>d?(g=2*Math.sqrt(1+c-o-d),e[3]=(f-u)/g,e[0]=(s+l)/g,e[1]=.25*g,e[2]=(h+p)/g):(g=2*Math.sqrt(1+d-o-c),e[3]=(s-l)/g,e[0]=(f+u)/g,e[1]=(h+p)/g,e[2]=.25*g),e},fromRotationTranslationScale:function(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=t[3],u=i+i,l=a+a,c=o+o,h=i*u,f=i*l,p=i*c,d=a*l,v=a*c,g=o*c,m=s*u,y=s*l,_=s*c,b=r[0],x=r[1],E=r[2];return e[0]=(1-(d+g))*b,e[1]=(f+_)*b,e[2]=(p-y)*b,e[3]=0,e[4]=(f-_)*x,e[5]=(1-(h+g))*x,e[6]=(v+m)*x,e[7]=0,e[8]=(p+y)*E,e[9]=(v-m)*E,e[10]=(1-(h+d))*E,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,n,r,i){var a=t[0],o=t[1],s=t[2],u=t[3],l=a+a,c=o+o,h=s+s,f=a*l,p=a*c,d=a*h,v=o*c,g=o*h,m=s*h,y=u*l,_=u*c,b=u*h,x=r[0],E=r[1],S=r[2],C=i[0],T=i[1],A=i[2],M=(1-(v+m))*x,w=(p+b)*x,k=(d-_)*x,O=(p-b)*E,P=(1-(f+m))*E,R=(g+y)*E,L=(d+_)*S,I=(g-y)*S,N=(1-(f+v))*S;return e[0]=M,e[1]=w,e[2]=k,e[3]=0,e[4]=O,e[5]=P,e[6]=R,e[7]=0,e[8]=L,e[9]=I,e[10]=N,e[11]=0,e[12]=n[0]+C-(M*C+O*T+L*A),e[13]=n[1]+T-(w*C+P*T+I*A),e[14]=n[2]+A-(k*C+R*T+N*A),e[15]=1,e},fromQuat:function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n+n,s=r+r,u=i+i,l=n*o,c=r*o,h=r*s,f=i*o,p=i*s,d=i*u,v=a*o,g=a*s,m=a*u;return e[0]=1-h-d,e[1]=c+m,e[2]=f-g,e[3]=0,e[4]=c-m,e[5]=1-l-d,e[6]=p+v,e[7]=0,e[8]=f+g,e[9]=p-v,e[10]=1-l-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,n,r,i,a,o){var s=1/(n-t),u=1/(i-r),l=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(i+r)*u,e[10]=(o+a)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*l,e[15]=0,e},perspectiveNO:ZT,perspective:qT,perspectiveZO:function(e,t,n,r,i){var a,o=1/Math.tan(t/2);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(a=1/(r-i),e[10]=i*a,e[14]=i*r*a):(e[10]=-1,e[14]=-r),e},perspectiveFromFieldOfView:function(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(o+s),l=2/(i+a);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(o-s)*u*.5,e[9]=(i-a)*l*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e},orthoNO:KT,ortho:QT,orthoZO:function(e,t,n,r,i,a,o){var s=1/(t-n),u=1/(r-i),l=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=a*l,e[15]=1,e},lookAt:JT,targetTo:function(e,t,n,r){var i=t[0],a=t[1],o=t[2],s=r[0],u=r[1],l=r[2],c=i-n[0],h=a-n[1],f=o-n[2],p=c*c+h*h+f*f;p>0&&(c*=p=1/Math.sqrt(p),h*=p,f*=p);var d=u*f-l*h,v=l*c-s*f,g=s*h-u*c;return(p=d*d+v*v+g*g)>0&&(d*=p=1/Math.sqrt(p),v*=p,g*=p),e[0]=d,e[1]=v,e[2]=g,e[3]=0,e[4]=h*g-f*v,e[5]=f*d-c*g,e[6]=c*v-h*d,e[7]=0,e[8]=c,e[9]=h,e[10]=f,e[11]=0,e[12]=i,e[13]=a,e[14]=o,e[15]=1,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob:function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},subtract:$T,multiplyScalar:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},multiplyScalarAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},equals:eA,mul:tA,sub:nA});function iA(){var e=new RT(3);return RT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function aA(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function oA(e,t,n){var r=new RT(3);return r[0]=e,r[1]=t,r[2]=n,r}function sA(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function uA(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function lA(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function cA(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function hA(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.hypot(n,r,i)}function fA(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function pA(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function dA(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function vA(e,t){var n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function gA(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function mA(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],u=n[2];return e[0]=i*u-a*s,e[1]=a*o-r*u,e[2]=r*s-i*o,e}function yA(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return o=o||1,e[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/o,e[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,e[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,e}function _A(e,t){var n=e[0],r=e[1],i=e[2],a=t[0],o=t[1],s=t[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(a*a+o*o+s*s),l=u&&gA(e,t)/u;return Math.acos(Math.min(Math.max(l,-1),1))}var bA,xA=sA,EA=uA,SA=lA,CA=hA,TA=fA,AA=aA,MA=pA,wA=(bA=iA(),function(e,t,n,r,i,a){var o,s;for(t||(t=3),n||(n=0),s=r?Math.min(r*t+n,e.length):e.length,o=n;o<s;o+=t)bA[0]=e[o],bA[1]=e[o+1],bA[2]=e[o+2],i(bA,bA,a),e[o]=bA[0],e[o+1]=bA[1],e[o+2]=bA[2];return e}),kA=Object.freeze({__proto__:null,create:iA,clone:function(e){var t=new RT(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length:aA,fromValues:oA,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},subtract:sA,multiply:uA,divide:lA,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:cA,scaleAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},distance:hA,squaredDistance:fA,squaredLength:pA,negate:dA,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:vA,dot:gA,cross:mA,lerp:function(e,t,n,r){var i=t[0],a=t[1],o=t[2];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=o+r*(n[2]-o),e},hermite:function(e,t,n,r,i,a){var o=a*a,s=o*(2*a-3)+1,u=o*(a-2)+a,l=o*(a-1),c=o*(3-2*a);return e[0]=t[0]*s+n[0]*u+r[0]*l+i[0]*c,e[1]=t[1]*s+n[1]*u+r[1]*l+i[1]*c,e[2]=t[2]*s+n[2]*u+r[2]*l+i[2]*c,e},bezier:function(e,t,n,r,i,a){var o=1-a,s=o*o,u=a*a,l=s*o,c=3*a*s,h=3*u*o,f=u*a;return e[0]=t[0]*l+n[0]*c+r[0]*h+i[0]*f,e[1]=t[1]*l+n[1]*c+r[1]*h+i[1]*f,e[2]=t[2]*l+n[2]*c+r[2]*h+i[2]*f,e},random:function(e,t){t=t||1;var n=2*LT()*Math.PI,r=2*LT()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e},transformMat4:yA,transformMat3:function(e,t,n){var r=t[0],i=t[1],a=t[2];return e[0]=r*n[0]+i*n[3]+a*n[6],e[1]=r*n[1]+i*n[4]+a*n[7],e[2]=r*n[2]+i*n[5]+a*n[8],e},transformQuat:function(e,t,n){var r=n[0],i=n[1],a=n[2],o=n[3],s=t[0],u=t[1],l=t[2],c=i*l-a*u,h=a*s-r*l,f=r*u-i*s,p=i*f-a*h,d=a*c-r*f,v=r*h-i*c,g=2*o;return c*=g,h*=g,f*=g,p*=2,d*=2,v*=2,e[0]=s+c+p,e[1]=u+h+d,e[2]=l+f+v,e},rotateX:function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0],a[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),a[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},rotateY:function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),a[1]=i[1],a[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},rotateZ:function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),a[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),a[2]=i[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},angle:_A,zero:function(e){return e[0]=0,e[1]=0,e[2]=0,e},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equals:function(e,t){var n=e[0],r=e[1],i=e[2],a=t[0],o=t[1],s=t[2];return Math.abs(n-a)<=PT*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=PT*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=PT*Math.max(1,Math.abs(i),Math.abs(s))},sub:xA,mul:EA,div:SA,dist:CA,sqrDist:TA,len:AA,sqrLen:MA,forEach:wA});function OA(){var e=new RT(4);return RT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function PA(e,t,n,r){var i=new RT(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function RA(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,e}!function(){var e=OA()}();function LA(){var e=new RT(2);return RT!=Float32Array&&(e[0]=0,e[1]=0),e}function IA(e,t){var n=new RT(2);return n[0]=e,n[1]=t,n}function NA(e,t){return e[0]=t[0],e[1]=t[1],e}function DA(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function FA(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function BA(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function UA(e,t){return e[0]*t[0]+e[1]*t[1]}function zA(e,t,n,r){var i=t[0],a=t[1];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e}var jA,VA,GA,HA,WA,XA=FA,YA=(function(){var e=LA()}(),Qx()(jA=function(){function e(){_(this,e),E(this,"viewport",void 0),E(this,"overridedViewProjectionMatrix",void 0),E(this,"jitteredViewProjectionMatrix",void 0),E(this,"jitteredProjectionMatrix",void 0),E(this,"viewMatrixInverse",void 0),E(this,"cameraPosition",void 0)}return x(e,[{key:"init",value:function(){}},{key:"update",value:function(e){this.viewport=e,this.viewMatrixInverse=IT(),BT(this.viewMatrixInverse,e.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var e=N(this.viewport.getCenter(),2);return[e[0],e[1]]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}},{key:"setViewProjectionMatrix",value:function(e){this.overridedViewProjectionMatrix=e}},{key:"jitterProjectionMatrix",value:function(e,t){var n=WT(IT(),[e,t,0]);this.jitteredProjectionMatrix=UT(IT(),n,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=UT(IT(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||jA),ZA=Qx()(VA=function(){function e(){_(this,e),E(this,"container",void 0),E(this,"controlCorners",void 0),E(this,"controlContainer",void 0),E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"controls",[]),E(this,"unAddControls",[])}return x(e,[{key:"init",value:function(e,t){this.container=e.container,this.scene=t,this.mapsService=t.get(YE.IMapService),this.initControlPos()}},{key:"addControl",value:function(e,t){t.get(YE.IMapService).map?(e.addTo(this.scene),this.controls.push(e)):this.unAddControls.push(e)}},{key:"getControlByName",value:function(e){return this.controls.find((function(t){return t.controlOption.name===e}))}},{key:"removeControl",value:function(e){var t=this.controls.indexOf(e);return t>-1&&this.controls.splice(t,1),e.remove(),this}},{key:"addControls",value:function(){var e=this;this.unAddControls.forEach((function(t){t.addTo(e.scene),e.controls.push(t)})),this.unAddControls=[]}},{key:"destroy",value:function(){var e,t=U(this.controls);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(e){t.e(e)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var e=this.controlCorners={},t="l7-",n=this.controlContainer=wd("div","l7-control-container",this.container);function r(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=r.map((function(e){return t+e})).join(" ");e[r.join("")]=wd("div",i,n)}r(["top","left"]),r(["top","right"]),r(["bottom","left"]),r(["bottom","right"]),r(["top","center"]),r(["right","center"]),r(["left","center"]),r(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var e in this.controlCorners)this.controlCorners[e]&&kd(this.controlCorners[e]);this.controlContainer&&kd(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||VA,qA=Qx()(GA=function(){function e(){_(this,e),E(this,"container",void 0),E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"markers",[]),E(this,"markerLayers",[]),E(this,"unAddMarkers",[]),E(this,"unAddMarkerLayers",[])}return x(e,[{key:"addMarkerLayer",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(e),e.addTo(this.scene)):this.unAddMarkerLayers.push(e)}},{key:"removeMarkerLayer",value:function(e){e.destroy(),this.markerLayers.indexOf(e);var t=this.markerLayers.indexOf(e);t>-1&&this.markerLayers.splice(t,1)}},{key:"addMarker",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(e),e.addTo(this.scene)):this.unAddMarkers.push(e)}},{key:"addMarkers",value:function(){var e=this;this.unAddMarkers.forEach((function(t){t.addTo(e.scene),e.markers.push(t)})),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var e=this;this.unAddMarkerLayers.forEach((function(t){e.markerLayers.push(t),t.addTo(e.scene)})),this.unAddMarkers=[]}},{key:"removeMarker",value:function(e){e.remove(),this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.get(YE.IMapService)}},{key:"destroy",value:function(){this.markers.forEach((function(e){e.remove()})),this.markers=[],this.markerLayers.forEach((function(e){e.destroy()})),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(e){e.destroy()}}]),e}())||GA,KA=Qx()(HA=function(){function e(){_(this,e),E(this,"scene",void 0),E(this,"popup",void 0),E(this,"mapsService",void 0),E(this,"unAddPopup",void 0)}return x(e,[{key:"removePopup",value:function(e){e.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(e){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(e.addTo(this.scene),this.popup=e):this.unAddPopup=e}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.get(YE.IMapService)}}]),e}())||HA,QA=d_((function(e,t,n){r_(e,t,n)})),JA={MapToken:"您正在使用 Demo测试地图token，如果生产环境中使用去对应地图请注册Token",SDK:"请确认引入了mapbox-gl api且在L7之前引入"},$A={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},eM={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},tM=Qx()(WA=function(){function e(){_(this,e),E(this,"sceneConfigCache",{}),E(this,"layerConfigCache",{})}return x(e,[{key:"getSceneConfig",value:function(e){return this.sceneConfigCache[e]}},{key:"getSceneWarninfo",value:function(e){return JA[e]}},{key:"setSceneConfig",value:function(e,t){this.sceneConfigCache[e]=v(v({},$A),t)}},{key:"getLayerConfig",value:function(e){return this.layerConfigCache[e]}},{key:"setLayerConfig",value:function(e,t,n){this.layerConfigCache[t]=v({},QA({},this.sceneConfigCache[e],eM,n))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||WA,nM=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1},rM=Math.abs,iM=Math.pow,aM=iM(2,-52),oM=iM(2,-23),sM=iM(2,127)*(2-oM),uM=iM(2,-126),lM=Math.fround||function(e){var t,n,r=rM(e),i=nM(e);return r<uM?i*(r/uM/oM+1/aM-1/aM)*uM*oM:(n=(t=(1+oM/aM)*r)-(t-r))>sM||n!=n?i*(1/0):i*n};er({target:"Math",stat:!0},{fround:lM});var cM,hM=Math.PI/180;function fM(e){var t=e.latitude,n=void 0===t?0:t,r=e.zoom,i=void 0===r?0:r,a=e.scale,o=e.highPrecision,s=void 0!==o&&o,u=e.flipY,l=void 0!==u&&u,c={},h=512*(a=void 0!==a?a:Math.pow(2,i)),f=Math.cos(n*hM),p=h/360,d=p/f,v=h/4003e4/f;if(c.pixelsPerMeter=[v,-v,v],c.metersPerPixel=[1/v,-1/v,1/v],c.pixelsPerDegree=[p,-d,v],c.degreesPerPixel=[1/p,-1/d,1/v],s){var g=hM*Math.tan(n*hM)/f,m=p*g/2,y=h/4003e4*g,_=y/d*v;c.pixelsPerDegree2=[0,-m,y],c.pixelsPerMeter2=[_,0,_],l&&(c.pixelsPerDegree2[1]=-c.pixelsPerDegree2[1],c.pixelsPerMeter2[1]=-c.pixelsPerMeter2[1])}return l&&(c.pixelsPerMeter[1]=-c.pixelsPerMeter[1],c.metersPerPixel[1]=-c.metersPerPixel[1],c.pixelsPerDegree[1]=-c.pixelsPerDegree[1],c.degreesPerPixel[1]=-c.degreesPerPixel[1]),c}(cM=e.CoordinateSystem||(e.CoordinateSystem={}))[cM.LNGLAT=1]="LNGLAT",cM[cM.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",cM[cM.VECTOR_TILE=3]="VECTOR_TILE",cM[cM.IDENTITY=4]="IDENTITY",cM[cM.P20=5]="P20",cM[cM.P20_OFFSET=6]="P20_OFFSET",cM[cM.METER_OFFSET=7]="METER_OFFSET",cM[cM.P20_2=8]="P20_2";var pM,dM,vM,gM,mM,yM,_M,bM,xM,EM,SM,CM={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},TM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],AM=(pM=Qx(),dM=Kx(YE.ICameraService),pM((mM=j((gM=function(){function t(){_(this,t),E(this,"needRefresh",!0),z(this,"cameraService",mM,this),E(this,"coordinateSystem",void 0),E(this,"viewportCenter",void 0),E(this,"viewportCenterProjection",void 0),E(this,"pixelsPerDegree",void 0),E(this,"pixelsPerDegree2",void 0),E(this,"pixelsPerMeter",void 0)}return x(t,[{key:"refresh",value:function(){var t=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),r=this.cameraService.getCenter(),i=fM({latitude:r[1],zoom:t}),a=i.pixelsPerMeter,o=i.pixelsPerDegree;this.viewportCenter=r,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=a,this.pixelsPerDegree=o,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===e.CoordinateSystem.LNGLAT||this.coordinateSystem===e.CoordinateSystem.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===e.CoordinateSystem.LNGLAT_OFFSET?this.calculateLnglatOffset(r,t):this.coordinateSystem===e.CoordinateSystem.P20_OFFSET&&this.calculateLnglatOffset(r,t,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(e){this.coordinateSystem=e}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(e,t,n,r){var i=fM({latitude:e[1],zoom:t,scale:n,flipY:r,highPrecision:!0}),a=i.pixelsPerMeter,o=i.pixelsPerDegree,s=i.pixelsPerDegree2,u=this.cameraService.getViewMatrix(),l=this.cameraService.getProjectionMatrix(),c=UT([],l,u),h=this.cameraService.projectFlat([Math.fround(e[0]),Math.fround(e[1])],Math.pow(2,t));this.viewportCenterProjection=RA([],[h[0],h[1],0,1],c),c=UT([],l,u=this.cameraService.getViewMatrixUncentered()||u),c=UT([],c,TM),this.cameraService.setViewProjectionMatrix(c),this.pixelsPerMeter=a,this.pixelsPerDegree=o,this.pixelsPerDegree2=s}}]),t}()).prototype,"cameraService",[dM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vM=gM))||vM),MM=H((function(e){
/*! Hammer.JS - v2.0.7 - 2016-04-22
   * http://hammerjs.github.io/
   *
   * Copyright (c) 2016 Jorik Tangelder;
   * Licensed under the MIT license */
!function(t,n,r,i){var a,o="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,s="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),u=o||s,l=["","webkit","Moz","MS","ms","o"],c=u?"":n.createElement("div"),h=Math.round,f=Math.abs,p=Date.now;function d(e,t,n){return setTimeout(x(e,n),t)}function v(e,t,n){return!!Array.isArray(e)&&(g(e,n[t],n),!0)}function g(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(void 0!==e.length)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function m(e,n,r){var i="DEPRECATED METHOD: "+n+"\n"+r+" AT \n";return function(){var n=new Error("get-stack-trace"),r=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=t.console&&(t.console.warn||t.console.log);return a&&a.call(t.console,i,r),e.apply(this,arguments)}}a="function"!=typeof Object.assign?function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}:Object.assign;var y=m((function(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;)(!n||n&&void 0===e[r[i]])&&(e[r[i]]=t[r[i]]),i++;return e}),"extend","Use `assign`."),_=m((function(e,t){return y(e,t,!0)}),"merge","Use `assign`.");function b(e,t,n){var r,i=t.prototype;(r=e.prototype=Object.create(i)).constructor=e,r._super=i,n&&a(r,n)}function x(e,t){return function(){return e.apply(t,arguments)}}function E(e,t){return"function"==typeof e?e.apply(t&&t[0]||void 0,t):e}function S(e,t){return void 0===e?t:e}function C(e,t,n){g(w(t),(function(t){e.addEventListener(t,n,!1)}))}function T(e,t,n){g(w(t),(function(t){e.removeEventListener(t,n,!1)}))}function A(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function M(e,t){return e.indexOf(t)>-1}function w(e){return e.trim().split(/\s+/g)}function k(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function O(e){return Array.prototype.slice.call(e,0)}function P(e,t,n){for(var r=[],i=[],a=0;a<e.length;){var o=t?e[a][t]:e[a];k(i,o)<0&&r.push(e[a]),i[a]=o,a++}return n&&(r=t?r.sort((function(e,n){return e[t]>n[t]})):r.sort()),r}function R(e,t){for(var n,r,i=t[0].toUpperCase()+t.slice(1),a=0;a<l.length;){if((r=(n=l[a])?n+i:t)in e)return r;a++}}var L=1;function I(e){var n=e.ownerDocument||e;return n.defaultView||n.parentWindow||t}var N="ontouchstart"in t,D=void 0!==R(t,"PointerEvent"),F=N&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),B=["x","y"],U=["clientX","clientY"];function z(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){E(e.options.enable,[e])&&n.handler(t)},this.init()}function j(e,t,n){var r=n.pointers.length,i=n.changedPointers.length,a=1&t&&r-i==0,o=12&t&&r-i==0;n.isFirst=!!a,n.isFinal=!!o,a&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,r=t.pointers,i=r.length;n.firstInput||(n.firstInput=V(t));i>1&&!n.firstMultiple?n.firstMultiple=V(t):1===i&&(n.firstMultiple=!1);var a=n.firstInput,o=n.firstMultiple,s=o?o.center:a.center,u=t.center=G(r);t.timeStamp=p(),t.deltaTime=t.timeStamp-a.timeStamp,t.angle=Y(s,u),t.distance=X(s,u),function(e,t){var n=t.center,r=e.offsetDelta||{},i=e.prevDelta||{},a=e.prevInput||{};1!==t.eventType&&4!==a.eventType||(i=e.prevDelta={x:a.deltaX||0,y:a.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y});t.deltaX=i.x+(n.x-r.x),t.deltaY=i.y+(n.y-r.y)}(n,t),t.offsetDirection=W(t.deltaX,t.deltaY);var l=H(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=l.x,t.overallVelocityY=l.y,t.overallVelocity=f(l.x)>f(l.y)?l.x:l.y,t.scale=o?(c=o.pointers,h=r,X(h[0],h[1],U)/X(c[0],c[1],U)):1,t.rotation=o?function(e,t){return Y(t[1],t[0],U)+Y(e[1],e[0],U)}(o.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,r,i,a,o=e.lastInterval||t,s=t.timeStamp-o.timeStamp;if(8!=t.eventType&&(s>25||void 0===o.velocity)){var u=t.deltaX-o.deltaX,l=t.deltaY-o.deltaY,c=H(s,u,l);r=c.x,i=c.y,n=f(c.x)>f(c.y)?c.x:c.y,a=W(u,l),e.lastInterval=t}else n=o.velocity,r=o.velocityX,i=o.velocityY,a=o.direction;t.velocity=n,t.velocityX=r,t.velocityY=i,t.direction=a}(n,t);var c,h;var d=e.element;A(t.srcEvent.target,d)&&(d=t.srcEvent.target);t.target=d}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function V(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:h(e.pointers[n].clientX),clientY:h(e.pointers[n].clientY)},n++;return{timeStamp:p(),pointers:t,center:G(t),deltaX:e.deltaX,deltaY:e.deltaY}}function G(e){var t=e.length;if(1===t)return{x:h(e[0].clientX),y:h(e[0].clientY)};for(var n=0,r=0,i=0;i<t;)n+=e[i].clientX,r+=e[i].clientY,i++;return{x:h(n/t),y:h(r/t)}}function H(e,t,n){return{x:t/e||0,y:n/e||0}}function W(e,t){return e===t?1:f(e)>=f(t)?e<0?2:4:t<0?8:16}function X(e,t,n){n||(n=B);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return Math.sqrt(r*r+i*i)}function Y(e,t,n){n||(n=B);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return 180*Math.atan2(i,r)/Math.PI}z.prototype={handler:function(){},init:function(){this.evEl&&C(this.element,this.evEl,this.domHandler),this.evTarget&&C(this.target,this.evTarget,this.domHandler),this.evWin&&C(I(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(I(this.element),this.evWin,this.domHandler)}};var Z={mousedown:1,mousemove:2,mouseup:4};function q(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.pressed=!1,z.apply(this,arguments)}b(q,z,{handler:function(e){var t=Z[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var K={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},Q={2:"touch",3:"pen",4:"mouse",5:"kinect"},J="pointerdown",$="pointermove pointerup pointercancel";function ee(){this.evEl=J,this.evWin=$,z.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}u||!t.MSPointerEvent||t.PointerEvent||(J="MSPointerDown",$="MSPointerMove MSPointerUp MSPointerCancel"),b(ee,z,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),i=K[r],a=Q[e.pointerType]||e.pointerType,o="touch"==a,s=k(t,e.pointerId,"pointerId");1&i&&(0===e.button||o)?s<0&&(t.push(e),s=t.length-1):12&i&&(n=!0),s<0||(t[s]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:a,srcEvent:e}),n&&t.splice(s,1))}});var te={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function ne(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,z.apply(this,arguments)}function re(e,t){var n=O(e.touches),r=O(e.changedTouches);return 12&t&&(n=P(n.concat(r),"identifier",!0)),[n,r]}b(ne,z,{handler:function(e){var t=te[e.type];if(1===t&&(this.started=!0),this.started){var n=re.call(this,e,t);12&t&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}}});var ie={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function ae(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},z.apply(this,arguments)}function oe(e,t){var n=O(e.touches),r=this.targetIds;if(3&t&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,a,o=O(e.changedTouches),s=[],u=this.target;if(a=n.filter((function(e){return A(e.target,u)})),1===t)for(i=0;i<a.length;)r[a[i].identifier]=!0,i++;for(i=0;i<o.length;)r[o[i].identifier]&&s.push(o[i]),12&t&&delete r[o[i].identifier],i++;return s.length?[P(a.concat(s),"identifier",!0),s]:void 0}b(ae,z,{handler:function(e){var t=ie[e.type],n=oe.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}});function se(){z.apply(this,arguments);var e=x(this.handler,this);this.touch=new ae(this.manager,e),this.mouse=new q(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function ue(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,le.call(this,t)):12&e&&le.call(this,t)}function le(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)}),2500)}}function ce(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],a=Math.abs(t-i.x),o=Math.abs(n-i.y);if(a<=25&&o<=25)return!0}return!1}b(se,z,{handler:function(e,t,n){var r="touch"==n.pointerType,i="mouse"==n.pointerType;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)ue.call(this,t,n);else if(i&&ce.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var he=u?void 0:R(c.style,"touchAction"),fe=void 0!==he,pe=function(){if(!fe)return!1;var e={};if(u)return e;var n=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(r){e[r]=!n||t.CSS.supports("touch-action",r)})),e}();function de(e,t){this.manager=e,this.set(t)}de.prototype={set:function(e){"compute"==e&&(e=this.compute()),fe&&this.manager.element.style&&pe[e]&&(this.manager.element.style[he]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return g(this.manager.recognizers,(function(t){E(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(M(e,"none"))return"none";var t=M(e,"pan-x"),n=M(e,"pan-y");if(t&&n)return"none";if(t||n)return t?"pan-x":"pan-y";if(M(e,"manipulation"))return"manipulation";return"auto"}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,i=M(r,"none")&&!pe.none,a=M(r,"pan-y")&&!pe["pan-y"],o=M(r,"pan-x")&&!pe["pan-x"];if(i){var s=1===e.pointers.length,u=e.distance<2,l=e.deltaTime<250;if(s&&u&&l)return}if(!o||!a)return i||a&&6&n||o&&24&n?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};function ve(e){this.options=a({},this.defaults,e||{}),this.id=L++,this.manager=null,this.options.enable=S(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function ge(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function me(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function ye(e,t){var n=t.manager;return n?n.get(e):e}function _e(){ve.apply(this,arguments)}function be(){_e.apply(this,arguments),this.pX=null,this.pY=null}function xe(){_e.apply(this,arguments)}function Ee(){ve.apply(this,arguments),this._timer=null,this._input=null}function Se(){_e.apply(this,arguments)}function Ce(){_e.apply(this,arguments)}function Te(){ve.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Ae(e,t){return(t=t||{}).recognizers=S(t.recognizers,Ae.defaults.preset),new Me(e,t)}ve.prototype={defaults:{},set:function(e){return a(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(v(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=ye(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return v(e,"dropRecognizeWith",this)||(e=ye(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(v(e,"requireFailure",this))return this;var t=this.requireFail;return-1===k(t,e=ye(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(v(e,"dropRequireFailure",this))return this;e=ye(e,this);var t=k(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function r(n){t.manager.emit(n,e)}n<8&&r(t.options.event+ge(n)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),n>=8&&r(t.options.event+ge(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=a({},e);if(!E(this.options.enable,[this,t]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},b(_e,ve,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=6&t,i=this.attrTest(e);return r&&(8&n||!i)?16|t:r||i?4&n?8|t:2&t?4|t:2:32}}),b(be,_e,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push("pan-y"),24&e&&t.push("pan-x"),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,i=e.direction,a=e.deltaX,o=e.deltaY;return i&t.direction||(6&t.direction?(i=0===a?1:a<0?2:4,n=a!=this.pX,r=Math.abs(e.deltaX)):(i=0===o?1:o<0?8:16,n=o!=this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&i&t.direction},attrTest:function(e){return _e.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=me(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),b(xe,_e,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),b(Ee,ve,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!r||!n||12&e.eventType&&!i)this.reset();else if(1&e.eventType)this.reset(),this._timer=d((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=p(),this.manager.emit(this.options.event,this._input)))}}),b(Se,_e,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),b(Ce,_e,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return be.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return 30&n?t=e.overallVelocity:6&n?t=e.overallVelocityX:24&n&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&f(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=me(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),b(Te,ve,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=e.eventType)return this.failTimeout();var a=!this.pTime||e.timeStamp-this.pTime<t.interval,o=!this.pCenter||X(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,o&&a?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=d((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return 32},failTimeout:function(){return this._timer=d((function(){this.state=32}),this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Ae.VERSION="2.0.7",Ae.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[Se,{enable:!1}],[xe,{enable:!1},["rotate"]],[Ce,{direction:6}],[be,{direction:6},["swipe"]],[Te],[Te,{event:"doubletap",taps:2},["tap"]],[Ee]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Me(e,t){var n;this.options=a({},Ae.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((n=this).options.inputClass||(D?ee:F?ae:N?se:q))(n,j),this.touchAction=new de(this,this.options.touchAction),we(this,!0),g(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function we(e,t){var n,r=e.element;r.style&&(g(e.options.cssProps,(function(i,a){n=R(r.style,a),t?(e.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}(Me.prototype={set:function(e){return a(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var r=this.recognizers,i=t.curRecognizer;(!i||i&&8&i.state)&&(i=t.curRecognizer=null);for(var a=0;a<r.length;)n=r[a],2===t.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(e),!i&&14&n.state&&(i=t.curRecognizer=n),a++}},get:function(e){if(e instanceof ve)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(v(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(v(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=k(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(void 0!==e&&void 0!==t){var n=this.handlers;return g(w(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(void 0!==e){var n=this.handlers;return g(w(e),(function(e){t?n[e]&&n[e].splice(k(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){if(u)return;var r=n.createEvent("Event");r.initEvent(e,!0,!0),r.gesture=t,t.target.dispatchEvent(r)}(e,t);var r=this.handlers[e]&&this.handlers[e].slice();if(r&&r.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<r.length;)r[i](t),i++}},destroy:function(){this.element&&we(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u)||(a(Ae,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Me,Input:z,TouchAction:de,TouchInput:ae,MouseInput:q,PointerEventInput:ee,TouchMouseInput:se,SingleTouchInput:ne,Recognizer:ve,AttrRecognizer:_e,Tap:Te,Pan:be,Swipe:Ce,Pinch:xe,Rotate:Se,Press:Ee,on:C,off:T,each:g,merge:_,extend:y,assign:a,inherit:b,bindFn:x,prefixed:R}),("undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Hammer=Ae,e.exports?e.exports=Ae:t.Hammer=Ae)}("undefined"!=typeof window?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document)}));(yM=e.InteractionEvent||(e.InteractionEvent={})).Hover="hover",yM.Click="click",yM.Select="select",yM.Active="active",yM.Drag="drag";var wM,kM,OM,PM,RM,LM,IM,NM,DM,FM,BM,UM,zM={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},jM=(_M=Qx(),bM=Kx(YE.IMapService),_M((SM=j((EM=function(t){S(r,t);var n=R(r);function r(){var t;_(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return E(O(t=n.call.apply(n,[this].concat(a))),"indragging",!1),z(O(t),"mapService",SM,O(t)),E(O(t),"hammertime",void 0),E(O(t),"lastClickTime",0),E(O(t),"lastClickXY",[-1,-1]),E(O(t),"clickTimer",void 0),E(O(t),"$containter",void 0),E(O(t),"onDrag",(function(n){var r=t.interactionEvent(n);r.type=zM[r.type],"dragging"===r.type?t.indragging=!0:t.indragging=!1,t.emit(e.InteractionEvent.Drag,r)})),E(O(t),"onHammer",(function(n){n.srcEvent.stopPropagation();var r=t.interactionEvent(n);t.emit(e.InteractionEvent.Hover,r)})),E(O(t),"onTouch",(function(e){var n=e.touches[0];t.onHover({x:n.pageX,y:n.pageY,type:"touch"})})),E(O(t),"onHover",(function(n){var r=n.clientX,i=n.clientY,a=n.type,o=t.mapService.getMapContainer();if(o)if(bd)r=r-o.left-0,i=i-o.top-0;else{var s=o.getBoundingClientRect(),u=s.top;r=r-s.left-o.clientLeft,i=i-u-o.clientTop}var l=t.mapService.containerToLngLat([r,i]);if("click"!==a)"touch"!==a?"click"!==a&&"dblclick"!==a&&t.emit(e.InteractionEvent.Hover,{x:r,y:i,lngLat:l,type:a,target:n}):t.isDoubleTap(r,i,l);else{if(!bd&&"ontouchstart"in document.documentElement==!0)return;t.isDoubleTap(r,i,l)}})),t}return x(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(e.InteractionEvent.Hover)}},{key:"triggerHover",value:function(t){var n=t.x,r=t.y;this.emit(e.InteractionEvent.Hover,{x:n,y:r})}},{key:"triggerSelect",value:function(t){this.emit(e.InteractionEvent.Select,{featureId:t})}},{key:"triggerActive",value:function(t){this.emit(e.InteractionEvent.Active,{featureId:t})}},{key:"handleMiniEvent",value:function(e){this.onHover({clientX:e.touches[0].pageX,clientY:e.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var e=this.mapService.getMapContainer();if(e)if(bd)Ed.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var t=new MM.Manager(e);t.add(new MM.Tap({event:"dblclick",taps:2})),t.add(new MM.Tap({event:"click"})),t.add(new MM.Pan({threshold:0,pointers:0})),t.add(new MM.Press({})),t.on("dblclick click",this.onHammer),t.on("panstart panmove panend pancancel",this.onDrag),e.addEventListener("mousemove",this.onHover),e.addEventListener("mousedown",this.onHover,!0),e.addEventListener("mouseup",this.onHover),e.addEventListener("contextmenu",this.onHover),this.hammertime=t}}},{key:"removeEventListenerOnMap",value:function(){if(bd)Ed.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var e=this.mapService.getMapContainer();e&&(e.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),e.removeEventListener("mousedown",this.onHover),e.removeEventListener("mouseup",this.onHover),e.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(e){var t,n,r=e.type;"touch"===e.pointerType?(n=Math.floor(e.pointers[0].clientY),t=Math.floor(e.pointers[0].clientX)):(n=Math.floor(e.srcEvent.y),t=Math.floor(e.srcEvent.x));var i=this.mapService.getMapContainer();if(i){var a=i.getBoundingClientRect(),o=a.top;t-=a.left,n-=o}return{x:t,y:n,lngLat:this.mapService.containerToLngLat([t,n]),type:r,target:e.srcEvent}}},{key:"isDoubleTap",value:function(t,n,r){var i=this,a=(new Date).getTime(),o="click";a-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-n)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),o="dblclick",this.emit(e.InteractionEvent.Hover,{x:t,y:n,lngLat:r,type:o})):(this.lastClickTime=a,this.lastClickXY=[t,n],this.clickTimer=setTimeout((function(){o="click",i.emit(e.InteractionEvent.Hover,{x:t,y:n,lngLat:r,type:o})}),400))}}]),r}(zb)).prototype,"mapService",[bM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xM=EM))||xM),VM=(H((function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var i=t&&t.prototype instanceof h?t:h,a=Object.create(i.prototype),o=new S(r||[]);return a._invoke=function(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return T()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=b(o,n);if(s){if(s===c)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===c)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,o),a}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var c={};function h(){}function f(){}function p(){}var d={};s(d,i,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(C([])));g&&g!==t&&n.call(g,i)&&(d=g);var m=p.prototype=h.prototype=Object.create(d);function y(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){var r;this._invoke=function(i,a){function o(){return new t((function(r,o){!function r(i,a,o,s){var u=l(e[i],e,a);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==typeof h&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return r("throw",e,o,s)}))}s(u.arg)}(i,a,r,o)}))}return r=r?r.then(o,o):o()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,c;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function C(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=p,s(m,"constructor",p),s(p,"constructor",f),f.displayName=s(p,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,s(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},y(_.prototype),s(_.prototype,a,(function(){return this})),e.AsyncIterator=_,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new _(u(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},y(m),s(m,o,"Generator"),s(m,i,(function(){return this})),s(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=C,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,c):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;E(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),c}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})),0);function GM(e){if(bd)return null;var t=e;if("string"==typeof e&&(t=document.getElementById(e)),t){var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      z-index:2;\n      height: 100%;\n      width: 100%;\n      pointer-events: none;\n    ",n.id="l7-scene-".concat(VM++),n.classList.add("l7-scene"),t.appendChild(n),n}return null}(wM=e.gl||(e.gl={}))[wM.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",wM[wM.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",wM[wM.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",wM[wM.POINTS=0]="POINTS",wM[wM.LINES=1]="LINES",wM[wM.LINE_LOOP=2]="LINE_LOOP",wM[wM.LINE_STRIP=3]="LINE_STRIP",wM[wM.TRIANGLES=4]="TRIANGLES",wM[wM.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",wM[wM.TRIANGLE_FAN=6]="TRIANGLE_FAN",wM[wM.ZERO=0]="ZERO",wM[wM.ONE=1]="ONE",wM[wM.SRC_COLOR=768]="SRC_COLOR",wM[wM.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",wM[wM.SRC_ALPHA=770]="SRC_ALPHA",wM[wM.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",wM[wM.DST_ALPHA=772]="DST_ALPHA",wM[wM.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",wM[wM.DST_COLOR=774]="DST_COLOR",wM[wM.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",wM[wM.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",wM[wM.FUNC_ADD=32774]="FUNC_ADD",wM[wM.BLEND_EQUATION=32777]="BLEND_EQUATION",wM[wM.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",wM[wM.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",wM[wM.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",wM[wM.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",wM[wM.MAX_EXT=32776]="MAX_EXT",wM[wM.MIN_EXT=32775]="MIN_EXT",wM[wM.BLEND_DST_RGB=32968]="BLEND_DST_RGB",wM[wM.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",wM[wM.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",wM[wM.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",wM[wM.CONSTANT_COLOR=32769]="CONSTANT_COLOR",wM[wM.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",wM[wM.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",wM[wM.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",wM[wM.BLEND_COLOR=32773]="BLEND_COLOR",wM[wM.ARRAY_BUFFER=34962]="ARRAY_BUFFER",wM[wM.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",wM[wM.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",wM[wM.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",wM[wM.STREAM_DRAW=35040]="STREAM_DRAW",wM[wM.STATIC_DRAW=35044]="STATIC_DRAW",wM[wM.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",wM[wM.BUFFER_SIZE=34660]="BUFFER_SIZE",wM[wM.BUFFER_USAGE=34661]="BUFFER_USAGE",wM[wM.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",wM[wM.FRONT=1028]="FRONT",wM[wM.BACK=1029]="BACK",wM[wM.FRONT_AND_BACK=1032]="FRONT_AND_BACK",wM[wM.CULL_FACE=2884]="CULL_FACE",wM[wM.BLEND=3042]="BLEND",wM[wM.DITHER=3024]="DITHER",wM[wM.STENCIL_TEST=2960]="STENCIL_TEST",wM[wM.DEPTH_TEST=2929]="DEPTH_TEST",wM[wM.SCISSOR_TEST=3089]="SCISSOR_TEST",wM[wM.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",wM[wM.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",wM[wM.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",wM[wM.NO_ERROR=0]="NO_ERROR",wM[wM.INVALID_ENUM=1280]="INVALID_ENUM",wM[wM.INVALID_VALUE=1281]="INVALID_VALUE",wM[wM.INVALID_OPERATION=1282]="INVALID_OPERATION",wM[wM.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",wM[wM.CW=2304]="CW",wM[wM.CCW=2305]="CCW",wM[wM.LINE_WIDTH=2849]="LINE_WIDTH",wM[wM.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",wM[wM.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",wM[wM.CULL_FACE_MODE=2885]="CULL_FACE_MODE",wM[wM.FRONT_FACE=2886]="FRONT_FACE",wM[wM.DEPTH_RANGE=2928]="DEPTH_RANGE",wM[wM.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",wM[wM.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",wM[wM.DEPTH_FUNC=2932]="DEPTH_FUNC",wM[wM.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",wM[wM.STENCIL_FUNC=2962]="STENCIL_FUNC",wM[wM.STENCIL_FAIL=2964]="STENCIL_FAIL",wM[wM.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",wM[wM.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",wM[wM.STENCIL_REF=2967]="STENCIL_REF",wM[wM.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",wM[wM.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",wM[wM.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",wM[wM.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",wM[wM.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",wM[wM.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",wM[wM.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",wM[wM.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",wM[wM.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",wM[wM.VIEWPORT=2978]="VIEWPORT",wM[wM.SCISSOR_BOX=3088]="SCISSOR_BOX",wM[wM.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",wM[wM.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",wM[wM.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",wM[wM.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",wM[wM.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",wM[wM.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",wM[wM.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",wM[wM.RED_BITS=3410]="RED_BITS",wM[wM.GREEN_BITS=3411]="GREEN_BITS",wM[wM.BLUE_BITS=3412]="BLUE_BITS",wM[wM.ALPHA_BITS=3413]="ALPHA_BITS",wM[wM.DEPTH_BITS=3414]="DEPTH_BITS",wM[wM.STENCIL_BITS=3415]="STENCIL_BITS",wM[wM.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",wM[wM.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",wM[wM.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",wM[wM.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",wM[wM.SAMPLES=32937]="SAMPLES",wM[wM.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",wM[wM.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",wM[wM.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",wM[wM.DONT_CARE=4352]="DONT_CARE",wM[wM.FASTEST=4353]="FASTEST",wM[wM.NICEST=4354]="NICEST",wM[wM.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",wM[wM.BYTE=5120]="BYTE",wM[wM.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",wM[wM.SHORT=5122]="SHORT",wM[wM.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",wM[wM.INT=5124]="INT",wM[wM.UNSIGNED_INT=5125]="UNSIGNED_INT",wM[wM.FLOAT=5126]="FLOAT",wM[wM.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",wM[wM.ALPHA=6406]="ALPHA",wM[wM.RGB=6407]="RGB",wM[wM.RGBA=6408]="RGBA",wM[wM.LUMINANCE=6409]="LUMINANCE",wM[wM.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",wM[wM.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",wM[wM.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",wM[wM.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",wM[wM.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",wM[wM.VERTEX_SHADER=35633]="VERTEX_SHADER",wM[wM.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",wM[wM.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",wM[wM.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",wM[wM.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",wM[wM.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",wM[wM.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",wM[wM.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",wM[wM.SHADER_TYPE=35663]="SHADER_TYPE",wM[wM.DELETE_STATUS=35712]="DELETE_STATUS",wM[wM.LINK_STATUS=35714]="LINK_STATUS",wM[wM.VALIDATE_STATUS=35715]="VALIDATE_STATUS",wM[wM.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",wM[wM.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",wM[wM.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",wM[wM.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",wM[wM.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",wM[wM.NEVER=512]="NEVER",wM[wM.LESS=513]="LESS",wM[wM.EQUAL=514]="EQUAL",wM[wM.LEQUAL=515]="LEQUAL",wM[wM.GREATER=516]="GREATER",wM[wM.NOTEQUAL=517]="NOTEQUAL",wM[wM.GEQUAL=518]="GEQUAL",wM[wM.ALWAYS=519]="ALWAYS",wM[wM.KEEP=7680]="KEEP",wM[wM.REPLACE=7681]="REPLACE",wM[wM.INCR=7682]="INCR",wM[wM.DECR=7683]="DECR",wM[wM.INVERT=5386]="INVERT",wM[wM.INCR_WRAP=34055]="INCR_WRAP",wM[wM.DECR_WRAP=34056]="DECR_WRAP",wM[wM.VENDOR=7936]="VENDOR",wM[wM.RENDERER=7937]="RENDERER",wM[wM.VERSION=7938]="VERSION",wM[wM.NEAREST=9728]="NEAREST",wM[wM.LINEAR=9729]="LINEAR",wM[wM.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",wM[wM.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",wM[wM.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",wM[wM.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",wM[wM.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",wM[wM.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",wM[wM.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",wM[wM.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",wM[wM.TEXTURE_2D=3553]="TEXTURE_2D",wM[wM.TEXTURE=5890]="TEXTURE",wM[wM.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",wM[wM.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",wM[wM.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",wM[wM.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",wM[wM.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",wM[wM.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",wM[wM.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",wM[wM.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",wM[wM.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",wM[wM.TEXTURE0=33984]="TEXTURE0",wM[wM.TEXTURE1=33985]="TEXTURE1",wM[wM.TEXTURE2=33986]="TEXTURE2",wM[wM.TEXTURE3=33987]="TEXTURE3",wM[wM.TEXTURE4=33988]="TEXTURE4",wM[wM.TEXTURE5=33989]="TEXTURE5",wM[wM.TEXTURE6=33990]="TEXTURE6",wM[wM.TEXTURE7=33991]="TEXTURE7",wM[wM.TEXTURE8=33992]="TEXTURE8",wM[wM.TEXTURE9=33993]="TEXTURE9",wM[wM.TEXTURE10=33994]="TEXTURE10",wM[wM.TEXTURE11=33995]="TEXTURE11",wM[wM.TEXTURE12=33996]="TEXTURE12",wM[wM.TEXTURE13=33997]="TEXTURE13",wM[wM.TEXTURE14=33998]="TEXTURE14",wM[wM.TEXTURE15=33999]="TEXTURE15",wM[wM.TEXTURE16=34e3]="TEXTURE16",wM[wM.TEXTURE17=34001]="TEXTURE17",wM[wM.TEXTURE18=34002]="TEXTURE18",wM[wM.TEXTURE19=34003]="TEXTURE19",wM[wM.TEXTURE20=34004]="TEXTURE20",wM[wM.TEXTURE21=34005]="TEXTURE21",wM[wM.TEXTURE22=34006]="TEXTURE22",wM[wM.TEXTURE23=34007]="TEXTURE23",wM[wM.TEXTURE24=34008]="TEXTURE24",wM[wM.TEXTURE25=34009]="TEXTURE25",wM[wM.TEXTURE26=34010]="TEXTURE26",wM[wM.TEXTURE27=34011]="TEXTURE27",wM[wM.TEXTURE28=34012]="TEXTURE28",wM[wM.TEXTURE29=34013]="TEXTURE29",wM[wM.TEXTURE30=34014]="TEXTURE30",wM[wM.TEXTURE31=34015]="TEXTURE31",wM[wM.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",wM[wM.REPEAT=10497]="REPEAT",wM[wM.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",wM[wM.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",wM[wM.FLOAT_VEC2=35664]="FLOAT_VEC2",wM[wM.FLOAT_VEC3=35665]="FLOAT_VEC3",wM[wM.FLOAT_VEC4=35666]="FLOAT_VEC4",wM[wM.INT_VEC2=35667]="INT_VEC2",wM[wM.INT_VEC3=35668]="INT_VEC3",wM[wM.INT_VEC4=35669]="INT_VEC4",wM[wM.BOOL=35670]="BOOL",wM[wM.BOOL_VEC2=35671]="BOOL_VEC2",wM[wM.BOOL_VEC3=35672]="BOOL_VEC3",wM[wM.BOOL_VEC4=35673]="BOOL_VEC4",wM[wM.FLOAT_MAT2=35674]="FLOAT_MAT2",wM[wM.FLOAT_MAT3=35675]="FLOAT_MAT3",wM[wM.FLOAT_MAT4=35676]="FLOAT_MAT4",wM[wM.SAMPLER_2D=35678]="SAMPLER_2D",wM[wM.SAMPLER_CUBE=35680]="SAMPLER_CUBE",wM[wM.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",wM[wM.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",wM[wM.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",wM[wM.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",wM[wM.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",wM[wM.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",wM[wM.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",wM[wM.COMPILE_STATUS=35713]="COMPILE_STATUS",wM[wM.LOW_FLOAT=36336]="LOW_FLOAT",wM[wM.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",wM[wM.HIGH_FLOAT=36338]="HIGH_FLOAT",wM[wM.LOW_INT=36339]="LOW_INT",wM[wM.MEDIUM_INT=36340]="MEDIUM_INT",wM[wM.HIGH_INT=36341]="HIGH_INT",wM[wM.FRAMEBUFFER=36160]="FRAMEBUFFER",wM[wM.RENDERBUFFER=36161]="RENDERBUFFER",wM[wM.RGBA4=32854]="RGBA4",wM[wM.RGB5_A1=32855]="RGB5_A1",wM[wM.RGB565=36194]="RGB565",wM[wM.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",wM[wM.STENCIL_INDEX=6401]="STENCIL_INDEX",wM[wM.STENCIL_INDEX8=36168]="STENCIL_INDEX8",wM[wM.DEPTH_STENCIL=34041]="DEPTH_STENCIL",wM[wM.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",wM[wM.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",wM[wM.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",wM[wM.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",wM[wM.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",wM[wM.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",wM[wM.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",wM[wM.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",wM[wM.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",wM[wM.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",wM[wM.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",wM[wM.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",wM[wM.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",wM[wM.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",wM[wM.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",wM[wM.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",wM[wM.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",wM[wM.NONE=0]="NONE",wM[wM.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",wM[wM.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",wM[wM.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",wM[wM.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",wM[wM.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",wM[wM.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",wM[wM.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",wM[wM.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",wM[wM.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",wM[wM.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",wM[wM.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",wM[wM.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",wM[wM.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",wM[wM.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL";var HM,WM,XM,YM,ZM,qM,KM,QM,JM,$M=(kM=Qx(),OM=Kx(YE.IRendererService),PM=Kx(YE.IGlobalConfigService),RM=Kx(YE.IInteractionService),LM=Kx(YE.ILayerService),kM((DM=j((NM=function(){function t(){var e=this;_(this,t),z(this,"rendererService",DM,this),z(this,"configService",FM,this),z(this,"interactionService",BM,this),z(this,"layerService",UM,this),E(this,"pickingFBO",void 0),E(this,"width",0),E(this,"height",0),E(this,"alreadyInPicking",!1),E(this,"pickBufferScale",1),E(this,"lastPickTime",(new Date).getTime()),E(this,"pickFromPickingFBO",(function(t,n){var r,i=n.x,a=n.y,o=n.lngLat,s=n.type,u=n.target,l=!1,c=e.rendererService,h=(c.getViewportSize,c.readPixels),f=c.getContainer,p=e.getContainerSize(f()),d=p.width,g=p.height;d*=zd,g*=zd;var m,y=t.getLayerConfig(),_=y.enableHighlight,b=y.enableSelect,x=i*zd,E=a*zd;if(x>d-1*zd||x<0||E>g-1*zd||E<0)return!1;if(0!==(m=h({x:Math.floor(x/e.pickBufferScale),y:Math.floor((g-(a+1)*zd)/e.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}))[0]||0!==m[1]||0!==m[2]){var S=gg(m),C=t.getSource().getFeatureById(S);S!==t.getCurrentPickId()&&"mousemove"===s&&(s="mouseenter");var T={x:i,y:a,type:s,lngLat:o,featureId:S,feature:C,target:u};C&&(l=!0,t.setCurrentPickId(S),e.triggerHoverOnLayer(t,T))}else{var A={x:i,y:a,lngLat:o,type:null!==t.getCurrentPickId()&&"mousemove"===s?"mouseout":"un"+s,featureId:null,target:u,feature:null};e.triggerHoverOnLayer(t,v(v({},A),{},{type:"unpick"})),e.triggerHoverOnLayer(t,A),t.setCurrentPickId(null)}if(_&&e.highlightPickedFeature(t,m),b&&"click"===s&&(null===(r=m)||void 0===r?void 0:r.toString())!==[0,0,0,0].toString()){var M=gg(m);null===t.getCurrentSelectedId()||M!==t.getCurrentSelectedId()?(e.selectFeature(t,m),t.setCurrentSelectedId(M)):(e.selectFeature(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))}return l}))}var n,r,i;return x(t,[{key:"init",value:function(t){var n=this.rendererService,r=n.createTexture2D,i=n.createFramebuffer,a=(n.getViewportSize,n.getContainer),o=this.getContainerSize(a()),s=o.width,u=o.height;s*=zd,u*=zd,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=i({color:r({width:Math.round(s/this.pickBufferScale),height:Math.round(u/this.pickBufferScale),wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.interactionService.on(e.InteractionEvent.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:(i=y(regeneratorRuntime.mark((function e(t,n,r){var i,a,o,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=this.rendererService,a=i.useFramebuffer,o=i.clear,i.getContainer,this.resizePickingFBO(),a(this.pickingFBO,(function(){o({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.hooks.beforePickingEncode.call(),t.renderModels(),t.hooks.afterPickingEncode.call();var e=s.pickBox(t,n);r(e)}));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"pickBox",value:function(e,t){var n,r=this,i=N(t.map((function(e){var t=e<0?0:e;return Math.floor(t*zd/r.pickBufferScale)})),4),a=i[0],o=i[1],s=i[2],u=i[3],l=this.rendererService,c=(l.getViewportSize,l.readPixels),h=l.getContainer,f=this.getContainerSize(h()),p=f.width,d=f.height;if(d*=zd,a>((p*=zd)-1)*zd/this.pickBufferScale||s<0||o>(d-1)*zd/this.pickBufferScale||u<0)return[];var g=Math.min(p/this.pickBufferScale,s)-a,m=Math.min(d/this.pickBufferScale,u)-o;n=c({x:a,y:Math.floor(d/this.pickBufferScale-(u+1)),width:g,height:m,data:new Uint8Array(g*m*4),framebuffer:this.pickingFBO});for(var y=[],_={},b=0;b<n.length/4;b+=1){var x=gg(n.slice(4*b,4*b+4));if(-1!==x&&!_[x]){var E=e.getSource().getFeatureById(x);y.push(v(v({},E),{},{pickedFeatureIdx:x})),_[x]=!0}}return y}},{key:"getContainerSize",value:function(e){return e.getContext?{width:e.width/zd,height:e.height/zd}:e.getBoundingClientRect()}},{key:"pickingAllLayer",value:(r=y(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging)&&this.layerService.getShaderPickStat()){e.next=2;break}return e.abrupt("return");case 2:if(this.alreadyInPicking=!0,!((n=(new Date).getTime())-this.lastPickTime>10||"contextmenu"===t.type||"click"===t.type)){e.next=7;break}return e.next=7,this.pickingLayers(t);case 7:this.lastPickTime=n,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"resizePickingFBO",value:function(){var e=this.rendererService.getContainer,t=this.getContainerSize(e()),n=t.width,r=t.height;n*=zd,r*=zd,this.width===n&&this.height===r||(this.pickingFBO.resize({width:Math.round(n/this.pickBufferScale),height:Math.round(r/this.pickBufferScale)}),this.width=n,this.height=r)}},{key:"pickingLayers",value:(n=y(regeneratorRuntime.mark((function e(t){var n,r,i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=this.rendererService).getViewportSize,r=n.useFramebuffer,i=n.clear,n.getContainer,this.resizePickingFBO(),r(this.pickingFBO,(function(){a.layerService.getRenderList().filter((function(e){return e.needPick(t.type)})).reverse().some((function(e){return i({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),e.hooks.beforePickingEncode.call(),e.renderModels(!0),e.hooks.afterPickingEncode.call(),a.pickFromPickingFBO(e,t)&&!e.getLayerConfig().enablePropagation}))}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"triggerHoverOnLayer",value:function(e,t){var n,r,i,a;a=!0,null==(n=t)||null===(r=n.target)||void 0===r||null===(i=r.path)||void 0===i||i.map((function(e){var t;null!=e&&e.classList&&(null==e||null===(t=e.classList)||void 0===t||t.forEach((function(e){"l7-marker"!==e&&"l7-popup"!==e||(a=!1)})))})),a&&e.emit(t.type,t)}},{key:"highlightPickedFeature",value:function(e,t){var n=N(t,3),r=n[0],i=n[1],a=n[2];e.hooks.beforeHighlight.call([r,i,a])}},{key:"selectFeature",value:function(e,t){var n=N(t,3),r=n[0],i=n[1],a=n[2];e.hooks.beforeSelect.call([r,i,a])}}]),t}()).prototype,"rendererService",[OM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FM=j(NM.prototype,"configService",[PM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BM=j(NM.prototype,"interactionService",[RM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UM=j(NM.prototype,"layerService",[LM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IM=NM))||IM),ew=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];_(this,e),E(this,"autoStart",void 0),E(this,"startTime",0),E(this,"oldTime",0),E(this,"running",!1),E(this,"elapsedTime",0),this.autoStart=t}return x(e,[{key:"start",value:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}(),tw=(HM=Qx(),WM=Kx(YE.IRendererService),XM=Kx(YE.IMapService),YM=Kx(YE.IGlobalConfigService),HM((KM=j((qM=function(){function e(){_(this,e),E(this,"clock",new ew),E(this,"alreadyInRendering",!1),E(this,"layers",[]),E(this,"layerList",[]),E(this,"layerRenderID",void 0),E(this,"sceneInited",!1),E(this,"animateInstanceCount",0),E(this,"shaderPicking",!0),E(this,"enableRender",!0),z(this,"renderService",KM,this),z(this,"mapService",QM,this),z(this,"configService",JM,this)}var t;return x(e,[{key:"add",value:function(e){this.sceneInited&&e.init(),this.layers.push(e),this.updateLayerRenderList()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach((function(e){e.inited||e.init()})),this.updateLayerRenderList()}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(e){return this.layers.find((function(t){return t.id===e}))}},{key:"getLayerByName",value:function(e){return this.layers.find((function(t){return t.name===e}))}},{key:"cleanRemove",value:function(e,t){if(t){var n=t.layerChildren.indexOf(e);n>-1&&t.layerChildren.splice(n,1)}else{var r=this.layers.indexOf(e);r>-1&&this.layers.splice(r,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(e,t){if(t){var n=t.layerChildren.indexOf(e);n>-1&&t.layerChildren.splice(n,1)}else{var r=this.layers.indexOf(e);r>-1&&this.layers.splice(r,1)}this.updateLayerRenderList(),e.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(e){this.enableRender=e}},{key:"renderLayers",value:(t=y(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.alreadyInRendering&&this.enableRender){e.next=2;break}return e.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),t=U(this.layerList),e.prev=5,t.s();case 7:if((n=t.n()).done){e.next=20;break}if((r=n.value).hooks.beforeRenderData.call(),r.hooks.beforeRender.call(),!r.getLayerConfig().enableMultiPassRenderer){e.next=16;break}return e.next=14,r.renderMultiPass();case 14:e.next=17;break;case 16:r.render();case 17:r.hooks.afterRender.call();case 18:e.next=7;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(5),t.e(e.t0);case 25:return e.prev=25,t.f(),e.finish(25);case 28:this.alreadyInRendering=!1;case 29:case"end":return e.stop()}}),e,this,[[5,22,25,28]])}))),function(){return t.apply(this,arguments)})},{key:"updateLayerRenderList",value:function(){var e=this;this.layerList=[],this.layers.filter((function(e){return e.inited})).filter((function(e){return e.isVisible()})).forEach((function(t){e.layerList.push(t),t.layerChildren.filter((function(e){return e.inited})).filter((function(e){return e.isVisible()})).forEach((function(t){e.layerList.push(t)}))})),this.layerList.sort((function(e,t){return e.zIndex-t.zIndex}))}},{key:"destroy",value:function(){this.layers.forEach((function(e){e.layerChildren&&(e.layerChildren.forEach((function(e){return e.destroy()})),e.layerChildren=[]),e.destroy()})),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){0==this.animateInstanceCount++&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){0==--this.animateInstanceCount&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=Ed.requestAnimationFrame(this.runRender.bind(this))}},{key:"clear",value:function(){var e=vg(this.mapService.bgColor);this.renderService.clear({color:e,depth:1,stencil:0,framebuffer:null})}},{key:"stopRender",value:function(){Ed.cancelAnimationFrame(this.layerRenderID)}}]),e}()).prototype,"renderService",[WM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QM=j(qM.prototype,"mapService",[XM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JM=j(qM.prototype,"configService",[YM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZM=qM))||ZM);var nw,rw,iw,aw,ow,sw,uw=function(e){return null==e},lw=function(){function e(t){var n=this;_(this,e),E(this,"name",void 0),E(this,"type",void 0),E(this,"scale",void 0),E(this,"descriptor",void 0),E(this,"featureBufferLayout",[]),E(this,"needRescale",!1),E(this,"needRemapping",!1),E(this,"needRegenerateVertices",!1),E(this,"featureRange",{startIndex:0,endIndex:1/0}),E(this,"vertexAttribute",void 0),E(this,"defaultCallback",(function(e){var t;return 0===e.length?(null===(t=n.scale)||void 0===t?void 0:t.defaultValues)||[]:e.map((function(e,t){var r;return(null===(r=n.scale)||void 0===r?void 0:r.scalers[t].func)(e)}))})),this.setProps(t)}return x(e,[{key:"setProps",value:function(e){Object.assign(this,e)}},{key:"mapping",value:function(e){var t;if(null!==(t=this.scale)&&void 0!==t&&t.callback){var n,r=null===(n=this.scale)||void 0===n?void 0:n.callback.apply(n,D(e));if(!uw(r))return[r]}return this.defaultCallback(e)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),cw=["buffer","update","name"],hw=(E(nw={},e.gl.FLOAT,4),E(nw,e.gl.UNSIGNED_BYTE,1),E(nw,e.gl.UNSIGNED_SHORT,2),nw),fw=(rw=Qx(),iw=Kx(YE.IRendererService),rw((sw=j((ow=function(){function t(){_(this,t),E(this,"attributesAndIndices",void 0),z(this,"rendererService",sw,this),E(this,"attributes",[]),E(this,"triangulation",void 0),E(this,"featureLayout",{sizePerElement:0,elements:[]})}return x(t,[{key:"registerStyleAttribute",value:function(e){var t=this.getLayerStyleAttribute(e.name||"");return t?t.setProps(e):(t=new lw(e),this.attributes.push(t)),t}},{key:"updateStyleAttribute",value:function(e,t,n){var r=this.getLayerStyleAttribute(e);r||(r=this.registerStyleAttribute(v(v({},t),{},{name:e})));var i=t.scale;i&&r&&(r.scale=i,r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0,n&&n.featureRange&&(r.featureRange=n.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(e){return this.attributes.find((function(t){return t.name===e}))}},{key:"getLayerAttributeScale",value:function(e){var t,n=this.getLayerStyleAttribute(e),r=null==n||null===(t=n.scale)||void 0===t?void 0:t.scalers;return r&&r[0]?r[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0,a=this.attributes.find((function(e){return e.name===t}));if(a&&a.descriptor){var o=a.descriptor,s=o.update,u=o.buffer,l=o.size,c=void 0===l?0:l,h=hw[u.type||e.gl.FLOAT];if(s){var f=this.featureLayout,p=f.elements,d=f.sizePerElement,v=p.slice(r,i);if(!v.length)return;var g=v[0].offset,m=g*c*h,y=v.map((function(e,t){for(var r=e.featureIdx,i=e.vertices,a=e.normals,o=i.length/d,u=[],l=0;l<o;l++){var c=a?a.slice(3*l,3*l+3):[];u.push.apply(u,D(s(n[r],r,i.slice(l*d,l*d+d),t,c)))}return u})).reduce((function(e,t){return e.push.apply(e,D(t)),e}),[]);a.vertexAttribute.updateBuffer({data:y,offset:m})}}}},{key:"createAttributesAndIndices",value:function(t,n,r){var i=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var a=this.attributes.map((function(e){return e.resetDescriptor(),e.descriptor})),o=0,s=[],u=3;t.forEach((function(e,t){var n=i.triangulation(e,r),l=n.indices,c=n.vertices,h=n.normals,f=n.size;l.forEach((function(e){s.push(e+o)})),u=f;var p=c.length/f;i.featureLayout.sizePerElement=u,i.featureLayout.elements.push({featureIdx:t,vertices:c,normals:h,offset:o}),o+=p;for(var d=function(n){var r=(null==h?void 0:h.slice(3*n,3*n+3))||[],i=c.slice(n*f,n*f+f);a.forEach((function(a,o){var s;a&&a.update&&(s=a.buffer.data).push.apply(s,D(a.update(e,t,i,n,r)))}))},v=0;v<p;v++)d(v)}));var l=this.rendererService,c=l.createAttribute,h=l.createBuffer,f=l.createElements,p={};a.forEach((function(e,t){if(e){var n=e.buffer,r=(e.update,e.name,k(e,cw)),a=c(v({buffer:h(n)},r));p[e.name||""]=a,i.attributes[t].vertexAttribute=a}}));var d=f({data:s,type:e.gl.UNSIGNED_INT,count:s.length});return this.attributesAndIndices={attributes:p,elements:d},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var e;this.attributes.forEach((function(e){e.vertexAttribute&&e.vertexAttribute.destroy()})),null===(e=this.attributesAndIndices)||void 0===e||e.elements.destroy(),this.attributes=[]}}]),t}()).prototype,"rendererService",[iw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aw=ow))||aw);function pw(e){var t=e.target||e.srcElement;t.__resizeRAF__&&cancelAnimationFrame(t.__resizeRAF__),t.__resizeRAF__=requestAnimationFrame((function(){var n=t.__resizeTrigger__,r=n&&n.__resizeListeners__;r&&r.forEach((function(t){t.call(n,e)}))}))}var dw,vw,gw,mw,yw,_w,bw,xw,Ew,Sw,Cw,Tw,Aw,Mw,ww,kw,Ow,Pw,Rw,Lw,Iw,Nw,Dw,Fw,Bw,Uw,zw,jw,Vw,Gw,Hw,Ww,Xw,Yw=function(e,t){var n,r=this.document,i=r.attachEvent;if("undefined"!=typeof navigator&&(n=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/)),!e.__resizeListeners__)if(e.__resizeListeners__=[],i)e.__resizeTrigger__=e,e.attachEvent("onresize",pw);else{"static"===getComputedStyle(e).position&&(e.style.position="relative");var a=e.__resizeTrigger__=r.createElement("object");a.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),a.setAttribute("class","resize-sensor"),a.setAttribute("tabindex","-1"),a.setAttribute("title",""),a.__resizeElement__=e,a.onload=function(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",pw)},a.type="text/html",n&&e.appendChild(a),a.data="about:blank",n||e.appendChild(a)}e.__resizeListeners__.push(t)},Zw="undefined"==typeof window?Yw:Yw.bind(window),qw=function(e,t){var n=document.attachEvent,r=e.__resizeListeners__||[];if(t){var i=r.indexOf(t);-1!==i&&r.splice(i,1)}else r=e.__resizeListeners__=[];if(!r.length){if(n)e.detachEvent("onresize",pw);else if(e.__resizeTrigger__){var a=e.__resizeTrigger__.contentDocument,o=a&&a.defaultView;o&&(o.removeEventListener("resize",pw),delete o.__resizeTrigger__),e.__resizeTrigger__=!e.removeChild(e.__resizeTrigger__)}delete e.__resizeListeners__}};Zw.unbind=qw;var Kw=(dw=Qx(),vw=Kx(YE.SceneID),gw=Kx(YE.IIconService),mw=Kx(YE.IFontService),yw=Kx(YE.IControlService),_w=Kx(YE.IGlobalConfigService),bw=Kx(YE.IMapService),xw=Kx(YE.ICoordinateSystemService),Ew=Kx(YE.IRendererService),Sw=Kx(YE.ILayerService),Cw=Kx(YE.ICameraService),Tw=Kx(YE.IInteractionService),Aw=Kx(YE.IPickingService),Mw=Kx(YE.IShaderModuleService),ww=Kx(YE.IMarkerService),kw=Kx(YE.IPopupService),dw((Rw=j((Pw=function(t){S(i,t);var n,r=R(i);function i(){var e;return _(this,i),E(O(e=r.call(this)),"destroyed",!1),E(O(e),"loaded",!1),E(O(e),"loadFont",!1),E(O(e),"fontFamily",""),z(O(e),"id",Rw,O(e)),z(O(e),"iconService",Lw,O(e)),z(O(e),"fontService",Iw,O(e)),z(O(e),"controlService",Nw,O(e)),z(O(e),"configService",Dw,O(e)),z(O(e),"map",Fw,O(e)),z(O(e),"coordinateSystemService",Bw,O(e)),z(O(e),"rendererService",Uw,O(e)),z(O(e),"layerService",zw,O(e)),z(O(e),"cameraService",jw,O(e)),z(O(e),"interactionService",Vw,O(e)),z(O(e),"pickingService",Gw,O(e)),z(O(e),"shaderModuleService",Hw,O(e)),z(O(e),"markerService",Ww,O(e)),z(O(e),"popupService",Xw,O(e)),E(O(e),"inited",!1),E(O(e),"initPromise",void 0),E(O(e),"rendering",!1),E(O(e),"$container",void 0),E(O(e),"canvas",void 0),E(O(e),"markerContainer",void 0),E(O(e),"hooks",void 0),E(O(e),"handleWindowResized",(function(){e.emit("resize"),e.$container&&(e.initContainer(),Bd(),e.coordinateSystemService.needRefresh=!0,e.render())})),E(O(e),"handleMapCameraChanged",(function(t){e.cameraService.update(t),e.render()})),e.hooks={init:new Db},e}return x(i,[{key:"init",value:function(t){var n=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return n.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",y(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(e){n.map.onCameraChanged((function(t){n.cameraService.init(),n.cameraService.update(t),"GAODE2.x"!==n.map.version&&e()})),"GAODE2.x"!==n.map.version?n.map.init():e()}));case 2:if("GAODE2.x"!==n.map.version||!n.map.initViewPort){t.next=6;break}return t.next=5,n.map.init();case 5:n.map.initViewPort();case 6:n.map.onCameraChanged(n.handleMapCameraChanged),n.map.addMarkerContainer(),n.markerService.addMarkers(),n.markerService.addMarkerLayers(),n.popupService.initPopup(),n.interactionService.init(),n.interactionService.on(e.InteractionEvent.Drag,n.addSceneEvent.bind(n));case 13:case"end":return t.stop()}}),t)})))),this.hooks.init.tapPromise("initRenderer",y(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=GM(n.configService.getSceneConfig(n.id).id||""),n.$container=t,!t){e.next=11;break}return n.canvas=wd("canvas","",t),n.setCanvas(),e.next=7,n.rendererService.init(n.canvas,n.configService.getSceneConfig(n.id));case 7:Zw(n.$container,n.handleWindowResized),Ed.matchMedia&&(null===(r=Ed.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))||void 0===r||r.addListener(n.handleWindowResized)),e.next=12;break;case 11:console.error("容器 id 不存在");case 12:n.pickingService.init(n.id);case 13:case"end":return e.stop()}}),e)})))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(t){var n=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return n.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",y(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(e){n.map.onCameraChanged((function(t){n.cameraService.init(),n.cameraService.update(t),"GAODE2.x"!==n.map.version&&e()})),n.map.initMiniMap()}));case 2:n.map.onCameraChanged(n.handleMapCameraChanged),n.interactionService.init(),n.interactionService.on(e.InteractionEvent.Drag,n.addSceneEvent.bind(n));case 5:case"end":return t.stop()}}),t)})))),this.hooks.init.tapPromise("initRenderer",y(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.canvas,n.$container=r||null,!n.$container){e.next=7;break}return e.next=5,n.rendererService.init(t.canvas,n.configService.getSceneConfig(n.id));case 5:e.next=8;break;case 7:console.error("容器 id 不存在");case 8:n.pickingService.init(n.id);case 9:case"end":return e.stop()}}),e)})))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(e){this.layerService.sceneService=this,this.layerService.add(e),this.render()}},{key:"render",value:(n=y(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rendering&&!this.destroyed){e.next=2;break}return e.abrupt("return");case 2:if(this.rendering=!0,this.inited){e.next=23;break}return e.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!this.loadFont||!document.fonts){e.next=18;break}return e.prev=8,e.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:e.next=18;break;case 13:e.prev=13,e.t0=e.catch(8),console.warn("当前环境不支持 document.fonts !"),console.warn("当前环境不支持 iconfont !"),console.warn(e.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return e.stop()}}),e,this,[[8,13]])}))),function(){return n.apply(this,arguments)})},{key:"addFontFace",value:function(e,t){this.fontFamily=e;var n=document.createElement("style");n.type="text/css",n.innerText="\n        @font-face{\n            font-family: '".concat(e,"';\n            src: url('").concat(t,"') format('woff2'),\n            url('").concat(t,"') format('woff'),\n            url('").concat(t,"') format('truetype');\n        }"),document.getElementsByTagName("head")[0].appendChild(n),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(e){var t,n=null===(t=this.$container)||void 0===t?void 0:t.getElementsByTagName("canvas")[0];return this.render(),"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var e=this.$container.parentElement;null!==e&&(this.markerContainer=wd("div","l7-marker-container",e))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var e,t,n,r=this;this.inited?(this.emit("destroy"),this.layerService.destroy(),setTimeout((function(){r.rendererService.destroy()})),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),null===(e=this.$container)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,qw(this.$container,this.handleWindowResized),Ed.matchMedia&&(null===(n=Ed.matchMedia("screen and (min-resolution: 2dppx)"))||void 0===n||n.removeListener(this.handleWindowResized))):this.destroyed=!0}},{key:"initContainer",value:function(){var e,t,n=zd,r=(null===(e=this.$container)||void 0===e?void 0:e.clientWidth)||400,i=(null===(t=this.$container)||void 0===t?void 0:t.clientHeight)||300,a=this.canvas;a&&(a.width=r*n,a.height=i*n),this.rendererService.viewport({x:0,y:0,width:n*r,height:n*i})}},{key:"setCanvas",value:function(){var e,t,n=zd,r=(null===(e=this.$container)||void 0===e?void 0:e.clientWidth)||400,i=(null===(t=this.$container)||void 0===t?void 0:t.clientHeight)||300,a=this.canvas;a.width=r*n,a.height=i*n,a.style.width="100%",a.style.height="100%"}},{key:"addSceneEvent",value:function(e){this.emit(e.type,e)}}]),i}(jb)).prototype,"id",[vw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lw=j(Pw.prototype,"iconService",[gw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iw=j(Pw.prototype,"fontService",[mw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nw=j(Pw.prototype,"controlService",[yw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dw=j(Pw.prototype,"configService",[_w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fw=j(Pw.prototype,"map",[bw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bw=j(Pw.prototype,"coordinateSystemService",[xw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uw=j(Pw.prototype,"rendererService",[Ew],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zw=j(Pw.prototype,"layerService",[Sw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jw=j(Pw.prototype,"cameraService",[Cw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vw=j(Pw.prototype,"interactionService",[Tw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gw=j(Pw.prototype,"pickingService",[Aw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hw=j(Pw.prototype,"shaderModuleService",[Mw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ww=j(Pw.prototype,"markerService",[ww],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xw=j(Pw.prototype,"popupService",[kw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ow=Pw))||Ow);var Qw=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var Jw=function(e){return this.__data__.has(e)};function $w(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Qm;++t<n;)this.add(e[t])}$w.prototype.add=$w.prototype.push=Qw,$w.prototype.has=Jw;var ek=$w;var tk=function(e,t,n,r){for(var i=e.length,a=n+(r?1:-1);r?a--:++a<i;)if(t(e[a],a,e))return a;return-1};var nk=function(e){return e!=e};var rk=function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1};var ik=function(e,t,n){return t==t?rk(e,t,n):tk(e,nk,n)};var ak=function(e,t){return!!(null==e?0:e.length)&&ik(e,t,0)>-1};var ok=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1};var sk=function(e,t){return e.has(t)};var uk=function(){};var lk=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n},ck=B_&&1/lk(new B_([,-0]))[1]==1/0?function(e){return new B_(e)}:uk;var hk=function(e,t,n){var r=-1,i=ak,a=e.length,o=!0,s=[],u=s;if(n)o=!1,i=ok;else if(a>=200){var l=t?null:ck(e);if(l)return lk(l);o=!1,i=sk,u=new ek}else u=t?[]:s;e:for(;++r<a;){var c=e[r],h=t?t(c):c;if(c=n||0!==c?c:0,o&&h==h){for(var f=u.length;f--;)if(u[f]===h)continue e;t&&u.push(h),s.push(c)}else i(u,h,n)||(u!==s&&u.push(h),s.push(c))}return s};var fk=function(e){return e&&e.length?hk(e):[]};er({target:"Array",proto:!0},{fill:Xc}),Hs("fill");var pk=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function dk(e){var t={};return{content:e=e.replace(pk,(function(e,n,r){var i=r.split(":"),a=i[0].trim(),o="";switch(i.length>1&&(o=i[1].trim()),n){case"bool":o="true"===o;break;case"float":case"int":o=Number(o);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":o=o?o.replace("[","").replace("]","").split(",").reduce((function(e,t){return e.push(Number(t.trim())),e}),[]):new Array(function(e){var t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16}return t}(n)).fill(0)}return t[a]=o,"uniform ".concat(n," ").concat(a,";\n")})),uniforms:t}}var vk,gk,mk,yk="#define PI 3.14159265359",_k=/precision\s+(high|low|medium)p\s+float/,bk=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,xk=Qx()(vk=function(){function e(){_(this,e),E(this,"moduleCache",{}),E(this,"rawContentCache",{})}return x(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:yk,fs:yk}),this.registerModule("decode",{vs:"#define SHIFT_RIGHT17 1.0 / 131072.0\n#define SHIFT_RIGHT18 1.0 / 262144.0\n#define SHIFT_RIGHT19 1.0 / 524288.0\n#define SHIFT_RIGHT20 1.0 / 1048576.0\n#define SHIFT_RIGHT21 1.0 / 2097152.0\n#define SHIFT_RIGHT22 1.0 / 4194304.0\n#define SHIFT_RIGHT23 1.0 / 8388608.0\n#define SHIFT_RIGHT24 1.0 / 16777216.0\n#define SHIFT_LEFT17 131072.0\n#define SHIFT_LEFT18 262144.0\n#define SHIFT_LEFT19 524288.0\n#define SHIFT_LEFT20 1048576.0\n#define SHIFT_LEFT21 2097152.0\n#define SHIFT_LEFT22 4194304.0\n#define SHIFT_LEFT23 8388608.0\n#define SHIFT_LEFT24 16777216.0\nvec2 unpack_float(float packedValue) {\nint packedIntValue = int(packedValue);\nint v0 = packedIntValue / 256;\nreturn vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(vec2 encodedColor) {\nreturn vec4(\nunpack_float(encodedColor[0]) / 255.0,\nunpack_float(encodedColor[1]) / 255.0\n);\n}",fs:""}),this.registerModule("projection",{vs:"#define TILE_SIZE 512.0\n#define PI 3.1415926536\n#define WORLD_SCALE TILE_SIZE / (PI * 2.0)\n#define COORDINATE_SYSTEM_LNGLAT 1.0\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0\n#define COORDINATE_SYSTEM_VECTOR_TILE 3.0\n#define COORDINATE_SYSTEM_IDENTITY 4.0\n#define COORDINATE_SYSTEM_P20 5.0\n#define COORDINATE_SYSTEM_P20_OFFSET 6.0\n#define COORDINATE_SYSTEM_METER_OFFSET 7.0\n#define COORDINATE_SYSTEM_P20_2 8.0\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_ProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrix;\nuniform float u_Zoom : 1;\nuniform float u_ZoomScale : 1;\nuniform float u_CoordinateSystem;\nuniform vec2 u_ViewportCenter;\nuniform vec4 u_ViewportCenterProjection;\nuniform vec3 u_PixelsPerDegree;\nuniform vec3 u_PixelsPerDegree2;\nuniform vec3 u_PixelsPerMeter;\nuniform vec2 u_ViewportSize;\nuniform float u_DevicePixelRatio;\nuniform float u_FocalDistance;\nuniform vec3 u_CameraPosition;\nvec2 project_mercator(vec2 lnglat) {\nfloat x = lnglat.x;\nreturn vec2(\nradians(x) + PI,\nPI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))\n);\n}\nfloat project_scale(float meters) {\nreturn meters * u_PixelsPerMeter.z;\n}\nvec4 project_offset(vec4 offset) {\nfloat dy = offset.y;\ndy = clamp(dy, -1., 1.);\nvec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;\nreturn vec4(offset.xyz * pixels_per_unit, offset.w);\n}\nvec3 project_normal(vec3 normal) {\nvec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);\nreturn normalize(normal_modelspace.xyz * u_PixelsPerMeter);\n}\nvec3 project_offset_normal(vec3 vector) {\nif (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01\n|| u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nreturn normalize(vector * u_PixelsPerDegree);\n}\nreturn project_normal(vector);\n}\nvec3 reverse_offset_normal(vec3 vector) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {\nreturn vector * vec3(1.0, -1.0, 1.0);\n}\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn vector;\n}\nreturn vector;\n}\nvec4 project_position(vec4 position) {\nfloat a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\nfloat b = COORDINATE_SYSTEM_P20_OFFSET;\nfloat c = COORDINATE_SYSTEM_LNGLAT;\nif (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n|| u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nfloat X = position.x - u_ViewportCenter.x;\nfloat Y = position.y - u_ViewportCenter.y;\nreturn project_offset(vec4(X, Y, position.z, position.w));\n}\nif (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\nreturn vec4(\nproject_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\nproject_scale(position.z),\nposition.w\n);\n}\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\nreturn vec4(\n(project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),\nproject_scale(position.z),\nposition.w\n);\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn vec4(\nposition.xy, \nproject_scale(position.z), \nposition.w);\n}\nreturn position;\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\nvec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;\nreturn offset * u_FocalDistance;\n}\nfloat project_pixel_allmap(float pixel) {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn pixel * pow(2.0, u_Zoom);\n}\nreturn pixel;\n}\nfloat project_pixel_texture(float pixel) {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nreturn pixel * pow(0.5, u_Zoom);\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n}\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(0.5, u_Zoom);\n}\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\nreturn pixel * pow(2.0, (20.0 - u_Zoom));\n}\nreturn pixel * 2.0;\n}\nfloat project_float_pixel(float pixel) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom));\n}\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom));\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n}\nreturn pixel;\n}\nfloat project_pixel(float pixel) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom));\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n}\nreturn pixel;\n}\nvec2 project_pixel(vec2 pixel) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom));\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n}\nreturn pixel * -1.;\n}\nvec3 project_pixel(vec3 pixel) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nreturn pixel * pow(2.0, (19.0 - u_Zoom));\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nreturn pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));\n}\nreturn pixel * -1.;\n}\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\nu_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nposition.w *= u_PixelsPerMeter.z;\n}\nreturn viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\nreturn project_common_position_to_clipspace(\nposition,\nu_ViewProjectionMatrix,\nu_ViewportCenterProjection\n);\n}\nvec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {\nvec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);\nif (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\nu_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\npos.w = pos.w / u_PixelsPerMeter.z;\n}\nreturn pos;\n}\nbool isEqual( float a,  float b) {\nreturn  a< b + 0.001 && a > b - 0.001;\n}",fs:""}),this.registerModule("project",{vs:"#define E 2.718281828459045\nvec2 ProjectFlat(vec2 lnglat){\nfloat maxs=85.0511287798;\nfloat lat=max(min(maxs,lnglat.y),-maxs);\nfloat scale= 268435456.;\nfloat d=PI/180.;\nfloat x=lnglat.x*d;\nfloat y=lat*d;\ny=log(tan((PI/4.)+(y/2.)));\nfloat a=.5/PI,\nb=.5,\nc=-.5/PI;\nd=.5;\nx=scale*(a*x+b);\ny=scale*(c*y+d);\nreturn vec2(x,y);\n}\nvec2 unProjectFlat(vec2 px){\nfloat a=.5/PI;\nfloat b=.5;\nfloat c=-.5/PI;\nfloat d=.5;\nfloat scale = 268435456.;\nfloat x=(px.x/scale-b)/a;\nfloat y=(px.y/scale-d)/c;\ny=(atan(pow(E,y))-(PI/4.))*2.;\nd=PI/180.;\nfloat lat=y/d;\nfloat lng=x/d;\nreturn vec2(lng,lat);\n}\nfloat pixelDistance(vec2 from, vec2 to) {\nvec2 a1 = ProjectFlat(from);\nvec2 b1 = ProjectFlat(to);\nreturn distance(a1, b1);\n}\nvec2 customProject(vec2 lnglat) {\nfloat t = lnglat.x;\nfloat e = lnglat.y;\nfloat Sm = 180.0 / PI;\nfloat Tm = 6378137.0;\nfloat Rm = PI / 180.0;\nfloat r = 85.0511287798;\ne = max(min(r, e), -r);\nt *= Rm;\ne *= Rm;\ne = log(tan(PI / 4.0 + e / 2.0));\nreturn vec2(t * Tm, e * Tm);\n}\nvec2 unProjCustomCoord(vec2 point) {\nfloat Sm = 57.29577951308232;\nfloat Tm = 6378137.0;\nfloat t = point.x;\nfloat e = point.y;\nreturn vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);\n}\nfloat customPixelDistance(vec2 from, vec2 to) {\nvec2 a1 = ProjectFlat(from);\nvec2 b1 = ProjectFlat(to);\nreturn distance(a1, b1);\n}",fs:""}),this.registerModule("sdf_2d",{vs:"",fs:"\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\nfloat sdCircle(vec2 p, float r) {\nreturn length(p) - r;\n}\nfloat sdEquilateralTriangle(vec2 p) {\nfloat k = sqrt(3.0);\np.x = abs(p.x) - 1.0;\np.y = p.y + 1.0/k;\nif( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\np.x -= clamp( p.x, -2.0, 0.0 );\nreturn -length(p)*sign(p.y);\n}\nfloat sdBox(vec2 p, vec2 b) {\nvec2 d = abs(p)-b;\nreturn length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\nfloat sdPentagon(vec2 p, float r) {\nvec3 k = vec3(0.809016994,0.587785252,0.726542528);\np.x = abs(p.x);\np -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\np -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\np -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\nreturn length(p)*sign(p.y);\n}\nfloat sdHexagon(vec2 p, float r) {\nvec3 k = vec3(-0.866025404,0.5,0.577350269);\np = abs(p);\np -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\np -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\nreturn length(p)*sign(p.y);\n}\nfloat sdOctogon(vec2 p, float r) {\nvec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\np = abs(p);\np -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\np -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\np -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\nreturn length(p)*sign(p.y);\n}\nfloat sdHexagram(vec2 p, float r) {\nvec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\np = abs(p);\np -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\np -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\np -= vec2(clamp(p.x,r*k.z,r*k.w),r);\nreturn length(p)*sign(p.y);\n}\nfloat sdRhombus(vec2 p, vec2 b) {\nvec2 q = abs(p);\nfloat h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\nfloat d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\nreturn d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\nfloat sdVesica(vec2 p, float r, float d) {\np = abs(p);\nfloat b = sqrt(r*r-d*d);\nreturn ((p.y-b)*d>p.x*b)\n? length(p-vec2(0.0,b))\n: length(p-vec2(-d,0.0))-r;\n}"}),this.registerModule("lighting",{vs:"\nuniform float u_Ambient : 1.0;\nuniform float u_Diffuse : 1.0;\nuniform float u_Specular : 1.0;\nuniform int u_NumOfDirectionalLights : 1;\nuniform int u_NumOfSpotLights : 0;\n#define SHININESS 32.0\n#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3\n#define MAX_NUM_OF_SPOT_LIGHTS 3\nstruct DirectionalLight {\nvec3 direction;\nvec3 ambient;\nvec3 diffuse;\nvec3 specular;\n};\nstruct SpotLight {\nvec3 position;\nvec3 direction;\nvec3 ambient;\nvec3 diffuse;\nvec3 specular;\nfloat constant;\nfloat linear;\nfloat quadratic;\nfloat angle;\nfloat blur;\nfloat exponent;\n};\nuniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];\nuniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];\nvec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {\nvec3 lightDir = normalize(light.direction);\nfloat diff = max(dot(normal, lightDir), 0.0);\nvec3 halfwayDir = normalize(lightDir + viewDir);\nfloat spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);\nvec3 ambient = light.ambient * u_Ambient;\nvec3 diffuse = light.diffuse * diff * u_Diffuse;\nvec3 specular = light.specular * spec * u_Specular;\nreturn ambient + diffuse + specular;\n}\nvec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {\nvec3 weight = vec3(0.0);\nfor (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {\nif (i >= u_NumOfDirectionalLights) {\nbreak;\n}\nweight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);\n}\nreturn weight;\n}",fs:""}),this.registerModule("light",{vs:"#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nfloat calc_lighting(vec4 pos) {\nvec3 worldPos = vec3(pos * u_ModelMatrix);\nvec3 worldNormal = a_Normal;\nvec3 viewDir = normalize(u_CameraPosition - worldPos);\nvec3 lightDir = normalize(vec3(1, -10.5, 12));\nvec3 halfDir = normalize(viewDir+lightDir);\nfloat lambert = dot(worldNormal, lightDir);\nfloat specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\nfloat lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;\nreturn lightWeight;\n}",fs:""}),this.registerModule("picking",{vs:"attribute vec3 a_PickingColor;\nvarying vec4 v_PickingResult;\nuniform vec3 u_PickingColor : [0, 0, 0];\nuniform vec3 u_CurrentSelectedId : [0, 0, 0];\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform vec4 u_SelectColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_PickingThreshold : 1.0;\nuniform float u_PickingBuffer: 0.0;\nuniform float u_shaderPick;\nuniform float u_EnableSelect: 0.0;\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n#define NORMAL 0.0\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\nbool isVertexPicked(vec3 vertexColor) {\nreturn\nabs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&\nabs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&\nabs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;\n}\nbool isVertexSelected(vec3 vertexColor) {\nreturn\nabs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&\nabs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&\nabs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;\n}\nvoid setPickingColor(vec3 pickingColor) {\nif(u_shaderPick < 0.5) {\nreturn;\n}\nv_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));\nv_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\nfloat setPickingSize(float x) {\nreturn u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}\nfloat setPickingOrder(float z) {\nbool selected = bool(v_PickingResult.a);\nreturn selected ? z + 1. : 0.;\n}",fs:"varying vec4 v_PickingResult;\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform vec4 u_SelectColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_shaderPick;\nuniform float u_activeMix: 0;\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\nvec4 filterHighlightColor(vec4 color, float weight) {\nbool selected = bool(v_PickingResult.a);\nif (selected) {\nvec4 highLightColor = u_HighlightColor * COLOR_SCALE;\nfloat highLightAlpha = highLightColor.a;\nfloat highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\nvec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\nreturn vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);\n} else {\nreturn color;\n}\n}\nvec4 filterPickingColor(vec4 color) {\nvec3 pickingColor = v_PickingResult.rgb;\nif (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\ndiscard;\n}\nreturn u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\nvec4 filterColor(vec4 color) {\nif(u_shaderPick < 0.5) {\nreturn color;\n} else {\nreturn filterPickingColor(filterHighlightColor(color, 1.0));\n}\n}\nvec4 filterColorAnimate(vec4 color) {\nif(u_shaderPick < 0.5) {\nreturn color;\n} else {\nreturn filterPickingColor(filterHighlightColor(color, color.a));\n}\n}\nvec4 filterColorWithLight(vec4 color, float lightWeight) {\nif(u_shaderPick < 0.5) {\nreturn color;\n} else {\nreturn filterPickingColor(filterHighlightColor(color, lightWeight));\n}\n}"}),this.registerModule("styleMapping",{vs:"attribute float a_vertexId;\nuniform mat4 u_cellTypeLayout;\nuniform sampler2D u_dataTexture;\nbool hasOpacity() {\nreturn u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\nbool hasStrokeOpacity() {\nreturn u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\nbool hasStrokeWidth() {\nreturn u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\nbool hasStroke() {\nreturn u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\nbool hasOffsets() {\nreturn u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\nbool hasThetaOffset() {\nreturn u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;\n}\nfloat pos2value(vec2 pos, float columnWidth, float rowHeight) {\nfloat u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;\nfloat v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);\nreturn texture2D(u_dataTexture, vec2(u, v)).r;\n}\nvec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {\nfloat nextColumn = currentColumn;\nfloat nextRow = currentRow;\nif(currentColumn + nextStep <= columnCount){\nnextColumn = currentColumn + nextStep;\n} else {\nnextColumn = mod(currentColumn + nextStep, columnCount);\nnextRow = currentRow + 1.0;\n}\nreturn vec2(nextColumn, nextRow);\n}\nfloat calCellCount() {\nreturn  u_cellTypeLayout[1][0] +\nu_cellTypeLayout[1][1] +\nu_cellTypeLayout[1][2] +\nu_cellTypeLayout[1][3] * 4.0 +\nu_cellTypeLayout[2][0] * 2.0 +\nu_cellTypeLayout[2][1];\n}",fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:"\nvec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\nif(!hasThetaOffset()) {\nreturn vec2(u_thetaOffset, textureOffset);\n} else {\nvec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nfloat textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);\nreturn vec2(textureThetaOffset, textureOffset + 1.0);\n}\n}",fs:""}),this.registerModule("styleMappingCalOpacity",{vs:"\nvec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\nif(!hasOpacity()) {\nreturn vec2(u_opacity, textureOffset);\n} else {\nvec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nfloat textureOpacity = pos2value(valuePos, columnWidth, rowHeight);\nreturn vec2(textureOpacity, textureOffset + 1.0);\n}\n}",fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:"\nvec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\nif(!hasStrokeOpacity()) {\nreturn vec2(u_stroke_opacity, textureOffset);\n} else {\nvec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nfloat textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);\nreturn vec2(textureStrokeOpacity, textureOffset + 1.0);\n}\n}",fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:"\nvec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {\nif(!hasStrokeWidth()) {\nreturn vec2(u_stroke_width, textureOffset);\n} else {\nvec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nfloat textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);\nreturn vec2(textureStrokeWidth, textureOffset + 1.0);\n}\n}",fs:""})}},{key:"registerModule",value:function(e,t){if(!this.rawContentCache[e]){var n=t.vs,r=t.fs,i=t.uniforms,a=dk(n),o=a.content,s=a.uniforms,u=dk(r),l=u.content,c=u.uniforms;this.rawContentCache[e]={fs:l,uniforms:v(v(v({},s),c),i),vs:o}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(e){var t=this;if(this.moduleCache[e])return this.moduleCache[e];var n=this.rawContentCache[e].vs,r=this.rawContentCache[e].fs,i=this.processModule(n,[],"vs"),a=i.content,o=i.includeList,s=this.processModule(r,[],"fs"),u=s.content,l=s.includeList,c=u,h=fk(o.concat(l).concat(e)).reduce((function(e,n){return v(v({},e),t.rawContentCache[n].uniforms)}),{});return _k.test(u)||(c="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n"+u),this.moduleCache[e]={fs:c.trim(),uniforms:h,vs:a.trim()},this.moduleCache[e]}},{key:"processModule",value:function(e,t,n){var r=this;return{content:e.replace(bk,(function(e,i){var a=i.split(" ")[0].replace(/"/g,"");if(t.indexOf(a)>-1)return"";var o=r.rawContentCache[a][n];return t.push(a),r.processModule(o,t,n).content})),includeList:t}}}]),e}())||vk;(gk=e.PassType||(e.PassType={})).Normal="normal",gk.PostProcessing="post-processing";var Ek,Sk,Ck,Tk,Ak,Mk,wk,kk=Qx()(mk=function(){function t(){_(this,t),E(this,"shaderModuleService",void 0),E(this,"rendererService",void 0),E(this,"cameraService",void 0),E(this,"mapService",void 0),E(this,"interactionService",void 0),E(this,"layerService",void 0),E(this,"config",void 0)}return x(t,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return e.PassType.Normal}},{key:"init",value:function(e,t){this.config=t,this.rendererService=e.getContainer().get(YE.IRendererService),this.cameraService=e.getContainer().get(YE.ICameraService),this.mapService=e.getContainer().get(YE.IMapService),this.interactionService=e.getContainer().get(YE.IInteractionService),this.layerService=e.getContainer().get(YE.ILayerService),this.shaderModuleService=e.getContainer().get(YE.IShaderModuleService)}},{key:"render",value:function(e){}}]),t}())||mk,Ok=Qx()(Ek=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.apply(this,arguments)}return x(n,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(e,t){I(C(n.prototype),"init",this).call(this,e,t)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),n}(kk))||Ek,Pk=(Sk=Qx(),Ck=Kx(YE.IPostProcessor),Sk((Mk=j((Ak=function(){function t(){_(this,t),E(this,"passes",[]),z(this,"postProcessor",Mk,this),E(this,"layer",void 0),E(this,"renderFlag",void 0),E(this,"width",0),E(this,"height",0)}var n;return x(t,[{key:"setLayer",value:function(e){this.layer=e}},{key:"setRenderFlag",value:function(e){this.renderFlag=e}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:(n=y(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=U(this.passes),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,r.render(this.layer);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:return e.next=19,this.postProcessor.render(this.layer);case 19:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))),function(){return n.apply(this,arguments)})},{key:"resize",value:function(e,t){this.width===e&&this.height===t||(this.postProcessor.resize(e,t),this.width=e,this.height=t)}},{key:"add",value:function(t,n){t.getType()===e.PassType.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(e,t,n){e.init(this.layer,t),this.passes.splice(n,0,e)}},{key:"destroy",value:function(){this.passes.length=0}}]),t}()).prototype,"postProcessor",[Ck],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tk=Ak))||Tk),Rk=Qx()(wk=function(t){S(r,t);var n=R(r);function r(){var e;_(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return E(O(e=n.call.apply(n,[this].concat(i))),"pickingFBO",void 0),E(O(e),"layer",void 0),E(O(e),"width",0),E(O(e),"height",0),E(O(e),"alreadyInRendering",!1),E(O(e),"pickFromPickingFBO",(function(t){var n=t.x,r=t.y,i=t.lngLat,a=t.type;if(e.layer.isVisible()&&e.layer.needPick(a)){var o,s=e.rendererService,u=s.getViewportSize,l=s.readPixels,c=s.useFramebuffer,h=u(),f=h.width,p=h.height,d=e.layer.getLayerConfig(),g=d.enableHighlight,m=d.enableSelect,y=n*zd,_=r*zd;if(!(y>f||y<0||_>p||_<0))c(e.pickingFBO,(function(){var t;if(0!==(o=l({x:Math.round(y),y:Math.round(p-(r+1)*zd),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}))[0]||0!==o[1]||0!==o[2]){var s=gg(o),u=e.layer.getSource().getFeatureById(s),c={x:n,y:r,type:a,lngLat:i,featureId:s,feature:u};u&&(e.layer.setCurrentPickId(s),e.triggerHoverOnLayer(c))}else{var h={x:n,y:r,lngLat:i,type:null===e.layer.getCurrentPickId()?"un"+a:"mouseout",featureId:null,feature:null};e.triggerHoverOnLayer(v(v({},h),{},{type:"unpick"})),e.triggerHoverOnLayer(h),e.layer.setCurrentPickId(null)}g&&e.highlightPickedFeature(o),m&&"click"===a&&(null===(t=o)||void 0===t?void 0:t.toString())!==[0,0,0,0].toString()&&e.selectFeature(o)}))}})),e}return x(r,[{key:"getType",value:function(){return e.PassType.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(t,n){I(C(r.prototype),"init",this).call(this,t,n),this.layer=t;var i=this.rendererService,a=i.createTexture2D,o=i.createFramebuffer,s=(0,i.getViewportSize)(),u=s.width,l=s.height;this.pickingFBO=o({color:a({width:u,height:l,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.interactionService.on(e.InteractionEvent.Hover,this.pickFromPickingFBO),this.interactionService.on(e.InteractionEvent.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(e.InteractionEvent.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(e){var t=this;if(!this.alreadyInRendering){var n=this.rendererService,r=n.getViewportSize,i=n.useFramebuffer,a=n.clear,o=r(),s=o.width,u=o.height;this.alreadyInRendering=!0,this.width===s&&this.height===u||(this.pickingFBO.resize({width:s,height:u}),this.width=s,this.height=u),i(this.pickingFBO,(function(){a({framebuffer:t.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var n=t.layer.multiPassRenderer.getRenderFlag();t.layer.multiPassRenderer.setRenderFlag(!1),e.hooks.beforePickingEncode.call(),e.render(),e.hooks.afterPickingEncode.call(),t.layer.multiPassRenderer.setRenderFlag(n),t.alreadyInRendering=!1}))}}},{key:"triggerHoverOnLayer",value:function(e){this.layer.emit(e.type,e)}},{key:"highlightPickedFeature",value:function(e){var t=N(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeHighlight.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(e){var t=N(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeSelect.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(e){var t=mg(e.featureId);this.selectFeature(new Uint8Array(t))}},{key:"highlightFeatureHandle",value:function(e){var t=mg(e.featureId);this.highlightPickedFeature(new Uint8Array(t))}}]),r}(kk))||wk,Lk="attribute vec2 a_Position;\nvarying vec2 v_UV;\nvoid main() {\nv_UV = 0.5 * (a_Position + 1.0);\ngl_Position = vec4(a_Position, 0., 1.);\n}";var Ik=function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var a=Array(i);++r<i;)a[r]=e[r+t];return a};var Nk=function(e,t,n){var r=e.length;return n=void 0===n?r:n,!t&&n>=r?e:Ik(e,t,n)},Dk=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var Fk=function(e){return Dk.test(e)};var Bk=function(e){return e.split("")},Uk="[\\ud800-\\udfff]",zk="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",jk="\\ud83c[\\udffb-\\udfff]",Vk="[^\\ud800-\\udfff]",Gk="(?:\\ud83c[\\udde6-\\uddff]){2}",Hk="[\\ud800-\\udbff][\\udc00-\\udfff]",Wk="(?:"+zk+"|"+jk+")"+"?",Xk="[\\ufe0e\\ufe0f]?"+Wk+("(?:\\u200d(?:"+[Vk,Gk,Hk].join("|")+")[\\ufe0e\\ufe0f]?"+Wk+")*"),Yk="(?:"+[Vk+zk+"?",zk,Gk,Hk,Uk].join("|")+")",Zk=RegExp(jk+"(?="+jk+")|"+Yk+Xk,"g");var qk=function(e){return e.match(Zk)||[]};var Kk=function(e){return Fk(e)?qk(e):Bk(e)};var Qk=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i};var Jk=function(e){return"symbol"==typeof e||yy(e)&&"[object Symbol]"==vm(e)},$k=om?om.prototype:void 0,eO=$k?$k.toString:void 0;var tO=function e(t){if("string"==typeof t)return t;if(Cy(t))return Qk(t,e)+"";if(Jk(t))return eO?eO.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};var nO=function(e){return null==e?"":tO(e)};var rO=function(e){return function(t){t=nO(t);var n=Fk(t)?Kk(t):void 0,r=n?n[0]:t.charAt(0),i=n?Nk(n,1).join(""):t.slice(1);return r[e]()+i}}("toUpperCase");var iO=function(e){return rO(nO(e).toLowerCase())};var aO=function(e,t,n,r){var i=-1,a=null==e?0:e.length;for(r&&a&&(n=e[++i]);++i<a;)n=t(n,e[i],i,e);return n};var oO=function(e){return function(t){return null==e?void 0:e[t]}}({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),sO=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,uO=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");var lO=function(e){return(e=nO(e))&&e.replace(sO,oO).replace(uO,"")},cO=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var hO=function(e){return e.match(cO)||[]},fO=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var pO=function(e){return fO.test(e)},dO="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",vO="["+dO+"]",gO="\\d+",mO="[\\u2700-\\u27bf]",yO="[a-z\\xdf-\\xf6\\xf8-\\xff]",_O="[^\\ud800-\\udfff"+dO+gO+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",bO="(?:\\ud83c[\\udde6-\\uddff]){2}",xO="[\\ud800-\\udbff][\\udc00-\\udfff]",EO="[A-Z\\xc0-\\xd6\\xd8-\\xde]",SO="(?:"+yO+"|"+_O+")",CO="(?:"+EO+"|"+_O+")",TO="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",AO="[\\ufe0e\\ufe0f]?"+TO+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",bO,xO].join("|")+")[\\ufe0e\\ufe0f]?"+TO+")*"),MO="(?:"+[mO,bO,xO].join("|")+")"+AO,wO=RegExp([EO+"?"+yO+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[vO,EO,"$"].join("|")+")",CO+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[vO,EO+SO,"$"].join("|")+")",EO+"?"+SO+"+(?:['’](?:d|ll|m|re|s|t|ve))?",EO+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",gO,MO].join("|"),"g");var kO=function(e){return e.match(wO)||[]};var OO=function(e,t,n){return e=nO(e),void 0===(t=n?void 0:t)?pO(e)?kO(e):hO(e):e.match(t)||[]},PO=RegExp("['’]","g");var RO,LO,IO,NO,DO,FO,BO,UO,zO,jO,VO,GO,HO,WO,XO,YO,ZO,qO,KO,QO,JO=function(e){return function(t){return aO(OO(lO(t).replace(PO,"")),e,"")}}((function(e,t,n){return t=t.toLowerCase(),e+(n?iO(t):t)})),$O=(RO=Qx(),LO=Kx(YE.IShaderModuleService),RO((DO=j((NO=function(){function t(){_(this,t),z(this,"shaderModuleService",DO,this),E(this,"rendererService",void 0),E(this,"config",void 0),E(this,"quad",Lk),E(this,"enabled",!0),E(this,"renderToScreen",!1),E(this,"model",void 0),E(this,"name",void 0),E(this,"optionsToUpdate",{})}return x(t,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){this.name=e}},{key:"getType",value:function(){return e.PassType.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(YE.IRendererService),this.shaderModuleService=t.getContainer().get(YE.IShaderModuleService);var r=this.rendererService,i=r.createAttribute,a=r.createBuffer,o=r.createModel,s=this.setupShaders(),u=s.vs,l=s.fs,c=s.uniforms;this.model=o({vs:u,fs:l,attributes:{a_Position:i({buffer:a({data:[-4,-4,4,-4,0,4],type:e.gl.FLOAT}),size:2})},uniforms:v(v({u_Texture:null},c),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:"copy"===this.getName()}})}},{key:"render",value:function(e,t){var n=this,r=e.multiPassRenderer.getPostProcessor(),i=this.rendererService,a=i.useFramebuffer,o=i.getViewportSize,s=i.clear,u=o(),l=u.width,c=u.height;a(this.renderToScreen?null:r.getWriteFBO(),(function(){s({framebuffer:r.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var e=v({u_BloomFinal:0,u_Texture:r.getReadFBO(),u_ViewportSize:[l,c]},n.convertOptionsToUniforms(n.optionsToUpdate));t&&(e.u_BloomFinal=1,e.u_Texture2=t),n.model.draw({uniforms:e})}))}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(e){this.enabled=e}},{key:"setRenderToScreen",value:function(e){this.renderToScreen=e}},{key:"updateOptions",value:function(e){this.optionsToUpdate=v(v({},this.optionsToUpdate),e)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(e){var t={};return Object.keys(e).forEach((function(n){uw(e[n])||(t["u_".concat(rO(JO(n)))]=e[n])})),t}}]),t}()).prototype,"shaderModuleService",[LO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IO=NO))||IO),eP=Qx()(FO=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.apply(this,arguments)}return x(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Lk,fs:"varying vec2 v_UV;\nuniform float u_BloomFinal: 0.0;\nuniform sampler2D u_Texture;\nuniform sampler2D u_Texture2;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_radius: 5.0;\nuniform float u_intensity: 0.3;\nuniform float u_baseRadio: 0.5;\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\nvec4 color = vec4(0.0);\nvec2 off1 = vec2(1.3846153846) * direction;\nvec2 off2 = vec2(3.2307692308) * direction;\ncolor += texture2D(image, uv) * 0.2270270270;\ncolor += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\ncolor += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\ncolor += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\ncolor += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\nreturn color;\n}\nfloat luminance(vec4 color) {\nreturn  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;\n}\nvoid main() {\nfloat r = sqrt(u_radius);\nvec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));\nvec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));\nvec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));\nvec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));\nvec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;\nif(u_BloomFinal > 0.0) {\nvec4 baseColor = texture2D(u_Texture2, v_UV);\nfloat baselum = luminance(baseColor);\ngl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);\nif(baselum <= 0.2) {\ngl_FragColor = inbloomColor * u_intensity;\n}\n} else {\ngl_FragColor = inbloomColor;\n}\n}"});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),a=i.width,o=i.height;return{vs:t,fs:n,uniforms:v(v({},r),{},{u_ViewportSize:[a,o]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return uw(e.bloomRadius)||(t.u_radius=e.bloomRadius),uw(e.bloomIntensity)||(t.u_intensity=e.bloomIntensity),uw(e.bloomBaseRadio)||(t.u_baseRadio=e.bloomBaseRadio),t}}]),n}($O))||FO,tP="varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\nvec4 color = vec4(0.0);\nvec2 off1 = vec2(1.3846153846) * direction;\nvec2 off2 = vec2(3.2307692308) * direction;\ncolor += texture2D(image, uv) * 0.2270270270;\ncolor += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\ncolor += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\ncolor += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\ncolor += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\nreturn color;\n}\nvoid main() {\ngl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}",nP=Qx()(BO=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.apply(this,arguments)}return x(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Lk,fs:tP});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),a=i.width,o=i.height;return{vs:t,fs:n,uniforms:v(v({},r),{},{u_ViewportSize:[a,o]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return uw(e.blurRadius)||(t.u_BlurDir=[e.blurRadius,0]),t}}]),n}($O))||BO,rP=Qx()(UO=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.apply(this,arguments)}return x(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Lk,fs:tP});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),a=i.width,o=i.height;return{vs:t,fs:n,uniforms:v(v({},r),{},{u_ViewportSize:[a,o]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return uw(e.blurRadius)||(t.u_BlurDir=[0,e.blurRadius]),t}}]),n}($O))||UO,iP=Qx()(zO=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.apply(this,arguments)}return x(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:Lk,fs:'varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Angle : 0;\nuniform float u_Size : 8;\n#pragma include "common"\nfloat scale = PI / u_Size;\nfloat pattern(float u_Angle, vec2 texSize, vec2 texCoord) {\nfloat s = sin(u_Angle), c = cos(u_Angle);\nvec2 tex = texCoord * texSize - u_Center * texSize;\nvec2 point = vec2(\nc * tex.x - s * tex.y,\ns * tex.x + c * tex.y\n) * scale;\nreturn (sin(point.x) * sin(point.y)) * 4.0;\n}\nvec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\nvec3 cmy = 1.0 - color.rgb;\nfloat k = min(cmy.x, min(cmy.y, cmy.z));\ncmy = (cmy - k) / (1.0 - k);\ncmy = clamp(\ncmy * 10.0 - 3.0 + vec3(\npattern(u_Angle + 0.26179, texSize, texCoord),\npattern(u_Angle + 1.30899, texSize, texCoord),\npattern(u_Angle, texSize, texCoord)\n),\n0.0,\n1.0\n);\nk = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);\nreturn vec4(1.0 - cmy - k, color.a);\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);\n}'});var e=this.shaderModuleService.getModule("colorhalftone-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),a=i.width,o=i.height;return{vs:t,fs:n,uniforms:v(v({},r),{},{u_ViewportSize:[a,o]})}}}]),n}($O))||zO,aP="varying vec2 v_UV;\nuniform sampler2D u_Texture;\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}",oP=Qx()(jO=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.apply(this,arguments)}return x(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Lk,fs:aP}),this.shaderModuleService.getModule("copy-pass")}}]),n}($O))||jO,sP=Qx()(VO=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.apply(this,arguments)}return x(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Lk,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Scale : 10;\nvec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\nvec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;\ntex.y /= 0.866025404;\ntex.x -= tex.y * 0.5;\nvec2 a;\nif (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\na = vec2(floor(tex.x), floor(tex.y));\n}\nelse a = vec2(ceil(tex.x), ceil(tex.y));\nvec2 b = vec2(ceil(tex.x), floor(tex.y));\nvec2 c = vec2(floor(tex.x), ceil(tex.y));\nvec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\nvec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\nvec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\nvec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\nfloat alen = length(TEX - A);\nfloat blen = length(TEX - B);\nfloat clen = length(TEX - C);\nvec2 choice;\nif (alen < blen) {\nif (alen < clen) choice = a;\nelse choice = c;\n} else {\nif (blen < clen) choice = b;\nelse choice = c;\n}\nchoice.x += choice.y * 0.5;\nchoice.y *= 0.866025404;\nchoice *= u_Scale / texSize;\nreturn texture2D(texture, choice + u_Center);\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("hexagonalpixelate-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),a=i.width,o=i.height;return{vs:t,fs:n,uniforms:v(v({},r),{},{u_ViewportSize:[a,o]})}}}]),n}($O))||VO,uP=Qx()(GO=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.apply(this,arguments)}return x(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Lk,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_Strength : 0.6;\nvec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\nvec2 dx = vec2(1.0 / texSize.x, 0.0);\nvec2 dy = vec2(0.0, 1.0 / texSize.y);\nvec4 color = texture2D(texture, texCoord);\nfloat bigTotal = 0.0;\nfloat smallTotal = 0.0;\nvec3 bigAverage = vec3(0.0);\nvec3 smallAverage = vec3(0.0);\nfor (float x = -2.0; x <= 2.0; x += 1.0) {\nfor (float y = -2.0; y <= 2.0; y += 1.0) {\nvec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\nbigAverage += sample;\nbigTotal += 1.0;\nif (abs(x) + abs(y) < 2.0) {\nsmallAverage += sample;\nsmallTotal += 1.0;\n}\n}\n}\nvec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\nfloat power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;\nreturn vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("ink-pass"),t=e.vs,n=e.fs,r=e.uniforms,i=this.rendererService.getViewportSize(),a=i.width,o=i.height;return{vs:t,fs:n,uniforms:v(v({},r),{},{u_ViewportSize:[a,o]})}}}]),n}($O))||GO,lP=Qx()(HO=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.apply(this,arguments)}return x(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:Lk,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\nfloat rand(vec2 co) {\nreturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\nvec4 noise_filterColor(vec4 color, vec2 texCoord) {\nfloat diff = (rand(texCoord) - 0.5) * u_Amount;\ncolor.r += diff;\ncolor.g += diff;\ncolor.b += diff;\nreturn color;\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = noise_filterColor(gl_FragColor, v_UV);\n}"}),this.shaderModuleService.getModule("noise-pass")}}]),n}($O))||HO,cP=Qx()(WO=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.apply(this,arguments)}return x(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Lk,fs:"varying vec2 v_UV;\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\nvec4 sepia_filterColor(vec4 color) {\nfloat r = color.r;\nfloat g = color.g;\nfloat b = color.b;\ncolor.r =\nmin(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));\ncolor.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));\ncolor.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));\nreturn color;\n}\nvoid main() {\ngl_FragColor = vec4(texture2D(u_Texture, v_UV));\ngl_FragColor = sepia_filterColor(gl_FragColor);\n}"}),this.shaderModuleService.getModule("sepia-pass")}}]),n}($O))||WO,hP=On.f,fP=$((function(){hP(1)}));er({target:"Object",stat:!0,forced:!Ie||fP,sham:!Ie},{getOwnPropertyDescriptor:function(e,t){return hP(wn(e),t)}});var pP,dP,vP,gP,mP,yP,_P=(XO=Qx(),YO=Kx(YE.IRendererService),ZO=qx(),XO((QO=j((KO=function(){function t(){_(this,t),z(this,"rendererService",QO,this),E(this,"passes",[]),E(this,"readFBO",void 0),E(this,"writeFBO",void 0)}var n,r;return x(t,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var e=this.rendererService,t=e.getViewportSize,n=e.createTexture2D,r=t();return n({x:0,y:0,width:r.width,height:r.height,copy:!0})}},{key:"getReadFBOTex",value:function(){var e=this,t=this.rendererService.useFramebuffer;return new Promise((function(n,r){t(e.readFBO,y(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n(e.getCurrentFBOTex());case 1:case"end":return t.stop()}}),t)}))))}))}},{key:"renderBloomPass",value:(r=y(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getReadFBOTex();case 2:r=e.sent,i=0;case 4:if(!(i<4)){e.next=11;break}return e.next=7,n.render(t,r);case 7:this.swap(),i++,e.next=4;break;case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"render",value:(n=y(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.passes.length)){e.next=15;break}if((r=this.passes[n]).setRenderToScreen(this.isLastEnabledPass(n)),"bloom"!==r.getName()){e.next=9;break}return e.next=7,this.renderBloomPass(t,r);case 7:e.next=12;break;case 9:return e.next=11,r.render(t);case 11:n!==this.passes.length-1&&this.swap();case 12:n++,e.next=1;break;case 15:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"resize",value:function(e,t){this.readFBO.resize({width:e,height:t}),this.writeFBO.resize({width:e,height:t})}},{key:"add",value:function(e,t,n){e.init(t,n),this.passes.push(e)}},{key:"insert",value:function(e,t,n,r){e.init(n,r),this.passes.splice(t,0,e)}},{key:"getPostProcessingPassByName",value:function(e){return this.passes.find((function(t){return t.getName()===e}))}},{key:"init",value:function(){var t=this.rendererService,n=t.createFramebuffer,r=t.createTexture2D;this.readFBO=n({color:r({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.writeFBO=n({color:r({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].isEnabled())return!1;return!0}},{key:"swap",value:function(){var e=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=e}}]),t}()).prototype,"rendererService",[YO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j(KO.prototype,"init",[ZO],Object.getOwnPropertyDescriptor(KO.prototype,"init"),KO.prototype),qO=KO))||qO),bP=Qx()(pP=function(t){S(r,t);var n=R(r);function r(){return _(this,r),n.apply(this,arguments)}return x(r,[{key:"getType",value:function(){return e.PassType.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(e,t){I(C(r.prototype),"init",this).call(this,e,t)}},{key:"render",value:function(e){var t=this.rendererService,n=t.useFramebuffer,r=t.clear,i=e.multiPassRenderer.getPostProcessor().getReadFBO();n(i,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i}),e.multiPassRenderer.setRenderFlag(!1),e.models.forEach((function(t){t.draw({uniforms:e.layerModel.getUninforms()})})),e.multiPassRenderer.setRenderFlag(!0)}))}}]),r}(kk))||pP;function xP(e,t){for(var n=0,r=1/t,i=e;i>0;)n+=r*(i%t),i=Math.floor(i/t),r/=t;return n}var EP=1,SP=(dP=Qx(),vP=Kx(YE.IShaderModuleService),dP((yP=j((mP=function(t){S(r,t);var n=R(r);function r(){var e;_(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return z(O(e=n.call.apply(n,[this].concat(i))),"shaderModuleService",yP,O(e)),E(O(e),"haltonSequence",[]),E(O(e),"accumulatingId",0),E(O(e),"frame",0),E(O(e),"timer",void 0),E(O(e),"sampleRenderTarget",void 0),E(O(e),"prevRenderTarget",void 0),E(O(e),"outputRenderTarget",void 0),E(O(e),"copyRenderTarget",void 0),E(O(e),"blendModel",void 0),E(O(e),"outputModel",void 0),E(O(e),"copyModel",void 0),e}return x(r,[{key:"getType",value:function(){return e.PassType.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(t,n){I(C(r.prototype),"init",this).call(this,t,n);var i=this.rendererService,a=i.createFramebuffer,o=i.createTexture2D;this.sampleRenderTarget=a({color:o({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=a({color:o({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=a({color:o({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=a({color:o({width:1,height:1,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE})});for(var s=0;s<30;s++)this.haltonSequence.push([xP(s,2),xP(s,3)]);this.blendModel=this.createTriangleModel("blend-pass","uniform float u_opacity : 1.0;\nuniform float u_MixRatio : 0.5;\nuniform sampler2D u_Diffuse1;\nuniform sampler2D u_Diffuse2;\nvarying vec2 v_UV;\nvoid main() {\nvec4 texel1 = texture2D(u_Diffuse1, v_UV);\nvec4 texel2 = texture2D(u_Diffuse2, v_UV);\ngl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);\n}"),this.outputModel=this.createTriangleModel("copy-pass",aP,{blend:{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:e.gl.ONE,dstAlpha:e.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:e.gl.FUNC_ADD,alpha:e.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",aP)}},{key:"render",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,a=n.useFramebuffer,o=i(),s=o.width,u=o.height;this.sampleRenderTarget.resize({width:s,height:u}),this.prevRenderTarget.resize({width:s,height:u}),this.outputRenderTarget.resize({width:s,height:u}),this.copyRenderTarget.resize({width:s,height:u}),this.resetFrame(),this.stopAccumulating();var l=e.multiPassRenderer.getPostProcessor().getReadFBO();a(l,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l}),e.multiPassRenderer.setRenderFlag(!1),e.render(),e.multiPassRenderer.setRenderFlag(!0)}));this.accumulatingId=EP++,this.timer=Ed.setTimeout((function(){!function n(r){t.accumulatingId&&r===t.accumulatingId&&(t.isFinished()||(t.doRender(e),Ed.requestAnimationFrame((function(){n(r)}))))}(t.accumulatingId)}),50)}},{key:"doRender",value:function(e){var t=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,a=n.useFramebuffer,o=i(),s=o.width,u=o.height,l=e.getLayerConfig().jitterScale,c=void 0===l?1:l,h=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((2*h[0]-1)/s*c,(2*h[1]-1)/u*c),e.multiPassRenderer.setRenderFlag(!1),e.hooks.beforeRender.call(),a(this.sampleRenderTarget,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:t.sampleRenderTarget}),e.render()})),e.hooks.afterRender.call(),e.multiPassRenderer.setRenderFlag(!0);var f=e.getLayerConfig();a(this.outputRenderTarget,(function(){t.blendModel.draw({uniforms:{u_opacity:f.opacity||1,u_MixRatio:0===t.frame?1:.9,u_Diffuse1:t.sampleRenderTarget,u_Diffuse2:0===t.frame?e.multiPassRenderer.getPostProcessor().getReadFBO():t.prevRenderTarget}})})),0===this.frame&&r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(a(this.copyRenderTarget,(function(){t.outputModel.draw({uniforms:{u_Texture:t.outputRenderTarget}})})),a(e.multiPassRenderer.getPostProcessor().getReadFBO(),(function(){t.copyModel.draw({uniforms:{u_Texture:t.copyRenderTarget}})})),e.multiPassRenderer.getPostProcessor().render(e));var p=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=p,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,Ed.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(t,n,r){this.shaderModuleService.registerModule(t,{vs:Lk,fs:n});var i=this.shaderModuleService.getModule(t),a=i.vs,o=i.fs,s=i.uniforms,u=this.rendererService,l=u.createAttribute,c=u.createBuffer;return(0,u.createModel)(v({vs:a,fs:o,attributes:{a_Position:l({buffer:c({data:[-4,-4,4,-4,0,4],type:e.gl.FLOAT}),size:2})},uniforms:v({},s),depth:{enable:!1},count:3},r))}}]),r}(kk)).prototype,"shaderModuleService",[vP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gP=mP))||gP),CP=new Jx;CP.bind(YE.IGlobalConfigService).to(tM).inSingletonScope(),Zx(Qx(),jb),CP.bind(YE.IEventEmitter).to(jb);var TP=eE(CP,!1),AP=function(e){var t=TP.lazyInject(e);return function(e,n,r){t.call(this,e,n),r&&(r.initializer=function(){return e[n]})}},MP=0;function wP(){var e=new Jx;return e.parent=CP,e.bind(YE.SceneID).toConstantValue("".concat(MP++)),e.bind(YE.IShaderModuleService).to(xk).inSingletonScope(),e.bind(YE.ILayerService).to(tw).inSingletonScope(),e.bind(YE.ISceneService).to(Kw).inSingletonScope(),e.bind(YE.ICameraService).to(YA).inSingletonScope(),e.bind(YE.ICoordinateSystemService).to(AM).inSingletonScope(),e.bind(YE.IInteractionService).to(jM).inSingletonScope(),e.bind(YE.IPickingService).to($M).inSingletonScope(),e.bind(YE.IControlService).to(ZA).inSingletonScope(),e.bind(YE.IMarkerService).to(qA).inSingletonScope(),e.bind(YE.IIconService).to(OT).inSingletonScope(),e.bind(YE.IFontService).to(uS).inSingletonScope(),e.bind(YE.IPopupService).to(KA).inSingletonScope(),e.bind(YE.INormalPass).to(Ok).whenTargetNamed("clear"),e.bind(YE.INormalPass).to(Rk).whenTargetNamed("pixelPicking"),e.bind(YE.INormalPass).to(bP).whenTargetNamed("render"),e.bind(YE.INormalPass).to(SP).whenTargetNamed("taa"),e.bind(YE.IFactoryNormalPass).toFactory((function(e){return function(t){return e.container.getNamed(YE.INormalPass,t)}})),e.bind(YE.IPostProcessingPass).to(oP).whenTargetNamed("copy"),e.bind(YE.IPostProcessingPass).to(eP).whenTargetNamed("bloom"),e.bind(YE.IPostProcessingPass).to(nP).whenTargetNamed("blurH"),e.bind(YE.IPostProcessingPass).to(rP).whenTargetNamed("blurV"),e.bind(YE.IPostProcessingPass).to(lP).whenTargetNamed("noise"),e.bind(YE.IPostProcessingPass).to(cP).whenTargetNamed("sepia"),e.bind(YE.IPostProcessingPass).to(iP).whenTargetNamed("colorHalftone"),e.bind(YE.IPostProcessingPass).to(sP).whenTargetNamed("hexagonalPixelate"),e.bind(YE.IPostProcessingPass).to(uP).whenTargetNamed("ink"),e.bind(YE.IFactoryPostProcessingPass).toFactory((function(e){return function(t){var n=e.container.getNamed(YE.IPostProcessingPass,t);return n.setName(t),n}})),e}function kP(e){var t=new Jx;return t.parent=e,t.bind(YE.IStyleAttributeService).to(fw).inSingletonScope(),t.bind(YE.IMultiPassRenderer).to(Pk).inSingletonScope(),t.bind(YE.IPostProcessor).to(_P).inSingletonScope(),t}var OP=function(e,t,n){return e==e&&(void 0!==n&&(e=e<=n?e:n),void 0!==t&&(e=e>=t?e:t)),e},PP=/\s/;var RP=function(e){for(var t=e.length;t--&&PP.test(e.charAt(t)););return t},LP=/^\s+/;var IP=function(e){return e?e.slice(0,RP(e)+1).replace(LP,""):e},NP=/^[-+]0x[0-9a-f]+$/i,DP=/^0b[01]+$/i,FP=/^0o[0-7]+$/i,BP=parseInt;var UP=function(e){if("number"==typeof e)return e;if(Jk(e))return NaN;if(gm(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=gm(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=IP(e);var n=DP.test(e);return n||FP.test(e)?BP(e.slice(2),n?2:8):NP.test(e)?NaN:+e};var zP=function(e,t,n){return void 0===n&&(n=t,t=void 0),void 0!==n&&(n=(n=UP(n))==n?n:0),void 0!==t&&(t=(t=UP(t))==t?t:0),OP(UP(e),t,n)},jP=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"];function VP(e){return jP.indexOf(e)}var GP,HP,WP,XP;function YP(e,t){return 256*(e=zP(Math.floor(e),0,255))+(t=zP(Math.floor(t),0,255))}(GP=e.BlendType||(e.BlendType={})).normal="normal",GP.additive="additive",GP.subtractive="subtractive",GP.min="min",GP.max="max",GP.none="none",(HP=e.ScaleTypes||(e.ScaleTypes={})).LINEAR="linear",HP.POWER="power",HP.LOG="log",HP.IDENTITY="identity",HP.TIME="time",HP.QUANTILE="quantile",HP.QUANTIZE="quantize",HP.THRESHOLD="threshold",HP.CAT="cat",(WP=e.StyleScaleType||(e.StyleScaleType={})).CONSTANT="constant",WP.VARIABLE="variable",(XP=e.AttributeType||(e.AttributeType={}))[XP.Attribute=0]="Attribute",XP[XP.InstancedAttribute=1]="InstancedAttribute",XP[XP.Uniform=2]="Uniform";var ZP,qP=["mapload","mapchange","mapAfterFrameChange"],KP={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},QP=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];(ZP=e.PositionType||(e.PositionType={})).TOPRIGHT="topright",ZP.TOPLEFT="topleft",ZP.BOTTOMRIGHT="bottomright",ZP.BOTTOMLEFT="bottomleft",ZP.TOPCENTER="topcenter",ZP.BOTTOMCENTER="bottomcenter",ZP.LEFTCENTER="leftcenter",ZP.RIGHTCENTER="rightcenter";var JP=0,$P=function(t){S(r,t);var n=R(r);function r(e){var t;return _(this,r),E(O(t=n.call(this)),"controlOption",void 0),E(O(t),"container",void 0),E(O(t),"sceneContainer",void 0),E(O(t),"mapsService",void 0),E(O(t),"renderService",void 0),E(O(t),"layerService",void 0),E(O(t),"controlService",void 0),E(O(t),"isShow",void 0),t.controlOption=v(v({},t.getDefault()),e||{}),t}return x(r,[{key:"getDefault",value:function(){return{position:e.PositionType.TOPRIGHT,name:"".concat(JP++)}}},{key:"setPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.PositionType.BOTTOMRIGHT,n=this.controlService;return n&&n.removeControl(this),this.controlOption.position=t,n&&n.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(e){this.mapsService=e.get(YE.IMapService),this.renderService=e.get(YE.IRendererService),this.layerService=e.get(YE.ILayerService),this.controlService=e.get(YE.IControlService),this.sceneContainer=e,this.isShow=!0,this.container=this.onAdd();var t=this.container,n=this.controlOption.position,r=this.controlService.controlCorners[n];return Od(t,"l7-control"),-1!==n.indexOf("bottom")?r.insertBefore(t,r.firstChild):r.appendChild(t),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){Od(this.container,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){Pd(this.container,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;kd(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(e){if(this.mapsService&&e&&e.screenX>0&&e.screenY>0){var t=this.mapsService.getContainer();null!==t&&t.focus()}}}]),r}(jb),eR=function(t){S(r,t);var n=R(r);function r(e){var t;return _(this,r),E(O(t=n.call(this,e)),"layerControlInputs",void 0),E(O(t),"layers",void 0),E(O(t),"lastZIndex",void 0),E(O(t),"handlingClick",void 0),E(O(t),"layersLink",void 0),E(O(t),"baseLayersList",void 0),E(O(t),"separator",void 0),E(O(t),"overlaysList",void 0),E(O(t),"form",void 0),t.layerControlInputs=[],t.layers=[],t.lastZIndex=0,t.handlingClick=!1,t.initLayers(),Dv(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],O(t)),t}return x(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:e.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var e=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach((function(t){t.layer.on("remove",e.onLayerChange),t.layer.on("add",e.onLayerChange)})),this.container}},{key:"addVisualLayer",value:function(e,t){return this.addLayer(e,t,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var e=this.renderService.getViewportSize().height;Od(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var t=e-(this.container.offsetTop+50);return t<this.form.clientHeight?(Od(this.form,"l7-control-layers-scrollbar"),this.form.style.height=t+"px"):Pd(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Pd(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var e=this;this.mapsService&&(this.mapsService.off("click",this.collapse),this.layers.forEach((function(t){t.layer.off("remove",e.onLayerChange),t.layer.off("add",e.onLayerChange)})))}},{key:"initLayout",value:function(){var e="l7-control-layers",t=this.container=wd("div",e),n=this.controlOption.collapsed;t.setAttribute("aria-haspopup","true");var r=this.form=wd("form",e+"-list");n&&(this.mapsService.on("click",this.collapse),t.addEventListener("mouseenter",this.expand),t.addEventListener("mouseleave",this.collapse)),this.layersLink=wd("a",e+"-toggle",t),this.layersLink.title="Layers",n||this.expand(),this.baseLayersList=wd("div",e+"-base",r),this.separator=wd("div",e+"-separator",r),this.overlaysList=wd("div",e+"-overlays",r),t.appendChild(r)}},{key:"initLayers",value:function(){var e=this,t=this.controlOption,n=t.baseLayers,r=void 0===n?{}:n,i=t.overlayers,a=void 0===i?{}:i;Object.keys(r).forEach((function(t,n){e.addLayer(r[t],t,!1)})),Object.keys(a).forEach((function(t,n){e.addLayer(a[t],t,!0)}))}},{key:"update",value:function(){if(!this.container)return this;var e,t,n,r;Nd(this.baseLayersList),Nd(this.overlaysList),this.layerControlInputs=[];var i=0;for(n=0;n<this.layers.length;n++)r=this.layers[n],this.addItem(r),t=t||r.overlay,e=e||!r.overlay,i+=r.overlay?0:1;return this.controlOption.hideSingleBase&&(e=e&&i>1,this.baseLayersList.style.display=e?"":"none"),this.separator.style.display=t&&e?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var e,t,n=this.layerControlInputs,r=this.mapsService.getZoom(),i=n.length-1;i>=0;i--)if(e=n[i],(t=this.layerService.getLayer(e.layerId))&&t.inited){var a=t.getMinZoom(),o=t.getMaxZoom();e.disabled=r<a||r>o}}},{key:"addLayer",value:function(e,t,n){this.mapsService&&(e.on("add",this.onLayerChange),e.on("remove",this.onLayerChange)),this.layers.push({layer:e,name:t,overlay:n});var r=this.controlOption,i=r.sortLayers,a=r.sortFunction,o=r.autoZIndex;i&&this.layers.sort((function(e,t){return a(e.layer,t.layer,e.name,t.name)})),o&&e.setZIndex&&(this.lastZIndex++,e.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(e){this.handlingClick||this.update();var t=this.layerService.getLayer(e.target.layerId),n=null!=t&&t.overlay?"add"===e.type?"overlayadd":"overlayremove":"add"===e.type?"baselayerchange":null;n&&this.emit(n,t)}},{key:"createRadioElement",value:function(e,t){var n='<input type="radio" class="l7-control-layers-selector" name="'+e+'"'+(t?' checked="checked"':"")+"/>",r=document.createElement("div");return r.innerHTML=n,r.firstChild}},{key:"addItem",value:function(e){var t,n=document.createElement("label"),r=this.layerService.getLayer(e.layer.id),i=r&&r.inited&&e.layer.isVisible();e.overlay?((t=document.createElement("input")).type="checkbox",t.className="l7-control-layers-selector",t.defaultChecked=i):t=this.createRadioElement("l7-base-layers",i),this.layerControlInputs.push(t),t.layerId=e.layer.id,t.addEventListener("click",this.onInputClick);var a=document.createElement("span");a.innerHTML=" "+e.name;var o=document.createElement("div");return n.appendChild(o),o.appendChild(t),o.appendChild(a),(e.overlay?this.overlaysList:this.baseLayersList).appendChild(n),this.checkDisabledLayers(),n}},{key:"onInputClick",value:function(){var e,t,n=this.layerControlInputs,r=[],i=[];this.handlingClick=!0;for(var a=n.length-1;a>=0;a--)e=n[a],t=this.layerService.getLayer(e.layerId),e.checked?r.push(t):e.checked||i.push(t);i.forEach((function(e){e.hide()})),r.forEach((function(e){e.show()})),this.handlingClick=!1}}]),r}($P),tR=function(t){S(r,t);var n=R(r);function r(){return _(this,r),n.apply(this,arguments)}return x(r,[{key:"getDefault",value:function(){return{position:e.PositionType.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var e=wd("div","l7-control-logo"),t=wd("a","l7-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://antv.alipay.com/l7",t.setAttribute("aria-label","AntV logo"),t.setAttribute("rel","noopener nofollow"),e.appendChild(t),e}},{key:"onRemove",value:function(){return null}}]),r}($P),nR=function(t){S(r,t);var n=R(r);function r(e){var t;return _(this,r),E(O(t=n.call(this,e)),"mScale",void 0),E(O(t),"iScale",void 0),Dv(["update"],O(t)),t}return x(r,[{key:"getDefault",value:function(){return{position:e.PositionType.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var e=wd("div","l7-control-scale");this.addScales("l7-control-scale-line",e);var t=this.controlOption.updateWhenIdle;return this.mapsService.on(t?"moveend":"mapmove",this.update),this.mapsService.on(t?"zoomend":"zoomchange",this.update),this.update(),e}},{key:"onRemove",value:function(){var e=this.controlOption.updateWhenIdle;this.mapsService.off(e?"zoomend":"zoomchange",this.update),this.mapsService.off(e?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var e=this.mapsService,t=this.controlOption.maxWidth,n=e.getSize()[1]/2,r=e.containerToLngLat([0,n]),i=e.containerToLngLat([t,n]),a=wv([r.lng,r.lat],[i.lng,i.lat]);this.updateScales(a)}},{key:"updateScales",value:function(e){var t=this.controlOption,n=t.metric,r=t.imperial;n&&e&&this.updateMetric(e),r&&e&&this.updateImperial(e)}},{key:"updateMetric",value:function(e){var t=this.getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this.updateScale(this.mScale,n,t/e)}},{key:"updateImperial",value:function(e){var t,n,r,i=3.2808399*e;i>5280?(t=i/5280,n=this.getRoundNum(t),this.updateScale(this.iScale,n+" mi",n/t)):(r=this.getRoundNum(i),this.updateScale(this.iScale,r+" ft",r/i))}},{key:"updateScale",value:function(e,t,n){var r=this.controlOption.maxWidth;e.style.width=Math.round(r*n)+"px",e.innerHTML=t}},{key:"getRoundNum",value:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return t*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}},{key:"addScales",value:function(e,t){var n=this.controlOption,r=n.metric,i=n.imperial;r&&(this.mScale=wd("div",e,t)),i&&(this.iScale=wd("div",e,t))}}]),r}($P),rR=function(t){S(r,t);var n=R(r);function r(e){var t;return _(this,r),E(O(t=n.call(this,e)),"disabled",void 0),E(O(t),"zoomInButton",void 0),E(O(t),"zoomOutButton",void 0),Dv(["updateDisabled","zoomIn","zoomOut"],O(t)),t}return x(r,[{key:"getDefault",value:function(){return{position:e.PositionType.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var e=wd("div","l7-control-zoom l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-control-zoom-in",e,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-control-zoom-out",e,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),e}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(e,t,n,r,i){var a=wd("a",n,r);return a.innerHTML=e,a.title=t,a.href="javascript:void(0)",a.addEventListener("click",i),a}},{key:"updateDisabled",value:function(){var e=this.mapsService;Pd(this.zoomInButton,"l7-disabled"),Pd(this.zoomOutButton,"l7-disabled"),(this.disabled||e.getZoom()<=e.getMinZoom())&&Od(this.zoomOutButton,"l7-disabled"),(this.disabled||e.getZoom()>=e.getMaxZoom())&&Od(this.zoomInButton,"l7-disabled")}}]),r}($P),iR=/"/g,aR=ae("".replace),oR=function(e,t,n,r){var i=Ia(se(e)),a="<"+t;return""!==n&&(a+=" "+n+'="'+aR(Ia(r),iR,"&quot;")+'"'),a+">"+i+"</"+t+">"},sR=function(e){return $((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))};er({target:"String",proto:!0,forced:sR("anchor")},{anchor:function(e){return oR(this,"a","name",e)}});var uR=function(t){S(r,t);var n=R(r);function r(e){var t;return _(this,r),E(O(t=n.call(this)),"markerOption",void 0),E(O(t),"defaultMarker",void 0),E(O(t),"popup",void 0),E(O(t),"mapsService",void 0),E(O(t),"sceneSerive",void 0),E(O(t),"lngLat",void 0),E(O(t),"scene",void 0),E(O(t),"added",!1),E(O(t),"eventHandle",(function(e){t.emit(e.type,{target:e,data:t.markerOption.extData,lngLat:t.lngLat})})),t.markerOption=v(v({},t.getDefault()),e),Dv(["update","onMove","onUp","addDragHandler","onMapClick"],O(t)),t.init(),t}return x(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:e.anchorType.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(e){this.scene=e,this.mapsService=e.get(YE.IMapService),this.sceneSerive=e.get(YE.ISceneService);var t=this.markerOption,n=t.element;t.draggable;return this.mapsService.getMarkerContainer().appendChild(n),this.registerMarkerEvent(n),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var e=this.markerOption.element;return e&&kd(e),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(e){return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(e){var t=this;if(!this.added)return this.once("added",(function(){t.setElement(e)})),this;var n=this.markerOption.element;return n&&kd(n),this.markerOption.element=e,this.init(),this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.update(),this}},{key:"openPopup",value:function(){var e=this;if(!this.added)return this.once("added",(function(){e.openPopup()})),this;var t=this.popup;return t?(t.isOpen()||t.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var e=this;this.added||this.once("added",(function(){e.closePopup()}));var t=this.popup;return t&&t.remove(),this}},{key:"setPopup",value:function(e){return this.popup=e,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var e=this.popup;return e?(e.isOpen()?e.remove():e.addTo(this.scene),this):this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(e){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(e){this.markerOption.extData=e}},{key:"update",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.anchor;this.updatePosition(),Fd(t,"".concat(_g[n]))}}},{key:"onMapClick",value:function(e){var t=this.markerOption.element;this.popup&&t&&this.togglePopup()}},{key:"updatePosition",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.offsets,r=this.lngLat,i=r.lng,a=r.lat,o=this.mapsService.getBounds(),s=this.mapsService.lngLatToContainer([i,a]);if(t){t.style.display="block",t.style.whiteSpace="nowrap";var u=this.mapsService.getContainer(),l=0,c=0;if(u&&(l=u.scrollWidth,c=u.scrollHeight),Math.abs(o[0][0])>180||Math.abs(o[1][0])>180){if(s.x>l){var h=this.mapsService.lngLatToContainer([i-360,a]);s.x=h.x}if(s.x<0){var f=this.mapsService.lngLatToContainer([i+360,a]);s.x=f.x}}(s.x>l||s.x<0||s.y>c||s.y<0)&&(t.style.display="none"),t.style.left=s.x+n[0]+"px",t.style.top=s.y-n[1]+"px"}}}},{key:"init",value:function(){var e=this,t=this.markerOption.element,n=this.markerOption,r=n.color,i=n.anchor;if(!t){this.defaultMarker=!0,t=wd("div"),this.markerOption.element=t;var a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height","48px"),a.setAttributeNS(null,"width","48px"),a.setAttributeNS(null,"viewBox","0 0 1024 1024");var o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),o.setAttributeNS(null,"fill",r),a.appendChild(o),t.appendChild(a)}Od(t,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach((function(n){var r,i,a=(null===(r=e.markerOption)||void 0===r?void 0:r.style)&&(null===(i=e.markerOption)||void 0===i?void 0:i.style[n]);t&&(t.style[n]=a)})),t.addEventListener("click",(function(t){e.onMapClick(t)})),t.addEventListener("click",this.eventHandle),bg(t,i,"marker")}},{key:"registerMarkerEvent",value:function(e){e.addEventListener("mousemove",this.eventHandle),e.addEventListener("click",this.eventHandle),e.addEventListener("mousedown",this.eventHandle),e.addEventListener("mouseup",this.eventHandle),e.addEventListener("dblclick",this.eventHandle),e.addEventListener("contextmenu",this.eventHandle),e.addEventListener("mouseover",this.eventHandle),e.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var e=this.getElement();e.removeEventListener("mousemove",this.eventHandle),e.removeEventListener("click",this.eventHandle),e.removeEventListener("mousedown",this.eventHandle),e.removeEventListener("mouseup",this.eventHandle),e.removeEventListener("dblclick",this.eventHandle),e.removeEventListener("contextmenu",this.eventHandle),e.removeEventListener("mouseover",this.eventHandle),e.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(e){throw new Error("Method not implemented.")}},{key:"onUp",value:function(e){throw new Error("Method not implemented.")}}]),r}(jb),lR=function(e){S(n,e);var t=R(n);function n(e){var r,i;return _(this,n),E(O(i=t.call(this)),"markers",[]),E(O(i),"markerLayerOption",void 0),E(O(i),"clusterIndex",void 0),E(O(i),"points",[]),E(O(i),"clusterMarkers",[]),E(O(i),"mapsService",void 0),E(O(i),"scene",void 0),E(O(i),"zoom",void 0),E(O(i),"bbox",void 0),i.markerLayerOption=QA(i.getDefault(),e),Dv(["update"],O(i)),i.zoom=(null===(r=i.markerLayerOption.clusterOption)||void 0===r?void 0:r.zoom)||-99,i}return x(n,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(e){return this.scene=e,this.mapsService=e.get(YE.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(e){this.markerLayerOption.cluster&&this.addPoint(e,this.markers.length),this.markers.push(e)}},{key:"removeMarker",value:function(e){this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}},{key:"hide",value:function(){this.markers.map((function(e){e.getElement().style.opacity="0"})),this.clusterMarkers.map((function(e){e.getElement().style.opacity="0"}))}},{key:"show",value:function(){this.markers.map((function(e){e.getElement().style.opacity="1"})),this.clusterMarkers.map((function(e){e.getElement().style.opacity="1"}))}},{key:"getMarkers",value:function(){return this.markerLayerOption.cluster?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var e=this;this.getMarkers().forEach((function(t){t.addTo(e.scene)}))}},{key:"clear",value:function(){this.markers.forEach((function(e){e.remove()})),this.clusterMarkers.forEach((function(e){e.remove()})),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(e,t){var n=e.getLnglat(),r={geometry:{type:"Point",coordinates:[n.lng,n.lat]},properties:v(v({},e.getExtData()),{},{marker_id:t})};this.points.push(r)}},{key:"initCluster",value:function(){if(this.markerLayerOption.cluster){var e=this.markerLayerOption.clusterOption,t=e.radius,n=e.minZoom,r=void 0===n?0:n,i=e.maxZoom;this.clusterIndex=new Vb({radius:t,minZoom:r,maxZoom:i}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(e,t){var n=this,r=e[0].concat(e[1]),i=this.clusterIndex.getClusters(r,t);this.clusterMarkers.forEach((function(e){e.remove()})),this.clusterMarkers=[],i.forEach((function(e){var t,r=n.markerLayerOption.clusterOption,i=r.field,a=r.method;if(e.properties&&null!==(t=e.properties)&&void 0!==t&&t.cluster_id){var o,s=n.getLeaves(null===(o=e.properties)||void 0===o?void 0:o.cluster_id);if(e.properties.clusterData=s,i&&a){var u=Dg(a,Ng(null==s?void 0:s.map((function(e){return E({},i,e.properties[i])})),i)),l="point_"+a;e.properties[l]=u.toFixed(2)}}var c=n.clusterMarker(e);n.clusterMarkers.push(c),c.addTo(n.scene)}))}},{key:"getLeaves",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e?this.clusterIndex.getLeaves(e,t,n):null}},{key:"clusterMarker",value:function(e){var t=this.markerLayerOption.clusterOption.element,n=void 0===t?this.generateElement.bind(this):t;return new uR({element:n(e)}).setLnglat({lng:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]})}},{key:"normalMarker",value:function(e){var t=e.properties.marker_id;return this.markers[t]}},{key:"update",value:function(){var e=this.mapsService.getZoom(),t=this.mapsService.getBounds();(!this.bbox||Math.abs(e-this.zoom)>=1||!Ov(this.bbox,t))&&(this.bbox=kv(t,.5),this.zoom=Math.floor(e),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(e){var t=wd("div","l7-marker-cluster"),n=wd("div","",t),r=wd("span","",n),i=this.markerLayerOption.clusterOption,a=i.field,o=i.method;e.properties.point_count=e.properties.point_count||1;var s=a&&o?e.properties["point_"+o]||e.properties[a]:e.properties.point_count;return r.textContent=s,t}}]),n}(jb),cR=function(t){S(r,t);var n=R(r);function r(e){var t;return _(this,r),E(O(t=n.call(this)),"popupOption",void 0),E(O(t),"mapsService",void 0),E(O(t),"sceneSerive",void 0),E(O(t),"lngLat",void 0),E(O(t),"content",void 0),E(O(t),"closeButton",void 0),E(O(t),"timeoutInstance",void 0),E(O(t),"container",void 0),E(O(t),"tip",void 0),E(O(t),"scene",void 0),t.popupOption=v(v({},t.getdefault()),e),Dv(["update","onClickClose","remove"],O(t)),t}return x(r,[{key:"addTo",value:function(e){var t=this;return this.mapsService=e.get(YE.IMapService),this.sceneSerive=e.get(YE.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=e,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout((function(){t.mapsService.on("click",t.onClickClose)}),30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(e){var t,n=window.document.createDocumentFragment(),r=window.document.createElement("body");for(r.innerHTML=e;t=r.firstChild;)n.appendChild(t);return this.setDOMContent(n)}},{key:"setLnglat",value:function(e){return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(e){return this.setDOMContent(window.document.createTextNode(e))}},{key:"setMaxWidth",value:function(e){return this.popupOption.maxWidth=e,this.update(),this}},{key:"setDOMContent",value:function(e){return this.createContent(),this.content.appendChild(e),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&kd(this.content),this.content=wd("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=wd("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(e,t,n){var r=window.document.createElement(e);return void 0!==t&&(r.className=t),n&&n.appendChild(r),r}},{key:"removeDom",value:function(e){e.parentNode&&e.parentNode.removeChild(e)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:e.anchorType.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(e){e.stopPropagation&&e.stopPropagation(),this.remove()}},{key:"update",value:function(){var e=this,t=this.lngLat,n=this.popupOption,r=n.className,i=n.maxWidth,a=n.anchor;if(this.mapsService&&t&&this.content){var o=this.mapsService.getMarkerContainer();if(!this.container&&o)this.container=this.creatDom("div","l7-popup",o),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),r&&r.split(" ").forEach((function(t){return e.container.classList.add(t)})),this.popupOption.stopPropagation&&["mousemove","mousedown","mouseup","click","dblclick"].forEach((function(t){e.container.addEventListener(t,(function(e){e.stopPropagation()}))})),this.container.style.whiteSpace="nowrap";i&&this.container.style.maxWidth!==i&&(this.container.style.maxWidth=i),this.updatePosition(),Fd(this.container,"".concat(_g[a])),bg(this.container,a,"popup")}}},{key:"updatePosition",value:function(){if(this.mapsService){var e=this.lngLat,t=e.lng,n=e.lat,r=this.popupOption.offsets,i=this.mapsService.lngLatToContainer([t,n]);this.container.style.left=i.x+r[0]+"px",this.container.style.top=i.y-r[1]+"px"}}}]),r}(jb);function hR(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}hR(".l7-marker-container {\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  position: absolute;\n}\n\n.l7-marker {\n  position: absolute !important;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  cursor: pointer;\n}\n\n.l7-marker-cluster {\n  background-clip: padding-box;\n  border-radius: 20px;\n  background-color: rgba(181, 226, 140, 0.6);\n  width: 40px;\n  height: 40px;\n}\n.l7-marker-cluster div {\n  width: 30px;\n  height: 30px;\n  margin-left: 5px;\n  margin-top: 5px;\n  text-align: center;\n  border-radius: 15px;\n  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  background-color: rgba(110, 204, 57, 0.6);\n}\n.l7-marker-cluster span {\n  line-height: 30px;\n}\n\n.l7-popup-anchor-bottom,\n.l7-popup-anchor-bottom-left,\n.l7-popup-anchor-bottom-right {\n  -webkit-flex-direction: column-reverse;\n  flex-direction: column-reverse;\n}\n\n.l7-popup-close-button {\n  position: absolute;\n  right: 0;\n  top: 0;\n  border: 0;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n  background-color: transparent;\n}\n\n.l7-popup-close-button:hover {\n  background-color: rgba(0, 0, 0, 0.05);\n}\n\n.l7-popup-content {\n  position: relative;\n  background: #fff;\n  border-radius: 3px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  padding: 10px 10px 15px;\n  pointer-events: auto;\n}\n\n/* layers control */\n\n.l7-control-layers {\n  box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);\n  background: #fff;\n  border-radius: 5px;\n}\n.l7-popup-anchor-top,\n.l7-popup-anchor-top-left,\n.l7-popup-anchor-top-right {\n  -webkit-flex-direction: column;\n  flex-direction: column;\n}\n\n.l7-popup-anchor-left {\n  -webkit-flex-direction: row;\n  flex-direction: row;\n}\n\n.l7-popup-anchor-right {\n  -webkit-flex-direction: row-reverse;\n  flex-direction: row-reverse;\n}\n.l7-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  display: -webkit-flex;\n  display: flex;\n  will-change: transform;\n  pointer-events: none;\n  z-index: 5;\n}\n.l7-popup-tip {\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n  z-index: 1;\n}\n.l7-popup-anchor-top .l7-popup-tip {\n  -webkit-align-self: center;\n  align-self: center;\n  border-top: none;\n  border-bottom-color: #fff;\n}\n\n.l7-popup-anchor-top-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  align-self: flex-start;\n  border-top: none;\n  border-left: none;\n  border-bottom-color: #fff;\n}\n\n.l7-popup-anchor-top-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  align-self: flex-end;\n  border-top: none;\n  border-right: none;\n  border-bottom-color: #fff;\n}\n\n.l7-popup-anchor-bottom .l7-popup-tip {\n  -webkit-align-self: center;\n  align-self: center;\n  border-bottom: none;\n  border-top-color: #fff;\n}\n\n.l7-popup-anchor-bottom-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  align-self: flex-start;\n  border-bottom: none;\n  border-left: none;\n  border-top-color: #fff;\n}\n\n.l7-popup-anchor-bottom-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  align-self: flex-end;\n  border-bottom: none;\n  border-right: none;\n  border-top-color: #fff;\n}\n\n.l7-popup-anchor-left .l7-popup-tip {\n  -webkit-align-self: center;\n  align-self: center;\n  border-left: none;\n  border-right-color: #fff;\n}\n\n.l7-popup-anchor-right .l7-popup-tip {\n  -webkit-align-self: center;\n  align-self: center;\n  border-right: none;\n  border-left-color: #fff;\n}\n\n.l7-popup-close-button {\n  position: absolute;\n  right: 0;\n  top: 0;\n  border: 0;\n  padding: 0;\n  font-size: 25px;\n  line-height: 20px;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n  background-color: transparent;\n}\n\n.l7-popup-close-button:hover {\n  background-color: rgba(0, 0, 0, 0.05);\n}\n\n.l7-popup-content {\n  position: relative;\n  background: #fff;\n  border-radius: 3px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  padding: 10px 10px 15px;\n  pointer-events: auto;\n}\n\n.l7-popup-anchor-top-left .l7-popup-content {\n  border-top-left-radius: 0;\n}\n\n.l7-popup-anchor-top-right .l7-popup-content {\n  border-top-right-radius: 0;\n}\n\n.l7-popup-anchor-bottom-left .l7-popup-content {\n  border-bottom-left-radius: 0;\n}\n\n.l7-popup-anchor-bottom-right .l7-popup-content {\n  border-bottom-right-radius: 0;\n}\n\n.l7-popup-track-pointer {\n  display: none;\n}\n\n.l7-popup-track-pointer * {\n  pointer-events: none;\n  user-select: none;\n}\n\n.l7-map:hover .l7-popup-track-pointer {\n  display: flex;\n}\n\n.l7-map:active .l7-popup-track-pointer {\n  display: none;\n}\n\n.l7-popup-close-button:hover {\n  background-color: rgba(0, 0, 0, 0.05);\n}\n\n.l7-popup-content {\n  position: relative;\n  background: #fff;\n  border-radius: 3px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n  padding: 10px 10px 15px;\n  pointer-events: auto;\n}\n\n/* general toolbar styles */\n\n.l7-bar {\n  box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);\n  border-radius: 4px;\n}\n.l7-bar a,\n.l7-bar a:hover {\n  background-color: #fff;\n  width: 30px;\n  height: 30px;\n  font-size: 20px;\n  display: block;\n  text-align: center;\n  text-decoration: none;\n  color: #8e9dab;\n}\n.l7-bar a,\n.l7-control-layers-toggle {\n  background-position: 50% 50%;\n  background-repeat: no-repeat;\n  display: block;\n}\n.l7-bar a:hover {\n  background-color: #f4f4f4;\n}\n.l7-bar a:first-child {\n  border-top-left-radius: 2px;\n  border-top-right-radius: 2px;\n}\n.l7-bar a:last-child {\n  border-bottom-left-radius: 2px;\n  border-bottom-right-radius: 2px;\n  border-bottom: none;\n}\n.l7-bar a.l7-disabled {\n  cursor: default;\n  background-color: #f4f4f4;\n  color: #bbb;\n}\n\n/* control positioning */\n\n.l7-control-container {\n  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;\n}\n.l7-control-hide {\n  display: none;\n}\n.l7-control {\n  position: relative;\n  z-index: 800;\n  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */\n  pointer-events: auto;\n}\n.l7-control {\n  float: left;\n  clear: both;\n}\n.l7-top,\n.l7-bottom {\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-top {\n  top: 0;\n}\n.l7-right {\n  right: 0;\n}\n.l7-bottom {\n  bottom: 0;\n}\n.l7-left {\n  left: 0;\n}\n.l7-center {\n  display: flex;\n  position: absolute;\n  justify-content: center;\n}\n.l7-bottom.l7-center,\n.l7-top.l7-center {\n  width: 100%;\n}\n.l7-right.l7-center,\n.l7-left.l7-center {\n  height: 100%;\n  flex-direction: column;\n}\n\n.l7-top.l7-center,\n.l7-left.l7-center {\n  align-items: flex-start;\n}\n\n.l7-bottom.l7-center,\n.l7-right.l7-center {\n  align-items: flex-end;\n}\n\n.l7-center .l7-control {\n  margin-right: 10px;\n  margin-bottom: 10px;\n}\n\n.l7-control {\n  float: left;\n  clear: both;\n}\n.l7-right .l7-control {\n  float: right;\n}\n.l7-top .l7-control {\n  margin-top: 10px;\n}\n.l7-bottom .l7-control {\n  margin-bottom: 10px;\n}\n.l7-left .l7-control {\n  margin-left: 10px;\n}\n.l7-right .l7-control {\n  margin-right: 10px;\n}\n\n/* attribution and scale controls */\n\n.l7-control-container .l7-control-attribution {\n  background: #fff;\n  background: rgba(59, 58, 58, 0.7);\n  margin: 0;\n}\n.l7-control-attribution,\n.l7-control-scale-line {\n  padding: 0 5px;\n  color: #333;\n}\n.l7-control-attribution a {\n  text-decoration: none;\n}\n.l7-control-attribution a:hover {\n  text-decoration: underline;\n}\n.l7-container .l7-control-attribution,\n.l7-container .l7-control-scale {\n  font-size: 11px;\n  padding: 5px 5px 2px 5px;\n  background: rgba(255, 255, 255, 0.7);\n}\n.l7-left .l7-control-scale {\n  margin-left: 5px;\n}\n.l7-bottom .l7-control-scale {\n  margin-bottom: 5px;\n}\n.l7-control-scale-line {\n  border: 2px solid #000;\n  border-top: none;\n  color: #000;\n  line-height: 1.1;\n  padding: 2px 5px 1px;\n  font-size: 11px;\n  white-space: nowrap;\n  overflow: hidden;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n\n  background: #fff;\n}\n.l7-control-scale-line:not(:first-child) {\n  border-top: 2px solid #777;\n  border-bottom: none;\n  margin-top: -2px;\n}\n.l7-control-scale-line:not(:first-child):not(:last-child) {\n  border-bottom: 2px solid #777;\n}\n\n.l7-touch .l7-control-attribution,\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  box-shadow: none;\n}\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  border: 2px solid rgba(0, 0, 0, 0.2);\n  background-clip: padding-box;\n}\n/*logo */\n\n.l7-ctrl-logo {\n  background-size: 100% 100%;\n  width: 89px;\n  height: 16px;\n  margin: 0 0 -3px -3px;\n  display: flex;\n  background-repeat: no-repeat;\n  cursor: pointer;\n  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');\n}\n\n/* layers control */\n\n.l7-control-layers {\n  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);\n  background: #fff;\n  border-radius: 2px;\n}\n.l7-control-layers-toggle {\n  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');\n  width: 30px;\n  height: 30px;\n  background-size: 20px 20px;\n}\n\n.l7-touch .l7-control-layers-toggle {\n  width: 44px;\n  height: 44px;\n}\n.l7-control-layers .l7-control-layers-list,\n.l7-control-layers-expanded .l7-control-layers-toggle {\n  display: none;\n}\n.l7-control-layers-expanded .l7-control-layers-list {\n  display: block;\n  position: relative;\n}\n.l7-control-layers-expanded {\n  padding: 6px 10px 6px 6px;\n  color: #59626b;\n  background: #fff;\n}\n.l7-control-layers-scrollbar {\n  overflow-y: scroll;\n  overflow-x: hidden;\n  padding-right: 5px;\n}\n.l7-control-layers-selector {\n  margin-top: 2px;\n  position: relative;\n  top: 1px;\n}\n.l7-control-layers label {\n  display: block;\n  padding: 8px;\n}\n.l7-control-layers label input[type='radio'],\n.l7-control-layers label input[type='checkbox'] {\n  width: 14px;\n  height: 14px;\n  margin: 0;\n}\n.l7-control-layers-separator {\n  height: 0;\n  border-top: 1px solid #d8d8d8;\n  margin: 5px -10px 5px -6px;\n}\n.mapboxgl-ctrl-logo {\n  display: none !important;\n}\n.amap-logo {\n  display: none !important;\n}\n");var fR={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},pR="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",dR={5:pR,"5module":pR+" export import",6:pR+" const class extends export import super"},vR=/^in(stanceof)?$/,gR="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࢠ-ࢴࢶ-ࣇऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഄ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄຆ-ຊຌ-ຣລວ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳳᳵᳶᳺᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆿㇰ-ㇿ㐀-䶿一-鿼ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞿꟂ-ꟊꟵ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭩꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",mR="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛࣓-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍୕-ୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ඁ-ඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ຼ່-ໍ໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠐-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᪿᫀᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭᳴᳷-᳹᷀-᷹᷻-᷿‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧ꠬ꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿",yR=new RegExp("["+gR+"]"),_R=new RegExp("["+gR+mR+"]");gR=mR=null;var bR=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],xR=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function ER(e,t){for(var n=65536,r=0;r<t.length;r+=2){if((n+=t[r])>e)return!1;if((n+=t[r+1])>=e)return!0}}function SR(e,t){return e<65?36===e:e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&yR.test(String.fromCharCode(e)):!1!==t&&ER(e,bR)))}function CR(e,t){return e<48?36===e:e<58||!(e<65)&&(e<91||(e<97?95===e:e<123||(e<=65535?e>=170&&_R.test(String.fromCharCode(e)):!1!==t&&(ER(e,bR)||ER(e,xR)))))}var TR=function(e,t){void 0===t&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null};function AR(e,t){return new TR(e,{beforeExpr:!0,binop:t})}var MR={beforeExpr:!0},wR={startsExpr:!0},kR={};function OR(e,t){return void 0===t&&(t={}),t.keyword=e,kR[e]=new TR(e,t)}var PR={num:new TR("num",wR),regexp:new TR("regexp",wR),string:new TR("string",wR),name:new TR("name",wR),eof:new TR("eof"),bracketL:new TR("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new TR("]"),braceL:new TR("{",{beforeExpr:!0,startsExpr:!0}),braceR:new TR("}"),parenL:new TR("(",{beforeExpr:!0,startsExpr:!0}),parenR:new TR(")"),comma:new TR(",",MR),semi:new TR(";",MR),colon:new TR(":",MR),dot:new TR("."),question:new TR("?",MR),questionDot:new TR("?."),arrow:new TR("=>",MR),template:new TR("template"),invalidTemplate:new TR("invalidTemplate"),ellipsis:new TR("...",MR),backQuote:new TR("`",wR),dollarBraceL:new TR("${",{beforeExpr:!0,startsExpr:!0}),eq:new TR("=",{beforeExpr:!0,isAssign:!0}),assign:new TR("_=",{beforeExpr:!0,isAssign:!0}),incDec:new TR("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new TR("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:AR("||",1),logicalAND:AR("&&",2),bitwiseOR:AR("|",3),bitwiseXOR:AR("^",4),bitwiseAND:AR("&",5),equality:AR("==/!=/===/!==",6),relational:AR("</>/<=/>=",7),bitShift:AR("<</>>/>>>",8),plusMin:new TR("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:AR("%",10),star:AR("*",10),slash:AR("/",10),starstar:new TR("**",{beforeExpr:!0}),coalesce:AR("??",1),_break:OR("break"),_case:OR("case",MR),_catch:OR("catch"),_continue:OR("continue"),_debugger:OR("debugger"),_default:OR("default",MR),_do:OR("do",{isLoop:!0,beforeExpr:!0}),_else:OR("else",MR),_finally:OR("finally"),_for:OR("for",{isLoop:!0}),_function:OR("function",wR),_if:OR("if"),_return:OR("return",MR),_switch:OR("switch"),_throw:OR("throw",MR),_try:OR("try"),_var:OR("var"),_const:OR("const"),_while:OR("while",{isLoop:!0}),_with:OR("with"),_new:OR("new",{beforeExpr:!0,startsExpr:!0}),_this:OR("this",wR),_super:OR("super",wR),_class:OR("class",wR),_extends:OR("extends",MR),_export:OR("export"),_import:OR("import",wR),_null:OR("null",wR),_true:OR("true",wR),_false:OR("false",wR),_in:OR("in",{beforeExpr:!0,binop:7}),_instanceof:OR("instanceof",{beforeExpr:!0,binop:7}),_typeof:OR("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:OR("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:OR("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},RR=/\r\n?|\n|\u2028|\u2029/,LR=new RegExp(RR.source,"g");function IR(e,t){return 10===e||13===e||!t&&(8232===e||8233===e)}var NR=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,DR=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,FR=Object.prototype,BR=FR.hasOwnProperty,UR=FR.toString;function zR(e,t){return BR.call(e,t)}var jR=Array.isArray||function(e){return"[object Array]"===UR.call(e)};function VR(e){return new RegExp("^(?:"+e.replace(/ /g,"|")+")$")}var GR=function(e,t){this.line=e,this.column=t};GR.prototype.offset=function(e){return new GR(this.line,this.column+e)};var HR=function(e,t,n){this.start=t,this.end=n,null!==e.sourceFile&&(this.source=e.sourceFile)};function WR(e,t){for(var n=1,r=0;;){LR.lastIndex=r;var i=LR.exec(e);if(!(i&&i.index<t))return new GR(n,t-r);++n,r=i.index+i[0].length}}var XR={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function YR(e){var t={};for(var n in XR)t[n]=e&&zR(e,n)?e[n]:XR[n];if(t.ecmaVersion>=2015&&(t.ecmaVersion-=2009),null==t.allowReserved&&(t.allowReserved=t.ecmaVersion<5),jR(t.onToken)){var r=t.onToken;t.onToken=function(e){return r.push(e)}}return jR(t.onComment)&&(t.onComment=function(e,t){return function(n,r,i,a,o,s){var u={type:n?"Block":"Line",value:r,start:i,end:a};e.locations&&(u.loc=new HR(this,o,s)),e.ranges&&(u.range=[i,a]),t.push(u)}}(t,t.onComment)),t}function ZR(e,t){return 2|(e?4:0)|(t?8:0)}var qR=function(e,t,n){this.options=e=YR(e),this.sourceFile=e.sourceFile,this.keywords=VR(dR[e.ecmaVersion>=6?6:"module"===e.sourceType?"5module":5]);var r="";if(!0!==e.allowReserved){for(var i=e.ecmaVersion;!(r=fR[i]);i--);"module"===e.sourceType&&(r+=" await")}this.reservedWords=VR(r);var a=(r?r+" ":"")+fR.strict;this.reservedWordsStrict=VR(a),this.reservedWordsStrictBind=VR(a+" "+fR.strictBind),this.input=String(t),this.containsEsc=!1,n?(this.pos=n,this.lineStart=this.input.lastIndexOf("\n",n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(RR).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=PR.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===e.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},0===this.pos&&e.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(1),this.regexpState=null},KR={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};qR.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)},KR.inFunction.get=function(){return(2&this.currentVarScope().flags)>0},KR.inGenerator.get=function(){return(8&this.currentVarScope().flags)>0},KR.inAsync.get=function(){return(4&this.currentVarScope().flags)>0},KR.allowSuper.get=function(){return(64&this.currentThisScope().flags)>0},KR.allowDirectSuper.get=function(){return(128&this.currentThisScope().flags)>0},KR.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},qR.prototype.inNonArrowFunction=function(){return(2&this.currentThisScope().flags)>0},qR.extend=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var n=this,r=0;r<e.length;r++)n=e[r](n);return n},qR.parse=function(e,t){return new this(t,e).parse()},qR.parseExpressionAt=function(e,t,n){var r=new this(n,e,t);return r.nextToken(),r.parseExpression()},qR.tokenizer=function(e,t){return new this(t,e)},Object.defineProperties(qR.prototype,KR);var QR=qR.prototype,JR=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;function $R(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}QR.strictDirective=function(e){for(;;){DR.lastIndex=e,e+=DR.exec(this.input)[0].length;var t=JR.exec(this.input.slice(e));if(!t)return!1;if("use strict"===(t[1]||t[2])){DR.lastIndex=e+t[0].length;var n=DR.exec(this.input),r=n.index+n[0].length,i=this.input.charAt(r);return";"===i||"}"===i||RR.test(n[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(i)||"!"===i&&"="===this.input.charAt(r+1))}e+=t[0].length,DR.lastIndex=e,e+=DR.exec(this.input)[0].length,";"===this.input[e]&&e++}},QR.eat=function(e){return this.type===e&&(this.next(),!0)},QR.isContextual=function(e){return this.type===PR.name&&this.value===e&&!this.containsEsc},QR.eatContextual=function(e){return!!this.isContextual(e)&&(this.next(),!0)},QR.expectContextual=function(e){this.eatContextual(e)||this.unexpected()},QR.canInsertSemicolon=function(){return this.type===PR.eof||this.type===PR.braceR||RR.test(this.input.slice(this.lastTokEnd,this.start))},QR.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},QR.semicolon=function(){this.eat(PR.semi)||this.insertSemicolon()||this.unexpected()},QR.afterTrailingComma=function(e,t){if(this.type===e)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),t||this.next(),!0},QR.expect=function(e){this.eat(e)||this.unexpected()},QR.unexpected=function(e){this.raise(null!=e?e:this.start,"Unexpected token")},QR.checkPatternErrors=function(e,t){if(e){e.trailingComma>-1&&this.raiseRecoverable(e.trailingComma,"Comma is not permitted after the rest element");var n=t?e.parenthesizedAssign:e.parenthesizedBind;n>-1&&this.raiseRecoverable(n,"Parenthesized pattern")}},QR.checkExpressionErrors=function(e,t){if(!e)return!1;var n=e.shorthandAssign,r=e.doubleProto;if(!t)return n>=0||r>=0;n>=0&&this.raise(n,"Shorthand property assignments are valid only in destructuring patterns"),r>=0&&this.raiseRecoverable(r,"Redefinition of __proto__ property")},QR.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},QR.isSimpleAssignTarget=function(e){return"ParenthesizedExpression"===e.type?this.isSimpleAssignTarget(e.expression):"Identifier"===e.type||"MemberExpression"===e.type};var eL=qR.prototype;eL.parseTopLevel=function(e){var t={};for(e.body||(e.body=[]);this.type!==PR.eof;){var n=this.parseStatement(null,!0,t);e.body.push(n)}if(this.inModule)for(var r=0,i=Object.keys(this.undefinedExports);r<i.length;r+=1){var a=i[r];this.raiseRecoverable(this.undefinedExports[a].start,"Export '"+a+"' is not defined")}return this.adaptDirectivePrologue(e.body),this.next(),e.sourceType=this.options.sourceType,this.finishNode(e,"Program")};var tL={kind:"loop"},nL={kind:"switch"};eL.isLet=function(e){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;DR.lastIndex=this.pos;var t=DR.exec(this.input),n=this.pos+t[0].length,r=this.input.charCodeAt(n);if(91===r)return!0;if(e)return!1;if(123===r)return!0;if(SR(r,!0)){for(var i=n+1;CR(this.input.charCodeAt(i),!0);)++i;var a=this.input.slice(n,i);if(!vR.test(a))return!0}return!1},eL.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;DR.lastIndex=this.pos;var e=DR.exec(this.input),t=this.pos+e[0].length;return!(RR.test(this.input.slice(this.pos,t))||"function"!==this.input.slice(t,t+8)||t+8!==this.input.length&&CR(this.input.charAt(t+8)))},eL.parseStatement=function(e,t,n){var r,i=this.type,a=this.startNode();switch(this.isLet(e)&&(i=PR._var,r="let"),i){case PR._break:case PR._continue:return this.parseBreakContinueStatement(a,i.keyword);case PR._debugger:return this.parseDebuggerStatement(a);case PR._do:return this.parseDoStatement(a);case PR._for:return this.parseForStatement(a);case PR._function:return e&&(this.strict||"if"!==e&&"label"!==e)&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(a,!1,!e);case PR._class:return e&&this.unexpected(),this.parseClass(a,!0);case PR._if:return this.parseIfStatement(a);case PR._return:return this.parseReturnStatement(a);case PR._switch:return this.parseSwitchStatement(a);case PR._throw:return this.parseThrowStatement(a);case PR._try:return this.parseTryStatement(a);case PR._const:case PR._var:return r=r||this.value,e&&"var"!==r&&this.unexpected(),this.parseVarStatement(a,r);case PR._while:return this.parseWhileStatement(a);case PR._with:return this.parseWithStatement(a);case PR.braceL:return this.parseBlock(!0,a);case PR.semi:return this.parseEmptyStatement(a);case PR._export:case PR._import:if(this.options.ecmaVersion>10&&i===PR._import){DR.lastIndex=this.pos;var o=DR.exec(this.input),s=this.pos+o[0].length,u=this.input.charCodeAt(s);if(40===u||46===u)return this.parseExpressionStatement(a,this.parseExpression())}return this.options.allowImportExportEverywhere||(t||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===PR._import?this.parseImport(a):this.parseExport(a,n);default:if(this.isAsyncFunction())return e&&this.unexpected(),this.next(),this.parseFunctionStatement(a,!0,!e);var l=this.value,c=this.parseExpression();return i===PR.name&&"Identifier"===c.type&&this.eat(PR.colon)?this.parseLabeledStatement(a,l,c,e):this.parseExpressionStatement(a,c)}},eL.parseBreakContinueStatement=function(e,t){var n="break"===t;this.next(),this.eat(PR.semi)||this.insertSemicolon()?e.label=null:this.type!==PR.name?this.unexpected():(e.label=this.parseIdent(),this.semicolon());for(var r=0;r<this.labels.length;++r){var i=this.labels[r];if(null==e.label||i.name===e.label.name){if(null!=i.kind&&(n||"loop"===i.kind))break;if(e.label&&n)break}}return r===this.labels.length&&this.raise(e.start,"Unsyntactic "+t),this.finishNode(e,n?"BreakStatement":"ContinueStatement")},eL.parseDebuggerStatement=function(e){return this.next(),this.semicolon(),this.finishNode(e,"DebuggerStatement")},eL.parseDoStatement=function(e){return this.next(),this.labels.push(tL),e.body=this.parseStatement("do"),this.labels.pop(),this.expect(PR._while),e.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(PR.semi):this.semicolon(),this.finishNode(e,"DoWhileStatement")},eL.parseForStatement=function(e){this.next();var t=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(tL),this.enterScope(0),this.expect(PR.parenL),this.type===PR.semi)return t>-1&&this.unexpected(t),this.parseFor(e,null);var n=this.isLet();if(this.type===PR._var||this.type===PR._const||n){var r=this.startNode(),i=n?"let":this.value;return this.next(),this.parseVar(r,!0,i),this.finishNode(r,"VariableDeclaration"),(this.type===PR._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&1===r.declarations.length?(this.options.ecmaVersion>=9&&(this.type===PR._in?t>-1&&this.unexpected(t):e.await=t>-1),this.parseForIn(e,r)):(t>-1&&this.unexpected(t),this.parseFor(e,r))}var a=new $R,o=this.parseExpression(!0,a);return this.type===PR._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===PR._in?t>-1&&this.unexpected(t):e.await=t>-1),this.toAssignable(o,!1,a),this.checkLVal(o),this.parseForIn(e,o)):(this.checkExpressionErrors(a,!0),t>-1&&this.unexpected(t),this.parseFor(e,o))},eL.parseFunctionStatement=function(e,t,n){return this.next(),this.parseFunction(e,iL|(n?0:aL),!1,t)},eL.parseIfStatement=function(e){return this.next(),e.test=this.parseParenExpression(),e.consequent=this.parseStatement("if"),e.alternate=this.eat(PR._else)?this.parseStatement("if"):null,this.finishNode(e,"IfStatement")},eL.parseReturnStatement=function(e){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(PR.semi)||this.insertSemicolon()?e.argument=null:(e.argument=this.parseExpression(),this.semicolon()),this.finishNode(e,"ReturnStatement")},eL.parseSwitchStatement=function(e){var t;this.next(),e.discriminant=this.parseParenExpression(),e.cases=[],this.expect(PR.braceL),this.labels.push(nL),this.enterScope(0);for(var n=!1;this.type!==PR.braceR;)if(this.type===PR._case||this.type===PR._default){var r=this.type===PR._case;t&&this.finishNode(t,"SwitchCase"),e.cases.push(t=this.startNode()),t.consequent=[],this.next(),r?t.test=this.parseExpression():(n&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),n=!0,t.test=null),this.expect(PR.colon)}else t||this.unexpected(),t.consequent.push(this.parseStatement(null));return this.exitScope(),t&&this.finishNode(t,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(e,"SwitchStatement")},eL.parseThrowStatement=function(e){return this.next(),RR.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),e.argument=this.parseExpression(),this.semicolon(),this.finishNode(e,"ThrowStatement")};var rL=[];eL.parseTryStatement=function(e){if(this.next(),e.block=this.parseBlock(),e.handler=null,this.type===PR._catch){var t=this.startNode();if(this.next(),this.eat(PR.parenL)){t.param=this.parseBindingAtom();var n="Identifier"===t.param.type;this.enterScope(n?32:0),this.checkLVal(t.param,n?4:2),this.expect(PR.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),t.param=null,this.enterScope(0);t.body=this.parseBlock(!1),this.exitScope(),e.handler=this.finishNode(t,"CatchClause")}return e.finalizer=this.eat(PR._finally)?this.parseBlock():null,e.handler||e.finalizer||this.raise(e.start,"Missing catch or finally clause"),this.finishNode(e,"TryStatement")},eL.parseVarStatement=function(e,t){return this.next(),this.parseVar(e,!1,t),this.semicolon(),this.finishNode(e,"VariableDeclaration")},eL.parseWhileStatement=function(e){return this.next(),e.test=this.parseParenExpression(),this.labels.push(tL),e.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(e,"WhileStatement")},eL.parseWithStatement=function(e){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),e.object=this.parseParenExpression(),e.body=this.parseStatement("with"),this.finishNode(e,"WithStatement")},eL.parseEmptyStatement=function(e){return this.next(),this.finishNode(e,"EmptyStatement")},eL.parseLabeledStatement=function(e,t,n,r){for(var i=0,a=this.labels;i<a.length;i+=1){a[i].name===t&&this.raise(n.start,"Label '"+t+"' is already declared")}for(var o=this.type.isLoop?"loop":this.type===PR._switch?"switch":null,s=this.labels.length-1;s>=0;s--){var u=this.labels[s];if(u.statementStart!==e.start)break;u.statementStart=this.start,u.kind=o}return this.labels.push({name:t,kind:o,statementStart:this.start}),e.body=this.parseStatement(r?-1===r.indexOf("label")?r+"label":r:"label"),this.labels.pop(),e.label=n,this.finishNode(e,"LabeledStatement")},eL.parseExpressionStatement=function(e,t){return e.expression=t,this.semicolon(),this.finishNode(e,"ExpressionStatement")},eL.parseBlock=function(e,t,n){for(void 0===e&&(e=!0),void 0===t&&(t=this.startNode()),t.body=[],this.expect(PR.braceL),e&&this.enterScope(0);this.type!==PR.braceR;){var r=this.parseStatement(null);t.body.push(r)}return n&&(this.strict=!1),this.next(),e&&this.exitScope(),this.finishNode(t,"BlockStatement")},eL.parseFor=function(e,t){return e.init=t,this.expect(PR.semi),e.test=this.type===PR.semi?null:this.parseExpression(),this.expect(PR.semi),e.update=this.type===PR.parenR?null:this.parseExpression(),this.expect(PR.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,"ForStatement")},eL.parseForIn=function(e,t){var n=this.type===PR._in;return this.next(),"VariableDeclaration"===t.type&&null!=t.declarations[0].init&&(!n||this.options.ecmaVersion<8||this.strict||"var"!==t.kind||"Identifier"!==t.declarations[0].id.type)?this.raise(t.start,(n?"for-in":"for-of")+" loop variable declaration may not have an initializer"):"AssignmentPattern"===t.type&&this.raise(t.start,"Invalid left-hand side in for-loop"),e.left=t,e.right=n?this.parseExpression():this.parseMaybeAssign(),this.expect(PR.parenR),e.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(e,n?"ForInStatement":"ForOfStatement")},eL.parseVar=function(e,t,n){for(e.declarations=[],e.kind=n;;){var r=this.startNode();if(this.parseVarId(r,n),this.eat(PR.eq)?r.init=this.parseMaybeAssign(t):"const"!==n||this.type===PR._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===r.id.type||t&&(this.type===PR._in||this.isContextual("of"))?r.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),e.declarations.push(this.finishNode(r,"VariableDeclarator")),!this.eat(PR.comma))break}return e},eL.parseVarId=function(e,t){e.id=this.parseBindingAtom(),this.checkLVal(e.id,"var"===t?1:2,!1)};var iL=1,aL=2;eL.parseFunction=function(e,t,n,r){this.initFunction(e),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!r)&&(this.type===PR.star&&t&aL&&this.unexpected(),e.generator=this.eat(PR.star)),this.options.ecmaVersion>=8&&(e.async=!!r),t&iL&&(e.id=4&t&&this.type!==PR.name?null:this.parseIdent(),!e.id||t&aL||this.checkLVal(e.id,this.strict||e.generator||e.async?this.treatFunctionsAsVar?1:2:3));var i=this.yieldPos,a=this.awaitPos,o=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ZR(e.async,e.generator)),t&iL||(e.id=this.type===PR.name?this.parseIdent():null),this.parseFunctionParams(e),this.parseFunctionBody(e,n,!1),this.yieldPos=i,this.awaitPos=a,this.awaitIdentPos=o,this.finishNode(e,t&iL?"FunctionDeclaration":"FunctionExpression")},eL.parseFunctionParams=function(e){this.expect(PR.parenL),e.params=this.parseBindingList(PR.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},eL.parseClass=function(e,t){this.next();var n=this.strict;this.strict=!0,this.parseClassId(e,t),this.parseClassSuper(e);var r=this.startNode(),i=!1;for(r.body=[],this.expect(PR.braceL);this.type!==PR.braceR;){var a=this.parseClassElement(null!==e.superClass);a&&(r.body.push(a),"MethodDefinition"===a.type&&"constructor"===a.kind&&(i&&this.raise(a.start,"Duplicate constructor in the same class"),i=!0))}return this.strict=n,this.next(),e.body=this.finishNode(r,"ClassBody"),this.finishNode(e,t?"ClassDeclaration":"ClassExpression")},eL.parseClassElement=function(e){var t=this;if(this.eat(PR.semi))return null;var n=this.startNode(),r=function(e,r){void 0===r&&(r=!1);var i=t.start,a=t.startLoc;return!!t.eatContextual(e)&&(!(t.type===PR.parenL||r&&t.canInsertSemicolon())||(n.key&&t.unexpected(),n.computed=!1,n.key=t.startNodeAt(i,a),n.key.name=e,t.finishNode(n.key,"Identifier"),!1))};n.kind="method",n.static=r("static");var i=this.eat(PR.star),a=!1;i||(this.options.ecmaVersion>=8&&r("async",!0)?(a=!0,i=this.options.ecmaVersion>=9&&this.eat(PR.star)):r("get")?n.kind="get":r("set")&&(n.kind="set")),n.key||this.parsePropertyName(n);var o=n.key,s=!1;return n.computed||n.static||!("Identifier"===o.type&&"constructor"===o.name||"Literal"===o.type&&"constructor"===o.value)?n.static&&"Identifier"===o.type&&"prototype"===o.name&&this.raise(o.start,"Classes may not have a static property named prototype"):("method"!==n.kind&&this.raise(o.start,"Constructor can't have get/set modifier"),i&&this.raise(o.start,"Constructor can't be a generator"),a&&this.raise(o.start,"Constructor can't be an async method"),n.kind="constructor",s=e),this.parseClassMethod(n,i,a,s),"get"===n.kind&&0!==n.value.params.length&&this.raiseRecoverable(n.value.start,"getter should have no params"),"set"===n.kind&&1!==n.value.params.length&&this.raiseRecoverable(n.value.start,"setter should have exactly one param"),"set"===n.kind&&"RestElement"===n.value.params[0].type&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params"),n},eL.parseClassMethod=function(e,t,n,r){return e.value=this.parseMethod(t,n,r),this.finishNode(e,"MethodDefinition")},eL.parseClassId=function(e,t){this.type===PR.name?(e.id=this.parseIdent(),t&&this.checkLVal(e.id,2,!1)):(!0===t&&this.unexpected(),e.id=null)},eL.parseClassSuper=function(e){e.superClass=this.eat(PR._extends)?this.parseExprSubscripts():null},eL.parseExport=function(e,t){if(this.next(),this.eat(PR.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(e.exported=this.parseIdent(!0),this.checkExport(t,e.exported.name,this.lastTokStart)):e.exported=null),this.expectContextual("from"),this.type!==PR.string&&this.unexpected(),e.source=this.parseExprAtom(),this.semicolon(),this.finishNode(e,"ExportAllDeclaration");if(this.eat(PR._default)){var n;if(this.checkExport(t,"default",this.lastTokStart),this.type===PR._function||(n=this.isAsyncFunction())){var r=this.startNode();this.next(),n&&this.next(),e.declaration=this.parseFunction(r,4|iL,!1,n)}else if(this.type===PR._class){var i=this.startNode();e.declaration=this.parseClass(i,"nullableID")}else e.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(e,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())e.declaration=this.parseStatement(null),"VariableDeclaration"===e.declaration.type?this.checkVariableExport(t,e.declaration.declarations):this.checkExport(t,e.declaration.id.name,e.declaration.id.start),e.specifiers=[],e.source=null;else{if(e.declaration=null,e.specifiers=this.parseExportSpecifiers(t),this.eatContextual("from"))this.type!==PR.string&&this.unexpected(),e.source=this.parseExprAtom();else{for(var a=0,o=e.specifiers;a<o.length;a+=1){var s=o[a];this.checkUnreserved(s.local),this.checkLocalExport(s.local)}e.source=null}this.semicolon()}return this.finishNode(e,"ExportNamedDeclaration")},eL.checkExport=function(e,t,n){e&&(zR(e,t)&&this.raiseRecoverable(n,"Duplicate export '"+t+"'"),e[t]=!0)},eL.checkPatternExport=function(e,t){var n=t.type;if("Identifier"===n)this.checkExport(e,t.name,t.start);else if("ObjectPattern"===n)for(var r=0,i=t.properties;r<i.length;r+=1){var a=i[r];this.checkPatternExport(e,a)}else if("ArrayPattern"===n)for(var o=0,s=t.elements;o<s.length;o+=1){var u=s[o];u&&this.checkPatternExport(e,u)}else"Property"===n?this.checkPatternExport(e,t.value):"AssignmentPattern"===n?this.checkPatternExport(e,t.left):"RestElement"===n?this.checkPatternExport(e,t.argument):"ParenthesizedExpression"===n&&this.checkPatternExport(e,t.expression)},eL.checkVariableExport=function(e,t){if(e)for(var n=0,r=t;n<r.length;n+=1){var i=r[n];this.checkPatternExport(e,i.id)}},eL.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},eL.parseExportSpecifiers=function(e){var t=[],n=!0;for(this.expect(PR.braceL);!this.eat(PR.braceR);){if(n)n=!1;else if(this.expect(PR.comma),this.afterTrailingComma(PR.braceR))break;var r=this.startNode();r.local=this.parseIdent(!0),r.exported=this.eatContextual("as")?this.parseIdent(!0):r.local,this.checkExport(e,r.exported.name,r.exported.start),t.push(this.finishNode(r,"ExportSpecifier"))}return t},eL.parseImport=function(e){return this.next(),this.type===PR.string?(e.specifiers=rL,e.source=this.parseExprAtom()):(e.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),e.source=this.type===PR.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(e,"ImportDeclaration")},eL.parseImportSpecifiers=function(){var e=[],t=!0;if(this.type===PR.name){var n=this.startNode();if(n.local=this.parseIdent(),this.checkLVal(n.local,2),e.push(this.finishNode(n,"ImportDefaultSpecifier")),!this.eat(PR.comma))return e}if(this.type===PR.star){var r=this.startNode();return this.next(),this.expectContextual("as"),r.local=this.parseIdent(),this.checkLVal(r.local,2),e.push(this.finishNode(r,"ImportNamespaceSpecifier")),e}for(this.expect(PR.braceL);!this.eat(PR.braceR);){if(t)t=!1;else if(this.expect(PR.comma),this.afterTrailingComma(PR.braceR))break;var i=this.startNode();i.imported=this.parseIdent(!0),this.eatContextual("as")?i.local=this.parseIdent():(this.checkUnreserved(i.imported),i.local=i.imported),this.checkLVal(i.local,2),e.push(this.finishNode(i,"ImportSpecifier"))}return e},eL.adaptDirectivePrologue=function(e){for(var t=0;t<e.length&&this.isDirectiveCandidate(e[t]);++t)e[t].directive=e[t].expression.raw.slice(1,-1)},eL.isDirectiveCandidate=function(e){return"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"string"==typeof e.expression.value&&('"'===this.input[e.start]||"'"===this.input[e.start])};var oL=qR.prototype;oL.toAssignable=function(e,t,n){if(this.options.ecmaVersion>=6&&e)switch(e.type){case"Identifier":this.inAsync&&"await"===e.name&&this.raise(e.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":e.type="ObjectPattern",n&&this.checkPatternErrors(n,!0);for(var r=0,i=e.properties;r<i.length;r+=1){var a=i[r];this.toAssignable(a,t),"RestElement"!==a.type||"ArrayPattern"!==a.argument.type&&"ObjectPattern"!==a.argument.type||this.raise(a.argument.start,"Unexpected token")}break;case"Property":"init"!==e.kind&&this.raise(e.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(e.value,t);break;case"ArrayExpression":e.type="ArrayPattern",n&&this.checkPatternErrors(n,!0),this.toAssignableList(e.elements,t);break;case"SpreadElement":e.type="RestElement",this.toAssignable(e.argument,t),"AssignmentPattern"===e.argument.type&&this.raise(e.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==e.operator&&this.raise(e.left.end,"Only '=' operator can be used for specifying default value."),e.type="AssignmentPattern",delete e.operator,this.toAssignable(e.left,t);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(e.expression,t,n);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!t)break;default:this.raise(e.start,"Assigning to rvalue")}else n&&this.checkPatternErrors(n,!0);return e},oL.toAssignableList=function(e,t){for(var n=e.length,r=0;r<n;r++){var i=e[r];i&&this.toAssignable(i,t)}if(n){var a=e[n-1];6===this.options.ecmaVersion&&t&&a&&"RestElement"===a.type&&"Identifier"!==a.argument.type&&this.unexpected(a.argument.start)}return e},oL.parseSpread=function(e){var t=this.startNode();return this.next(),t.argument=this.parseMaybeAssign(!1,e),this.finishNode(t,"SpreadElement")},oL.parseRestBinding=function(){var e=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==PR.name&&this.unexpected(),e.argument=this.parseBindingAtom(),this.finishNode(e,"RestElement")},oL.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case PR.bracketL:var e=this.startNode();return this.next(),e.elements=this.parseBindingList(PR.bracketR,!0,!0),this.finishNode(e,"ArrayPattern");case PR.braceL:return this.parseObj(!0)}return this.parseIdent()},oL.parseBindingList=function(e,t,n){for(var r=[],i=!0;!this.eat(e);)if(i?i=!1:this.expect(PR.comma),t&&this.type===PR.comma)r.push(null);else{if(n&&this.afterTrailingComma(e))break;if(this.type===PR.ellipsis){var a=this.parseRestBinding();this.parseBindingListItem(a),r.push(a),this.type===PR.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(e);break}var o=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(o),r.push(o)}return r},oL.parseBindingListItem=function(e){return e},oL.parseMaybeDefault=function(e,t,n){if(n=n||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(PR.eq))return n;var r=this.startNodeAt(e,t);return r.left=n,r.right=this.parseMaybeAssign(),this.finishNode(r,"AssignmentPattern")},oL.checkLVal=function(e,t,n){switch(void 0===t&&(t=0),e.type){case"Identifier":2===t&&"let"===e.name&&this.raiseRecoverable(e.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(e.name)&&this.raiseRecoverable(e.start,(t?"Binding ":"Assigning to ")+e.name+" in strict mode"),n&&(zR(n,e.name)&&this.raiseRecoverable(e.start,"Argument name clash"),n[e.name]=!0),0!==t&&5!==t&&this.declareName(e.name,t,e.start);break;case"ChainExpression":this.raiseRecoverable(e.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":t&&this.raiseRecoverable(e.start,"Binding member expression");break;case"ObjectPattern":for(var r=0,i=e.properties;r<i.length;r+=1){var a=i[r];this.checkLVal(a,t,n)}break;case"Property":this.checkLVal(e.value,t,n);break;case"ArrayPattern":for(var o=0,s=e.elements;o<s.length;o+=1){var u=s[o];u&&this.checkLVal(u,t,n)}break;case"AssignmentPattern":this.checkLVal(e.left,t,n);break;case"RestElement":this.checkLVal(e.argument,t,n);break;case"ParenthesizedExpression":this.checkLVal(e.expression,t,n);break;default:this.raise(e.start,(t?"Binding":"Assigning to")+" rvalue")}};var sL=qR.prototype;sL.checkPropClash=function(e,t,n){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===e.type||this.options.ecmaVersion>=6&&(e.computed||e.method||e.shorthand))){var r,i=e.key;switch(i.type){case"Identifier":r=i.name;break;case"Literal":r=String(i.value);break;default:return}var a=e.kind;if(this.options.ecmaVersion>=6)"__proto__"===r&&"init"===a&&(t.proto&&(n?n.doubleProto<0&&(n.doubleProto=i.start):this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),t.proto=!0);else{var o=t[r="$"+r];if(o)("init"===a?this.strict&&o.init||o.get||o.set:o.init||o[a])&&this.raiseRecoverable(i.start,"Redefinition of property");else o=t[r]={init:!1,get:!1,set:!1};o[a]=!0}}},sL.parseExpression=function(e,t){var n=this.start,r=this.startLoc,i=this.parseMaybeAssign(e,t);if(this.type===PR.comma){var a=this.startNodeAt(n,r);for(a.expressions=[i];this.eat(PR.comma);)a.expressions.push(this.parseMaybeAssign(e,t));return this.finishNode(a,"SequenceExpression")}return i},sL.parseMaybeAssign=function(e,t,n){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(e);this.exprAllowed=!1}var r=!1,i=-1,a=-1;t?(i=t.parenthesizedAssign,a=t.trailingComma,t.parenthesizedAssign=t.trailingComma=-1):(t=new $R,r=!0);var o=this.start,s=this.startLoc;this.type!==PR.parenL&&this.type!==PR.name||(this.potentialArrowAt=this.start);var u=this.parseMaybeConditional(e,t);if(n&&(u=n.call(this,u,o,s)),this.type.isAssign){var l=this.startNodeAt(o,s);return l.operator=this.value,l.left=this.type===PR.eq?this.toAssignable(u,!1,t):u,r||(t.parenthesizedAssign=t.trailingComma=t.doubleProto=-1),t.shorthandAssign>=l.left.start&&(t.shorthandAssign=-1),this.checkLVal(u),this.next(),l.right=this.parseMaybeAssign(e),this.finishNode(l,"AssignmentExpression")}return r&&this.checkExpressionErrors(t,!0),i>-1&&(t.parenthesizedAssign=i),a>-1&&(t.trailingComma=a),u},sL.parseMaybeConditional=function(e,t){var n=this.start,r=this.startLoc,i=this.parseExprOps(e,t);if(this.checkExpressionErrors(t))return i;if(this.eat(PR.question)){var a=this.startNodeAt(n,r);return a.test=i,a.consequent=this.parseMaybeAssign(),this.expect(PR.colon),a.alternate=this.parseMaybeAssign(e),this.finishNode(a,"ConditionalExpression")}return i},sL.parseExprOps=function(e,t){var n=this.start,r=this.startLoc,i=this.parseMaybeUnary(t,!1);return this.checkExpressionErrors(t)||i.start===n&&"ArrowFunctionExpression"===i.type?i:this.parseExprOp(i,n,r,-1,e)},sL.parseExprOp=function(e,t,n,r,i){var a=this.type.binop;if(null!=a&&(!i||this.type!==PR._in)&&a>r){var o=this.type===PR.logicalOR||this.type===PR.logicalAND,s=this.type===PR.coalesce;s&&(a=PR.logicalAND.binop);var u=this.value;this.next();var l=this.start,c=this.startLoc,h=this.parseExprOp(this.parseMaybeUnary(null,!1),l,c,a,i),f=this.buildBinary(t,n,e,h,u,o||s);return(o&&this.type===PR.coalesce||s&&(this.type===PR.logicalOR||this.type===PR.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(f,t,n,r,i)}return e},sL.buildBinary=function(e,t,n,r,i,a){var o=this.startNodeAt(e,t);return o.left=n,o.operator=i,o.right=r,this.finishNode(o,a?"LogicalExpression":"BinaryExpression")},sL.parseMaybeUnary=function(e,t){var n,r=this.start,i=this.startLoc;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))n=this.parseAwait(),t=!0;else if(this.type.prefix){var a=this.startNode(),o=this.type===PR.incDec;a.operator=this.value,a.prefix=!0,this.next(),a.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(e,!0),o?this.checkLVal(a.argument):this.strict&&"delete"===a.operator&&"Identifier"===a.argument.type?this.raiseRecoverable(a.start,"Deleting local variable in strict mode"):t=!0,n=this.finishNode(a,o?"UpdateExpression":"UnaryExpression")}else{if(n=this.parseExprSubscripts(e),this.checkExpressionErrors(e))return n;for(;this.type.postfix&&!this.canInsertSemicolon();){var s=this.startNodeAt(r,i);s.operator=this.value,s.prefix=!1,s.argument=n,this.checkLVal(n),this.next(),n=this.finishNode(s,"UpdateExpression")}}return!t&&this.eat(PR.starstar)?this.buildBinary(r,i,n,this.parseMaybeUnary(null,!1),"**",!1):n},sL.parseExprSubscripts=function(e){var t=this.start,n=this.startLoc,r=this.parseExprAtom(e);if("ArrowFunctionExpression"===r.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd))return r;var i=this.parseSubscripts(r,t,n);return e&&"MemberExpression"===i.type&&(e.parenthesizedAssign>=i.start&&(e.parenthesizedAssign=-1),e.parenthesizedBind>=i.start&&(e.parenthesizedBind=-1)),i},sL.parseSubscripts=function(e,t,n,r){for(var i=this.options.ecmaVersion>=8&&"Identifier"===e.type&&"async"===e.name&&this.lastTokEnd===e.end&&!this.canInsertSemicolon()&&e.end-e.start==5&&this.potentialArrowAt===e.start,a=!1;;){var o=this.parseSubscript(e,t,n,r,i,a);if(o.optional&&(a=!0),o===e||"ArrowFunctionExpression"===o.type){if(a){var s=this.startNodeAt(t,n);s.expression=o,o=this.finishNode(s,"ChainExpression")}return o}e=o}},sL.parseSubscript=function(e,t,n,r,i,a){var o=this.options.ecmaVersion>=11,s=o&&this.eat(PR.questionDot);r&&s&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var u=this.eat(PR.bracketL);if(u||s&&this.type!==PR.parenL&&this.type!==PR.backQuote||this.eat(PR.dot)){var l=this.startNodeAt(t,n);l.object=e,l.property=u?this.parseExpression():this.parseIdent("never"!==this.options.allowReserved),l.computed=!!u,u&&this.expect(PR.bracketR),o&&(l.optional=s),e=this.finishNode(l,"MemberExpression")}else if(!r&&this.eat(PR.parenL)){var c=new $R,h=this.yieldPos,f=this.awaitPos,p=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var d=this.parseExprList(PR.parenR,this.options.ecmaVersion>=8,!1,c);if(i&&!s&&!this.canInsertSemicolon()&&this.eat(PR.arrow))return this.checkPatternErrors(c,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=h,this.awaitPos=f,this.awaitIdentPos=p,this.parseArrowExpression(this.startNodeAt(t,n),d,!0);this.checkExpressionErrors(c,!0),this.yieldPos=h||this.yieldPos,this.awaitPos=f||this.awaitPos,this.awaitIdentPos=p||this.awaitIdentPos;var v=this.startNodeAt(t,n);v.callee=e,v.arguments=d,o&&(v.optional=s),e=this.finishNode(v,"CallExpression")}else if(this.type===PR.backQuote){(s||a)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var g=this.startNodeAt(t,n);g.tag=e,g.quasi=this.parseTemplate({isTagged:!0}),e=this.finishNode(g,"TaggedTemplateExpression")}return e},sL.parseExprAtom=function(e){this.type===PR.slash&&this.readRegexp();var t,n=this.potentialArrowAt===this.start;switch(this.type){case PR._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),t=this.startNode(),this.next(),this.type!==PR.parenL||this.allowDirectSuper||this.raise(t.start,"super() call outside constructor of a subclass"),this.type!==PR.dot&&this.type!==PR.bracketL&&this.type!==PR.parenL&&this.unexpected(),this.finishNode(t,"Super");case PR._this:return t=this.startNode(),this.next(),this.finishNode(t,"ThisExpression");case PR.name:var r=this.start,i=this.startLoc,a=this.containsEsc,o=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!a&&"async"===o.name&&!this.canInsertSemicolon()&&this.eat(PR._function))return this.parseFunction(this.startNodeAt(r,i),0,!1,!0);if(n&&!this.canInsertSemicolon()){if(this.eat(PR.arrow))return this.parseArrowExpression(this.startNodeAt(r,i),[o],!1);if(this.options.ecmaVersion>=8&&"async"===o.name&&this.type===PR.name&&!a)return o=this.parseIdent(!1),!this.canInsertSemicolon()&&this.eat(PR.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,i),[o],!0)}return o;case PR.regexp:var s=this.value;return(t=this.parseLiteral(s.value)).regex={pattern:s.pattern,flags:s.flags},t;case PR.num:case PR.string:return this.parseLiteral(this.value);case PR._null:case PR._true:case PR._false:return(t=this.startNode()).value=this.type===PR._null?null:this.type===PR._true,t.raw=this.type.keyword,this.next(),this.finishNode(t,"Literal");case PR.parenL:var u=this.start,l=this.parseParenAndDistinguishExpression(n);return e&&(e.parenthesizedAssign<0&&!this.isSimpleAssignTarget(l)&&(e.parenthesizedAssign=u),e.parenthesizedBind<0&&(e.parenthesizedBind=u)),l;case PR.bracketL:return t=this.startNode(),this.next(),t.elements=this.parseExprList(PR.bracketR,!0,!0,e),this.finishNode(t,"ArrayExpression");case PR.braceL:return this.parseObj(!1,e);case PR._function:return t=this.startNode(),this.next(),this.parseFunction(t,0);case PR._class:return this.parseClass(this.startNode(),!1);case PR._new:return this.parseNew();case PR.backQuote:return this.parseTemplate();case PR._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},sL.parseExprImport=function(){var e=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var t=this.parseIdent(!0);switch(this.type){case PR.parenL:return this.parseDynamicImport(e);case PR.dot:return e.meta=t,this.parseImportMeta(e);default:this.unexpected()}},sL.parseDynamicImport=function(e){if(this.next(),e.source=this.parseMaybeAssign(),!this.eat(PR.parenR)){var t=this.start;this.eat(PR.comma)&&this.eat(PR.parenR)?this.raiseRecoverable(t,"Trailing comma is not allowed in import()"):this.unexpected(t)}return this.finishNode(e,"ImportExpression")},sL.parseImportMeta=function(e){this.next();var t=this.containsEsc;return e.property=this.parseIdent(!0),"meta"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for import is 'import.meta'"),t&&this.raiseRecoverable(e.start,"'import.meta' must not contain escaped characters"),"module"!==this.options.sourceType&&this.raiseRecoverable(e.start,"Cannot use 'import.meta' outside a module"),this.finishNode(e,"MetaProperty")},sL.parseLiteral=function(e){var t=this.startNode();return t.value=e,t.raw=this.input.slice(this.start,this.end),110===t.raw.charCodeAt(t.raw.length-1)&&(t.bigint=t.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(t,"Literal")},sL.parseParenExpression=function(){this.expect(PR.parenL);var e=this.parseExpression();return this.expect(PR.parenR),e},sL.parseParenAndDistinguishExpression=function(e){var t,n=this.start,r=this.startLoc,i=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var a,o=this.start,s=this.startLoc,u=[],l=!0,c=!1,h=new $R,f=this.yieldPos,p=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==PR.parenR;){if(l?l=!1:this.expect(PR.comma),i&&this.afterTrailingComma(PR.parenR,!0)){c=!0;break}if(this.type===PR.ellipsis){a=this.start,u.push(this.parseParenItem(this.parseRestBinding())),this.type===PR.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}u.push(this.parseMaybeAssign(!1,h,this.parseParenItem))}var d=this.start,v=this.startLoc;if(this.expect(PR.parenR),e&&!this.canInsertSemicolon()&&this.eat(PR.arrow))return this.checkPatternErrors(h,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=f,this.awaitPos=p,this.parseParenArrowList(n,r,u);u.length&&!c||this.unexpected(this.lastTokStart),a&&this.unexpected(a),this.checkExpressionErrors(h,!0),this.yieldPos=f||this.yieldPos,this.awaitPos=p||this.awaitPos,u.length>1?((t=this.startNodeAt(o,s)).expressions=u,this.finishNodeAt(t,"SequenceExpression",d,v)):t=u[0]}else t=this.parseParenExpression();if(this.options.preserveParens){var g=this.startNodeAt(n,r);return g.expression=t,this.finishNode(g,"ParenthesizedExpression")}return t},sL.parseParenItem=function(e){return e},sL.parseParenArrowList=function(e,t,n){return this.parseArrowExpression(this.startNodeAt(e,t),n)};var uL=[];sL.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var e=this.startNode(),t=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(PR.dot)){e.meta=t;var n=this.containsEsc;return e.property=this.parseIdent(!0),"target"!==e.property.name&&this.raiseRecoverable(e.property.start,"The only valid meta property for new is 'new.target'"),n&&this.raiseRecoverable(e.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(e.start,"'new.target' can only be used in functions"),this.finishNode(e,"MetaProperty")}var r=this.start,i=this.startLoc,a=this.type===PR._import;return e.callee=this.parseSubscripts(this.parseExprAtom(),r,i,!0),a&&"ImportExpression"===e.callee.type&&this.raise(r,"Cannot use new with import()"),this.eat(PR.parenL)?e.arguments=this.parseExprList(PR.parenR,this.options.ecmaVersion>=8,!1):e.arguments=uL,this.finishNode(e,"NewExpression")},sL.parseTemplateElement=function(e){var t=e.isTagged,n=this.startNode();return this.type===PR.invalidTemplate?(t||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),n.value={raw:this.value,cooked:null}):n.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),n.tail=this.type===PR.backQuote,this.finishNode(n,"TemplateElement")},sL.parseTemplate=function(e){void 0===e&&(e={});var t=e.isTagged;void 0===t&&(t=!1);var n=this.startNode();this.next(),n.expressions=[];var r=this.parseTemplateElement({isTagged:t});for(n.quasis=[r];!r.tail;)this.type===PR.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(PR.dollarBraceL),n.expressions.push(this.parseExpression()),this.expect(PR.braceR),n.quasis.push(r=this.parseTemplateElement({isTagged:t}));return this.next(),this.finishNode(n,"TemplateLiteral")},sL.isAsyncProp=function(e){return!e.computed&&"Identifier"===e.key.type&&"async"===e.key.name&&(this.type===PR.name||this.type===PR.num||this.type===PR.string||this.type===PR.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===PR.star)&&!RR.test(this.input.slice(this.lastTokEnd,this.start))},sL.parseObj=function(e,t){var n=this.startNode(),r=!0,i={};for(n.properties=[],this.next();!this.eat(PR.braceR);){if(r)r=!1;else if(this.expect(PR.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(PR.braceR))break;var a=this.parseProperty(e,t);e||this.checkPropClash(a,i,t),n.properties.push(a)}return this.finishNode(n,e?"ObjectPattern":"ObjectExpression")},sL.parseProperty=function(e,t){var n,r,i,a,o=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(PR.ellipsis))return e?(o.argument=this.parseIdent(!1),this.type===PR.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(o,"RestElement")):(this.type===PR.parenL&&t&&(t.parenthesizedAssign<0&&(t.parenthesizedAssign=this.start),t.parenthesizedBind<0&&(t.parenthesizedBind=this.start)),o.argument=this.parseMaybeAssign(!1,t),this.type===PR.comma&&t&&t.trailingComma<0&&(t.trailingComma=this.start),this.finishNode(o,"SpreadElement"));this.options.ecmaVersion>=6&&(o.method=!1,o.shorthand=!1,(e||t)&&(i=this.start,a=this.startLoc),e||(n=this.eat(PR.star)));var s=this.containsEsc;return this.parsePropertyName(o),!e&&!s&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(o)?(r=!0,n=this.options.ecmaVersion>=9&&this.eat(PR.star),this.parsePropertyName(o,t)):r=!1,this.parsePropertyValue(o,e,n,r,i,a,t,s),this.finishNode(o,"Property")},sL.parsePropertyValue=function(e,t,n,r,i,a,o,s){if((n||r)&&this.type===PR.colon&&this.unexpected(),this.eat(PR.colon))e.value=t?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,o),e.kind="init";else if(this.options.ecmaVersion>=6&&this.type===PR.parenL)t&&this.unexpected(),e.kind="init",e.method=!0,e.value=this.parseMethod(n,r);else if(t||s||!(this.options.ecmaVersion>=5)||e.computed||"Identifier"!==e.key.type||"get"!==e.key.name&&"set"!==e.key.name||this.type===PR.comma||this.type===PR.braceR||this.type===PR.eq)this.options.ecmaVersion>=6&&!e.computed&&"Identifier"===e.key.type?((n||r)&&this.unexpected(),this.checkUnreserved(e.key),"await"!==e.key.name||this.awaitIdentPos||(this.awaitIdentPos=i),e.kind="init",t?e.value=this.parseMaybeDefault(i,a,e.key):this.type===PR.eq&&o?(o.shorthandAssign<0&&(o.shorthandAssign=this.start),e.value=this.parseMaybeDefault(i,a,e.key)):e.value=e.key,e.shorthand=!0):this.unexpected();else{(n||r)&&this.unexpected(),e.kind=e.key.name,this.parsePropertyName(e),e.value=this.parseMethod(!1);var u="get"===e.kind?0:1;if(e.value.params.length!==u){var l=e.value.start;"get"===e.kind?this.raiseRecoverable(l,"getter should have no params"):this.raiseRecoverable(l,"setter should have exactly one param")}else"set"===e.kind&&"RestElement"===e.value.params[0].type&&this.raiseRecoverable(e.value.params[0].start,"Setter cannot use rest params")}},sL.parsePropertyName=function(e){if(this.options.ecmaVersion>=6){if(this.eat(PR.bracketL))return e.computed=!0,e.key=this.parseMaybeAssign(),this.expect(PR.bracketR),e.key;e.computed=!1}return e.key=this.type===PR.num||this.type===PR.string?this.parseExprAtom():this.parseIdent("never"!==this.options.allowReserved)},sL.initFunction=function(e){e.id=null,this.options.ecmaVersion>=6&&(e.generator=e.expression=!1),this.options.ecmaVersion>=8&&(e.async=!1)},sL.parseMethod=function(e,t,n){var r=this.startNode(),i=this.yieldPos,a=this.awaitPos,o=this.awaitIdentPos;return this.initFunction(r),this.options.ecmaVersion>=6&&(r.generator=e),this.options.ecmaVersion>=8&&(r.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(64|ZR(t,r.generator)|(n?128:0)),this.expect(PR.parenL),r.params=this.parseBindingList(PR.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(r,!1,!0),this.yieldPos=i,this.awaitPos=a,this.awaitIdentPos=o,this.finishNode(r,"FunctionExpression")},sL.parseArrowExpression=function(e,t,n){var r=this.yieldPos,i=this.awaitPos,a=this.awaitIdentPos;return this.enterScope(16|ZR(n,!1)),this.initFunction(e),this.options.ecmaVersion>=8&&(e.async=!!n),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,e.params=this.toAssignableList(t,!0),this.parseFunctionBody(e,!0,!1),this.yieldPos=r,this.awaitPos=i,this.awaitIdentPos=a,this.finishNode(e,"ArrowFunctionExpression")},sL.parseFunctionBody=function(e,t,n){var r=t&&this.type!==PR.braceL,i=this.strict,a=!1;if(r)e.body=this.parseMaybeAssign(),e.expression=!0,this.checkParams(e,!1);else{var o=this.options.ecmaVersion>=7&&!this.isSimpleParamList(e.params);i&&!o||(a=this.strictDirective(this.end))&&o&&this.raiseRecoverable(e.start,"Illegal 'use strict' directive in function with non-simple parameter list");var s=this.labels;this.labels=[],a&&(this.strict=!0),this.checkParams(e,!i&&!a&&!t&&!n&&this.isSimpleParamList(e.params)),this.strict&&e.id&&this.checkLVal(e.id,5),e.body=this.parseBlock(!1,void 0,a&&!i),e.expression=!1,this.adaptDirectivePrologue(e.body.body),this.labels=s}this.exitScope()},sL.isSimpleParamList=function(e){for(var t=0,n=e;t<n.length;t+=1){if("Identifier"!==n[t].type)return!1}return!0},sL.checkParams=function(e,t){for(var n={},r=0,i=e.params;r<i.length;r+=1){var a=i[r];this.checkLVal(a,1,t?null:n)}},sL.parseExprList=function(e,t,n,r){for(var i=[],a=!0;!this.eat(e);){if(a)a=!1;else if(this.expect(PR.comma),t&&this.afterTrailingComma(e))break;var o=void 0;n&&this.type===PR.comma?o=null:this.type===PR.ellipsis?(o=this.parseSpread(r),r&&this.type===PR.comma&&r.trailingComma<0&&(r.trailingComma=this.start)):o=this.parseMaybeAssign(!1,r),i.push(o)}return i},sL.checkUnreserved=function(e){var t=e.start,n=e.end,r=e.name;(this.inGenerator&&"yield"===r&&this.raiseRecoverable(t,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&"await"===r&&this.raiseRecoverable(t,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(r)&&this.raise(t,"Unexpected keyword '"+r+"'"),this.options.ecmaVersion<6&&-1!==this.input.slice(t,n).indexOf("\\"))||(this.strict?this.reservedWordsStrict:this.reservedWords).test(r)&&(this.inAsync||"await"!==r||this.raiseRecoverable(t,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(t,"The keyword '"+r+"' is reserved"))},sL.parseIdent=function(e,t){var n=this.startNode();return this.type===PR.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,"class"!==n.name&&"function"!==n.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(!!e),this.finishNode(n,"Identifier"),e||(this.checkUnreserved(n),"await"!==n.name||this.awaitIdentPos||(this.awaitIdentPos=n.start)),n},sL.parseYield=function(e){this.yieldPos||(this.yieldPos=this.start);var t=this.startNode();return this.next(),this.type===PR.semi||this.canInsertSemicolon()||this.type!==PR.star&&!this.type.startsExpr?(t.delegate=!1,t.argument=null):(t.delegate=this.eat(PR.star),t.argument=this.parseMaybeAssign(e)),this.finishNode(t,"YieldExpression")},sL.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!1),this.finishNode(e,"AwaitExpression")};var lL=qR.prototype;lL.raise=function(e,t){var n=WR(this.input,e);t+=" ("+n.line+":"+n.column+")";var r=new SyntaxError(t);throw r.pos=e,r.loc=n,r.raisedAt=this.pos,r},lL.raiseRecoverable=lL.raise,lL.curPosition=function(){if(this.options.locations)return new GR(this.curLine,this.pos-this.lineStart)};var cL=qR.prototype,hL=function(e){this.flags=e,this.var=[],this.lexical=[],this.functions=[]};cL.enterScope=function(e){this.scopeStack.push(new hL(e))},cL.exitScope=function(){this.scopeStack.pop()},cL.treatFunctionsAsVarInScope=function(e){return 2&e.flags||!this.inModule&&1&e.flags},cL.declareName=function(e,t,n){var r=!1;if(2===t){var i=this.currentScope();r=i.lexical.indexOf(e)>-1||i.functions.indexOf(e)>-1||i.var.indexOf(e)>-1,i.lexical.push(e),this.inModule&&1&i.flags&&delete this.undefinedExports[e]}else if(4===t){this.currentScope().lexical.push(e)}else if(3===t){var a=this.currentScope();r=this.treatFunctionsAsVar?a.lexical.indexOf(e)>-1:a.lexical.indexOf(e)>-1||a.var.indexOf(e)>-1,a.functions.push(e)}else for(var o=this.scopeStack.length-1;o>=0;--o){var s=this.scopeStack[o];if(s.lexical.indexOf(e)>-1&&!(32&s.flags&&s.lexical[0]===e)||!this.treatFunctionsAsVarInScope(s)&&s.functions.indexOf(e)>-1){r=!0;break}if(s.var.push(e),this.inModule&&1&s.flags&&delete this.undefinedExports[e],3&s.flags)break}r&&this.raiseRecoverable(n,"Identifier '"+e+"' has already been declared")},cL.checkLocalExport=function(e){-1===this.scopeStack[0].lexical.indexOf(e.name)&&-1===this.scopeStack[0].var.indexOf(e.name)&&(this.undefinedExports[e.name]=e)},cL.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},cL.currentVarScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(3&t.flags)return t}},cL.currentThisScope=function(){for(var e=this.scopeStack.length-1;;e--){var t=this.scopeStack[e];if(3&t.flags&&!(16&t.flags))return t}};var fL=function(e,t,n){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new HR(e,n)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},pL=qR.prototype;function dL(e,t,n,r){return e.type=t,e.end=n,this.options.locations&&(e.loc.end=r),this.options.ranges&&(e.range[1]=n),e}pL.startNode=function(){return new fL(this,this.start,this.startLoc)},pL.startNodeAt=function(e,t){return new fL(this,e,t)},pL.finishNode=function(e,t){return dL.call(this,e,t,this.lastTokEnd,this.lastTokEndLoc)},pL.finishNodeAt=function(e,t,n,r){return dL.call(this,e,t,n,r)};var vL=function(e,t,n,r,i){this.token=e,this.isExpr=!!t,this.preserveSpace=!!n,this.override=r,this.generator=!!i},gL={b_stat:new vL("{",!1),b_expr:new vL("{",!0),b_tmpl:new vL("${",!1),p_stat:new vL("(",!1),p_expr:new vL("(",!0),q_tmpl:new vL("`",!0,!0,(function(e){return e.tryReadTemplateToken()})),f_stat:new vL("function",!1),f_expr:new vL("function",!0),f_expr_gen:new vL("function",!0,!1,null,!0),f_gen:new vL("function",!1,!1,null,!0)},mL=qR.prototype;mL.initialContext=function(){return[gL.b_stat]},mL.braceIsBlock=function(e){var t=this.curContext();return t===gL.f_expr||t===gL.f_stat||(e!==PR.colon||t!==gL.b_stat&&t!==gL.b_expr?e===PR._return||e===PR.name&&this.exprAllowed?RR.test(this.input.slice(this.lastTokEnd,this.start)):e===PR._else||e===PR.semi||e===PR.eof||e===PR.parenR||e===PR.arrow||(e===PR.braceL?t===gL.b_stat:e!==PR._var&&e!==PR._const&&e!==PR.name&&!this.exprAllowed):!t.isExpr)},mL.inGeneratorContext=function(){for(var e=this.context.length-1;e>=1;e--){var t=this.context[e];if("function"===t.token)return t.generator}return!1},mL.updateContext=function(e){var t,n=this.type;n.keyword&&e===PR.dot?this.exprAllowed=!1:(t=n.updateContext)?t.call(this,e):this.exprAllowed=n.beforeExpr},PR.parenR.updateContext=PR.braceR.updateContext=function(){if(1!==this.context.length){var e=this.context.pop();e===gL.b_stat&&"function"===this.curContext().token&&(e=this.context.pop()),this.exprAllowed=!e.isExpr}else this.exprAllowed=!0},PR.braceL.updateContext=function(e){this.context.push(this.braceIsBlock(e)?gL.b_stat:gL.b_expr),this.exprAllowed=!0},PR.dollarBraceL.updateContext=function(){this.context.push(gL.b_tmpl),this.exprAllowed=!0},PR.parenL.updateContext=function(e){var t=e===PR._if||e===PR._for||e===PR._with||e===PR._while;this.context.push(t?gL.p_stat:gL.p_expr),this.exprAllowed=!0},PR.incDec.updateContext=function(){},PR._function.updateContext=PR._class.updateContext=function(e){!e.beforeExpr||e===PR.semi||e===PR._else||e===PR._return&&RR.test(this.input.slice(this.lastTokEnd,this.start))||(e===PR.colon||e===PR.braceL)&&this.curContext()===gL.b_stat?this.context.push(gL.f_stat):this.context.push(gL.f_expr),this.exprAllowed=!1},PR.backQuote.updateContext=function(){this.curContext()===gL.q_tmpl?this.context.pop():this.context.push(gL.q_tmpl),this.exprAllowed=!1},PR.star.updateContext=function(e){if(e===PR._function){var t=this.context.length-1;this.context[t]===gL.f_expr?this.context[t]=gL.f_expr_gen:this.context[t]=gL.f_gen}this.exprAllowed=!0},PR.name.updateContext=function(e){var t=!1;this.options.ecmaVersion>=6&&e!==PR.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(t=!0),this.exprAllowed=t};var yL="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",_L=yL+" Extended_Pictographic",bL={9:yL,10:_L,11:"ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS Extended_Pictographic"},xL="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",EL="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",SL=EL+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",CL={9:EL,10:SL,11:"Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho"},TL={};function AL(e){var t=TL[e]={binary:VR(bL[e]+" "+xL),nonBinary:{General_Category:VR(xL),Script:VR(CL[e])}};t.nonBinary.Script_Extensions=t.nonBinary.Script,t.nonBinary.gc=t.nonBinary.General_Category,t.nonBinary.sc=t.nonBinary.Script,t.nonBinary.scx=t.nonBinary.Script_Extensions}AL(9),AL(10),AL(11);var ML=qR.prototype,wL=function(e){this.parser=e,this.validFlags="gim"+(e.options.ecmaVersion>=6?"uy":"")+(e.options.ecmaVersion>=9?"s":""),this.unicodeProperties=TL[e.options.ecmaVersion>=11?11:e.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function kL(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}function OL(e){return 36===e||e>=40&&e<=43||46===e||63===e||e>=91&&e<=94||e>=123&&e<=125}function PL(e){return e>=65&&e<=90||e>=97&&e<=122}function RL(e){return PL(e)||95===e}function LL(e){return RL(e)||IL(e)}function IL(e){return e>=48&&e<=57}function NL(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102}function DL(e){return e>=65&&e<=70?e-65+10:e>=97&&e<=102?e-97+10:e-48}function FL(e){return e>=48&&e<=55}wL.prototype.reset=function(e,t,n){var r=-1!==n.indexOf("u");this.start=0|e,this.source=t+"",this.flags=n,this.switchU=r&&this.parser.options.ecmaVersion>=6,this.switchN=r&&this.parser.options.ecmaVersion>=9},wL.prototype.raise=function(e){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+e)},wL.prototype.at=function(e,t){void 0===t&&(t=!1);var n=this.source,r=n.length;if(e>=r)return-1;var i=n.charCodeAt(e);if(!t&&!this.switchU||i<=55295||i>=57344||e+1>=r)return i;var a=n.charCodeAt(e+1);return a>=56320&&a<=57343?(i<<10)+a-56613888:i},wL.prototype.nextIndex=function(e,t){void 0===t&&(t=!1);var n=this.source,r=n.length;if(e>=r)return r;var i,a=n.charCodeAt(e);return!t&&!this.switchU||a<=55295||a>=57344||e+1>=r||(i=n.charCodeAt(e+1))<56320||i>57343?e+1:e+2},wL.prototype.current=function(e){return void 0===e&&(e=!1),this.at(this.pos,e)},wL.prototype.lookahead=function(e){return void 0===e&&(e=!1),this.at(this.nextIndex(this.pos,e),e)},wL.prototype.advance=function(e){void 0===e&&(e=!1),this.pos=this.nextIndex(this.pos,e)},wL.prototype.eat=function(e,t){return void 0===t&&(t=!1),this.current(t)===e&&(this.advance(t),!0)},ML.validateRegExpFlags=function(e){for(var t=e.validFlags,n=e.flags,r=0;r<n.length;r++){var i=n.charAt(r);-1===t.indexOf(i)&&this.raise(e.start,"Invalid regular expression flag"),n.indexOf(i,r+1)>-1&&this.raise(e.start,"Duplicate regular expression flag")}},ML.validateRegExpPattern=function(e){this.regexp_pattern(e),!e.switchN&&this.options.ecmaVersion>=9&&e.groupNames.length>0&&(e.switchN=!0,this.regexp_pattern(e))},ML.regexp_pattern=function(e){e.pos=0,e.lastIntValue=0,e.lastStringValue="",e.lastAssertionIsQuantifiable=!1,e.numCapturingParens=0,e.maxBackReference=0,e.groupNames.length=0,e.backReferenceNames.length=0,this.regexp_disjunction(e),e.pos!==e.source.length&&(e.eat(41)&&e.raise("Unmatched ')'"),(e.eat(93)||e.eat(125))&&e.raise("Lone quantifier brackets")),e.maxBackReference>e.numCapturingParens&&e.raise("Invalid escape");for(var t=0,n=e.backReferenceNames;t<n.length;t+=1){var r=n[t];-1===e.groupNames.indexOf(r)&&e.raise("Invalid named capture referenced")}},ML.regexp_disjunction=function(e){for(this.regexp_alternative(e);e.eat(124);)this.regexp_alternative(e);this.regexp_eatQuantifier(e,!0)&&e.raise("Nothing to repeat"),e.eat(123)&&e.raise("Lone quantifier brackets")},ML.regexp_alternative=function(e){for(;e.pos<e.source.length&&this.regexp_eatTerm(e););},ML.regexp_eatTerm=function(e){return this.regexp_eatAssertion(e)?(e.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(e)&&e.switchU&&e.raise("Invalid quantifier"),!0):!!(e.switchU?this.regexp_eatAtom(e):this.regexp_eatExtendedAtom(e))&&(this.regexp_eatQuantifier(e),!0)},ML.regexp_eatAssertion=function(e){var t=e.pos;if(e.lastAssertionIsQuantifiable=!1,e.eat(94)||e.eat(36))return!0;if(e.eat(92)){if(e.eat(66)||e.eat(98))return!0;e.pos=t}if(e.eat(40)&&e.eat(63)){var n=!1;if(this.options.ecmaVersion>=9&&(n=e.eat(60)),e.eat(61)||e.eat(33))return this.regexp_disjunction(e),e.eat(41)||e.raise("Unterminated group"),e.lastAssertionIsQuantifiable=!n,!0}return e.pos=t,!1},ML.regexp_eatQuantifier=function(e,t){return void 0===t&&(t=!1),!!this.regexp_eatQuantifierPrefix(e,t)&&(e.eat(63),!0)},ML.regexp_eatQuantifierPrefix=function(e,t){return e.eat(42)||e.eat(43)||e.eat(63)||this.regexp_eatBracedQuantifier(e,t)},ML.regexp_eatBracedQuantifier=function(e,t){var n=e.pos;if(e.eat(123)){var r=0,i=-1;if(this.regexp_eatDecimalDigits(e)&&(r=e.lastIntValue,e.eat(44)&&this.regexp_eatDecimalDigits(e)&&(i=e.lastIntValue),e.eat(125)))return-1!==i&&i<r&&!t&&e.raise("numbers out of order in {} quantifier"),!0;e.switchU&&!t&&e.raise("Incomplete quantifier"),e.pos=n}return!1},ML.regexp_eatAtom=function(e){return this.regexp_eatPatternCharacters(e)||e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)},ML.regexp_eatReverseSolidusAtomEscape=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatAtomEscape(e))return!0;e.pos=t}return!1},ML.regexp_eatUncapturingGroup=function(e){var t=e.pos;if(e.eat(40)){if(e.eat(63)&&e.eat(58)){if(this.regexp_disjunction(e),e.eat(41))return!0;e.raise("Unterminated group")}e.pos=t}return!1},ML.regexp_eatCapturingGroup=function(e){if(e.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(e):63===e.current()&&e.raise("Invalid group"),this.regexp_disjunction(e),e.eat(41))return e.numCapturingParens+=1,!0;e.raise("Unterminated group")}return!1},ML.regexp_eatExtendedAtom=function(e){return e.eat(46)||this.regexp_eatReverseSolidusAtomEscape(e)||this.regexp_eatCharacterClass(e)||this.regexp_eatUncapturingGroup(e)||this.regexp_eatCapturingGroup(e)||this.regexp_eatInvalidBracedQuantifier(e)||this.regexp_eatExtendedPatternCharacter(e)},ML.regexp_eatInvalidBracedQuantifier=function(e){return this.regexp_eatBracedQuantifier(e,!0)&&e.raise("Nothing to repeat"),!1},ML.regexp_eatSyntaxCharacter=function(e){var t=e.current();return!!OL(t)&&(e.lastIntValue=t,e.advance(),!0)},ML.regexp_eatPatternCharacters=function(e){for(var t=e.pos,n=0;-1!==(n=e.current())&&!OL(n);)e.advance();return e.pos!==t},ML.regexp_eatExtendedPatternCharacter=function(e){var t=e.current();return!(-1===t||36===t||t>=40&&t<=43||46===t||63===t||91===t||94===t||124===t)&&(e.advance(),!0)},ML.regexp_groupSpecifier=function(e){if(e.eat(63)){if(this.regexp_eatGroupName(e))return-1!==e.groupNames.indexOf(e.lastStringValue)&&e.raise("Duplicate capture group name"),void e.groupNames.push(e.lastStringValue);e.raise("Invalid group")}},ML.regexp_eatGroupName=function(e){if(e.lastStringValue="",e.eat(60)){if(this.regexp_eatRegExpIdentifierName(e)&&e.eat(62))return!0;e.raise("Invalid capture group name")}return!1},ML.regexp_eatRegExpIdentifierName=function(e){if(e.lastStringValue="",this.regexp_eatRegExpIdentifierStart(e)){for(e.lastStringValue+=kL(e.lastIntValue);this.regexp_eatRegExpIdentifierPart(e);)e.lastStringValue+=kL(e.lastIntValue);return!0}return!1},ML.regexp_eatRegExpIdentifierStart=function(e){var t=e.pos,n=this.options.ecmaVersion>=11,r=e.current(n);return e.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(e,n)&&(r=e.lastIntValue),function(e){return SR(e,!0)||36===e||95===e}(r)?(e.lastIntValue=r,!0):(e.pos=t,!1)},ML.regexp_eatRegExpIdentifierPart=function(e){var t=e.pos,n=this.options.ecmaVersion>=11,r=e.current(n);return e.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(e,n)&&(r=e.lastIntValue),function(e){return CR(e,!0)||36===e||95===e||8204===e||8205===e}(r)?(e.lastIntValue=r,!0):(e.pos=t,!1)},ML.regexp_eatAtomEscape=function(e){return!!(this.regexp_eatBackReference(e)||this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)||e.switchN&&this.regexp_eatKGroupName(e))||(e.switchU&&(99===e.current()&&e.raise("Invalid unicode escape"),e.raise("Invalid escape")),!1)},ML.regexp_eatBackReference=function(e){var t=e.pos;if(this.regexp_eatDecimalEscape(e)){var n=e.lastIntValue;if(e.switchU)return n>e.maxBackReference&&(e.maxBackReference=n),!0;if(n<=e.numCapturingParens)return!0;e.pos=t}return!1},ML.regexp_eatKGroupName=function(e){if(e.eat(107)){if(this.regexp_eatGroupName(e))return e.backReferenceNames.push(e.lastStringValue),!0;e.raise("Invalid named reference")}return!1},ML.regexp_eatCharacterEscape=function(e){return this.regexp_eatControlEscape(e)||this.regexp_eatCControlLetter(e)||this.regexp_eatZero(e)||this.regexp_eatHexEscapeSequence(e)||this.regexp_eatRegExpUnicodeEscapeSequence(e,!1)||!e.switchU&&this.regexp_eatLegacyOctalEscapeSequence(e)||this.regexp_eatIdentityEscape(e)},ML.regexp_eatCControlLetter=function(e){var t=e.pos;if(e.eat(99)){if(this.regexp_eatControlLetter(e))return!0;e.pos=t}return!1},ML.regexp_eatZero=function(e){return 48===e.current()&&!IL(e.lookahead())&&(e.lastIntValue=0,e.advance(),!0)},ML.regexp_eatControlEscape=function(e){var t=e.current();return 116===t?(e.lastIntValue=9,e.advance(),!0):110===t?(e.lastIntValue=10,e.advance(),!0):118===t?(e.lastIntValue=11,e.advance(),!0):102===t?(e.lastIntValue=12,e.advance(),!0):114===t&&(e.lastIntValue=13,e.advance(),!0)},ML.regexp_eatControlLetter=function(e){var t=e.current();return!!PL(t)&&(e.lastIntValue=t%32,e.advance(),!0)},ML.regexp_eatRegExpUnicodeEscapeSequence=function(e,t){void 0===t&&(t=!1);var n,r=e.pos,i=t||e.switchU;if(e.eat(117)){if(this.regexp_eatFixedHexDigits(e,4)){var a=e.lastIntValue;if(i&&a>=55296&&a<=56319){var o=e.pos;if(e.eat(92)&&e.eat(117)&&this.regexp_eatFixedHexDigits(e,4)){var s=e.lastIntValue;if(s>=56320&&s<=57343)return e.lastIntValue=1024*(a-55296)+(s-56320)+65536,!0}e.pos=o,e.lastIntValue=a}return!0}if(i&&e.eat(123)&&this.regexp_eatHexDigits(e)&&e.eat(125)&&((n=e.lastIntValue)>=0&&n<=1114111))return!0;i&&e.raise("Invalid unicode escape"),e.pos=r}return!1},ML.regexp_eatIdentityEscape=function(e){if(e.switchU)return!!this.regexp_eatSyntaxCharacter(e)||!!e.eat(47)&&(e.lastIntValue=47,!0);var t=e.current();return!(99===t||e.switchN&&107===t)&&(e.lastIntValue=t,e.advance(),!0)},ML.regexp_eatDecimalEscape=function(e){e.lastIntValue=0;var t=e.current();if(t>=49&&t<=57){do{e.lastIntValue=10*e.lastIntValue+(t-48),e.advance()}while((t=e.current())>=48&&t<=57);return!0}return!1},ML.regexp_eatCharacterClassEscape=function(e){var t=e.current();if(function(e){return 100===e||68===e||115===e||83===e||119===e||87===e}(t))return e.lastIntValue=-1,e.advance(),!0;if(e.switchU&&this.options.ecmaVersion>=9&&(80===t||112===t)){if(e.lastIntValue=-1,e.advance(),e.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(e)&&e.eat(125))return!0;e.raise("Invalid property name")}return!1},ML.regexp_eatUnicodePropertyValueExpression=function(e){var t=e.pos;if(this.regexp_eatUnicodePropertyName(e)&&e.eat(61)){var n=e.lastStringValue;if(this.regexp_eatUnicodePropertyValue(e)){var r=e.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(e,n,r),!0}}if(e.pos=t,this.regexp_eatLoneUnicodePropertyNameOrValue(e)){var i=e.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(e,i),!0}return!1},ML.regexp_validateUnicodePropertyNameAndValue=function(e,t,n){zR(e.unicodeProperties.nonBinary,t)||e.raise("Invalid property name"),e.unicodeProperties.nonBinary[t].test(n)||e.raise("Invalid property value")},ML.regexp_validateUnicodePropertyNameOrValue=function(e,t){e.unicodeProperties.binary.test(t)||e.raise("Invalid property name")},ML.regexp_eatUnicodePropertyName=function(e){var t=0;for(e.lastStringValue="";RL(t=e.current());)e.lastStringValue+=kL(t),e.advance();return""!==e.lastStringValue},ML.regexp_eatUnicodePropertyValue=function(e){var t=0;for(e.lastStringValue="";LL(t=e.current());)e.lastStringValue+=kL(t),e.advance();return""!==e.lastStringValue},ML.regexp_eatLoneUnicodePropertyNameOrValue=function(e){return this.regexp_eatUnicodePropertyValue(e)},ML.regexp_eatCharacterClass=function(e){if(e.eat(91)){if(e.eat(94),this.regexp_classRanges(e),e.eat(93))return!0;e.raise("Unterminated character class")}return!1},ML.regexp_classRanges=function(e){for(;this.regexp_eatClassAtom(e);){var t=e.lastIntValue;if(e.eat(45)&&this.regexp_eatClassAtom(e)){var n=e.lastIntValue;!e.switchU||-1!==t&&-1!==n||e.raise("Invalid character class"),-1!==t&&-1!==n&&t>n&&e.raise("Range out of order in character class")}}},ML.regexp_eatClassAtom=function(e){var t=e.pos;if(e.eat(92)){if(this.regexp_eatClassEscape(e))return!0;if(e.switchU){var n=e.current();(99===n||FL(n))&&e.raise("Invalid class escape"),e.raise("Invalid escape")}e.pos=t}var r=e.current();return 93!==r&&(e.lastIntValue=r,e.advance(),!0)},ML.regexp_eatClassEscape=function(e){var t=e.pos;if(e.eat(98))return e.lastIntValue=8,!0;if(e.switchU&&e.eat(45))return e.lastIntValue=45,!0;if(!e.switchU&&e.eat(99)){if(this.regexp_eatClassControlLetter(e))return!0;e.pos=t}return this.regexp_eatCharacterClassEscape(e)||this.regexp_eatCharacterEscape(e)},ML.regexp_eatClassControlLetter=function(e){var t=e.current();return!(!IL(t)&&95!==t)&&(e.lastIntValue=t%32,e.advance(),!0)},ML.regexp_eatHexEscapeSequence=function(e){var t=e.pos;if(e.eat(120)){if(this.regexp_eatFixedHexDigits(e,2))return!0;e.switchU&&e.raise("Invalid escape"),e.pos=t}return!1},ML.regexp_eatDecimalDigits=function(e){var t=e.pos,n=0;for(e.lastIntValue=0;IL(n=e.current());)e.lastIntValue=10*e.lastIntValue+(n-48),e.advance();return e.pos!==t},ML.regexp_eatHexDigits=function(e){var t=e.pos,n=0;for(e.lastIntValue=0;NL(n=e.current());)e.lastIntValue=16*e.lastIntValue+DL(n),e.advance();return e.pos!==t},ML.regexp_eatLegacyOctalEscapeSequence=function(e){if(this.regexp_eatOctalDigit(e)){var t=e.lastIntValue;if(this.regexp_eatOctalDigit(e)){var n=e.lastIntValue;t<=3&&this.regexp_eatOctalDigit(e)?e.lastIntValue=64*t+8*n+e.lastIntValue:e.lastIntValue=8*t+n}else e.lastIntValue=t;return!0}return!1},ML.regexp_eatOctalDigit=function(e){var t=e.current();return FL(t)?(e.lastIntValue=t-48,e.advance(),!0):(e.lastIntValue=0,!1)},ML.regexp_eatFixedHexDigits=function(e,t){var n=e.pos;e.lastIntValue=0;for(var r=0;r<t;++r){var i=e.current();if(!NL(i))return e.pos=n,!1;e.lastIntValue=16*e.lastIntValue+DL(i),e.advance()}return!0};var BL=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new HR(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},UL=qR.prototype;function zL(e){return"function"!=typeof BigInt?null:BigInt(e.replace(/_/g,""))}function jL(e){return e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e)))}UL.next=function(e){!e&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new BL(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},UL.getToken=function(){return this.next(),new BL(this)},"undefined"!=typeof Symbol&&(UL[Symbol.iterator]=function(){var e=this;return{next:function(){var t=e.getToken();return{done:t.type===PR.eof,value:t}}}}),UL.curContext=function(){return this.context[this.context.length-1]},UL.nextToken=function(){var e=this.curContext();return e&&e.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(PR.eof):e.override?e.override(this):void this.readToken(this.fullCharCodeAtPos())},UL.readToken=function(e){return SR(e,this.options.ecmaVersion>=6)||92===e?this.readWord():this.getTokenFromCode(e)},UL.fullCharCodeAtPos=function(){var e=this.input.charCodeAt(this.pos);return e<=55295||e>=57344?e:(e<<10)+this.input.charCodeAt(this.pos+1)-56613888},UL.skipBlockComment=function(){var e,t=this.options.onComment&&this.curPosition(),n=this.pos,r=this.input.indexOf("*/",this.pos+=2);if(-1===r&&this.raise(this.pos-2,"Unterminated comment"),this.pos=r+2,this.options.locations)for(LR.lastIndex=n;(e=LR.exec(this.input))&&e.index<this.pos;)++this.curLine,this.lineStart=e.index+e[0].length;this.options.onComment&&this.options.onComment(!0,this.input.slice(n+2,r),n,this.pos,t,this.curPosition())},UL.skipLineComment=function(e){for(var t=this.pos,n=this.options.onComment&&this.curPosition(),r=this.input.charCodeAt(this.pos+=e);this.pos<this.input.length&&!IR(r);)r=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(t+e,this.pos),t,this.pos,n,this.curPosition())},UL.skipSpace=function(){e:for(;this.pos<this.input.length;){var e=this.input.charCodeAt(this.pos);switch(e){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(!(e>8&&e<14||e>=5760&&NR.test(String.fromCharCode(e))))break e;++this.pos}}},UL.finishToken=function(e,t){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var n=this.type;this.type=e,this.value=t,this.updateContext(n)},UL.readToken_dot=function(){var e=this.input.charCodeAt(this.pos+1);if(e>=48&&e<=57)return this.readNumber(!0);var t=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===e&&46===t?(this.pos+=3,this.finishToken(PR.ellipsis)):(++this.pos,this.finishToken(PR.dot))},UL.readToken_slash=function(){var e=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===e?this.finishOp(PR.assign,2):this.finishOp(PR.slash,1)},UL.readToken_mult_modulo_exp=function(e){var t=this.input.charCodeAt(this.pos+1),n=1,r=42===e?PR.star:PR.modulo;return this.options.ecmaVersion>=7&&42===e&&42===t&&(++n,r=PR.starstar,t=this.input.charCodeAt(this.pos+2)),61===t?this.finishOp(PR.assign,n+1):this.finishOp(r,n)},UL.readToken_pipe_amp=function(e){var t=this.input.charCodeAt(this.pos+1);if(t===e){if(this.options.ecmaVersion>=12)if(61===this.input.charCodeAt(this.pos+2))return this.finishOp(PR.assign,3);return this.finishOp(124===e?PR.logicalOR:PR.logicalAND,2)}return 61===t?this.finishOp(PR.assign,2):this.finishOp(124===e?PR.bitwiseOR:PR.bitwiseAND,1)},UL.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(PR.assign,2):this.finishOp(PR.bitwiseXOR,1)},UL.readToken_plus_min=function(e){var t=this.input.charCodeAt(this.pos+1);return t===e?45!==t||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!RR.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(PR.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===t?this.finishOp(PR.assign,2):this.finishOp(PR.plusMin,1)},UL.readToken_lt_gt=function(e){var t=this.input.charCodeAt(this.pos+1),n=1;return t===e?(n=62===e&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+n)?this.finishOp(PR.assign,n+1):this.finishOp(PR.bitShift,n)):33!==t||60!==e||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===t&&(n=2),this.finishOp(PR.relational,n)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},UL.readToken_eq_excl=function(e){var t=this.input.charCodeAt(this.pos+1);return 61===t?this.finishOp(PR.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===e&&62===t&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(PR.arrow)):this.finishOp(61===e?PR.eq:PR.prefix,1)},UL.readToken_question=function(){var e=this.options.ecmaVersion;if(e>=11){var t=this.input.charCodeAt(this.pos+1);if(46===t){var n=this.input.charCodeAt(this.pos+2);if(n<48||n>57)return this.finishOp(PR.questionDot,2)}if(63===t){if(e>=12)if(61===this.input.charCodeAt(this.pos+2))return this.finishOp(PR.assign,3);return this.finishOp(PR.coalesce,2)}}return this.finishOp(PR.question,1)},UL.getTokenFromCode=function(e){switch(e){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(PR.parenL);case 41:return++this.pos,this.finishToken(PR.parenR);case 59:return++this.pos,this.finishToken(PR.semi);case 44:return++this.pos,this.finishToken(PR.comma);case 91:return++this.pos,this.finishToken(PR.bracketL);case 93:return++this.pos,this.finishToken(PR.bracketR);case 123:return++this.pos,this.finishToken(PR.braceL);case 125:return++this.pos,this.finishToken(PR.braceR);case 58:return++this.pos,this.finishToken(PR.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(PR.backQuote);case 48:var t=this.input.charCodeAt(this.pos+1);if(120===t||88===t)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===t||79===t)return this.readRadixNumber(8);if(98===t||66===t)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(e);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(e);case 124:case 38:return this.readToken_pipe_amp(e);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(e);case 60:case 62:return this.readToken_lt_gt(e);case 61:case 33:return this.readToken_eq_excl(e);case 63:return this.readToken_question();case 126:return this.finishOp(PR.prefix,1)}this.raise(this.pos,"Unexpected character '"+jL(e)+"'")},UL.finishOp=function(e,t){var n=this.input.slice(this.pos,this.pos+t);return this.pos+=t,this.finishToken(e,n)},UL.readRegexp=function(){for(var e,t,n=this.pos;;){this.pos>=this.input.length&&this.raise(n,"Unterminated regular expression");var r=this.input.charAt(this.pos);if(RR.test(r)&&this.raise(n,"Unterminated regular expression"),e)e=!1;else{if("["===r)t=!0;else if("]"===r&&t)t=!1;else if("/"===r&&!t)break;e="\\"===r}++this.pos}var i=this.input.slice(n,this.pos);++this.pos;var a=this.pos,o=this.readWord1();this.containsEsc&&this.unexpected(a);var s=this.regexpState||(this.regexpState=new wL(this));s.reset(n,i,o),this.validateRegExpFlags(s),this.validateRegExpPattern(s);var u=null;try{u=new RegExp(i,o)}catch(e){}return this.finishToken(PR.regexp,{pattern:i,flags:o,value:u})},UL.readInt=function(e,t,n){for(var r=this.options.ecmaVersion>=12&&void 0===t,i=n&&48===this.input.charCodeAt(this.pos),a=this.pos,o=0,s=0,u=0,l=null==t?1/0:t;u<l;++u,++this.pos){var c=this.input.charCodeAt(this.pos),h=void 0;if(r&&95===c)i&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),95===s&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),0===u&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),s=c;else{if((h=c>=97?c-97+10:c>=65?c-65+10:c>=48&&c<=57?c-48:1/0)>=e)break;s=c,o=o*e+h}}return r&&95===s&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===a||null!=t&&this.pos-a!==t?null:o},UL.readRadixNumber=function(e){var t=this.pos;this.pos+=2;var n=this.readInt(e);return null==n&&this.raise(this.start+2,"Expected number in radix "+e),this.options.ecmaVersion>=11&&110===this.input.charCodeAt(this.pos)?(n=zL(this.input.slice(t,this.pos)),++this.pos):SR(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(PR.num,n)},UL.readNumber=function(e){var t=this.pos;e||null!==this.readInt(10,void 0,!0)||this.raise(t,"Invalid number");var n=this.pos-t>=2&&48===this.input.charCodeAt(t);n&&this.strict&&this.raise(t,"Invalid number");var r=this.input.charCodeAt(this.pos);if(!n&&!e&&this.options.ecmaVersion>=11&&110===r){var i=zL(this.input.slice(t,this.pos));return++this.pos,SR(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(PR.num,i)}n&&/[89]/.test(this.input.slice(t,this.pos))&&(n=!1),46!==r||n||(++this.pos,this.readInt(10),r=this.input.charCodeAt(this.pos)),69!==r&&101!==r||n||(43!==(r=this.input.charCodeAt(++this.pos))&&45!==r||++this.pos,null===this.readInt(10)&&this.raise(t,"Invalid number")),SR(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var a=function(e,t){return t?parseInt(e,8):parseFloat(e.replace(/_/g,""))}(this.input.slice(t,this.pos),n);return this.finishToken(PR.num,a)},UL.readCodePoint=function(){var e;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var t=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(t,"Code point out of bounds")}else e=this.readHexChar(4);return e},UL.readString=function(e){for(var t="",n=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var r=this.input.charCodeAt(this.pos);if(r===e)break;92===r?(t+=this.input.slice(n,this.pos),t+=this.readEscapedChar(!1),n=this.pos):(IR(r,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return t+=this.input.slice(n,this.pos++),this.finishToken(PR.string,t)};var VL={};UL.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(e){if(e!==VL)throw e;this.readInvalidTemplateToken()}this.inTemplateElement=!1},UL.invalidStringToken=function(e,t){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw VL;this.raise(e,t)},UL.readTmplToken=function(){for(var e="",t=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var n=this.input.charCodeAt(this.pos);if(96===n||36===n&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==PR.template&&this.type!==PR.invalidTemplate?(e+=this.input.slice(t,this.pos),this.finishToken(PR.template,e)):36===n?(this.pos+=2,this.finishToken(PR.dollarBraceL)):(++this.pos,this.finishToken(PR.backQuote));if(92===n)e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!0),t=this.pos;else if(IR(n)){switch(e+=this.input.slice(t,this.pos),++this.pos,n){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:e+="\n";break;default:e+=String.fromCharCode(n)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),t=this.pos}else++this.pos}},UL.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(PR.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},UL.readEscapedChar=function(e){var t=this.input.charCodeAt(++this.pos);switch(++this.pos,t){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return jL(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(e){var n=this.pos-1;return this.invalidStringToken(n,"Invalid escape sequence in template string"),null}default:if(t>=48&&t<=55){var r=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],i=parseInt(r,8);return i>255&&(r=r.slice(0,-1),i=parseInt(r,8)),this.pos+=r.length-1,t=this.input.charCodeAt(this.pos),"0"===r&&56!==t&&57!==t||!this.strict&&!e||this.invalidStringToken(this.pos-1-r.length,e?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(i)}return IR(t)?"":String.fromCharCode(t)}},UL.readHexChar=function(e){var t=this.pos,n=this.readInt(16,e);return null===n&&this.invalidStringToken(t,"Bad character escape sequence"),n},UL.readWord1=function(){this.containsEsc=!1;for(var e="",t=!0,n=this.pos,r=this.options.ecmaVersion>=6;this.pos<this.input.length;){var i=this.fullCharCodeAtPos();if(CR(i,r))this.pos+=i<=65535?1:2;else{if(92!==i)break;this.containsEsc=!0,e+=this.input.slice(n,this.pos);var a=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var o=this.readCodePoint();(t?SR:CR)(o,r)||this.invalidStringToken(a,"Invalid Unicode escape"),e+=jL(o),n=this.pos}t=!1}return e+this.input.slice(n,this.pos)},UL.readWord=function(){var e=this.readWord1(),t=PR.name;return this.keywords.test(e)&&(t=kR[e]),this.finishToken(t,e)};function GL(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function HL(e){var t="function"==typeof Map?new Map:void 0;return(HL=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return XL(e,arguments,ZL(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),YL(r,e)})(e)}function WL(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function XL(e,t,n){return(XL=WL()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&YL(i,n.prototype),i}).apply(null,arguments)}function YL(e,t){return(YL=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ZL(e){return(ZL=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}qR.acorn={Parser:qR,version:"7.4.1",defaultOptions:XR,Position:GR,SourceLocation:HR,getLineInfo:WR,Node:fL,TokenType:TR,tokTypes:PR,keywordTypes:kR,TokContext:vL,tokContexts:gL,isIdentifierChar:CR,isIdentifierStart:SR,Token:BL,isNewLine:IR,lineBreak:RR,lineBreakG:LR,nonASCIIwhitespace:NR};var qL=function(e){function t(){return e.apply(this,arguments)||this}return GL(t,e),t}(HL(Error)),KL=function(e){function t(){return e.apply(this,arguments)||this}return GL(t,e),t}(HL(SyntaxError)),QL=function(e){function t(){return e.apply(this,arguments)||this}return GL(t,e),t}(HL(ReferenceError)),JL=function(e){function t(){return e.apply(this,arguments)||this}return GL(t,e),t}(HL(TypeError)),$L=function(e){function t(){return e.apply(this,arguments)||this}return GL(t,e),t}(qL),eI=function(e){function t(){return e.apply(this,arguments)||this}return GL(t,e),t}(KL),tI=function(e){function t(){return e.apply(this,arguments)||this}return GL(t,e),t}(QL),nI={UnknownError:[3001,"%0",$L],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",$L],NodeTypeSyntaxError:[1001,"Unknown node type: %0",tI],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",tI],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",tI],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",tI],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",tI],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",tI],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",tI],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",tI],ParamTypeSyntaxError:[1009,"Unknown param type: %0",tI],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",tI],FunctionUndefinedReferenceError:[2001,"%0 is not a function",QL],VariableUndefinedReferenceError:[2002,"%0 is not defined",QL],IsNotConstructor:[2003,"%0 is not a constructor",JL]};function rI(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function iI(e,t,n){return(iI=rI()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&aI(i,n.prototype),i}).apply(null,arguments)}function aI(e,t){return(aI=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function oI(e,t){Object.defineProperty(e,"name",{value:t,writable:!1,enumerable:!1,configurable:!0})}var sI=Object.prototype.hasOwnProperty,uI=Symbol("Break"),lI=Symbol("Continue"),cI=Symbol("DefaultCase"),hI=Symbol("EmptyStatementReturn"),fI=Symbol("WithScopeName"),pI=Symbol("SuperScopeName"),dI=Symbol("RootScopeName"),vI=Symbol("GlobalScopeName");function gI(e){return"function"==typeof e}var mI=function(){function e(e){this.interpreter=e}return e.prototype.generator=function(){var e=this.interpreter;return{getOptions:e.getOptions.bind(e),getCurrentScope:function(){return this.getCurrentScope()}.bind(e),getGlobalScope:function(){return this.getGlobalScope()}.bind(e),getCurrentContext:function(){return this.getCurrentContext()}.bind(e),getExecStartTime:e.getExecStartTime.bind(e)}},e}();function yI(e,t,n){if(void 0===n&&(n=!0),!(e instanceof mI))throw new Error("Illegal call");if("string"!=typeof t)return t;if(t){var r=e.generator(),i={timeout:r.getOptions().timeout,_initEnv:function(){n||this.setCurrentContext(r.getCurrentContext()),this.execStartTime=r.getExecStartTime(),this.execEndTime=this.execStartTime}},a=n?r.getGlobalScope():r.getCurrentScope();return new MI(a,i).evaluate(t)}}function _I(e){if(!(e instanceof mI))throw new Error("Illegal call");for(var t=e.generator(),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var a=r.pop(),o=new MI(t.getGlobalScope(),t.getOptions()),s="\n\t\t    (function anonymous("+r.join(",")+"){\n\t\t        "+a+"\n\t\t    });\n\t\t    ";return o.evaluate(s)}Object.defineProperty(yI,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(_I,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var bI=function(e){this.value=e},xI=function(e){this.value=e},EI=function(e){this.value=e},SI=function(e,t,n){void 0===t&&(t=null),this.name=n,this.parent=t,this.data=e,this.labelStack=[]};function CI(){}function TI(e,t){return void 0===e&&(e=null),new SI(Object.create(null),e,t)}var AI={NaN:NaN,Infinity:1/0,undefined:void 0,Object:Object,Array:Array,String:String,Boolean:Boolean,Number:Number,Date:Date,RegExp:RegExp,Error:Error,URIError:URIError,TypeError:TypeError,RangeError:RangeError,SyntaxError:SyntaxError,ReferenceError:ReferenceError,Float32Array:Float32Array,Float64Array:Float64Array,Uint32Array:Uint32Array,Math:Math,parseInt:parseInt,parseFloat:parseFloat,isNaN:isNaN,isFinite:isFinite,decodeURI:decodeURI,decodeURIComponent:decodeURIComponent,encodeURI:encodeURI,encodeURIComponent:encodeURIComponent,escape:escape,unescape:unescape,eval:yI,Function:_I};"undefined"!=typeof JSON&&(AI.JSON=JSON),"undefined"!=typeof Promise&&(AI.Promise=Promise),"undefined"!=typeof Set&&(AI.Set=Set),"undefined"!=typeof Map&&(AI.Map=Map),"undefined"!=typeof Symbol&&(AI.Symbol=Symbol),"undefined"!=typeof Proxy&&(AI.Proxy=Proxy),"undefined"!=typeof WeakMap&&(AI.WeakMap=WeakMap),"undefined"!=typeof WeakSet&&(AI.WeakSet=WeakSet),"undefined"!=typeof Reflect&&(AI.Reflect=Reflect);var MI=function(){function e(t,n){void 0===t&&(t=e.global),void 0===n&&(n={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:n.ecmaVersion||e.ecmaVersion,timeout:n.timeout||0,rootContext:n.rootContext,globalContextInFunction:void 0===n.globalContextInFunction?e.globalContextInFunction:n.globalContextInFunction,_initEnv:n._initEnv},this.context=t||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var t=e.prototype;return t.initEnvironment=function(e){var t;if(e instanceof SI)t=e;else{var n=null,r=this.createSuperScope(e);this.options.rootContext&&(n=new SI(function(e){return Object.create(e)}(this.options.rootContext),r,dI)),t=new SI(e,n||r,vI)}this.globalScope=t,this.currentScope=this.globalScope,this.globalContext=t.data,this.currentContext=t.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var i=this.options._initEnv;i&&i.call(this)},t.getExecStartTime=function(){return this.execStartTime},t.getExecutionTime=function(){return this.execEndTime-this.execStartTime},t.setExecTimeout=function(e){void 0===e&&(e=0),this.options.timeout=e},t.getOptions=function(){return this.options},t.getGlobalScope=function(){return this.globalScope},t.getCurrentScope=function(){return this.currentScope},t.getCurrentContext=function(){return this.currentContext},t.isInterruptThrow=function(e){return e instanceof $L||e instanceof tI||e instanceof eI},t.createSuperScope=function(e){var t=Object.assign({},AI);return Object.keys(t).forEach((function(n){n in e&&delete t[n]})),new SI(t,null,pI)},t.setCurrentContext=function(e){this.currentContext=e},t.setCurrentScope=function(e){this.currentScope=e},t.evaluate=function(t){var n;if(void 0===t&&(t=""),t)return n=function(e,t){return qR.parse(e,t)}(t,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||e.ecmaVersion}),this.evaluateNode(n,t)},t.appendCode=function(e){return this.evaluate(e)},t.evaluateNode=function(e,t){var n=this;void 0===t&&(t=""),this.value=void 0,this.source=t,this.sourceList.push(t),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var r=this.getCurrentScope(),i=this.getCurrentContext(),a=r.labelStack.concat([]),o=this.callStack.concat([]);try{var s=this.createClosure(e);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),s()}catch(e){throw e}finally{n.setCurrentScope(r),n.setCurrentContext(i),r.labelStack=a,n.callStack=o,this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},t.createErrorMessage=function(e,t,n){var r=e[1].replace("%0",String(t));return null!==n&&(r+=this.getNodePosition(n||this.lastExecNode)),r},t.createError=function(e,t){return new t(e)},t.createThrowError=function(e,t){return this.createError(e,t)},t.createInternalThrowError=function(e,t,n){return this.createError(this.createErrorMessage(e,t,n),e[2])},t.checkTimeout=function(){if(!this.isRunning)return!1;var e=this.options.timeout||0;return Date.now()-this.execStartTime>e},t.getNodePosition=function(e){if(e){return e.loc?" ["+e.loc.start.line+":"+e.loc.start.column+"]":""}return""},t.createClosure=function(e){var t,n=this;switch(e.type){case"BinaryExpression":t=this.binaryExpressionHandler(e);break;case"LogicalExpression":t=this.logicalExpressionHandler(e);break;case"UnaryExpression":t=this.unaryExpressionHandler(e);break;case"UpdateExpression":t=this.updateExpressionHandler(e);break;case"ObjectExpression":t=this.objectExpressionHandler(e);break;case"ArrayExpression":t=this.arrayExpressionHandler(e);break;case"CallExpression":t=this.callExpressionHandler(e);break;case"NewExpression":t=this.newExpressionHandler(e);break;case"MemberExpression":t=this.memberExpressionHandler(e);break;case"ThisExpression":t=this.thisExpressionHandler(e);break;case"SequenceExpression":t=this.sequenceExpressionHandler(e);break;case"Literal":t=this.literalHandler(e);break;case"Identifier":t=this.identifierHandler(e);break;case"AssignmentExpression":t=this.assignmentExpressionHandler(e);break;case"FunctionDeclaration":t=this.functionDeclarationHandler(e);break;case"VariableDeclaration":t=this.variableDeclarationHandler(e);break;case"BlockStatement":case"Program":t=this.programHandler(e);break;case"ExpressionStatement":t=this.expressionStatementHandler(e);break;case"EmptyStatement":t=this.emptyStatementHandler(e);break;case"ReturnStatement":t=this.returnStatementHandler(e);break;case"FunctionExpression":t=this.functionExpressionHandler(e);break;case"IfStatement":t=this.ifStatementHandler(e);break;case"ConditionalExpression":t=this.conditionalExpressionHandler(e);break;case"ForStatement":t=this.forStatementHandler(e);break;case"WhileStatement":t=this.whileStatementHandler(e);break;case"DoWhileStatement":t=this.doWhileStatementHandler(e);break;case"ForInStatement":t=this.forInStatementHandler(e);break;case"WithStatement":t=this.withStatementHandler(e);break;case"ThrowStatement":t=this.throwStatementHandler(e);break;case"TryStatement":t=this.tryStatementHandler(e);break;case"ContinueStatement":t=this.continueStatementHandler(e);break;case"BreakStatement":t=this.breakStatementHandler(e);break;case"SwitchStatement":t=this.switchStatementHandler(e);break;case"LabeledStatement":t=this.labeledStatementHandler(e);break;case"DebuggerStatement":t=this.debuggerStatementHandler(e);break;default:throw this.createInternalThrowError(nI.NodeTypeSyntaxError,e.type,e)}return function(){var r=n.options.timeout;if(r&&r>0&&n.checkTimeout())throw n.createInternalThrowError(nI.ExecutionTimeOutError,r,null);return n.lastExecNode=e,t.apply(void 0,arguments)}},t.binaryExpressionHandler=function(e){var t=this,n=this.createClosure(e.left),r=this.createClosure(e.right);return function(){var i=n(),a=r();switch(e.operator){case"==":return i==a;case"!=":return i!=a;case"===":return i===a;case"!==":return i!==a;case"<":return i<a;case"<=":return i<=a;case">":return i>a;case">=":return i>=a;case"<<":return i<<a;case">>":return i>>a;case">>>":return i>>>a;case"+":return i+a;case"-":return i-a;case"*":return i*a;case"**":return Math.pow(i,a);case"/":return i/a;case"%":return i%a;case"|":return i|a;case"^":return i^a;case"&":return i&a;case"in":return i in a;case"instanceof":return i instanceof a;default:throw t.createInternalThrowError(nI.BinaryOperatorSyntaxError,e.operator,e)}}},t.logicalExpressionHandler=function(e){var t=this,n=this.createClosure(e.left),r=this.createClosure(e.right);return function(){switch(e.operator){case"||":return n()||r();case"&&":return n()&&r();default:throw t.createInternalThrowError(nI.LogicalOperatorSyntaxError,e.operator,e)}}},t.unaryExpressionHandler=function(e){var t=this;switch(e.operator){case"delete":var n=this.createObjectGetter(e.argument),r=this.createNameGetter(e.argument);return function(){return delete n()[r()]};default:var i;if("typeof"===e.operator&&"Identifier"===e.argument.type){var a=this.createObjectGetter(e.argument),o=this.createNameGetter(e.argument);i=function(){return a()[o()]}}else i=this.createClosure(e.argument);return function(){var n=i();switch(e.operator){case"-":return-n;case"+":return+n;case"!":return!n;case"~":return~n;case"void":return;case"typeof":return typeof n;default:throw t.createInternalThrowError(nI.UnaryOperatorSyntaxError,e.operator,e)}}}},t.updateExpressionHandler=function(e){var t=this,n=this.createObjectGetter(e.argument),r=this.createNameGetter(e.argument);return function(){var i=n(),a=r();switch(t.assertVariable(i,a,e),e.operator){case"++":return e.prefix?++i[a]:i[a]++;case"--":return e.prefix?--i[a]:i[a]--;default:throw t.createInternalThrowError(nI.UpdateOperatorSyntaxError,e.operator,e)}}},t.objectExpressionHandler=function(e){var t=this,n=[];var r=Object.create(null);return e.properties.forEach((function(e){var i=e.kind,a=function(e){return"Identifier"===e.type?e.name:"Literal"===e.type?e.value:this.throwError(nI.ObjectStructureSyntaxError,e.type,e)}(e.key);r[a]&&"init"!==i||(r[a]={}),r[a][i]=t.createClosure(e.value),n.push({key:a,property:e})})),function(){for(var e={},t=n.length,i=0;i<t;i++){var a=n[i],o=a.key,s=r[o],u=s.init?s.init():void 0,l=s.get?s.get():function(){},c=s.set?s.set():function(e){};if("set"in s||"get"in s){var h={configurable:!0,enumerable:!0,get:l,set:c};Object.defineProperty(e,o,h)}else{var f=a.property,p=f.kind;"Identifier"!==f.key.type||"FunctionExpression"!==f.value.type||"init"!==p||f.value.id||oI(u,f.key.name),e[o]=u}}return e}},t.arrayExpressionHandler=function(e){var t=this,n=e.elements.map((function(e){return e?t.createClosure(e):e}));return function(){for(var e=n.length,t=Array(e),r=0;r<e;r++){var i=n[r];i&&(t[r]=i())}return t}},t.safeObjectGet=function(e,t,n){return e[t]},t.createCallFunctionGetter=function(e){var t=this;switch(e.type){case"MemberExpression":var n=this.createClosure(e.object),r=this.createMemberKeyGetter(e),i=this.source;return function(){var a=n(),o=r(),s=t.safeObjectGet(a,o,e);if(!s||!gI(s)){var u=i.slice(e.start,e.end);throw t.createInternalThrowError(nI.FunctionUndefinedReferenceError,u,e)}return s.__IS_EVAL_FUNC?function(e){return s(new mI(t),e,!0)}:s.__IS_FUNCTION_FUNC?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return s.apply(void 0,[new mI(t)].concat(n))}:s.bind(a)};default:var a=this.createClosure(e);return function(){var n="";"Identifier"===e.type&&(n=e.name);var r=a();if(!r||!gI(r))throw t.createInternalThrowError(nI.FunctionUndefinedReferenceError,n,e);if("Identifier"===e.type&&r.__IS_EVAL_FUNC&&"eval"===n)return function(e){var i=t.getScopeFromName(n,t.getCurrentScope()),a=i.name===pI||i.name===vI||i.name===dI;return r(new mI(t),e,!a)};if(r.__IS_EVAL_FUNC)return function(e){return r(new mI(t),e,!0)};if(r.__IS_FUNCTION_FUNC)return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return r.apply(void 0,[new mI(t)].concat(n))};var i=t.options.globalContextInFunction;if("Identifier"===e.type){var o=t.getIdentifierScope(e);o.name===fI&&(i=o.data)}return r.bind(i)}}},t.callExpressionHandler=function(e){var t=this,n=this.createCallFunctionGetter(e.callee),r=e.arguments.map((function(e){return t.createClosure(e)}));return function(){return n().apply(void 0,r.map((function(e){return e()})))}},t.functionExpressionHandler=function(e){var t=this,n=this,r=this.source,i=this.collectDeclVars,a=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var o=e.id?e.id.name:"",s=e.params.length,u=e.params.map((function(e){return t.createParamNameGetter(e)})),l=this.createClosure(e.body),c=this.collectDeclVars,h=this.collectDeclFuncs;return this.collectDeclVars=i,this.collectDeclFuncs=a,function(){var t=n.getCurrentScope(),i=function e(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];n.callStack.push(""+o);var s=n.getCurrentScope(),f=TI(t,"FunctionScope("+o+")");n.setCurrentScope(f),n.addDeclarationsToScope(c,h,f),o&&(f.data[o]=e),f.data.arguments=arguments,u.forEach((function(e,t){f.data[e()]=i[t]}));var p=n.getCurrentContext();n.setCurrentContext(this);var d=l();if(n.setCurrentContext(p),n.setCurrentScope(s),n.callStack.pop(),d instanceof bI)return d.value};return oI(i,o),Object.defineProperty(i,"length",{value:s,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(i,"toString",{value:function(){return r.slice(e.start,e.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(i,"valueOf",{value:function(){return r.slice(e.start,e.end)},writable:!0,configurable:!0,enumerable:!1}),i}},t.newExpressionHandler=function(e){var t=this,n=this.source,r=this.createClosure(e.callee),i=e.arguments.map((function(e){return t.createClosure(e)}));return function(){var a=r();if(!gI(a)||a.__IS_EVAL_FUNC){var o=e.callee,s=n.slice(o.start,o.end);throw t.createInternalThrowError(nI.IsNotConstructor,s,e)}return a.__IS_FUNCTION_FUNC?a.apply(void 0,[new mI(t)].concat(i.map((function(e){return e()})))):iI(a,i.map((function(e){return e()})))}},t.memberExpressionHandler=function(e){var t=this.createClosure(e.object),n=this.createMemberKeyGetter(e);return function(){return t()[n()]}},t.thisExpressionHandler=function(e){var t=this;return function(){return t.getCurrentContext()}},t.sequenceExpressionHandler=function(e){var t=this,n=e.expressions.map((function(e){return t.createClosure(e)}));return function(){for(var e,t=n.length,r=0;r<t;r++){e=(0,n[r])()}return e}},t.literalHandler=function(e){return function(){return e.regex?new RegExp(e.regex.pattern,e.regex.flags):e.value}},t.identifierHandler=function(e){var t=this;return function(){var n=t.getCurrentScope(),r=t.getScopeDataFromName(e.name,n);return t.assertVariable(r,e.name,e),r[e.name]}},t.getIdentifierScope=function(e){var t=this.getCurrentScope();return this.getScopeFromName(e.name,t)},t.assignmentExpressionHandler=function(e){var t=this;"Identifier"!==e.left.type||"FunctionExpression"!==e.right.type||e.right.id||(e.right.id={type:"Identifier",name:e.left.name});var n=this.createObjectGetter(e.left),r=this.createNameGetter(e.left),i=this.createClosure(e.right);return function(){var a=n(),o=r(),s=i();switch("="!==e.operator&&t.assertVariable(a,o,e),e.operator){case"=":return a[o]=s;case"+=":return a[o]+=s;case"-=":return a[o]-=s;case"*=":return a[o]*=s;case"**=":return a[o]=Math.pow(a[o],s);case"/=":return a[o]/=s;case"%=":return a[o]%=s;case"<<=":return a[o]<<=s;case">>=":return a[o]>>=s;case">>>=":return a[o]>>>=s;case"&=":return a[o]&=s;case"^=":return a[o]^=s;case"|=":return a[o]|=s;default:throw t.createInternalThrowError(nI.AssignmentExpressionSyntaxError,e.type,e)}}},t.functionDeclarationHandler=function(e){if(e.id){var t=this.functionExpressionHandler(e);Object.defineProperty(t,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(e.id.name,t)}return function(){return hI}},t.getVariableName=function(e){if("Identifier"===e.type)return e.name;throw this.createInternalThrowError(nI.VariableTypeSyntaxError,e.type,e)},t.variableDeclarationHandler=function(e){for(var t,n=this,r=[],i=0;i<e.declarations.length;i++){var a=e.declarations[i];this.varDeclaration(this.getVariableName(a.id)),a.init&&r.push({type:"AssignmentExpression",operator:"=",left:a.id,right:a.init})}return r.length&&(t=this.createClosure({type:"BlockStatement",body:r})),function(){if(t){var e=n.isVarDeclMode;n.isVarDeclMode=!0,t(),n.isVarDeclMode=e}return hI}},t.assertVariable=function(e,t,n){if(e===this.globalScope.data&&!(t in e))throw this.createInternalThrowError(nI.VariableUndefinedReferenceError,t,n)},t.programHandler=function(e){var t=this,n=e.body.map((function(e){return t.createClosure(e)}));return function(){for(var e=hI,r=0;r<n.length;r++){var i=n[r],a=t.setValue(i());if(a!==hI&&((e=a)instanceof bI||e instanceof xI||e instanceof EI||e===uI||e===lI))break}return e}},t.expressionStatementHandler=function(e){return this.createClosure(e.expression)},t.emptyStatementHandler=function(e){return function(){return hI}},t.returnStatementHandler=function(e){var t=e.argument?this.createClosure(e.argument):CI;return function(){return new bI(t())}},t.ifStatementHandler=function(e){var t=this.createClosure(e.test),n=this.createClosure(e.consequent),r=e.alternate?this.createClosure(e.alternate):
/*!important*/
function(){return hI};return function(){return t()?n():r()}},t.conditionalExpressionHandler=function(e){return this.ifStatementHandler(e)},t.forStatementHandler=function(e){var t=this,n=CI,r=e.test?this.createClosure(e.test):function(){return!0},i=CI,a=this.createClosure(e.body);return"ForStatement"===e.type&&(n=e.init?this.createClosure(e.init):n,i=e.update?this.createClosure(e.update):CI),function(o){var s,u=hI,l="DoWhileStatement"===e.type;for(o&&"LabeledStatement"===o.type&&(s=o.label.name),n();l||r();i()){l=!1;var c=t.setValue(a());if(c!==hI&&c!==lI){if(c===uI)break;if((u=c)instanceof EI&&u.value===s)u=hI;else if(u instanceof bI||u instanceof xI||u instanceof EI)break}}return u}},t.whileStatementHandler=function(e){return this.forStatementHandler(e)},t.doWhileStatementHandler=function(e){return this.forStatementHandler(e)},t.forInStatementHandler=function(e){var t=this,n=e.left,r=this.createClosure(e.right),i=this.createClosure(e.body);return"VariableDeclaration"===e.left.type&&(this.createClosure(e.left)(),n=e.left.declarations[0].id),function(e){var a,o,s=hI;e&&"LabeledStatement"===e.type&&(a=e.label.name);var u=r();for(o in u){t.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:n,right:{type:"Literal",value:o}})();var l=t.setValue(i());if(l!==hI&&l!==lI){if(l===uI)break;if((s=l)instanceof EI&&s.value===a)s=hI;else if(s instanceof bI||s instanceof xI||s instanceof EI)break}}return s}},t.withStatementHandler=function(e){var t=this,n=this.createClosure(e.object),r=this.createClosure(e.body);return function(){var e=n(),i=t.getCurrentScope(),a=new SI(e,i,fI);t.setCurrentScope(a);var o=t.setValue(r());return t.setCurrentScope(i),o}},t.throwStatementHandler=function(e){var t=this,n=this.createClosure(e.argument);return function(){throw t.setValue(void 0),n()}},t.tryStatementHandler=function(e){var t=this,n=this.createClosure(e.block),r=e.handler?this.catchClauseHandler(e.handler):null,i=e.finalizer?this.createClosure(e.finalizer):null;return function(){var e,a,o=t.getCurrentScope(),s=t.getCurrentContext(),u=o.labelStack.concat([]),l=t.callStack.concat([]),c=hI,h=function(){t.setCurrentScope(o),t.setCurrentContext(s),o.labelStack=u,t.callStack=l};try{(c=t.setValue(n()))instanceof bI&&(e=c)}catch(n){if(h(),t.isInterruptThrow(n))throw n;if(r)try{(c=t.setValue(r(n)))instanceof bI&&(e=c)}catch(e){if(h(),t.isInterruptThrow(e))throw e;a=e}}if(i)try{(c=i())instanceof bI&&(e=c)}catch(e){if(h(),t.isInterruptThrow(e))throw e;a=e}if(a)throw a;return e||c}},t.catchClauseHandler=function(e){var t=this,n=this.createParamNameGetter(e.param),r=this.createClosure(e.body);return function(e){var i,a=t.getCurrentScope().data,o=n(),s=sI.call(a,o),u=a[o];return a[o]=e,i=r(),s?a[o]=u:delete a[o],i}},t.continueStatementHandler=function(e){return function(){return e.label?new EI(e.label.name):lI}},t.breakStatementHandler=function(e){return function(){return e.label?new xI(e.label.name):uI}},t.switchStatementHandler=function(e){var t=this,n=this.createClosure(e.discriminant),r=e.cases.map((function(e){return t.switchCaseHandler(e)}));return function(){for(var e,i,a,o=n(),s=!1,u=0;u<r.length;u++){var l=r[u](),c=l.testClosure();if(c!==cI){if(s||c===o){if(s=!0,(i=t.setValue(l.bodyClosure()))===hI)continue;if(i===uI)break;if((e=i)instanceof bI||e instanceof xI||e instanceof EI||e===lI)break}}else a=l}!s&&a&&((i=t.setValue(a.bodyClosure()))===hI||i===uI||i===lI||(e=i));return e}},t.switchCaseHandler=function(e){var t=e.test?this.createClosure(e.test):function(){return cI},n=this.createClosure({type:"BlockStatement",body:e.consequent});return function(){return{testClosure:t,bodyClosure:n}}},t.labeledStatementHandler=function(e){var t=this,n=e.label.name,r=this.createClosure(e.body);return function(){var i,a=t.getCurrentScope();return a.labelStack.push(n),(i=r(e))instanceof xI&&i.value===n&&(i=hI),a.labelStack.pop(),i}},t.debuggerStatementHandler=function(e){return function(){return hI}},t.createParamNameGetter=function(e){if("Identifier"===e.type)return function(){return e.name};throw this.createInternalThrowError(nI.ParamTypeSyntaxError,e.type,e)},t.createObjectKeyGetter=function(e){var t;return t="Identifier"===e.type?function(){return e.name}:this.createClosure(e),function(){return t()}},t.createMemberKeyGetter=function(e){return e.computed?this.createClosure(e.property):this.createObjectKeyGetter(e.property)},t.createObjectGetter=function(e){var t=this;switch(e.type){case"Identifier":return function(){return t.getScopeDataFromName(e.name,t.getCurrentScope())};case"MemberExpression":return this.createClosure(e.object);default:throw this.createInternalThrowError(nI.AssignmentTypeSyntaxError,e.type,e)}},t.createNameGetter=function(e){switch(e.type){case"Identifier":return function(){return e.name};case"MemberExpression":return this.createMemberKeyGetter(e);default:throw this.createInternalThrowError(nI.AssignmentTypeSyntaxError,e.type,e)}},t.varDeclaration=function(e){this.collectDeclVars[e]=void 0},t.funcDeclaration=function(e,t){this.collectDeclFuncs[e]=t},t.addDeclarationsToScope=function(e,t,n){var r=n.data;for(var i in t){var a=t[i];r[i]=a?a():a}for(var o in e)o in r||(r[o]=void 0)},t.getScopeValue=function(e,t){return this.getScopeFromName(e,t).data[e]},t.getScopeDataFromName=function(e,t){return this.getScopeFromName(e,t).data},t.getScopeFromName=function(e,t){var n=t;do{if(e in n.data)return n}while(n=n.parent);return this.globalScope},t.setValue=function(e){var t=this.callStack.length;return this.isVarDeclMode||t||e===hI||e===uI||e===lI||e instanceof xI||e instanceof EI||(this.value=e instanceof bI?e.value:e),e},t.getValue=function(){return this.value},e}();MI.version="0.0.3",MI.eval=yI,MI.Function=_I,MI.ecmaVersion=5,MI.globalContextInFunction=void 0,MI.global=Object.create(null);var wI,kI,OI,PI,RI,LI,II,NI,DI,FI,BI,UI,zI,jI,VI=function(e,t,n){return function(e,t,n){return new MI(t,n).evaluate(e)}(e,t,n)},GI=H((function(e,t){e.exports=function(e){var t=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},n=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e};function r(e){return"undefined"!=typeof atob?atob(e):"base64:"+e}function i(e){var t=new Error("(regl) "+e);throw console.error(t),t}function a(e,t){e||i(t)}function o(e){return e?": "+e:""}function s(e,t){switch(t){case"number":return"number"==typeof e;case"object":return"object"==typeof e;case"string":return"string"==typeof e;case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"undefined":return void 0===e;case"symbol":return"symbol"==typeof e}}function u(e,t,n){t.indexOf(e)<0&&i("invalid value"+o(n)+". must be one of: "+t)}var l=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function c(e,t){for(e+="";e.length<t;)e=" "+e;return e}function h(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function f(e,t){this.number=e,this.line=t,this.errors=[]}function p(e,t,n){this.file=e,this.line=t,this.message=n}function d(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function v(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function g(e,t){var n=e.split("\n"),i=1,a=0,o={unknown:new h,0:new h};o.unknown.name=o[0].name=t||d(),o.unknown.lines.push(new f(0,""));for(var s=0;s<n.length;++s){var u=n[s],l=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(l)switch(l[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(l[2]);c&&(i=0|c[1],c[2]&&((a=0|c[2])in o||(o[a]=new h)));break;case"define":var p=/SHADER_NAME(_B64)?\s+(.*)$/.exec(l[2]);p&&(o[a].name=p[1]?r(p[2]):p[2])}o[a].lines.push(new f(i++,u))}return Object.keys(o).forEach((function(e){var t=o[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),o}function m(e){e._commandRef=d()}function y(e,t){var n=v();i(e+" in command "+(t||d())+("unknown"===n?"":" called from "+n))}function _(e,t,n,r){s(e,t)||y("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e,r||d())}var b={};function x(e,t){return 32820===e||32819===e||33635===e?2:34042===e?4:b[e]*t}function E(e){return!(e&e-1||!e)}b[5120]=b[5121]=1,b[5122]=b[5123]=b[36193]=b[33635]=b[32819]=b[32820]=2,b[5124]=b[5125]=b[5126]=b[34042]=4;var S=n(a,{optional:function(e){e()},raise:i,commandRaise:y,command:function(e,t,n){e||y(t,n||d())},parameter:function(e,t,n){e in t||i("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,n,r){e in t||y("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join(),r||d())},constructor:function(e){Object.keys(e).forEach((function(e){l.indexOf(e)<0&&i('invalid regl constructor argument "'+e+'". must be one of '+l)}))},type:function(e,t,n){s(e,t)||i("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e)},commandType:_,isTypedArray:function(e,n){t(e)||i("invalid parameter type"+o(n)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||i("invalid parameter type, ("+e+")"+o(t)+". must be a nonnegative integer")},oneOf:u,shaderError:function(e,t,n,r,i){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var o=e.getShaderInfoLog(t),s=r===e.FRAGMENT_SHADER?"fragment":"vertex";_(n,"string",s+" shader source must be a string",i);var u=g(n,i),l=function(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new p(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new p("unknown",0,e))}})),t}(o);!function(e,t){t.forEach((function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))}(u,l),Object.keys(u).forEach((function(e){var t=u[e];if(t.hasErrors){var n=[""],r=[""];i("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){i(c(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),i(e.line+"\n","color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(n){var r=n.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(r);if(a){var o=a[1];switch(r=a[2],o){case"assign":o="="}t=Math.max(e.line.indexOf(o,t),0)}else t=0;i(c("| ",6)),i(c("^^^",t+3)+"\n","font-weight:bold"),i(c("| ",6)),i(r+"\n","font-weight:bold")})),i(c("| ",6)+"\n")}else i(c(e.number,4)+"|  "),i(e.line+"\n","color:red")})),"undefined"==typeof document||window.chrome?console.log(n.join("")):(r[0]=n.join("%c"),console.log.apply(console,r))}function i(e,t){n.push(e),r.push(t||"")}})),a.raise("Error compiling "+s+" shader, "+u[0].name)}},linkError:function(e,t,n,r,i){if(!e.getProgramParameter(t,e.LINK_STATUS)){var o=e.getProgramInfoLog(t),s=g(n,i),u='Error linking program with vertex shader, "'+g(r,i)[0].name+'", and fragment shader "'+s[0].name+'"';"undefined"!=typeof document?console.log("%c"+u+"\n%c"+o,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(u+"\n"+o),a.raise(u)}},callSite:v,saveCommandRef:m,saveDrawInfo:function(e,t,n,r){function i(e){return e?r.id(e):0}function a(e,t){Object.keys(t).forEach((function(t){e[r.id(t)]=!0}))}m(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var o=e._uniformSet={};a(o,t.static),a(o,t.dynamic);var s=e._attributeSet={};a(s,n.static),a(s,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,n){e.texture?u(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):u(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")},guessCommand:d,texture2D:function(e,t,n){var r,i=t.width,o=t.height,s=t.channels;a(i>0&&i<=n.maxTextureSize&&o>0&&o<=n.maxTextureSize,"invalid texture shape"),33071===e.wrapS&&33071===e.wrapT||a(E(i)&&E(o),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==i&&1!==o&&a(9984!==e.minFilter&&9986!==e.minFilter&&9985!==e.minFilter&&9987!==e.minFilter,"min filter requires mipmap"):(a(E(i)&&E(o),"texture must be a square power of 2 to support mipmapping"),a(t.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),5126===t.type&&(n.extensions.indexOf("oes_texture_float_linear")<0&&a(9728===e.minFilter&&9728===e.magFilter,"filter not supported, must enable oes_texture_float_linear"),a(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(r=0;r<16;++r)if(u[r]){var l=i>>r,c=o>>r;a(t.mipmask&1<<r,"missing mipmap data");var h=u[r];if(a(h.width===l&&h.height===c,"invalid shape for mip images"),a(h.format===t.format&&h.internalformat===t.internalformat&&h.type===t.type,"incompatible type for mip image"),h.compressed);else if(h.data){var f=Math.ceil(x(h.type,s)*l/h.unpackAlignment)*h.unpackAlignment;a(h.data.byteLength===f*c,"invalid data for image, buffer size is inconsistent with image format")}else h.element||h.copy}else e.genMipmaps||a(0==(t.mipmask&1<<r),"extra mipmap data");t.compressed&&a(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,n,r){var i=e.width,o=e.height,s=e.channels;a(i>0&&i<=r.maxTextureSize&&o>0&&o<=r.maxTextureSize,"invalid texture shape"),a(i===o,"cube map must be square"),a(33071===t.wrapS&&33071===t.wrapT,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var l=n[u];a(l.width===i&&l.height===o,"inconsistent cube map face shape"),t.genMipmaps&&(a(!l.compressed,"can not generate mipmap for compressed textures"),a(1===l.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=l.images,h=0;h<16;++h){var f=c[h];if(f){var p=i>>h,d=o>>h;a(l.mipmask&1<<h,"missing mipmap data"),a(f.width===p&&f.height===d,"invalid shape for mip images"),a(f.format===e.format&&f.internalformat===e.internalformat&&f.type===e.type,"incompatible type for mip image"),f.compressed||(f.data?a(f.data.byteLength===p*d*Math.max(x(f.type,s),f.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):f.element||f.copy)}}}}}),C=0;function T(e,t){this.id=C++,this.type=e,this.data=t}function A(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function M(e){return"["+function e(t){if(0===t.length)return[];var n=t.charAt(0),r=t.charAt(t.length-1);if(t.length>1&&n===r&&('"'===n||"'"===n))return['"'+A(t.substr(1,t.length-2))+'"'];var i=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(i)return e(t.substr(0,i.index)).concat(e(i[1])).concat(e(t.substr(i.index+i[0].length)));var a=t.split(".");if(1===a.length)return['"'+A(t)+'"'];for(var o=[],s=0;s<a.length;++s)o=o.concat(e(a[s]));return o}(e).join("][")+"]"}var w={DynamicVariable:T,define:function(e,t){return new T(e,M(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof T},unbox:function e(t,n){return"function"==typeof t?new T(0,t):"number"==typeof t||"boolean"==typeof t?new T(5,t):Array.isArray(t)?new T(6,t.map((function(t,r){return e(t,n+"["+r+"]")}))):t instanceof T?t:void S(!1,"invalid option type in uniform "+n)},accessor:M},k={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},O="undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM?function(){return+new Date}:"undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function P(e){return"string"==typeof e?e.split():(S(Array.isArray(e),"invalid extension array"),e)}function R(e){return"string"==typeof e?(S("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function L(e){var t,r,i,a,o,s=e||{},u={},l=[],c=[],h="undefined"==typeof window?1:window.devicePixelRatio,f=!1,p=function(e){e&&S.raise(e)},d=function(){};if("string"==typeof s?(S("undefined"!=typeof document,"selector queries only supported in DOM environments"),t=document.querySelector(s),S(t,"invalid query string for element")):"object"==typeof s?"string"==typeof(o=s).nodeName&&"function"==typeof o.appendChild&&"function"==typeof o.getBoundingClientRect?t=s:function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(s)?i=(a=s).canvas:(S.constructor(s),"gl"in s?a=s.gl:"canvas"in s?i=R(s.canvas):"container"in s&&(r=R(s.container)),"attributes"in s&&(u=s.attributes,S.type(u,"object","invalid context attributes")),"extensions"in s&&(l=P(s.extensions)),"optionalExtensions"in s&&(c=P(s.optionalExtensions)),"onDone"in s&&(S.type(s.onDone,"function","invalid or missing onDone callback"),p=s.onDone),"profile"in s&&(f=!!s.profile),"pixelRatio"in s&&(h=+s.pixelRatio,S(h>0,"invalid pixel ratio"))):S.raise("invalid arguments to regl"),t&&("canvas"===t.nodeName.toLowerCase()?i=t:r=t),!a){if(!i){S("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var v=function(e,t,r){var i,a=document.createElement("canvas");function o(){var t=window.innerWidth,n=window.innerHeight;if(e!==document.body){var i=a.getBoundingClientRect();t=i.right-i.left,n=i.bottom-i.top}a.width=r*t,a.height=r*n}return n(a.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),e.appendChild(a),e===document.body&&(a.style.position="absolute",n(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(o)}))).observe(e):window.addEventListener("resize",o,!1),o(),{canvas:a,onDestroy:function(){i?i.disconnect():window.removeEventListener("resize",o),e.removeChild(a)}}}(r||document.body,0,h);if(!v)return null;i=v.canvas,d=v.onDestroy}void 0===u.premultipliedAlpha&&(u.premultipliedAlpha=!0),a=function(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(i,u)}return a?{gl:a,canvas:i,container:r,extensions:l,optionalExtensions:c,pixelRatio:h,profile:f,onDone:p,onDestroy:d}:(d(),p("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function I(e,t){var n={};function r(t){S.type(t,"string","extension name must be string");var r,i=t.toLowerCase();try{r=n[i]=function(t){return e.getExtension(t)?e.getExtension(t):e.getExtension(t.toLowerCase())?e.getExtension(t.toLowerCase()):null}(t)}catch(e){}return!!r}for(var i=0;i<t.extensions.length;++i){var a=t.extensions[i];if(!r(a))return t.onDestroy(),t.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)}))}}}function N(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}function D(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function F(){var e=N(8,(function(){return[]}));function t(t){var n=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(t),r=e[D(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[D(t.byteLength)>>2].push(t)}return{alloc:t,free:n,allocType:function(e,n){var r=null;switch(e){case 5120:r=new Int8Array(t(n),0,n);break;case 5121:r=new Uint8Array(t(n),0,n);break;case 5122:r=new Int16Array(t(2*n),0,n);break;case 5123:r=new Uint16Array(t(2*n),0,n);break;case 5124:r=new Int32Array(t(4*n),0,n);break;case 5125:r=new Uint32Array(t(4*n),0,n);break;case 5126:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(e){n(e.buffer)}}}var B=F();function U(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||t(e.data))}B.zero=F();var z=function(e){return Object.keys(e).map((function(t){return e[t]}))},j={shape:function(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t},flatten:function(e,t,n,r){var i=1;if(t.length)for(var a=0;a<t.length;++a)i*=t[a];else i=0;var o=r||B.allocType(n,i);switch(t.length){case 0:break;case 1:!function(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}(e,t[0],o);break;case 2:!function(e,t,n,r){for(var i=0,a=0;a<t;++a)for(var o=e[a],s=0;s<n;++s)r[i++]=o[s]}(e,t[0],t[1],o);break;case 3:V(e,t[0],t[1],t[2],o,0);break;default:!function e(t,n,r,i,a){for(var o=1,s=r+1;s<n.length;++s)o*=n[s];var u=n[r];if(n.length-r==4){var l=n[r+1],c=n[r+2],h=n[r+3];for(s=0;s<u;++s)V(t[s],l,c,h,i,a),a+=o}else for(s=0;s<u;++s)e(t[s],n,r+1,i,a),a+=o}(e,t,0,o,0)}return o}};function V(e,t,n,r,i,a){for(var o=a,s=0;s<t;++s)for(var u=e[s],l=0;l<n;++l)for(var c=u[l],h=0;h<r;++h)i[o++]=c[h]}var G={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},H={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},W={dynamic:35048,stream:35040,static:35044},X=j.flatten,Y=j.shape,Z=[];function q(e){return 0|G[Object.prototype.toString.call(e)]}function K(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function Q(e,t,n,r,i,a,o){for(var s=0,u=0;u<n;++u)for(var l=0;l<r;++l)e[s++]=t[i*u+a*l+o]}Z[5120]=1,Z[5122]=2,Z[5124]=4,Z[5121]=1,Z[5123]=2,Z[5125]=4,Z[5126]=4;var J={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},$=new Float32Array(1),ee=new Uint32Array($.buffer);function te(e){for(var t=B.allocType(5123,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{$[0]=e[n];var r=ee[0],i=r>>>31<<15,a=(r<<1>>>24)-127,o=r>>13&1023;if(a<-24)t[n]=i;else if(a<-14){var s=-14-a;t[n]=i+(o+1024>>s)}else t[n]=a>15?i+31744:i+(a+15<<10)+o}return t}function ne(e){return Array.isArray(e)||t(e)}var re=function(e){return!(e&e-1||!e)},ie=[9984,9986,9985,9987],ae=[0,6409,6410,6407,6408],oe={};function se(e){return"[object "+e+"]"}oe[6409]=oe[6406]=oe[6402]=1,oe[34041]=oe[6410]=2,oe[6407]=oe[35904]=3,oe[6408]=oe[35906]=4;var ue=se("HTMLCanvasElement"),le=se("OffscreenCanvas"),ce=se("CanvasRenderingContext2D"),he=se("ImageBitmap"),fe=se("HTMLImageElement"),pe=se("HTMLVideoElement"),de=Object.keys(G).concat([ue,le,ce,he,fe,pe]),ve=[];ve[5121]=1,ve[5126]=4,ve[36193]=2,ve[5123]=2,ve[5125]=4;var ge=[];function me(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function ye(e){return!!Array.isArray(e)&&!(0===e.length||!ne(e[0]))}function _e(e){return Object.prototype.toString.call(e)}function be(e){return _e(e)===ue}function xe(e){return _e(e)===le}function Ee(e){return!!("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM&&e&&e.getContext)}function Se(e){return!!("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM&&e&&"src"in e&&"crossOrigin"in e)}function Ce(e){if(!e)return!1;if(Ee(e)||Se(e))return!0;var t=_e(e);return de.indexOf(t)>=0||me(e)||ye(e)||U(e)}function Te(e){return 0|G[Object.prototype.toString.call(e)]}function Ae(e,t){return B.allocType(36193===e.type?5126:e.type,t)}function Me(e,t){36193===e.type?(e.data=te(t),B.freeType(t)):e.data=t}function we(e,t,n,r,i,a){var o;if(o=void 0!==ge[e]?ge[e]:oe[e]*ve[t],a&&(o*=6),i){for(var s=0,u=n;u>=1;)s+=o*u*u,u/=2;return s}return o*n*r}function ke(e,r,i,a,o,s,u){var l={"don't care":4352,"dont care":4352,nice:4354,fast:4353},c={repeat:10497,clamp:33071,mirror:33648},h={nearest:9728,linear:9729},f=n({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},h),p={none:0,browser:37444},d={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},v={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},g={};r.ext_srgb&&(v.srgb=35904,v.srgba=35906),r.oes_texture_float&&(d.float32=d.float=5126),r.oes_texture_half_float&&(d.float16=d["half float"]=36193),r.webgl_depth_texture&&(n(v,{depth:6402,"depth stencil":34041}),n(d,{uint16:5123,uint32:5125,"depth stencil":34042})),r.webgl_compressed_texture_s3tc&&n(g,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),r.webgl_compressed_texture_atc&&n(g,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),r.webgl_compressed_texture_pvrtc&&n(g,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),r.webgl_compressed_texture_etc1&&(g["rgb etc1"]=36196);var m=Array.prototype.slice.call(e.getParameter(34467)||new Uint32Array(0));Object.keys(g).forEach((function(e){var t=g[e];m.indexOf(t)>=0&&(v[e]=t)}));var y=Object.keys(v);i.textureFormats=y;var _=[];Object.keys(v).forEach((function(e){var t=v[e];_[t]=e}));var b=[];Object.keys(d).forEach((function(e){var t=d[e];b[t]=e}));var x=[];Object.keys(h).forEach((function(e){x[h[e]]=e}));var E=[];Object.keys(f).forEach((function(e){var t=f[e];E[t]=e}));var C=[];Object.keys(c).forEach((function(e){C[c[e]]=e}));var T=y.reduce((function(e,t){var n=v[t];return 6409===n||6406===n||6409===n||6410===n||6402===n||34041===n||r.ext_srgb&&(35904===n||35906===n)?e[n]=n:32855===n||t.indexOf("rgba")>=0?e[n]=6408:e[n]=6407,e}),{});function A(){this.internalformat=6408,this.format=6408,this.type=5121,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=37444,this.width=0,this.height=0,this.channels=0}function M(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function w(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(S.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(S.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(S.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(S.parameter(t.colorSpace,p,"invalid colorSpace"),e.colorSpace=p[t.colorSpace]),"type"in t){var n=t.type;S(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),S(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),S(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),S.parameter(n,d,"invalid texture type"),e.type=d[n]}var a=e.width,o=e.height,s=e.channels,u=!1;"shape"in t?(S(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),a=t.shape[0],o=t.shape[1],3===t.shape.length&&(s=t.shape[2],S(s>0&&s<=4,"invalid number of channels"),u=!0),S(a>=0&&a<=i.maxTextureSize,"invalid width"),S(o>=0&&o<=i.maxTextureSize,"invalid height")):("radius"in t&&(a=o=t.radius,S(a>=0&&a<=i.maxTextureSize,"invalid radius")),"width"in t&&(a=t.width,S(a>=0&&a<=i.maxTextureSize,"invalid width")),"height"in t&&(o=t.height,S(o>=0&&o<=i.maxTextureSize,"invalid height")),"channels"in t&&(s=t.channels,S(s>0&&s<=4,"invalid number of channels"),u=!0)),e.width=0|a,e.height=0|o,e.channels=0|s;var l=!1;if("format"in t){var c=t.format;S(r.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),S.parameter(c,v,"invalid texture format");var h=e.internalformat=v[c];e.format=T[h],c in d&&("type"in t||(e.type=d[c])),c in g&&(e.compressed=!0),l=!0}!u&&l?e.channels=oe[e.format]:u&&!l?e.channels!==ae[e.format]&&(e.format=e.internalformat=ae[e.channels]):l&&u&&S(e.channels===oe[e.format],"number of channels inconsistent with specified format")}}function k(t){e.pixelStorei(37440,t.flipY),e.pixelStorei(37441,t.premultiplyAlpha),e.pixelStorei(37443,t.colorSpace),e.pixelStorei(3317,t.unpackAlignment)}function O(){A.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function P(e,n){var r=null;if(Ce(n)?r=n:n&&(S.type(n,"object","invalid pixel data type"),w(e,n),"x"in n&&(e.xOffset=0|n.x),"y"in n&&(e.yOffset=0|n.y),Ce(n.data)&&(r=n.data)),S(!e.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){S(!r,"can not specify copy and data field for the same texture");var a=o.viewportWidth,s=o.viewportHeight;e.width=e.width||a-e.xOffset,e.height=e.height||s-e.yOffset,e.needsCopy=!0,S(e.xOffset>=0&&e.xOffset<a&&e.yOffset>=0&&e.yOffset<s&&e.width>0&&e.width<=a&&e.height>0&&e.height<=s,"copy texture read out of bounds")}else if(r){if(t(r))e.channels=e.channels||4,e.data=r,"type"in n||5121!==e.type||(e.type=Te(r));else if(me(r))e.channels=e.channels||4,function(e,t){var n=t.length;switch(e.type){case 5121:case 5123:case 5125:case 5126:var r=B.allocType(e.type,n);r.set(t),e.data=r;break;case 36193:e.data=te(t);break;default:S.raise("unsupported texture type, must specify a typed array")}}(e,r),e.alignment=1,e.needsFree=!0;else if(U(r)){var u=r.data;Array.isArray(u)||5121!==e.type||(e.type=Te(u));var l,c,h,f,p,d,v=r.shape,g=r.stride;3===v.length?(h=v[2],d=g[2]):(S(2===v.length,"invalid ndarray pixel data, must be 2 or 3D"),h=1,d=1),l=v[0],c=v[1],f=g[0],p=g[1],e.alignment=1,e.width=l,e.height=c,e.channels=h,e.format=e.internalformat=ae[h],e.needsFree=!0,function(e,t,n,r,i,a){for(var o=e.width,s=e.height,u=e.channels,l=Ae(e,o*s*u),c=0,h=0;h<s;++h)for(var f=0;f<o;++f)for(var p=0;p<u;++p)l[c++]=t[n*f+r*h+i*p+a];Me(e,l)}(e,u,f,p,d,r.offset)}else if(Ee(r)||be(r)||xe(r)||function(e){return _e(e)===ce}(r))Ee(r)||be(r)||xe(r)?e.element=r:e.element=r.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(function(e){return _e(e)===he}(r))e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(function(e){return _e(e)===fe}(r))e.element=r,e.width=r.naturalWidth,e.height=r.naturalHeight,e.channels=4;else if(Se(r))e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(function(e){return _e(e)===pe}(r))e.element=r,e.width=r.videoWidth,e.height=r.videoHeight,e.channels=4;else if(ye(r)){var m=e.width||r[0].length,y=e.height||r.length,_=e.channels;_=ne(r[0][0])?_||r[0][0].length:_||1;for(var b=j.shape(r),x=1,E=0;E<b.length;++E)x*=b[E];var C=Ae(e,x);j.flatten(r,b,"",C),Me(e,C),e.alignment=1,e.width=m,e.height=y,e.channels=_,e.format=e.internalformat=ae[_],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4;5126===e.type?S(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):36193===e.type&&S(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function R(t,n,r){var i=t.element,o=t.data,s=t.internalformat,u=t.format,l=t.type,c=t.width,h=t.height;k(t),i?e.texImage2D(n,r,u,u,l,i):t.compressed?e.compressedTexImage2D(n,r,s,c,h,0,o):t.needsCopy?(a(),e.copyTexImage2D(n,r,u,t.xOffset,t.yOffset,c,h,0)):e.texImage2D(n,r,u,c,h,0,u,l,o||null)}function L(t,n,r,i,o){var s=t.element,u=t.data,l=t.internalformat,c=t.format,h=t.type,f=t.width,p=t.height;k(t),s?e.texSubImage2D(n,o,r,i,c,h,s):t.compressed?e.compressedTexSubImage2D(n,o,r,i,l,f,p,u):t.needsCopy?(a(),e.copyTexSubImage2D(n,o,r,i,t.xOffset,t.yOffset,f,p)):e.texSubImage2D(n,o,r,i,f,p,c,h,u)}var I=[];function N(){return I.pop()||new O}function D(e){e.needsFree&&B.freeType(e.data),O.call(e),I.push(e)}function F(){A.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function V(e,t,n){var r=e.images[0]=N();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function G(e,t){var n=null;if(Ce(t))M(n=e.images[0]=N(),e),P(n,t),e.mipmask=1;else if(w(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)M(n=e.images[i]=N(),e),n.width>>=i,n.height>>=i,P(n,r[i]),e.mipmask|=1<<i;else M(n=e.images[0]=N(),e),P(n,t),e.mipmask=1;M(e,e.images[0]),!e.compressed||33776!==e.internalformat&&33777!==e.internalformat&&33778!==e.internalformat&&33779!==e.internalformat||S(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function H(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;R(n[r],t,r)}}var W=[];function X(){var e=W.pop()||new F;A.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function Y(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&D(t[n]),t[n]=null;W.push(e)}function Z(){this.minFilter=9728,this.magFilter=9728,this.wrapS=33071,this.wrapT=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function q(e,t){if("min"in t){var n=t.min;S.parameter(n,f),e.minFilter=f[n],ie.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;S.parameter(r,h),e.magFilter=h[r]}var a=e.wrapS,o=e.wrapT;if("wrap"in t){var s=t.wrap;"string"==typeof s?(S.parameter(s,c),a=o=c[s]):Array.isArray(s)&&(S.parameter(s[0],c),S.parameter(s[1],c),a=c[s[0]],o=c[s[1]])}else{if("wrapS"in t){var u=t.wrapS;S.parameter(u,c),a=c[u]}if("wrapT"in t){var p=t.wrapT;S.parameter(p,c),o=c[p]}}if(e.wrapS=a,e.wrapT=o,"anisotropic"in t){var d=t.anisotropic;S("number"==typeof d&&d>=1&&d<=i.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var v=!1;switch(typeof t.mipmap){case"string":S.parameter(t.mipmap,l,"invalid mipmap hint"),e.mipmapHint=l[t.mipmap],e.genMipmaps=!0,v=!0;break;case"boolean":v=e.genMipmaps=t.mipmap;break;case"object":S(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,v=!0;break;default:S.raise("invalid mipmap type")}v&&!("min"in t)&&(e.minFilter=9984)}}function K(t,n){e.texParameteri(n,10241,t.minFilter),e.texParameteri(n,10240,t.magFilter),e.texParameteri(n,10242,t.wrapS),e.texParameteri(n,10243,t.wrapT),r.ext_texture_filter_anisotropic&&e.texParameteri(n,34046,t.anisotropic),t.genMipmaps&&(e.hint(33170,t.mipmapHint),e.generateMipmap(n))}var Q=0,J={},$=i.maxTextureUnits,ee=Array($).map((function(){return null}));function se(t){A.call(this),this.mipmask=0,this.internalformat=6408,this.id=Q++,this.refCount=1,this.target=t,this.texture=e.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Z,u.profile&&(this.stats={size:0})}function ue(t){e.activeTexture(33984),e.bindTexture(t.target,t.texture)}function le(){var t=ee[0];t?e.bindTexture(t.target,t.texture):e.bindTexture(3553,null)}function de(t){var n=t.texture;S(n,"must not double destroy texture");var r=t.unit,i=t.target;r>=0&&(e.activeTexture(33984+r),e.bindTexture(i,null),ee[r]=null),e.deleteTexture(n),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete J[t.id],s.textureCount--}return n(se.prototype,{bind:function(){this.bindCount+=1;var t=this.unit;if(t<0){for(var n=0;n<$;++n){var r=ee[n];if(r){if(r.bindCount>0)continue;r.unit=-1}ee[n]=this,t=n;break}t>=$&&S.raise("insufficient number of texture units"),u.profile&&s.maxTextureUnits<t+1&&(s.maxTextureUnits=t+1),this.unit=t,e.activeTexture(33984+t),e.bindTexture(this.target,this.texture)}return t},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&de(this)}}),u.profile&&(s.getTotalTextureSize=function(){var e=0;return Object.keys(J).forEach((function(t){e+=J[t].stats.size})),e}),{create2D:function(t,n){var r=new se(3553);function a(e,t){var n=r.texInfo;Z.call(n);var o=X();return"number"==typeof e?V(o,0|e,"number"==typeof t?0|t:0|e):e?(S.type(e,"object","invalid arguments to regl.texture"),q(n,e),G(o,e)):V(o,1,1),n.genMipmaps&&(o.mipmask=(o.width<<1)-1),r.mipmask=o.mipmask,M(r,o),S.texture2D(n,o,i),r.internalformat=o.internalformat,a.width=o.width,a.height=o.height,ue(r),H(o,3553),K(n,3553),le(),Y(o),u.profile&&(r.stats.size=we(r.internalformat,r.type,o.width,o.height,n.genMipmaps,!1)),a.format=_[r.internalformat],a.type=b[r.type],a.mag=x[n.magFilter],a.min=E[n.minFilter],a.wrapS=C[n.wrapS],a.wrapT=C[n.wrapT],a}return J[r.id]=r,s.textureCount++,a(t,n),a.subimage=function(e,t,n,i){S(!!e,"must specify image data");var o=0|t,s=0|n,u=0|i,l=N();return M(l,r),l.width=0,l.height=0,P(l,e),l.width=l.width||(r.width>>u)-o,l.height=l.height||(r.height>>u)-s,S(r.type===l.type&&r.format===l.format&&r.internalformat===l.internalformat,"incompatible format for texture.subimage"),S(o>=0&&s>=0&&o+l.width<=r.width&&s+l.height<=r.height,"texture.subimage write out of bounds"),S(r.mipmask&1<<u,"missing mipmap data"),S(l.data||l.element||l.needsCopy,"missing image data"),ue(r),L(l,3553,o,s,u),le(),D(l),a},a.resize=function(t,n){var i=0|t,o=0|n||i;if(i===r.width&&o===r.height)return a;a.width=r.width=i,a.height=r.height=o,ue(r);for(var s=0;r.mipmask>>s;++s){var l=i>>s,c=o>>s;if(!l||!c)break;e.texImage2D(3553,s,r.format,l,c,0,r.format,r.type,null)}return le(),u.profile&&(r.stats.size=we(r.internalformat,r.type,i,o,!1,!1)),a},a._reglType="texture2d",a._texture=r,u.profile&&(a.stats=r.stats),a.destroy=function(){r.decRef()},a},createCube:function(t,n,r,a,o,l){var c=new se(34067);J[c.id]=c,s.cubeCount++;var h=new Array(6);function f(e,t,n,r,a,o){var s,l=c.texInfo;for(Z.call(l),s=0;s<6;++s)h[s]=X();if("number"!=typeof e&&e)if("object"==typeof e)if(t)G(h[0],e),G(h[1],t),G(h[2],n),G(h[3],r),G(h[4],a),G(h[5],o);else if(q(l,e),w(c,e),"faces"in e){var p=e.faces;for(S(Array.isArray(p)&&6===p.length,"cube faces must be a length 6 array"),s=0;s<6;++s)S("object"==typeof p[s]&&!!p[s],"invalid input for cube map face"),M(h[s],c),G(h[s],p[s])}else for(s=0;s<6;++s)G(h[s],e);else S.raise("invalid arguments to cube map");else{var d=0|e||1;for(s=0;s<6;++s)V(h[s],d,d)}for(M(c,h[0]),S.optional((function(){i.npotTextureCube||S(re(c.width)&&re(c.height),"your browser does not support non power or two texture dimensions")})),l.genMipmaps?c.mipmask=(h[0].width<<1)-1:c.mipmask=h[0].mipmask,S.textureCube(c,l,h,i),c.internalformat=h[0].internalformat,f.width=h[0].width,f.height=h[0].height,ue(c),s=0;s<6;++s)H(h[s],34069+s);for(K(l,34067),le(),u.profile&&(c.stats.size=we(c.internalformat,c.type,f.width,f.height,l.genMipmaps,!0)),f.format=_[c.internalformat],f.type=b[c.type],f.mag=x[l.magFilter],f.min=E[l.minFilter],f.wrapS=C[l.wrapS],f.wrapT=C[l.wrapT],s=0;s<6;++s)Y(h[s]);return f}return f(t,n,r,a,o,l),f.subimage=function(e,t,n,r,i){S(!!t,"must specify image data"),S("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var a=0|n,o=0|r,s=0|i,u=N();return M(u,c),u.width=0,u.height=0,P(u,t),u.width=u.width||(c.width>>s)-a,u.height=u.height||(c.height>>s)-o,S(c.type===u.type&&c.format===u.format&&c.internalformat===u.internalformat,"incompatible format for texture.subimage"),S(a>=0&&o>=0&&a+u.width<=c.width&&o+u.height<=c.height,"texture.subimage write out of bounds"),S(c.mipmask&1<<s,"missing mipmap data"),S(u.data||u.element||u.needsCopy,"missing image data"),ue(c),L(u,34069+e,a,o,s),le(),D(u),f},f.resize=function(t){var n=0|t;if(n!==c.width){f.width=c.width=n,f.height=c.height=n,ue(c);for(var r=0;r<6;++r)for(var i=0;c.mipmask>>i;++i)e.texImage2D(34069+r,i,c.format,n>>i,n>>i,0,c.format,c.type,null);return le(),u.profile&&(c.stats.size=we(c.internalformat,c.type,f.width,f.height,!1,!0)),f}},f._reglType="textureCube",f._texture=c,u.profile&&(f.stats=c.stats),f.destroy=function(){c.decRef()},f},clear:function(){for(var t=0;t<$;++t)e.activeTexture(33984+t),e.bindTexture(3553,null),ee[t]=null;z(J).forEach(de),s.cubeCount=0,s.textureCount=0},getTexture:function(e){return null},restore:function(){for(var t=0;t<$;++t){var n=ee[t];n&&(n.bindCount=0,n.unit=-1,ee[t]=null)}z(J).forEach((function(t){t.texture=e.createTexture(),e.bindTexture(t.target,t.texture);for(var n=0;n<32;++n)if(0!=(t.mipmask&1<<n))if(3553===t.target)e.texImage2D(3553,n,t.internalformat,t.width>>n,t.height>>n,0,t.internalformat,t.type,null);else for(var r=0;r<6;++r)e.texImage2D(34069+r,n,t.internalformat,t.width>>n,t.height>>n,0,t.internalformat,t.type,null);K(t.texInfo,t.target)}))},refresh:function(){for(var t=0;t<$;++t){var n=ee[t];n&&(n.bindCount=0,n.unit=-1,ee[t]=null),e.activeTexture(33984+t),e.bindTexture(3553,null),e.bindTexture(34067,null)}}}}ge[32854]=2,ge[32855]=2,ge[36194]=2,ge[34041]=4,ge[33776]=.5,ge[33777]=.5,ge[33778]=1,ge[33779]=1,ge[35986]=.5,ge[35987]=1,ge[34798]=1,ge[35840]=.5,ge[35841]=.25,ge[35842]=.5,ge[35843]=.25,ge[36196]=.5;var Oe=[];function Pe(e,t,n){return Oe[e]*t*n}Oe[32854]=2,Oe[32855]=2,Oe[36194]=2,Oe[33189]=2,Oe[36168]=1,Oe[34041]=4,Oe[35907]=4,Oe[34836]=16,Oe[34842]=8,Oe[34843]=6;var Re=[6407,6408],Le=[];Le[6408]=4,Le[6407]=3;var Ie=[];Ie[5121]=1,Ie[5126]=4,Ie[36193]=2;var Ne=[32854,32855,36194,35907,34842,34843,34836],De={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},Fe=["attributes","elements","offset","count","primitive","instances"];function Be(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.offset=0,this.stride=0,this.divisor=0}function Ue(e,n,r,i,a,o,s){function u(u){var l;null===n.next?(S(a.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),l=5121):(S(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),l=n.next.colorAttachments[0].texture._texture.type,S.optional((function(){o.oes_texture_float?(S(5121===l||5126===l,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),5126===l&&S(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):S(5121===l,"Reading from a framebuffer is only allowed for the type 'uint8'")})));var c=0,h=0,f=i.framebufferWidth,p=i.framebufferHeight,d=null;t(u)?d=u:u&&(S.type(u,"object","invalid arguments to regl.read()"),c=0|u.x,h=0|u.y,S(c>=0&&c<i.framebufferWidth,"invalid x offset for regl.read"),S(h>=0&&h<i.framebufferHeight,"invalid y offset for regl.read"),f=0|(u.width||i.framebufferWidth-c),p=0|(u.height||i.framebufferHeight-h),d=u.data||null),d&&(5121===l?S(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):5126===l&&S(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),S(f>0&&f+c<=i.framebufferWidth,"invalid width for read pixels"),S(p>0&&p+h<=i.framebufferHeight,"invalid height for read pixels"),r();var v=f*p*4;return d||(5121===l?d=new Uint8Array(v):5126===l&&(d=d||new Float32Array(v))),S.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),S(d.byteLength>=v,"data buffer for regl.read() too small"),e.pixelStorei(3333,4),e.readPixels(c,h,f,p,6408,l,d),d}return function(e){return e&&"framebuffer"in e?function(e){var t;return n.setFBO({framebuffer:e.framebuffer},(function(){t=u(e)})),t}(e):u(e)}}function ze(e){return Array.prototype.slice.call(e)}function je(e){return ze(e).join("")}var Ve="xyzw".split(""),Ge="profile",He="framebuffer",We="vert",Xe="frag",Ye="elements",Ze="primitive",qe="count",Ke="offset",Qe="instances",Je="vao",$e=He+"Width",et=He+"Height",tt=["blend.func","blend.equation","stencil.func","stencil.opFront","stencil.opBack","sample.coverage","viewport","scissor.box","polygonOffset.offset"],nt={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},rt=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],it={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},at={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},ot={frag:35632,vert:35633},st={cw:2304,ccw:2305};function ut(e){return Array.isArray(e)||t(e)||U(e)}function lt(e){return e.sort((function(e,t){return"viewport"===e?-1:"viewport"===t?1:e<t?-1:1}))}function ct(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function ht(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function ft(e){return new ct(!1,!1,!1,e)}function pt(e,t){var n=e.type;if(0===n){var r=e.data.length;return new ct(!0,r>=1,r>=2,t)}if(4===n){var i=e.data;return new ct(i.thisDep,i.contextDep,i.propDep,t)}if(5===n)return new ct(!1,!1,!1,t);if(6===n){for(var a=!1,o=!1,s=!1,u=0;u<e.data.length;++u){var l=e.data[u];if(1===l.type)s=!0;else if(2===l.type)o=!0;else if(3===l.type)a=!0;else if(0===l.type){a=!0;var c=l.data;c>=1&&(o=!0),c>=2&&(s=!0)}else 4===l.type&&(a=a||l.data.thisDep,o=o||l.data.contextDep,s=s||l.data.propDep)}return new ct(a,o,s,t)}return new ct(3===n,2===n,1===n,t)}var dt=new ct(!1,!1,!1,(function(){}));function vt(t,r,i,a,o,s,u,l,c,h,f,p,d,v,g){var m=h.Record,y={add:32774,subtract:32778,"reverse subtract":32779};i.ext_blend_minmax&&(y.min=32775,y.max=32776);var _=i.angle_instanced_arrays,b=i.webgl_draw_buffers,x=i.oes_vertex_array_object,E={dirty:!0,profile:g.profile},C={},T=[],A={},M={};function k(e){return e.replace(".","_")}function O(e,t,n){var r=k(e);T.push(e),C[r]=E[r]=!!n,A[r]=t}function P(e,t,n){var r=k(e);T.push(e),Array.isArray(n)?(E[r]=n.slice(),C[r]=n.slice()):E[r]=C[r]=n,M[r]=t}O("dither",3024),O("blend.enable",3042),P("blend.color","blendColor",[0,0,0,0]),P("blend.equation","blendEquationSeparate",[32774,32774]),P("blend.func","blendFuncSeparate",[1,0,1,0]),O("depth.enable",2929,!0),P("depth.func","depthFunc",513),P("depth.range","depthRange",[0,1]),P("depth.mask","depthMask",!0),P("colorMask","colorMask",[!0,!0,!0,!0]),O("cull.enable",2884),P("cull.face","cullFace",1029),P("frontFace","frontFace",2305),P("lineWidth","lineWidth",1),O("polygonOffset.enable",32823),P("polygonOffset.offset","polygonOffset",[0,0]),O("sample.alpha",32926),O("sample.enable",32928),P("sample.coverage","sampleCoverage",[1,!1]),O("stencil.enable",2960),P("stencil.mask","stencilMask",-1),P("stencil.func","stencilFunc",[519,0,-1]),P("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),P("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),O("scissor.enable",3089),P("scissor.box","scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),P("viewport","viewport",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var R={gl:t,context:d,strings:r,next:C,current:E,draw:p,elements:s,buffer:o,shader:f,attributes:h.state,vao:h,uniforms:c,framebuffer:l,extensions:i,timer:v,isBufferArgs:ut},L={primTypes:J,compareFuncs:it,blendFuncs:nt,blendEquations:y,stencilOps:at,glTypes:H,orientationType:st};S.optional((function(){R.isArrayLike=ne})),b&&(L.backBuffer=[1029],L.drawBuffer=N(a.maxDrawbuffers,(function(e){return 0===e?[0]:N(e,(function(e){return 36064+e}))})));var I=0;function D(){var t=function(){var t=0,r=[],i=[];function a(){var e=[],r=[];return n((function(){e.push.apply(e,ze(arguments))}),{def:function(){var n="v"+t++;return r.push(n),arguments.length>0&&(e.push(n,"="),e.push.apply(e,ze(arguments)),e.push(";")),n},toString:function(){return je([r.length>0?"var "+r.join(",")+";":"",je(e)])}})}function o(){var e=a(),t=a(),r=e.toString,i=t.toString;function o(n,r){t(n,r,"=",e.def(n,r),";")}return n((function(){e.apply(e,ze(arguments))}),{def:e.def,entry:e,exit:t,save:o,set:function(t,n,r){o(t,n),e(t,n,"=",r,";")},toString:function(){return r()+i()}})}var s=a(),u={};return{global:s,link:function(e){for(var n=0;n<i.length;++n)if(i[n]===e)return r[n];var a="g"+t++;return r.push(a),i.push(e),a},block:a,proc:function(e,t){var r=[];function i(){var e="a"+r.length;return r.push(e),e}t=t||0;for(var a=0;a<t;++a)i();var s=o(),l=s.toString;return u[e]=n(s,{arg:i,toString:function(){return je(["function(",r.join(),"){",l(),"}"])}})},scope:o,cond:function(){var e=je(arguments),t=o(),r=o(),i=t.toString,a=r.toString;return n(t,{then:function(){return t.apply(t,ze(arguments)),this},else:function(){return r.apply(r,ze(arguments)),this},toString:function(){var t=a();return t&&(t="else{"+t+"}"),je(["if(",e,"){",i(),"}",t])}})},compile:function(){var t=['"use strict";',s,"return {"];Object.keys(u).forEach((function(e){t.push('"',e,'":',u[e].toString(),",")})),t.push("}");var n=je(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return("undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM?e.Function.apply(null,r.concat(n)):Function.apply(null,r.concat(n))).apply(null,i)}}}(),i=t.link,a=t.global;t.id=I++,t.batchId="0";var o=i(R),s=t.shared={props:"a0"};Object.keys(R).forEach((function(e){s[e]=a.def(o,".",e)})),S.optional((function(){t.CHECK=i(S),t.commandStr=S.guessCommand(),t.command=i(t.commandStr),t.assert=function(e,t,n){e("if(!(",t,"))",this.CHECK,".commandRaise(",i(n),",",this.command,");")},L.invalidBlendCombinations=rt}));var u=t.next={},l=t.current={};Object.keys(M).forEach((function(e){Array.isArray(E[e])&&(u[e]=a.def(s.next,".",e),l[e]=a.def(s.current,".",e))}));var c=t.constants={};Object.keys(L).forEach((function(e){c[e]=a.def(JSON.stringify(L[e]))})),t.invoke=function(e,n){switch(n.type){case 0:var r=["this",s.context,s.props,t.batchId];return e.def(i(n.data),".call(",r.slice(0,Math.max(n.data.length+1,4)),")");case 1:return e.def(s.props,n.data);case 2:return e.def(s.context,n.data);case 3:return e.def("this",n.data);case 4:return n.data.append(t,e),n.data.ref;case 5:return n.data.toString();case 6:return n.data.map((function(n){return t.invoke(e,n)}))}},t.attribCache={};var f={};return t.scopeAttrib=function(e){var t=r.id(e);if(t in f)return f[t];var n=h.scope[t];return n||(n=h.scope[t]=new m),f[t]=i(n)},t}function F(e,t,n,u,c){var p=e.static,d=e.dynamic;S.optional((function(){var e=[He,We,Xe,Ye,Ze,Ke,qe,Qe,Ge,Je].concat(T);function t(t){Object.keys(t).forEach((function(t){S.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',c.commandStr)}))}t(p),t(d)}));var v=function(e,t){var n=e.static;if("string"==typeof n[Xe]&&"string"==typeof n[We]){if(Object.keys(t.dynamic).length>0)return null;var r=t.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var a=[],o=0;o<i.length;++o)S("number"==typeof r[i[o]],"must specify all vertex attribute locations when using vaos"),a.push([0|r[i[o]],i[o]]);return a}}return null}(e,t),g=function(e,t){var n=e.static,r=e.dynamic;if(He in n){var i=n[He];return i?(i=l.getFramebuffer(i),S.command(i,"invalid framebuffer object"),ft((function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,".next",n);var a=r.context;return t.set(a,"."+$e,n+".width"),t.set(a,"."+et,n+".height"),n}))):ft((function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+$e,r+".drawingBufferWidth"),t.set(r,"."+et,r+".drawingBufferHeight"),"null"}))}if(He in r){var a=r[He];return pt(a,(function(e,t){var n=e.invoke(t,a),r=e.shared,i=r.framebuffer,o=t.def(i,".getFramebuffer(",n,")");S.optional((function(){e.assert(t,"!"+n+"||"+o,"invalid framebuffer object")})),t.set(i,".next",o);var s=r.context;return t.set(s,"."+$e,o+"?"+o+".width:"+s+".drawingBufferWidth"),t.set(s,"."+et,o+"?"+o+".height:"+s+".drawingBufferHeight"),o}))}return null}(e),b=function(e,t,n){var r=e.static,i=e.dynamic;function a(e){if(e in r){var a=r[e];S.commandType(a,"object","invalid "+e,n.commandStr);var o,s,u=!0,l=0|a.x,c=0|a.y;return"width"in a?(o=0|a.width,S.command(o>=0,"invalid "+e,n.commandStr)):u=!1,"height"in a?(s=0|a.height,S.command(s>=0,"invalid "+e,n.commandStr)):u=!1,new ct(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,(function(e,t){var n=e.shared.context,r=o;"width"in a||(r=t.def(n,".",$e,"-",l));var i=s;return"height"in a||(i=t.def(n,".",et,"-",c)),[l,c,r,i]}))}if(e in i){var h=i[e],f=pt(h,(function(t,n){var r=t.invoke(n,h);S.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}));var i=t.shared.context,a=n.def(r,".x|0"),o=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",$e,"-",a,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",et,"-",o,")");return S.optional((function(){t.assert(n,s+">=0&&"+u+">=0","invalid "+e)})),[a,o,s,u]}));return t&&(f.thisDep=f.thisDep||t.thisDep,f.contextDep=f.contextDep||t.contextDep,f.propDep=f.propDep||t.propDep),f}return t?new ct(t.thisDep,t.contextDep,t.propDep,(function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",$e),t.def(n,".",et)]})):null}var o=a("viewport");if(o){var s=o;o=new ct(o.thisDep,o.contextDep,o.propDep,(function(e,t){var n=s.append(e,t),r=e.shared.context;return t.set(r,".viewportWidth",n[2]),t.set(r,".viewportHeight",n[3]),n}))}return{viewport:o,scissor_box:a("scissor.box")}}(e,g,c),x=function(e,t){var n=e.static,r=e.dynamic,i={},a=!1,o=function(){if(Je in n){var e=n[Je];return null!==e&&null===h.getVAO(e)&&(e=h.createVAO(e)),a=!0,i.vao=e,ft((function(t){var n=h.getVAO(e);return n?t.link(n):"null"}))}if(Je in r){a=!0;var t=r[Je];return pt(t,(function(e,n){var r=e.invoke(n,t);return n.def(e.shared.vao+".getVAO("+r+")")}))}return null}(),u=!1,l=function(){if(Ye in n){var e=n[Ye];if(i.elements=e,ut(e)){var l=i.elements=s.create(e,!0);e=s.getElements(l),u=!0}else e&&(e=s.getElements(e),u=!0,S.command(e,"invalid elements",t.commandStr));var c=ft((function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null}));return c.value=e,c}if(Ye in r){u=!0;var h=r[Ye];return pt(h,(function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,a=e.invoke(t,h),o=t.def("null"),s=t.def(r,"(",a,")"),u=e.cond(s).then(o,"=",i,".createStream(",a,");").else(o,"=",i,".getElements(",a,");");return S.optional((function(){e.assert(u.else,"!"+a+"||"+o,"invalid elements")})),t.entry(u),t.exit(e.cond(s).then(i,".destroyStream(",o,");")),e.ELEMENTS=o,o}))}return a?new ct(o.thisDep,o.contextDep,o.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.elements+".getElements("+e.shared.vao+".currentVAO.elements):null")})):null}();function c(e,s){if(e in n){var l=0|n[e];return s?i.offset=l:i.instances=l,S.command(!s||l>=0,"invalid "+e,t.commandStr),ft((function(e,t){return s&&(e.OFFSET=l),l}))}if(e in r){var c=r[e];return pt(c,(function(t,n){var r=t.invoke(n,c);return s&&(t.OFFSET=r,S.optional((function(){t.assert(n,r+">=0","invalid "+e)}))),r}))}if(s){if(u)return ft((function(e,t){return e.OFFSET=0,0}));if(a)return new ct(o.thisDep,o.contextDep,o.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.offset:0")}))}else if(a)return new ct(o.thisDep,o.contextDep,o.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.instances:-1")}));return null}var f=c(Ke,!0),p=function(){if(Ze in n){var e=n[Ze];return i.primitive=e,S.commandParameter(e,J,"invalid primitve",t.commandStr),ft((function(t,n){return J[e]}))}if(Ze in r){var s=r[Ze];return pt(s,(function(e,t){var n=e.constants.primTypes,r=e.invoke(t,s);return S.optional((function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys(J))})),t.def(n,"[",r,"]")}))}return u?ht(l)?l.value?ft((function(e,t){return t.def(e.ELEMENTS,".primType")})):ft((function(){return 4})):new ct(l.thisDep,l.contextDep,l.propDep,(function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",4)})):a?new ct(o.thisDep,o.contextDep,o.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.primitive:4")})):null}(),d=function(){if(qe in n){var e=0|n[qe];return i.count=e,S.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),ft((function(){return e}))}if(qe in r){var s=r[qe];return pt(s,(function(e,t){var n=e.invoke(t,s);return S.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(u){if(ht(l)){if(l)return f?new ct(f.thisDep,f.contextDep,f.propDep,(function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return S.optional((function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")})),n})):ft((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var c=ft((function(){return-1}));return S.optional((function(){c.MISSING=!0})),c}var h=new ct(l.thisDep||f.thisDep,l.contextDep||f.contextDep,l.propDep||f.propDep,(function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")}));return S.optional((function(){h.DYNAMIC=!0})),h}return a?new ct(o.thisDep,o.contextDep,o.propDep,(function(e,t){return t.def(e.shared.vao,".currentVAO?",e.shared.vao,".currentVAO.count:-1")})):null}(),v=c(Qe,!1);return{elements:l,primitive:p,count:d,instances:v,offset:f,vao:o,vaoActive:a,elementsActive:u,static:i}}(e,c),E=function(e,t){var n=e.static,r=e.dynamic,i={};return T.forEach((function(e){var o=k(e);function s(t,a){if(e in n){var s=t(n[e]);i[o]=ft((function(){return s}))}else if(e in r){var u=r[e];i[o]=pt(u,(function(e,t){return a(e,t,e.invoke(t,u))}))}}switch(e){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":return s((function(n){return S.commandType(n,"boolean",e,t.commandStr),n}),(function(t,n,r){return S.optional((function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)})),r}));case"depth.func":return s((function(n){return S.commandParameter(n,it,"invalid "+e,t.commandStr),it[n]}),(function(t,n,r){var i=t.constants.compareFuncs;return S.optional((function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys(it))})),n.def(i,"[",r,"]")}));case"depth.range":return s((function(e){return S.command(ne(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,n){return S.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]}));case"blend.func":return s((function(e){S.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,a="dstAlpha"in e?e.dstAlpha:e.dst;return S.commandParameter(n,nt,o+".srcRGB",t.commandStr),S.commandParameter(r,nt,o+".srcAlpha",t.commandStr),S.commandParameter(i,nt,o+".dstRGB",t.commandStr),S.commandParameter(a,nt,o+".dstAlpha",t.commandStr),S.command(-1===rt.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",t.commandStr),[nt[n],nt[i],nt[r],nt[a]]}),(function(t,n,r){var i=t.constants.blendFuncs;function a(a,o){var s=n.def('"',a,o,'" in ',r,"?",r,".",a,o,":",r,".",a);return S.optional((function(){t.assert(n,s+" in "+i,"invalid "+e+"."+a+o+", must be one of "+Object.keys(nt))})),s}S.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var o=a("src","RGB"),s=a("dst","RGB");S.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+o+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",o,"]"),l=n.def(i,"[",a("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),l,n.def(i,"[",a("dst","Alpha"),"]")]}));case"blend.equation":return s((function(n){return"string"==typeof n?(S.commandParameter(n,y,"invalid "+e,t.commandStr),[y[n],y[n]]):"object"==typeof n?(S.commandParameter(n.rgb,y,e+".rgb",t.commandStr),S.commandParameter(n.alpha,y,e+".alpha",t.commandStr),[y[n.rgb],y[n.alpha]]):void S.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,n,r){var i=t.constants.blendEquations,a=n.def(),o=n.def(),s=t.cond("typeof ",r,'==="string"');return S.optional((function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(y))}n(s.then,e,r),t.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(s.else,e+".rgb",r+".rgb"),n(s.else,e+".alpha",r+".alpha")})),s.then(a,"=",o,"=",i,"[",r,"];"),s.else(a,"=",i,"[",r,".rgb];",o,"=",i,"[",r,".alpha];"),n(s),[a,o]}));case"blend.color":return s((function(e){return S.command(ne(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),N(4,(function(t){return+e[t]}))}),(function(e,t,n){return S.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),N(4,(function(e){return t.def("+",n,"[",e,"]")}))}));case"stencil.mask":return s((function(e){return S.commandType(e,"number",o,t.commandStr),0|e}),(function(e,t,n){return S.optional((function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")})),t.def(n,"|0")}));case"stencil.func":return s((function(n){S.commandType(n,"object",o,t.commandStr);var r=n.cmp||"keep",i=n.ref||0,a="mask"in n?n.mask:-1;return S.commandParameter(r,it,e+".cmp",t.commandStr),S.commandType(i,"number",e+".ref",t.commandStr),S.commandType(a,"number",e+".mask",t.commandStr),[it[r],i,a]}),(function(e,t,n){var r=e.constants.compareFuncs;return S.optional((function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",7680),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case"stencil.opFront":case"stencil.opBack":return s((function(n){S.commandType(n,"object",o,t.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",a=n.zpass||"keep";return S.commandParameter(r,at,e+".fail",t.commandStr),S.commandParameter(i,at,e+".zfail",t.commandStr),S.commandParameter(a,at,e+".zpass",t.commandStr),["stencil.opBack"===e?1029:1028,at[r],at[i],at[a]]}),(function(t,n,r){var i=t.constants.stencilOps;function a(a){return S.optional((function(){t.assert(n,'!("'+a+'" in '+r+")||("+r+"."+a+" in "+i+")","invalid "+e+"."+a+", must be one of "+Object.keys(at))})),n.def('"',a,'" in ',r,"?",i,"[",r,".",a,"]:",7680)}return S.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),["stencil.opBack"===e?1029:1028,a("fail"),a("zfail"),a("zpass")]}));case"polygonOffset.offset":return s((function(e){S.commandType(e,"object",o,t.commandStr);var n=0|e.factor,r=0|e.units;return S.commandType(n,"number",o+".factor",t.commandStr),S.commandType(r,"number",o+".units",t.commandStr),[n,r]}),(function(t,n,r){return S.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case"cull.face":return s((function(e){var n=0;return"front"===e?n=1028:"back"===e&&(n=1029),S.command(!!n,o,t.commandStr),n}),(function(e,t,n){return S.optional((function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),t.def(n,'==="front"?',1028,":",1029)}));case"lineWidth":return s((function(e){return S.command("number"==typeof e&&e>=a.lineWidthDims[0]&&e<=a.lineWidthDims[1],"invalid line width, must be a positive number between "+a.lineWidthDims[0]+" and "+a.lineWidthDims[1],t.commandStr),e}),(function(e,t,n){return S.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+a.lineWidthDims[0]+"&&"+n+"<="+a.lineWidthDims[1],"invalid line width")})),n}));case"frontFace":return s((function(e){return S.commandParameter(e,st,o,t.commandStr),st[e]}),(function(e,t,n){return S.optional((function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(n+'==="cw"?2304:2305')}));case"colorMask":return s((function(e){return S.command(ne(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,n){return S.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),N(4,(function(e){return"!!"+n+"["+e+"]"}))}));case"sample.coverage":return s((function(e){S.command("object"==typeof e&&e,o,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return S.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]}),(function(e,t,n){return S.optional((function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]}))}})),i}(e,c),C=function(e,t,n){var i=e.static,a=e.dynamic;function o(e){if(e in i){var t=r.id(i[e]);S.optional((function(){f.shader(ot[e],t,S.guessCommand())}));var n=ft((function(){return t}));return n.id=t,n}if(e in a){var o=a[e];return pt(o,(function(t,n){var r=t.invoke(n,o),i=n.def(t.shared.strings,".id(",r,")");return S.optional((function(){n(t.shared.shader,".shader(",ot[e],",",i,",",t.command,");")})),i}))}return null}var s,u=o(Xe),l=o(We),c=null;return ht(u)&&ht(l)?(c=f.program(l.id,u.id,null,n),s=ft((function(e,t){return e.link(c)}))):s=new ct(u&&u.thisDep||l&&l.thisDep,u&&u.contextDep||l&&l.contextDep,u&&u.propDep||l&&l.propDep,(function(e,t){var n,r=e.shared.shader;n=u?u.append(e,t):t.def(r,".",Xe);var i=r+".program("+(l?l.append(e,t):t.def(r,".",We))+","+n;return S.optional((function(){i+=","+e.command})),t.def(i+")")})),{frag:u,vert:l,progVar:s,program:c}}(e,0,v);function A(e){var t=b[e];t&&(E[e]=t)}A("viewport"),A(k("scissor.box"));var M=Object.keys(E).length>0,w={framebuffer:g,draw:x,shader:C,state:E,dirty:M,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(w.profile=function(e){var t,n=e.static,r=e.dynamic;if(Ge in n){var i=!!n[Ge];(t=ft((function(e,t){return i}))).enable=i}else if(Ge in r){var a=r[Ge];t=pt(a,(function(e,t){return e.invoke(t,a)}))}return t}(e),w.uniforms=function(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach((function(e){var r,a=n[e];if("number"==typeof a||"boolean"==typeof a)r=ft((function(){return a}));else if("function"==typeof a){var o=a._reglType;"texture2d"===o||"textureCube"===o?r=ft((function(e){return e.link(a)})):"framebuffer"===o||"framebufferCube"===o?(S.command(a.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=ft((function(e){return e.link(a.color[0])}))):S.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else ne(a)?r=ft((function(t){return t.global.def("[",N(a.length,(function(n){return S.command("number"==typeof a[n]||"boolean"==typeof a[n],"invalid uniform "+e,t.commandStr),a[n]})),"]")})):S.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=a,i[e]=r})),Object.keys(r).forEach((function(e){var t=r[e];i[e]=pt(t,(function(e,n){return e.invoke(n,t)}))})),i}(n,c),w.drawVAO=w.scopeVAO=x.vao,!w.drawVAO&&C.program&&!v&&i.angle_instanced_arrays&&x.static.elements){var O=!0,P=C.program.attributes.map((function(e){var n=t.static[e];return O=O&&!!n,n}));if(O&&P.length>0){var R=h.getVAO(h.createVAO({attributes:P,elements:x.static.elements}));w.drawVAO=new ct(null,null,null,(function(e,t){return e.link(R)})),w.useVAO=!0}}return v?w.useVAO=!0:w.attributes=function(e,t){var n=e.static,i=e.dynamic,a={};return Object.keys(n).forEach((function(e){var i=n[e],s=r.id(e),u=new m;if(ut(i))u.state=1,u.buffer=o.getBuffer(o.create(i,34962,!1,!0)),u.type=0;else{var l=o.getBuffer(i);if(l)u.state=1,u.buffer=l,u.type=0;else if(S.command("object"==typeof i&&i,"invalid data for attribute "+e,t.commandStr),"constant"in i){var c=i.constant;u.buffer="null",u.state=2,"number"==typeof c?u.x=c:(S.command(ne(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+e,t.commandStr),Ve.forEach((function(e,t){t<c.length&&(u[e]=c[t])})))}else{l=ut(i.buffer)?o.getBuffer(o.create(i.buffer,34962,!1,!0)):o.getBuffer(i.buffer),S.command(!!l,'missing buffer for attribute "'+e+'"',t.commandStr);var h=0|i.offset;S.command(h>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var f=0|i.stride;S.command(f>=0&&f<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var p=0|i.size;S.command(!("size"in i)||p>0&&p<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var d=!!i.normalized,v=0;"type"in i&&(S.commandParameter(i.type,H,"invalid type for attribute "+e,t.commandStr),v=H[i.type]);var g=0|i.divisor;S.optional((function(){"divisor"in i&&(S.command(0===g||_,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),S.command(g>=0,'invalid divisor for attribute "'+e+'"',t.commandStr));var n=t.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(t){S.command(r.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",n)}))})),u.buffer=l,u.state=1,u.size=p,u.normalized=d,u.type=v||l.dtype,u.offset=h,u.stride=f,u.divisor=g}}a[e]=ft((function(e,t){var n=e.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(u).forEach((function(e){r[e]=u[e]})),u.buffer&&(r.buffer=e.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r}))})),Object.keys(i).forEach((function(e){var t=i[e];a[e]=pt(t,(function(n,r){var i=n.invoke(r,t),a=n.shared,o=n.constants,s=a.isBufferArgs,u=a.buffer;S.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+a.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')}));var l={isStream:r.def(!1)},c=new m;c.state=1,Object.keys(c).forEach((function(e){l[e]=r.def(""+c[e])}));var h=l.buffer,f=l.type;function p(e){r(l[e],"=",i,".",e,"|0;")}return r("if(",s,"(",i,")){",l.isStream,"=true;",h,"=",u,".createStream(",34962,",",i,");",f,"=",h,".dtype;","}else{",h,"=",u,".getBuffer(",i,");","if(",h,"){",f,"=",h,".dtype;",'}else if("constant" in ',i,"){",l.state,"=",2,";","if(typeof "+i+'.constant === "number"){',l[Ve[0]],"=",i,".constant;",Ve.slice(1).map((function(e){return l[e]})).join("="),"=0;","}else{",Ve.map((function(e,t){return l[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",h,"=",u,".createStream(",34962,",",i,".buffer);","}else{",h,"=",u,".getBuffer(",i,".buffer);","}",f,'="type" in ',i,"?",o.glTypes,"[",i,".type]:",h,".dtype;",l.normalized,"=!!",i,".normalized;"),p("size"),p("offset"),p("stride"),p("divisor"),r("}}"),r.exit("if(",l.isStream,"){",u,".destroyStream(",h,");","}"),l}))})),a}(t,c),w.context=function(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach((function(e){var n=t[e];r[e]=ft((function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)}))})),Object.keys(n).forEach((function(e){var t=n[e];r[e]=pt(t,(function(e,n){return e.invoke(n,t)}))})),r}(u),w}function B(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach((function(a){t.save(r,"."+a);var o=n[a].append(e,t);Array.isArray(o)?i(r,".",a,"=[",o.join(),"];"):i(r,".",a,"=",o,";")})),t(i)}function U(e,t,n,r){var i,a=e.shared,o=a.gl,s=a.framebuffer;b&&(i=t.def(a.extensions,".webgl_draw_buffers"));var u,l=e.constants,c=l.drawBuffer,h=l.backBuffer;u=n?n.append(e,t):t.def(s,".next"),r||t("if(",u,"!==",s,".cur){"),t("if(",u,"){",o,".bindFramebuffer(",36160,",",u,".framebuffer);"),b&&t(i,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),t("}else{",o,".bindFramebuffer(",36160,",null);"),b&&t(i,".drawBuffersWEBGL(",h,");"),t("}",s,".cur=",u,";"),r||t("}")}function z(e,t,n){var r=e.shared,i=r.gl,a=e.current,o=e.next,s=r.current,u=r.next,l=e.cond(s,".dirty");T.forEach((function(t){var r,c,h=k(t);if(!(h in n.state))if(h in o){r=o[h],c=a[h];var f=N(E[h].length,(function(e){return l.def(r,"[",e,"]")}));l(e.cond(f.map((function(e,t){return e+"!=="+c+"["+t+"]"})).join("||")).then(i,".",M[h],"(",f,");",f.map((function(e,t){return c+"["+t+"]="+e})).join(";"),";"))}else{r=l.def(u,".",h);var p=e.cond(r,"!==",s,".",h);l(p),h in A?p(e.cond(r).then(i,".enable(",A[h],");").else(i,".disable(",A[h],");"),s,".",h,"=",r,";"):p(i,".",M[h],"(",r,");",s,".",h,"=",r,";")}})),0===Object.keys(n.state).length&&l(s,".dirty=false;"),t(l)}function j(e,t,n,r){var i=e.shared,a=e.current,o=i.current,s=i.gl;lt(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var l=u.append(e,t);if(A[i]){var c=A[i];ht(u)?t(s,l?".enable(":".disable(",c,");"):t(e.cond(l).then(s,".enable(",c,");").else(s,".disable(",c,");")),t(o,".",i,"=",l,";")}else if(ne(l)){var h=a[i];t(s,".",M[i],"(",l,");",l.map((function(e,t){return h+"["+t+"]="+e})).join(";"),";")}else t(s,".",M[i],"(",l,");",o,".",i,"=",l,";")}}))}function V(e,t){_&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function G(e,t,n,r,i){var a,o,s,u=e.shared,l=e.stats,c=u.current,h=u.timer,f=n.profile;function p(){return"undefined"!=typeof my&&my&&"function"==typeof my.showToast&&!0!==my.isFRM||"undefined"==typeof performance?"Date.now()":"performance.now()"}function d(e){e(a=t.def(),"=",p(),";"),"string"==typeof i?e(l,".count+=",i,";"):e(l,".count++;"),v&&(r?e(o=t.def(),"=",h,".getNumPendingQueries();"):e(h,".beginQuery(",l,");"))}function g(e){e(l,".cpuTime+=",p(),"-",a,";"),v&&(r?e(h,".pushScopeStats(",o,",",h,".getNumPendingQueries(),",l,");"):e(h,".endQuery();"))}function m(e){var n=t.def(c,".profile");t(c,".profile=",e,";"),t.exit(c,".profile=",n,";")}if(f){if(ht(f))return void(f.enable?(d(t),g(t.exit),m("true")):m("false"));m(s=f.append(e,t))}else s=t.def(c,".profile");var y=e.block();d(y),t("if(",s,"){",y,"}");var _=e.block();g(_),t.exit("if(",s,"){",_,"}")}function W(e,t,n,r,i){var a=e.shared;r.forEach((function(r){var o,s=r.name,u=n.attributes[s];if(u){if(!i(u))return;o=u.append(e,t)}else{if(!i(dt))return;var l=e.scopeAttrib(s);S.optional((function(){e.assert(t,l+".state","missing attribute "+s)})),o={},Object.keys(new m).forEach((function(e){o[e]=t.def(l,".",e)}))}!function(n,r,i){var o=a.gl,s=t.def(n,".location"),u=t.def(a.attributes,"[",s,"]"),l=i.state,c=i.buffer,h=[i.x,i.y,i.z,i.w],f=["buffer","normalized","offset","stride"];function p(){t("if(!",u,".buffer){",o,".enableVertexAttribArray(",s,");}");var n,a=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",u,".type!==",a,"||",u,".size!==",n,"||",f.map((function(e){return u+"."+e+"!=="+i[e]})).join("||"),"){",o,".bindBuffer(",34962,",",c,".buffer);",o,".vertexAttribPointer(",[s,n,a,i.normalized,i.stride,i.offset],");",u,".type=",a,";",u,".size=",n,";",f.map((function(e){return u+"."+e+"="+i[e]+";"})).join(""),"}"),_){var l=i.divisor;t("if(",u,".divisor!==",l,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,l],");",u,".divisor=",l,";}")}}function d(){t("if(",u,".buffer){",o,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",Ve.map((function(e,t){return u+"."+e+"!=="+h[t]})).join("||"),"){",o,".vertexAttrib4f(",s,",",h,");",Ve.map((function(e,t){return u+"."+e+"="+h[t]+";"})).join(""),"}")}1===l?p():2===l?d():(t("if(",l,"===",1,"){"),p(),t("}else{"),d(),t("}"))}(e.link(r),function(e){switch(e){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}(r.info.type),o)}))}function X(e,t,n,i,a,o){for(var s,u=e.shared,l=u.gl,c=0;c<i.length;++c){var h,f=i[c],p=f.name,d=f.info.type,v=n.uniforms[p],g=e.link(f)+".location";if(v){if(!a(v))continue;if(ht(v)){var m=v.value;if(S.command(null!=m,'missing uniform "'+p+'"',e.commandStr),35678===d||35680===d){S.command("function"==typeof m&&(35678===d&&("texture2d"===m._reglType||"framebuffer"===m._reglType)||35680===d&&("textureCube"===m._reglType||"framebufferCube"===m._reglType)),"invalid texture for uniform "+p,e.commandStr);var y=e.link(m._texture||m.color[0]._texture);t(l,".uniform1i(",g,",",y+".bind());"),t.exit(y,".unbind();")}else if(35674===d||35675===d||35676===d){S.optional((function(){S.command(ne(m),"invalid matrix for uniform "+p,e.commandStr),S.command(35674===d&&4===m.length||35675===d&&9===m.length||35676===d&&16===m.length,"invalid length for matrix uniform "+p,e.commandStr)}));var _=e.global.def("new Float32Array(["+Array.prototype.slice.call(m)+"])"),b=2;35675===d?b=3:35676===d&&(b=4),t(l,".uniformMatrix",b,"fv(",g,",false,",_,");")}else{switch(d){case 5126:S.commandType(m,"number","uniform "+p,e.commandStr),s="1f";break;case 35664:S.command(ne(m)&&2===m.length,"uniform "+p,e.commandStr),s="2f";break;case 35665:S.command(ne(m)&&3===m.length,"uniform "+p,e.commandStr),s="3f";break;case 35666:S.command(ne(m)&&4===m.length,"uniform "+p,e.commandStr),s="4f";break;case 35670:S.commandType(m,"boolean","uniform "+p,e.commandStr),s="1i";break;case 5124:S.commandType(m,"number","uniform "+p,e.commandStr),s="1i";break;case 35671:case 35667:S.command(ne(m)&&2===m.length,"uniform "+p,e.commandStr),s="2i";break;case 35672:case 35668:S.command(ne(m)&&3===m.length,"uniform "+p,e.commandStr),s="3i";break;case 35673:case 35669:S.command(ne(m)&&4===m.length,"uniform "+p,e.commandStr),s="4i"}t(l,".uniform",s,"(",g,",",ne(m)?Array.prototype.slice.call(m):m,");")}continue}h=v.append(e,t)}else{if(!a(dt))continue;h=t.def(u.uniforms,"[",r.id(p),"]")}35678===d?(S(!Array.isArray(h),"must specify a scalar prop for textures"),t("if(",h,"&&",h,'._reglType==="framebuffer"){',h,"=",h,".color[0];","}")):35680===d&&(S(!Array.isArray(h),"must specify a scalar prop for cube maps"),t("if(",h,"&&",h,'._reglType==="framebufferCube"){',h,"=",h,".color[0];","}")),S.optional((function(){function n(n,r){e.assert(t,n,'bad data or missing for uniform "'+p+'".  '+r)}function r(e){S(!Array.isArray(h),"must not specify an array type for uniform"),n("typeof "+h+'==="'+e+'"',"invalid type, expected "+e)}function i(t,r){Array.isArray(h)?S(h.length===t,"must have length "+t):n(u.isArrayLike+"("+h+")&&"+h+".length==="+t,"invalid vector, should have length "+t,e.commandStr)}function a(t){S(!Array.isArray(h),"must not specify a value type"),n("typeof "+h+'==="function"&&'+h+'._reglType==="texture'+(3553===t?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(d){case 5124:r("number");break;case 35667:i(2);break;case 35668:i(3);break;case 35669:i(4);break;case 5126:r("number");break;case 35664:i(2);break;case 35665:i(3);break;case 35666:i(4);break;case 35670:r("boolean");break;case 35671:i(2);break;case 35672:i(3);break;case 35673:case 35674:i(4);break;case 35675:i(9);break;case 35676:i(16);break;case 35678:a(3553);break;case 35680:a(34067)}}));var x=1;switch(d){case 35678:case 35680:var E=t.def(h,"._texture");t(l,".uniform1i(",g,",",E,".bind());"),t.exit(E,".unbind();");continue;case 5124:case 35670:s="1i";break;case 35667:case 35671:s="2i",x=2;break;case 35668:case 35672:s="3i",x=3;break;case 35669:case 35673:s="4i",x=4;break;case 5126:s="1f";break;case 35664:s="2f",x=2;break;case 35665:s="3f",x=3;break;case 35666:s="4f",x=4;break;case 35674:s="Matrix2fv";break;case 35675:s="Matrix3fv";break;case 35676:s="Matrix4fv"}if("M"===s.charAt(0)){t(l,".uniform",s,"(",g,",");var C=Math.pow(d-35674+2,2),T=e.global.def("new Float32Array(",C,")");Array.isArray(h)?t("false,(",N(C,(function(e){return T+"["+e+"]="+h[e]})),",",T,")"):t("false,(Array.isArray(",h,")||",h," instanceof Float32Array)?",h,":(",N(C,(function(e){return T+"["+e+"]="+h+"["+e+"]"})),",",T,")"),t(");")}else if(x>1){for(var A=[],M=[],w=0;w<x;++w)Array.isArray(h)?M.push(h[w]):M.push(t.def(h+"["+w+"]")),o&&A.push(t.def());o&&t("if(!",e.batchId,"||",A.map((function(e,t){return e+"!=="+M[t]})).join("||"),"){",A.map((function(e,t){return e+"="+M[t]+";"})).join("")),t(l,".uniform",s,"(",g,",",M.join(","),");"),o&&t("}")}else{if(S(!Array.isArray(h),"uniform value must not be an array"),o){var k=t.def();t("if(!",e.batchId,"||",k,"!==",h,"){",k,"=",h,";")}t(l,".uniform",s,"(",g,",",h,");"),o&&t("}")}}}function Y(e,t,n,r){var i=e.shared,a=i.gl,o=i.draw,s=r.draw,u=function(){var u,l=s.elements,c=t;return l?((l.contextDep&&r.contextDynamic||l.propDep)&&(c=n),u=l.append(e,c),s.elementsActive&&c("if("+u+")"+a+".bindBuffer(34963,"+u+".buffer.buffer);")):(u=c.def(),c(u,"=",o,".",Ye,";","if(",u,"){",a,".bindBuffer(",34963,",",u,".buffer.buffer);}","else if(",i.vao,".currentVAO){",u,"=",e.shared.elements+".getElements("+i.vao,".currentVAO.elements);",x?"":"if("+u+")"+a+".bindBuffer(34963,"+u+".buffer.buffer);","}")),u}();function l(i){var a=s[i];return a?a.contextDep&&r.contextDynamic||a.propDep?a.append(e,n):a.append(e,t):t.def(o,".",i)}var c,h,f=l(Ze),p=l(Ke),d=function(){var i,a=s.count,u=t;return a?((a.contextDep&&r.contextDynamic||a.propDep)&&(u=n),i=a.append(e,u),S.optional((function(){a.MISSING&&e.assert(t,"false","missing vertex count"),a.DYNAMIC&&e.assert(u,i+">=0","missing vertex count")}))):(i=u.def(o,".",qe),S.optional((function(){e.assert(u,i+">=0","missing vertex count")}))),i}();if("number"==typeof d){if(0===d)return}else n("if(",d,"){"),n.exit("}");_&&(c=l(Qe),h=e.instancing);var v=u+".type",g=s.elements&&ht(s.elements)&&!s.vaoActive;function m(){function e(){n(h,".drawElementsInstancedANGLE(",[f,d,v,p+"<<(("+v+"-5121)>>1)",c],");")}function t(){n(h,".drawArraysInstancedANGLE(",[f,p,d,c],");")}u&&"null"!==u?g?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}function y(){function e(){n(a+".drawElements("+[f,d,v,p+"<<(("+v+"-5121)>>1)"]+");")}function t(){n(a+".drawArrays("+[f,p,d]+");")}u&&"null"!==u?g?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}_&&("number"!=typeof c||c>=0)?"string"==typeof c?(n("if(",c,">0){"),m(),n("}else if(",c,"<0){"),y(),n("}")):m():y()}function Z(e,t,n,r,i){var a=D(),o=a.proc("body",i);return S.optional((function(){a.commandStr=t.commandStr,a.command=a.link(t.commandStr)})),_&&(a.instancing=o.def(a.shared.extensions,".angle_instanced_arrays")),e(a,o,n,r),a.compile().body}function q(e,t,n,r){V(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,".setVAO(",n.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),W(e,t,n,r.attributes,(function(){return!0}))),X(e,t,n,r.uniforms,(function(){return!0}),!1),Y(e,t,t,n)}function K(e,t,n,r){function i(){return!0}e.batchId="a1",V(e,t),W(e,t,n,r.attributes,i),X(e,t,n,r.uniforms,i,!1),Y(e,t,t,n)}function Q(e,t,n,r){V(e,t);var i=n.contextDep,a=t.def(),o=t.def();e.shared.props=o,e.batchId=a;var s=e.scope(),u=e.scope();function l(e){return e.contextDep&&i||e.propDep}function c(e){return!l(e)}if(t(s.entry,"for(",a,"=0;",a,"<","a1",";++",a,"){",o,"=","a0","[",a,"];",u,"}",s.exit),n.needsContext&&B(e,u,n.context),n.needsFramebuffer&&U(e,u,n.framebuffer),j(e,u,n.state,l),n.profile&&l(n.profile)&&G(e,u,n,!1,!0),r)n.useVAO?n.drawVAO?l(n.drawVAO)?u(e.shared.vao,".setVAO(",n.drawVAO.append(e,u),");"):s(e.shared.vao,".setVAO(",n.drawVAO.append(e,s),");"):s(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(s(e.shared.vao,".setVAO(null);"),W(e,s,n,r.attributes,c),W(e,u,n,r.attributes,l)),X(e,s,n,r.uniforms,c,!1),X(e,u,n,r.uniforms,l,!0),Y(e,s,u,n);else{var h=e.global.def("{}"),f=n.shader.progVar.append(e,u),p=u.def(f,".id"),d=u.def(h,"[",p,"]");u(e.shared.gl,".useProgram(",f,".program);","if(!",d,"){",d,"=",h,"[",p,"]=",e.link((function(t){return Z(K,e,n,t,2)})),"(",f,");}",d,".call(this,a0[",a,"],",a,");")}}function $(e,t,n){var r=t.static[n];if(r&&function(e){if("object"==typeof e&&!ne(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(w.isDynamic(e[t[n]]))return!0;return!1}}(r)){var i=e.global,a=Object.keys(r),o=!1,s=!1,u=!1,l=e.global.def("{}");a.forEach((function(t){var n=r[t];if(w.isDynamic(n)){"function"==typeof n&&(n=r[t]=w.unbox(n));var a=pt(n,null);o=o||a.thisDep,u=u||a.propDep,s=s||a.contextDep}else{switch(i(l,".",t,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}})),t.dynamic[n]=new w.DynamicVariable(4,{thisDep:o,contextDep:s,propDep:u,ref:l,append:function(e,t){a.forEach((function(n){var i=r[n];if(w.isDynamic(i)){var a=e.invoke(t,i);t(l,".",n,"=",a,";")}}))}}),delete t.static[n]}}return{next:C,current:E,procs:function(){var e=D(),t=e.proc("poll"),n=e.proc("refresh"),r=e.block();t(r),n(r);var o,s=e.shared,u=s.gl,l=s.next,c=s.current;r(c,".dirty=false;"),U(e,t),U(e,n,null,!0),_&&(o=e.link(_)),i.oes_vertex_array_object&&n(e.link(i.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var h=0;h<a.maxAttributes;++h){var f=n.def(s.attributes,"[",h,"]"),p=e.cond(f,".buffer");p.then(u,".enableVertexAttribArray(",h,");",u,".bindBuffer(",34962,",",f,".buffer.buffer);",u,".vertexAttribPointer(",h,",",f,".size,",f,".type,",f,".normalized,",f,".stride,",f,".offset);").else(u,".disableVertexAttribArray(",h,");",u,".vertexAttrib4f(",h,",",f,".x,",f,".y,",f,".z,",f,".w);",f,".buffer=null;"),n(p),_&&n(o,".vertexAttribDivisorANGLE(",h,",",f,".divisor);")}return n(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(A).forEach((function(i){var a=A[i],o=r.def(l,".",i),s=e.block();s("if(",o,"){",u,".enable(",a,")}else{",u,".disable(",a,")}",c,".",i,"=",o,";"),n(s),t("if(",o,"!==",c,".",i,"){",s,"}")})),Object.keys(M).forEach((function(i){var a,o,s=M[i],h=E[i],f=e.block();if(f(u,".",s,"("),ne(h)){var p=h.length;a=e.global.def(l,".",i),o=e.global.def(c,".",i),f(N(p,(function(e){return a+"["+e+"]"})),");",N(p,(function(e){return o+"["+e+"]="+a+"["+e+"];"})).join("")),t("if(",N(p,(function(e){return a+"["+e+"]!=="+o+"["+e+"]"})).join("||"),"){",f,"}")}else a=r.def(l,".",i),o=r.def(c,".",i),f(a,");",c,".",i,"=",a,";"),t("if(",a,"!==",o,"){",f,"}");n(f)})),e.compile()}(),compile:function(e,t,i,a,o){var s=D();s.stats=s.link(o),Object.keys(t.static).forEach((function(e){$(s,t,e)})),tt.forEach((function(t){$(s,e,t)}));var u=F(e,t,i,a,s);return function(e,t){var n=e.proc("draw",1);V(e,n),B(e,n,t.context),U(e,n,t.framebuffer),z(e,n,t),j(e,n,t.state),G(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)q(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var i=e.global.def("{}"),a=n.def(r,".id"),o=n.def(i,"[",a,"]");n(e.cond(o).then(o,".call(this,a0);").else(o,"=",i,"[",a,"]=",e.link((function(n){return Z(q,e,t,n,1)})),"(",r,");",o,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;"),e.shared.vao&&n(e.shared.vao,".setVAO(null);")}(s,u),function(e,t){var n=e.proc("scope",3);e.batchId="a2";var i=e.shared,a=i.current;function o(r){var a=t.shader[r];a&&n.set(i.shader,"."+r,a.append(e,n))}B(e,n,t.context),t.framebuffer&&t.framebuffer.append(e,n),lt(Object.keys(t.state)).forEach((function(r){var a=t.state[r].append(e,n);ne(a)?a.forEach((function(t,i){n.set(e.next[r],"["+i+"]",t)})):n.set(i.next,"."+r,a)})),G(e,n,t,!0,!0),[Ye,Ke,qe,Qe,Ze].forEach((function(r){var a=t.draw[r];a&&n.set(i.draw,"."+r,""+a.append(e,n))})),Object.keys(t.uniforms).forEach((function(a){var o=t.uniforms[a].append(e,n);Array.isArray(o)&&(o="["+o.join()+"]"),n.set(i.uniforms,"["+r.id(a)+"]",o)})),Object.keys(t.attributes).forEach((function(r){var i=t.attributes[r].append(e,n),a=e.scopeAttrib(r);Object.keys(new m).forEach((function(e){n.set(a,"."+e,i[e])}))})),t.scopeVAO&&n.set(i.vao,".targetVAO",t.scopeVAO.append(e,n)),o(We),o(Xe),Object.keys(t.state).length>0&&(n(a,".dirty=true;"),n.exit(a,".dirty=true;")),n("a1(",e.shared.context,",a0,",e.batchId,");")}(s,u),function(e,t){var n=e.proc("batch",2);e.batchId="0",V(e,n);var r=!1,i=!0;Object.keys(t.context).forEach((function(e){r=r||t.context[e].propDep})),r||(B(e,n,t.context),i=!1);var a=t.framebuffer,o=!1;function s(e){return e.contextDep&&r||e.propDep}a?(a.propDep?r=o=!0:a.contextDep&&r&&(o=!0),o||U(e,n,a)):U(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),z(e,n,t),j(e,n,t.state,(function(e){return!s(e)})),t.profile&&s(t.profile)||G(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=o;var u=t.shader.progVar;if(u.contextDep&&r||u.propDep)Q(e,n,t,null);else{var l=u.append(e,n);if(n(e.shared.gl,".useProgram(",l,".program);"),t.shader.program)Q(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var c=e.global.def("{}"),h=n.def(l,".id"),f=n.def(c,"[",h,"]");n(e.cond(f).then(f,".call(this,a0,a1);").else(f,"=",c,"[",h,"]=",e.link((function(n){return Z(Q,e,t,n,2)})),"(",l,");",f,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;"),e.shared.vao&&n(e.shared.vao,".setVAO(null);")}(s,u),n(s.compile(),{destroy:function(){u.shader.program.destroy()}})}}}var gt=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(e){n.push(e)}var i=[];function a(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var o=[];function s(e){o.push(e)}var u=[];function l(e,t,n){var r=o.pop()||new a;r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,u.push(r)}var c=[],h=[];return{beginQuery:function(e){var r=n.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(35007,r),i.push(r),l(i.length-1,i.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:l,update:function(){var e,n,a=i.length;if(0!==a){h.length=Math.max(h.length,a+1),c.length=Math.max(c.length,a+1),c[0]=0,h[0]=0;var o=0;for(e=0,n=0;n<i.length;++n){var l=i[n];t.ext_disjoint_timer_query.getQueryObjectEXT(l,34919)?(o+=t.ext_disjoint_timer_query.getQueryObjectEXT(l,34918),r(l)):i[e++]=l,c[n+1]=o,h[n+1]=e}for(i.length=e,e=0,n=0;n<u.length;++n){var f=u[n],p=f.startQueryIndex,d=f.endQueryIndex;f.sum+=c[d]-c[p];var v=h[p],g=h[d];g===v?(f.stats.gpuTime+=f.sum/1e6,s(f)):(f.startQueryIndex=v,f.endQueryIndex=g,u[e++]=f)}u.length=e}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}};function mt(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}return function(e){var r=L(e);if(!r)return null;var i=r.gl,a=i.getContextAttributes(),o=i.isContextLost(),s=I(i,r);if(!s)return null;var u,l,c=(u={"":0},l=[""],{id:function(e){var t=u[e];return t||(t=u[e]=l.length,l.push(e),t)},str:function(e){return l[e]}}),h={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},f=s.extensions,p=gt(0,f),d=O(),v=i.drawingBufferWidth,g=i.drawingBufferHeight,m={tick:0,time:0,viewportWidth:v,viewportHeight:g,framebufferWidth:v,framebufferHeight:g,drawingBufferWidth:v,drawingBufferHeight:g,pixelRatio:r.pixelRatio},y={elements:null,primitive:4,count:-1,offset:0,instances:-1},_=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(34047));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(34852),i=e.getParameter(36063));var a=!!t.oes_texture_float;if(a){var o=e.createTexture();e.bindTexture(3553,o),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var s=e.createFramebuffer();if(e.bindFramebuffer(36160,s),e.framebufferTexture2D(36160,36064,3553,o,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160))a=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var u=B.allocType(5126,4);e.readPixels(0,0,1,1,6408,5126,u),e.getError()?a=!1:(e.deleteFramebuffer(s),e.deleteTexture(o),a=1===u[0]),B.freeType(u)}}var l=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var c=e.createTexture(),h=B.allocType(5121,36);e.activeTexture(33984),e.bindTexture(34067,c),e.texImage2D(34069,0,6408,3,3,0,6408,5121,h),B.freeType(h),e.bindTexture(34067,null),e.deleteTexture(c),l=!e.getError()}return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:a,npotTextureCube:l}}(i,f),b=function(e,n,r,i){var a=0,o={};function s(t){this.id=a++,this.buffer=e.createBuffer(),this.type=t,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){h(this)};var u=[];function l(t,n,r){t.byteLength=n.byteLength,e.bufferData(t.type,n,r)}function c(e,n,r,i,a,o){var s,u;if(e.usage=r,Array.isArray(n)){if(e.dtype=i||5126,n.length>0)if(Array.isArray(n[0])){s=Y(n);for(var c=1,h=1;h<s.length;++h)c*=s[h];e.dimension=c,l(e,u=X(n,s,e.dtype),r),o?e.persistentData=u:B.freeType(u)}else if("number"==typeof n[0]){e.dimension=a;var f=B.allocType(e.dtype,n.length);K(f,n),l(e,f,r),o?e.persistentData=f:B.freeType(f)}else t(n[0])?(e.dimension=n[0].length,e.dtype=i||q(n[0])||5126,l(e,u=X(n,[n.length,n[0].length],e.dtype),r),o?e.persistentData=u:B.freeType(u)):S.raise("invalid buffer data")}else if(t(n))e.dtype=i||q(n),e.dimension=a,l(e,n,r),o&&(e.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(U(n)){s=n.shape;var p=n.stride,d=n.offset,v=0,g=0,m=0,y=0;1===s.length?(v=s[0],g=1,m=p[0],y=0):2===s.length?(v=s[0],g=s[1],m=p[0],y=p[1]):S.raise("invalid shape"),e.dtype=i||q(n.data)||5126,e.dimension=g;var _=B.allocType(e.dtype,v*g);Q(_,n.data,v,g,m,y,d),l(e,_,r),o?e.persistentData=_:B.freeType(_)}else n instanceof ArrayBuffer?(e.dtype=5121,e.dimension=a,l(e,n,r),o&&(e.persistentData=new Uint8Array(new Uint8Array(n)))):S.raise("invalid buffer data")}function h(t){n.bufferCount--,i(t);var r=t.buffer;S(r,"buffer must not be deleted already"),e.deleteBuffer(r),t.buffer=null,delete o[t.id]}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(o).forEach((function(t){e+=o[t].stats.size})),e}),{create:function(i,a,u,l){n.bufferCount++;var f=new s(a);function p(n){var i=35044,a=null,o=0,s=0,u=1;return Array.isArray(n)||t(n)||U(n)||n instanceof ArrayBuffer?a=n:"number"==typeof n?o=0|n:n&&(S.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(S(null===a||Array.isArray(a)||t(a)||U(a),"invalid data for buffer"),a=n.data),"usage"in n&&(S.parameter(n.usage,W,"invalid buffer usage"),i=W[n.usage]),"type"in n&&(S.parameter(n.type,H,"invalid buffer type"),s=H[n.type]),"dimension"in n&&(S.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(S.nni(o,"buffer length must be a nonnegative integer"),o=0|n.length)),f.bind(),a?c(f,a,i,s,u,l):(o&&e.bufferData(f.type,o,i),f.dtype=s||5121,f.usage=i,f.dimension=u,f.byteLength=o),r.profile&&(f.stats.size=f.byteLength*Z[f.dtype]),p}function d(t,n){S(n+t.byteLength<=f.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+t.byteLength+" starting from offset "+n+" to a buffer of size "+f.byteLength),e.bufferSubData(f.type,n,t)}return o[f.id]=f,u||p(i),p._reglType="buffer",p._buffer=f,p.subdata=function(e,n){var r,i=0|(n||0);if(f.bind(),t(e)||e instanceof ArrayBuffer)d(e,i);else if(Array.isArray(e)){if(e.length>0)if("number"==typeof e[0]){var a=B.allocType(f.dtype,e.length);K(a,e),d(a,i),B.freeType(a)}else if(Array.isArray(e[0])||t(e[0])){r=Y(e);var o=X(e,r,f.dtype);d(o,i),B.freeType(o)}else S.raise("invalid buffer data")}else if(U(e)){r=e.shape;var s=e.stride,u=0,l=0,c=0,h=0;1===r.length?(u=r[0],l=1,c=s[0],h=0):2===r.length?(u=r[0],l=r[1],c=s[0],h=s[1]):S.raise("invalid shape");var v=Array.isArray(e.data)?f.dtype:q(e.data),g=B.allocType(v,u*l);Q(g,e.data,u,l,c,h,e.offset),d(g,i),B.freeType(g)}else S.raise("invalid data for buffer subdata");return p},r.profile&&(p.stats=f.stats),p.destroy=function(){h(f)},p},createStream:function(e,t){var n=u.pop();return n||(n=new s(e)),n.bind(),c(n,t,35040,0,1,!1),n},destroyStream:function(e){u.push(e)},clear:function(){z(o).forEach(h),u.forEach(h)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:function(){z(o).forEach((function(t){t.buffer=e.createBuffer(),e.bindBuffer(t.type,t.buffer),e.bufferData(t.type,t.persistentData||t.byteLength,t.usage)}))},_initBuffer:c}}(i,h,r,(function(e){return E.destroyBuffer(e)})),x=function(e,n,r,i){var a={},o=0,s={uint8:5121,uint16:5123};function u(e){this.id=o++,a[this.id]=this,this.buffer=e,this.primType=4,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=5125),u.prototype.bind=function(){this.buffer.bind()};var l=[];function c(i,a,o,s,u,l,c){var h;if(i.buffer.bind(),a){var f=c;c||t(a)&&(!U(a)||t(a.data))||(f=n.oes_element_index_uint?5125:5123),r._initBuffer(i.buffer,a,o,f,3)}else e.bufferData(34963,l,o),i.buffer.dtype=h||5121,i.buffer.usage=o,i.buffer.dimension=3,i.buffer.byteLength=l;if(h=c,!c){switch(i.buffer.dtype){case 5121:case 5120:h=5121;break;case 5123:case 5122:h=5123;break;case 5125:case 5124:h=5125;break;default:S.raise("unsupported type for element array")}i.buffer.dtype=h}i.type=h,S(5125!==h||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var p=u;p<0&&(p=i.buffer.byteLength,5123===h?p>>=1:5125===h&&(p>>=2)),i.vertCount=p;var d=s;if(s<0){d=4;var v=i.buffer.dimension;1===v&&(d=0),2===v&&(d=1),3===v&&(d=4)}i.primType=d}function h(e){i.elementsCount--,S(null!==e.buffer,"must not double destroy elements"),delete a[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(e,n){var a=r.create(null,34963,!0),o=new u(a._buffer);function l(e){if(e)if("number"==typeof e)a(e),o.primType=4,o.vertCount=0|e,o.type=5121;else{var n=null,r=35044,i=-1,u=-1,h=0,f=0;Array.isArray(e)||t(e)||U(e)?n=e:(S.type(e,"object","invalid arguments for elements"),"data"in e&&(n=e.data,S(Array.isArray(n)||t(n)||U(n),"invalid data for element buffer")),"usage"in e&&(S.parameter(e.usage,W,"invalid element buffer usage"),r=W[e.usage]),"primitive"in e&&(S.parameter(e.primitive,J,"invalid element buffer primitive"),i=J[e.primitive]),"count"in e&&(S("number"==typeof e.count&&e.count>=0,"invalid vertex count for elements"),u=0|e.count),"type"in e&&(S.parameter(e.type,s,"invalid buffer type"),f=s[e.type]),"length"in e?h=0|e.length:(h=u,5123===f||5122===f?h*=2:5125!==f&&5124!==f||(h*=4))),c(o,n,r,i,u,h,f)}else a(),o.primType=4,o.vertCount=0,o.type=5121;return l}return i.elementsCount++,l(e),l._reglType="elements",l._elements=o,l.subdata=function(e,t){return a.subdata(e,t),l},l.destroy=function(){h(o)},l},createStream:function(e){var t=l.pop();return t||(t=new u(r.create(null,34963,!0,!1)._buffer)),c(t,e,35040,-1,-1,0,0),t},destroyStream:function(e){l.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof u?e._elements:null},clear:function(){z(a).forEach(h)}}}(i,f,b,h),E=function(e,n,r,i,a,o,s){for(var u=r.maxAttributes,l=new Array(u),c=0;c<u;++c)l[c]=new Be;var h=0,f={},p={Record:Be,scope:{},state:l,currentVAO:null,targetVAO:null,restore:d()?function(){d()&&z(f).forEach((function(e){e.refresh()}))}:function(){},createVAO:function(e){var r=new g;function s(e){var i;if(Array.isArray(e))i=e,r.elements&&r.ownsElements&&r.elements.destroy(),r.elements=null,r.ownsElements=!1,r.offset=0,r.count=0,r.instances=-1,r.primitive=4;else{if(S("object"==typeof e,"invalid arguments for create vao"),S("attributes"in e,"must specify attributes for vao"),e.elements){var l=e.elements;r.ownsElements?"function"==typeof l&&"elements"===l._reglType?(r.elements.destroy(),r.ownsElements=!1):(r.elements(l),r.ownsElements=!1):o.getElements(e.elements)?(r.elements=e.elements,r.ownsElements=!1):(r.elements=o.create(e.elements),r.ownsElements=!0)}else r.elements=null,r.ownsElements=!1;i=e.attributes,r.offset=0,r.count=-1,r.instances=-1,r.primitive=4,r.elements&&(r.count=r.elements._elements.vertCount,r.primitive=r.elements._elements.primType),"offset"in e&&(r.offset=0|e.offset),"count"in e&&(r.count=0|e.count),"instances"in e&&(r.instances=0|e.instances),"primitive"in e&&(S(e.primitive in J,"bad primitive type: "+e.primitive),r.primitive=J[e.primitive]),S.optional((function(){for(var t=Object.keys(e),n=0;n<t.length;++n)S(Fe.indexOf(t[n])>=0,'invalid option for vao: "'+t[n]+'" valid options are '+Fe)})),S(Array.isArray(i),"attributes must be an array")}S(i.length<u,"too many attributes"),S(i.length>0,"must specify at least one attribute");var c={},h=r.attributes;h.length=i.length;for(var f=0;f<i.length;++f){var p,d=i[f],v=h[f]=new Be,g=d.data||d;Array.isArray(g)||t(g)||U(g)?(r.buffers[f]&&(p=r.buffers[f],t(g)&&p._buffer.byteLength>=g.byteLength?p.subdata(g):(p.destroy(),r.buffers[f]=null)),r.buffers[f]||(p=r.buffers[f]=a.create(d,34962,!1,!0)),v.buffer=a.getBuffer(p),v.size=0|v.buffer.dimension,v.normalized=!1,v.type=v.buffer.dtype,v.offset=0,v.stride=0,v.divisor=0,v.state=1,c[f]=1):a.getBuffer(d)?(v.buffer=a.getBuffer(d),v.size=0|v.buffer.dimension,v.normalized=!1,v.type=v.buffer.dtype,v.offset=0,v.stride=0,v.divisor=0,v.state=1):a.getBuffer(d.buffer)?(v.buffer=a.getBuffer(d.buffer),v.size=0|(+d.size||v.buffer.dimension),v.normalized=!!d.normalized||!1,"type"in d?(S.parameter(d.type,H,"invalid buffer type"),v.type=H[d.type]):v.type=v.buffer.dtype,v.offset=0|(d.offset||0),v.stride=0|(d.stride||0),v.divisor=0|(d.divisor||0),v.state=1,S(v.size>=1&&v.size<=4,"size must be between 1 and 4"),S(v.offset>=0,"invalid offset"),S(v.stride>=0&&v.stride<=255,"stride must be between 0 and 255"),S(v.divisor>=0,"divisor must be positive"),S(!v.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in d?(S(f>0,"first attribute must not be a constant"),v.x=+d.x||0,v.y=+d.y||0,v.z=+d.z||0,v.w=+d.w||0,v.state=2):S(!1,"invalid attribute spec for location "+f)}for(var m=0;m<r.buffers.length;++m)!c[m]&&r.buffers[m]&&(r.buffers[m].destroy(),r.buffers[m]=null);return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var e=0;e<r.buffers.length;++e)r.buffers[e]&&r.buffers[e].destroy();r.buffers.length=0,r.ownsElements&&(r.elements.destroy(),r.elements=null,r.ownsElements=!1),r.destroy()},s._vao=r,s._reglType="vao",s(e)},getVAO:function(e){return"function"==typeof e&&e._vao?e._vao:null},destroyBuffer:function(t){for(var n=0;n<l.length;++n){var r=l[n];r.buffer===t&&(e.disableVertexAttribArray(n),r.buffer=null)}},setVAO:d()?function(e){if(e!==p.currentVAO){var t=d();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),p.currentVAO=e}}:function(t){if(t!==p.currentVAO){if(t)t.bindAttrs();else{for(var n=v(),r=0;r<l.length;++r){var i=l[r];i.buffer?(e.enableVertexAttribArray(r),i.buffer.bind(),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}s.elements?e.bindBuffer(34963,s.elements.buffer.buffer):e.bindBuffer(34963,null)}p.currentVAO=t}},clear:d()?function(){z(f).forEach((function(e){e.destroy()}))}:function(){}};function d(){return n.oes_vertex_array_object}function v(){return n.angle_instanced_arrays}function g(){this.id=++h,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var e=d();this.vao=e?e.createVertexArrayOES():null,f[this.id]=this,this.buffers=[]}return g.prototype.bindAttrs=function(){for(var t=v(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(e.enableVertexAttribArray(r),e.bindBuffer(34962,i.buffer.buffer),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),t&&i.divisor&&t.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var a=n.length;a<u;++a)e.disableVertexAttribArray(a);var s=o.getElements(this.elements);s?e.bindBuffer(34963,s.buffer.buffer):e.bindBuffer(34963,null)},g.prototype.refresh=function(){var e=d();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),p.currentVAO=null,e.bindVertexArrayOES(null))},g.prototype.destroy=function(){if(this.vao){var e=d();this===p.currentVAO&&(p.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),f[this.id]&&(delete f[this.id],i.vaoCount-=1)},p}(i,f,_,h,b,x,y),C=function(e,t,r,i){var a={},o={};function s(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function u(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function l(n,r,i){var s=35632===n?a:o,u=s[r];if(!u){var l=t.str(r);u=e.createShader(n),e.shaderSource(u,l),e.compileShader(u),S.shaderError(e,u,l,n,i),s[r]=u}return u}var c={},h=[],f=0;function p(e,t){this.id=f++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(n,r,a){var o,c,h=l(35632,n.fragId),f=l(35633,n.vertId),p=n.program=e.createProgram();if(e.attachShader(p,h),e.attachShader(p,f),a)for(o=0;o<a.length;++o){var d=a[o];e.bindAttribLocation(p,d[0],d[1])}e.linkProgram(p),S.linkError(e,p,t.str(n.fragId),t.str(n.vertId),r);var v=e.getProgramParameter(p,35718);i.profile&&(n.stats.uniformsCount=v);var g=n.uniforms;for(o=0;o<v;++o)if(c=e.getActiveUniform(p,o))if(c.size>1)for(var m=0;m<c.size;++m){var y=c.name.replace("[0]","["+m+"]");u(g,new s(y,t.id(y),e.getUniformLocation(p,y),c))}else u(g,new s(c.name,t.id(c.name),e.getUniformLocation(p,c.name),c));var _=e.getProgramParameter(p,35721);i.profile&&(n.stats.attributesCount=_);var b=n.attributes;for(o=0;o<_;++o)(c=e.getActiveAttrib(p,o))&&u(b,new s(c.name,t.id(c.name),e.getAttribLocation(p,c.name),c))}return i.profile&&(r.getMaxUniformsCount=function(){var e=0;return h.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},r.getMaxAttributesCount=function(){var e=0;return h.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);z(a).forEach(t),a={},z(o).forEach(t),o={},h.forEach((function(t){e.deleteProgram(t.program)})),h.length=0,c={},r.shaderCount=0},program:function(t,i,s,u){S.command(t>=0,"missing vertex shader",s),S.command(i>=0,"missing fragment shader",s);var l=c[i];l||(l=c[i]={});var f=l[t];if(f&&(f.refCount++,!u))return f;var v=new p(i,t);return r.shaderCount++,d(v,s,u),f||(l[t]=v),h.push(v),n(v,{destroy:function(){if(v.refCount--,v.refCount<=0){e.deleteProgram(v.program);var t=h.indexOf(v);h.splice(t,1),r.shaderCount--}l[v.vertId].refCount<=0&&(e.deleteShader(o[v.vertId]),delete o[v.vertId],delete c[v.fragId][v.vertId]),Object.keys(c[v.fragId]).length||(e.deleteShader(a[v.fragId]),delete a[v.fragId],delete c[v.fragId])}})},restore:function(){a={},o={};for(var e=0;e<h.length;++e)d(h[e],null,h[e].attributes.map((function(e){return[e.location,e.name]})))},shader:l,frag:-1,vert:-1}}(i,c,h,r),T=ke(i,f,_,(function(){P.procs.poll()}),m,h,r),A=function(e,t,n,r,i){var a={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(a.srgba=35907),t.ext_color_buffer_half_float&&(a.rgba16f=34842,a.rgb16f=34843),t.webgl_color_buffer_float&&(a.rgba32f=34836);var o=[];Object.keys(a).forEach((function(e){var t=a[e];o[t]=e}));var s=0,u={};function l(e){this.id=s++,this.refCount=1,this.renderbuffer=e,this.format=32854,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function c(t){var n=t.renderbuffer;S(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(36161,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete u[t.id],r.renderbufferCount--}return l.prototype.decRef=function(){--this.refCount<=0&&c(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(u).forEach((function(t){e+=u[t].stats.size})),e}),{create:function(t,s){var c=new l(e.createRenderbuffer());function h(t,r){var s=0,u=0,l=32854;if("object"==typeof t&&t){var f=t;if("shape"in f){var p=f.shape;S(Array.isArray(p)&&p.length>=2,"invalid renderbuffer shape"),s=0|p[0],u=0|p[1]}else"radius"in f&&(s=u=0|f.radius),"width"in f&&(s=0|f.width),"height"in f&&(u=0|f.height);"format"in f&&(S.parameter(f.format,a,"invalid renderbuffer format"),l=a[f.format])}else"number"==typeof t?(s=0|t,u="number"==typeof r?0|r:s):t?S.raise("invalid arguments to renderbuffer constructor"):s=u=1;if(S(s>0&&u>0&&s<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==c.width||u!==c.height||l!==c.format)return h.width=c.width=s,h.height=c.height=u,c.format=l,e.bindRenderbuffer(36161,c.renderbuffer),e.renderbufferStorage(36161,l,s,u),S(0===e.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=Pe(c.format,c.width,c.height)),h.format=o[c.format],h}return u[c.id]=c,r.renderbufferCount++,h(t,s),h.resize=function(t,r){var a=0|t,o=0|r||a;return a===c.width&&o===c.height||(S(a>0&&o>0&&a<=n.maxRenderbufferSize&&o<=n.maxRenderbufferSize,"invalid renderbuffer size"),h.width=c.width=a,h.height=c.height=o,e.bindRenderbuffer(36161,c.renderbuffer),e.renderbufferStorage(36161,c.format,a,o),S(0===e.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=Pe(c.format,c.width,c.height))),h},h._reglType="renderbuffer",h._renderbuffer=c,i.profile&&(h.stats=c.stats),h.destroy=function(){c.decRef()},h},clear:function(){z(u).forEach(c)},restore:function(){z(u).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,t.renderbuffer),e.renderbufferStorage(36161,t.format,t.width,t.height)})),e.bindRenderbuffer(36161,null)}}}(i,f,_,h,r),M=function(e,t,r,i,a,o){var s={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],l=["rgba4","rgb565","rgb5 a1"];t.ext_srgb&&l.push("srgba"),t.ext_color_buffer_half_float&&l.push("rgba16f","rgb16f"),t.webgl_color_buffer_float&&l.push("rgba32f");var c=["uint8"];function h(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function f(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function p(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),a=Math.max(1,r.height);S(i===t&&a===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var o=e.renderbuffer._renderbuffer;S(o.width===t&&o.height===n,"inconsistent width/height for renderbuffer"),o.refCount+=1}}function d(t,n){n&&(n.texture?e.framebufferTexture2D(36160,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(36160,t,36161,n.renderbuffer._renderbuffer.renderbuffer))}function v(e){var t=3553,n=null,r=null,i=e;"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),S.type(i,"function","invalid attachment data");var a=i._reglType;return"texture2d"===a?(n=i,S(3553===t)):"textureCube"===a?(n=i,S(t>=34069&&t<34075,"invalid cube map target")):"renderbuffer"===a?(r=i,t=36161):S.raise("invalid regl object for attachment"),new h(t,n,r)}function g(e,t,n,r,o){if(n){var s=i.create2D({width:e,height:t,format:r,type:o});return s._texture.refCount=0,new h(3553,s,null)}var u=a.create({width:e,height:t,format:r});return u._renderbuffer.refCount=0,new h(36161,null,u)}function m(e){return e&&(e.texture||e.renderbuffer)}function y(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}t.oes_texture_half_float&&c.push("half float","float16"),t.oes_texture_float&&c.push("float","float32");var _=0,b={};function x(){this.id=_++,b[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function E(e){e.colorAttachments.forEach(f),f(e.depthAttachment),f(e.stencilAttachment),f(e.depthStencilAttachment)}function C(t){var n=t.framebuffer;S(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,o.framebufferCount--,delete b[t.id]}function T(t){var n;e.bindFramebuffer(36160,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)d(36064+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(36160,36064+n,3553,null,0);e.framebufferTexture2D(36160,33306,3553,null,0),e.framebufferTexture2D(36160,36096,3553,null,0),e.framebufferTexture2D(36160,36128,3553,null,0),d(36096,t.depthAttachment),d(36128,t.stencilAttachment),d(33306,t.depthStencilAttachment);var a=e.checkFramebufferStatus(36160);e.isContextLost()||36053===a||S.raise("framebuffer configuration not supported, status = "+De[a]),e.bindFramebuffer(36160,s.next?s.next.framebuffer:null),s.cur=s.next,e.getError()}function A(e,i){var a=new x;function h(e,n){var i;S(s.next!==a,"can not update framebuffer which is currently in use");var o=0,f=0,d=!0,y=!0,_=null,b=!0,x="rgba",C="uint8",A=1,M=null,w=null,k=null,O=!1;if("number"==typeof e)o=0|e,f=0|n||o;else if(e){S.type(e,"object","invalid arguments for framebuffer");var P=e;if("shape"in P){var R=P.shape;S(Array.isArray(R)&&R.length>=2,"invalid shape for framebuffer"),o=R[0],f=R[1]}else"radius"in P&&(o=f=P.radius),"width"in P&&(o=P.width),"height"in P&&(f=P.height);("color"in P||"colors"in P)&&(_=P.color||P.colors,Array.isArray(_)&&S(1===_.length||t.webgl_draw_buffers,"multiple render targets not supported")),_||("colorCount"in P&&(A=0|P.colorCount,S(A>0,"invalid color buffer count")),"colorTexture"in P&&(b=!!P.colorTexture,x="rgba4"),"colorType"in P&&(C=P.colorType,b?(S(t.oes_texture_float||!("float"===C||"float32"===C),"you must enable OES_texture_float in order to use floating point framebuffer objects"),S(t.oes_texture_half_float||!("half float"===C||"float16"===C),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===C||"float16"===C?(S(t.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),x="rgba16f"):"float"!==C&&"float32"!==C||(S(t.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),x="rgba32f"),S.oneOf(C,c,"invalid color type")),"colorFormat"in P&&(x=P.colorFormat,u.indexOf(x)>=0?b=!0:l.indexOf(x)>=0?b=!1:S.optional((function(){b?S.oneOf(P.colorFormat,u,"invalid color format for texture"):S.oneOf(P.colorFormat,l,"invalid color format for renderbuffer")})))),("depthTexture"in P||"depthStencilTexture"in P)&&(O=!(!P.depthTexture&&!P.depthStencilTexture),S(!O||t.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in P&&("boolean"==typeof P.depth?d=P.depth:(M=P.depth,y=!1)),"stencil"in P&&("boolean"==typeof P.stencil?y=P.stencil:(w=P.stencil,d=!1)),"depthStencil"in P&&("boolean"==typeof P.depthStencil?d=y=P.depthStencil:(k=P.depthStencil,d=!1,y=!1))}else o=f=1;var L=null,I=null,N=null,D=null;if(Array.isArray(_))L=_.map(v);else if(_)L=[v(_)];else for(L=new Array(A),i=0;i<A;++i)L[i]=g(o,f,b,x,C);S(t.webgl_draw_buffers||L.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),S(L.length<=r.maxColorAttachments,"too many color attachments, not supported"),o=o||L[0].width,f=f||L[0].height,M?I=v(M):d&&!y&&(I=g(o,f,O,"depth","uint32")),w?N=v(w):y&&!d&&(N=g(o,f,!1,"stencil","uint8")),k?D=v(k):!M&&!w&&y&&d&&(D=g(o,f,O,"depth stencil","depth stencil")),S(!!M+!!w+!!k<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var F=null;for(i=0;i<L.length;++i)if(p(L[i],o,f),S(!L[i]||L[i].texture&&Re.indexOf(L[i].texture._texture.format)>=0||L[i].renderbuffer&&Ne.indexOf(L[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),L[i]&&L[i].texture){var B=Le[L[i].texture._texture.format]*Ie[L[i].texture._texture.type];null===F?F=B:S(F===B,"all color attachments much have the same number of bits per pixel.")}return p(I,o,f),S(!I||I.texture&&6402===I.texture._texture.format||I.renderbuffer&&33189===I.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object"),p(N,o,f),S(!N||N.renderbuffer&&36168===N.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object"),p(D,o,f),S(!D||D.texture&&34041===D.texture._texture.format||D.renderbuffer&&34041===D.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object"),E(a),a.width=o,a.height=f,a.colorAttachments=L,a.depthAttachment=I,a.stencilAttachment=N,a.depthStencilAttachment=D,h.color=L.map(m),h.depth=m(I),h.stencil=m(N),h.depthStencil=m(D),h.width=a.width,h.height=a.height,T(a),h}return o.framebufferCount++,h(e,i),n(h,{resize:function(e,t){S(s.next!==a,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===a.width&&r===a.height)return h;for(var i=a.colorAttachments,o=0;o<i.length;++o)y(i[o],n,r);return y(a.depthAttachment,n,r),y(a.stencilAttachment,n,r),y(a.depthStencilAttachment,n,r),a.width=h.width=n,a.height=h.height=r,T(a),h},_reglType:"framebuffer",_framebuffer:a,destroy:function(){C(a),E(a)},use:function(e){s.setFBO({framebuffer:h},e)}})}return n(s,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof x)return t}return null},create:A,createCube:function(e){var a=Array(6);function o(e){var r;S(a.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var l,h={color:null},f=0,p=null,d="rgba",v="uint8",g=1;if("number"==typeof e)f=0|e;else if(e){S.type(e,"object","invalid arguments for framebuffer");var m=e;if("shape"in m){var y=m.shape;S(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),S(y[0]===y[1],"cube framebuffer must be square"),f=y[0]}else"radius"in m&&(f=0|m.radius),"width"in m?(f=0|m.width,"height"in m&&S(m.height===f,"must be square")):"height"in m&&(f=0|m.height);("color"in m||"colors"in m)&&(p=m.color||m.colors,Array.isArray(p)&&S(1===p.length||t.webgl_draw_buffers,"multiple render targets not supported")),p||("colorCount"in m&&(g=0|m.colorCount,S(g>0,"invalid color buffer count")),"colorType"in m&&(S.oneOf(m.colorType,c,"invalid color type"),v=m.colorType),"colorFormat"in m&&(d=m.colorFormat,S.oneOf(m.colorFormat,u,"invalid color format for texture"))),"depth"in m&&(h.depth=m.depth),"stencil"in m&&(h.stencil=m.stencil),"depthStencil"in m&&(h.depthStencil=m.depthStencil)}else f=1;if(p)if(Array.isArray(p))for(l=[],r=0;r<p.length;++r)l[r]=p[r];else l=[p];else{l=Array(g);var _={radius:f,format:d,type:v};for(r=0;r<g;++r)l[r]=i.createCube(_)}for(h.color=Array(l.length),r=0;r<l.length;++r){var b=l[r];S("function"==typeof b&&"textureCube"===b._reglType,"invalid cube map"),f=f||b.width,S(b.width===f&&b.height===f,"invalid cube map shape"),h.color[r]={target:34069,data:l[r]}}for(r=0;r<6;++r){for(var x=0;x<l.length;++x)h.color[x].target=34069+r;r>0&&(h.depth=a[0].depth,h.stencil=a[0].stencil,h.depthStencil=a[0].depthStencil),a[r]?a[r](h):a[r]=A(h)}return n(o,{width:f,height:f,color:l})}return o(e),n(o,{faces:a,resize:function(e){var t,n=0|e;if(S(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===o.width)return o;var i=o.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;t<6;++t)a[t].resize(n);return o.width=o.height=n,o},_reglType:"framebufferCube",destroy:function(){a.forEach((function(e){e.destroy()}))}})},clear:function(){z(b).forEach(C)},restore:function(){s.cur=null,s.next=null,s.dirty=!0,z(b).forEach((function(t){t.framebuffer=e.createFramebuffer(),T(t)}))}})}(i,f,_,T,A,h),P=vt(i,c,f,_,b,x,0,M,{},E,C,y,m,p,r),R=Ue(i,M,P.procs.poll,m,a,f,_),N=P.next,D=i.canvas,F=[],j=[],V=[],G=[r.onDestroy],$=null;function ee(){if(0===F.length)return p&&p.update(),void($=null);$=k.next(ee),he();for(var e=F.length-1;e>=0;--e){var t=F[e];t&&t(m,null,0)}i.flush(),p&&p.update()}function te(){!$&&F.length>0&&($=k.next(ee))}function ne(){$&&(k.cancel(ee),$=null)}function re(e){e.preventDefault(),o=!0,ne(),j.forEach((function(e){e()}))}function ie(e){i.getError(),o=!1,s.restore(),C.restore(),b.restore(),T.restore(),A.restore(),M.restore(),E.restore(),p&&p.restore(),P.procs.refresh(),te(),V.forEach((function(e){e()}))}var ae="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM;function oe(e){function t(e,t){var n={},r={};return Object.keys(e).forEach((function(i){var a=e[i];if(w.isDynamic(a))r[i]=w.unbox(a,i);else{if(t&&Array.isArray(a))for(var o=0;o<a.length;++o)if(w.isDynamic(a[o]))return void(r[i]=w.unbox(a,i));n[i]=a}})),{dynamic:r,static:n}}S(!!e,"invalid args to regl({...})"),S.type(e,"object","invalid args to regl({...})");var r=t(e.context||{},!0),i=t(e.uniforms||{},!0),a=t(e.attributes||{},!1),s=t(function(e){var t=n({},e);function r(e){if(e in t){var n=t[e];delete t[e],Object.keys(n).forEach((function(r){t[e+"."+r]=n[r]}))}}return delete t.uniforms,delete t.attributes,delete t.context,delete t.vao,"stencil"in t&&t.stencil.op&&(t.stencil.opBack=t.stencil.opFront=t.stencil.op,delete t.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in e&&(t.vao=e.vao),t}(e),!1),u={gpuTime:0,cpuTime:0,count:0},l=P.compile(s,a,i,r,u),c=l.draw,h=l.batch,f=l.scope,p=[];return n((function(e,t){var n;if(o&&S.raise("context lost"),"function"==typeof e)return f.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(n=0;n<e;++n)f.call(this,null,t,n);else{if(!Array.isArray(e))return f.call(this,e,t,0);for(n=0;n<e.length;++n)f.call(this,e[n],t,n)}else if("number"==typeof e){if(e>0)return h.call(this,function(e){for(;p.length<e;)p.push(null);return p}(0|e),0|e)}else{if(!Array.isArray(e))return c.call(this,e);if(e.length)return h.call(this,e,e.length)}}),{stats:u,destroy:function(){l.destroy()}})}!ae&&D&&(D.addEventListener("webglcontextlost",re,!1),D.addEventListener("webglcontextrestored",ie,!1));var se=M.setFBO=oe({framebuffer:w.define.call(null,1,"framebuffer")});function ue(e,t){var n=0;P.procs.poll();var r=t.color;r&&(i.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=16384),"depth"in t&&(i.clearDepth(+t.depth),n|=256),"stencil"in t&&(i.clearStencil(0|t.stencil),n|=1024),S(!!n,"called regl.clear with no buffer specified"),i.clear(n)}function le(e){return S.type(e,"function","regl.frame() callback must be a function"),F.push(e),te(),{cancel:function(){var t=mt(F,e);S(t>=0,"cannot cancel a frame twice"),F[t]=function e(){var t=mt(F,e);F[t]=F[F.length-1],F.length-=1,F.length<=0&&ne()}}}}function ce(){var e=N.viewport,t=N.scissor_box;e[0]=e[1]=t[0]=t[1]=0,m.viewportWidth=m.framebufferWidth=m.drawingBufferWidth=e[2]=t[2]=i.drawingBufferWidth,m.viewportHeight=m.framebufferHeight=m.drawingBufferHeight=e[3]=t[3]=i.drawingBufferHeight}function he(){m.tick+=1,m.time=pe(),ce(),P.procs.poll()}function fe(){T.refresh(),ce(),P.procs.refresh(),p&&p.update()}function pe(){return(O()-d)/1e3}fe();var de=n(oe,{clear:function(e){if(S("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var t=0;t<6;++t)se(n({framebuffer:e.framebuffer.faces[t]},e),ue);else se(e,ue);else ue(0,e)},prop:w.define.bind(null,1),context:w.define.bind(null,2),this:w.define.bind(null,3),draw:oe({}),buffer:function(e){return b.create(e,34962,!1,!1)},elements:function(e){return x.create(e,!1)},texture:T.create2D,cube:T.createCube,renderbuffer:A.create,framebuffer:M.create,framebufferCube:M.createCube,vao:E.createVAO,attributes:a,frame:le,on:function(e,t){var n;switch(S.type(t,"function","listener callback must be a function"),e){case"frame":return le(t);case"lost":n=j;break;case"restore":n=V;break;case"destroy":n=G;break;default:S.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}},limits:_,hasExtension:function(e){return _.extensions.indexOf(e.toLowerCase())>=0},read:R,destroy:function(){F.length=0,ne(),!ae&&D&&(D.removeEventListener("webglcontextlost",re),D.removeEventListener("webglcontextrestored",ie)),C.clear(),M.clear(),A.clear(),E.clear(),T.clear(),x.clear(),b.clear(),p&&p.clear(),G.forEach((function(e){e()}))},_gl:i,_refresh:fe,poll:function(){he(),p&&p.update()},now:pe,stats:h});return r.onDone(null,de),de}}(VI)})),HI=function(){function e(t,n){_(this,e),E(this,"attribute",void 0),E(this,"buffer",void 0);var r=n.buffer,i=n.offset,a=n.stride,o=n.normalized,s=n.size,u=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:a||0,normalized:o||!1,divisor:u||0},s&&(this.attribute.size=s)}return x(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(e){this.buffer.subData(e)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),WI=(E(wI={},e.gl.POINTS,"points"),E(wI,e.gl.LINES,"lines"),E(wI,e.gl.LINE_LOOP,"line loop"),E(wI,e.gl.LINE_STRIP,"line strip"),E(wI,e.gl.TRIANGLES,"triangles"),E(wI,e.gl.TRIANGLE_FAN,"triangle fan"),E(wI,e.gl.TRIANGLE_STRIP,"triangle strip"),wI),XI=(E(kI={},e.gl.STATIC_DRAW,"static"),E(kI,e.gl.DYNAMIC_DRAW,"dynamic"),E(kI,e.gl.STREAM_DRAW,"stream"),kI),YI=(E(OI={},e.gl.BYTE,"int8"),E(OI,e.gl.UNSIGNED_INT,"int16"),E(OI,e.gl.INT,"int32"),E(OI,e.gl.UNSIGNED_BYTE,"uint8"),E(OI,e.gl.UNSIGNED_SHORT,"uint16"),E(OI,e.gl.UNSIGNED_INT,"uint32"),E(OI,e.gl.FLOAT,"float"),OI),ZI=(E(PI={},e.gl.ALPHA,"alpha"),E(PI,e.gl.LUMINANCE,"luminance"),E(PI,e.gl.LUMINANCE_ALPHA,"luminance alpha"),E(PI,e.gl.RGB,"rgb"),E(PI,e.gl.RGBA,"rgba"),E(PI,e.gl.RGBA4,"rgba4"),E(PI,e.gl.RGB5_A1,"rgb5 a1"),E(PI,e.gl.RGB565,"rgb565"),E(PI,e.gl.DEPTH_COMPONENT,"depth"),E(PI,e.gl.DEPTH_STENCIL,"depth stencil"),PI),qI=(E(RI={},e.gl.DONT_CARE,"dont care"),E(RI,e.gl.NICEST,"nice"),E(RI,e.gl.FASTEST,"fast"),RI),KI=(E(LI={},e.gl.NEAREST,"nearest"),E(LI,e.gl.LINEAR,"linear"),E(LI,e.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),E(LI,e.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),E(LI,e.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),E(LI,e.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),LI),QI=(E(II={},e.gl.REPEAT,"repeat"),E(II,e.gl.CLAMP_TO_EDGE,"clamp"),E(II,e.gl.MIRRORED_REPEAT,"mirror"),II),JI=(E(NI={},e.gl.NONE,"none"),E(NI,e.gl.BROWSER_DEFAULT_WEBGL,"browser"),NI),$I=(E(DI={},e.gl.NEVER,"never"),E(DI,e.gl.ALWAYS,"always"),E(DI,e.gl.LESS,"less"),E(DI,e.gl.LEQUAL,"lequal"),E(DI,e.gl.GREATER,"greater"),E(DI,e.gl.GEQUAL,"gequal"),E(DI,e.gl.EQUAL,"equal"),E(DI,e.gl.NOTEQUAL,"notequal"),DI),eN=(E(FI={},e.gl.FUNC_ADD,"add"),E(FI,e.gl.MIN_EXT,"min"),E(FI,e.gl.MAX_EXT,"max"),E(FI,e.gl.FUNC_SUBTRACT,"subtract"),E(FI,e.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),FI),tN=(E(BI={},e.gl.ZERO,"zero"),E(BI,e.gl.ONE,"one"),E(BI,e.gl.SRC_COLOR,"src color"),E(BI,e.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),E(BI,e.gl.SRC_ALPHA,"src alpha"),E(BI,e.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),E(BI,e.gl.DST_COLOR,"dst color"),E(BI,e.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),E(BI,e.gl.DST_ALPHA,"dst alpha"),E(BI,e.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),E(BI,e.gl.CONSTANT_COLOR,"constant color"),E(BI,e.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),E(BI,e.gl.CONSTANT_ALPHA,"constant alpha"),E(BI,e.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),E(BI,e.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),BI),nN=(E(UI={},e.gl.NEVER,"never"),E(UI,e.gl.ALWAYS,"always"),E(UI,e.gl.LESS,"less"),E(UI,e.gl.LEQUAL,"lequal"),E(UI,e.gl.GREATER,"greater"),E(UI,e.gl.GEQUAL,"gequal"),E(UI,e.gl.EQUAL,"equal"),E(UI,e.gl.NOTEQUAL,"notequal"),UI),rN=(E(zI={},e.gl.ZERO,"zero"),E(zI,e.gl.KEEP,"keep"),E(zI,e.gl.REPLACE,"replace"),E(zI,e.gl.INVERT,"invert"),E(zI,e.gl.INCR,"increment"),E(zI,e.gl.DECR,"decrement"),E(zI,e.gl.INCR_WRAP,"increment wrap"),E(zI,e.gl.DECR_WRAP,"decrement wrap"),zI),iN=(E(jI={},e.gl.FRONT,"front"),E(jI,e.gl.BACK,"back"),jI),aN=function(){function t(n,r){_(this,t),E(this,"buffer",void 0);var i=r.data,a=r.usage,o=r.type;this.buffer=n.buffer({data:i,usage:XI[a||e.gl.STATIC_DRAW],type:YI[o||e.gl.UNSIGNED_BYTE]})}return x(t,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(e){var t=e.data,n=e.offset;this.buffer.subdata(t,n)}}]),t}(),oN=function(){function t(n,r){_(this,t),E(this,"elements",void 0);var i=r.data,a=r.usage,o=r.type,s=r.count;this.elements=n.elements({data:i,usage:XI[a||e.gl.STATIC_DRAW],type:YI[o||e.gl.UNSIGNED_BYTE],count:s})}return x(t,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(e){var t=e.data;this.elements.subdata(t)}},{key:"destroy",value:function(){}}]),t}(),sN=function(){function e(t,n){_(this,e),E(this,"framebuffer",void 0);var r=n.width,i=n.height,a=n.color,o=n.colors,s=(n.depth,n.stencil,{width:r,height:i});Array.isArray(o)&&(s.colors=o.map((function(e){return e.get()}))),a&&"boolean"!=typeof a&&(s.color=a.get()),this.framebuffer=t.framebuffer(s)}return x(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.framebuffer.resize(t,n)}}]),e}(),uN=Mn.f,lN=ae(uN),cN=ae([].push),hN=function(e){return function(t){for(var n,r=wn(t),i=ro(r),a=i.length,o=0,s=[];a>o;)n=i[o++],Ie&&!lN(r,n)||cN(s,e?[n,r[n]]:r[n]);return s}},fN={entries:hN(!0),values:hN(!1)}.values;er({target:"Object",stat:!0},{values:function(e){return fN(e)}});var pN,dN,vN,gN,mN,yN=function(){function t(n,r){_(this,t),E(this,"reGl",void 0),E(this,"destroyed",!1),E(this,"drawCommand",void 0),E(this,"drawPickCommand",void 0),E(this,"drawParams",void 0),E(this,"options",void 0),E(this,"uniforms",{}),this.reGl=n;var i=r.vs,a=r.fs,o=r.attributes,s=r.uniforms,u=r.primitive,l=r.count,c=r.elements,h=r.depth,f=r.blend,p=r.stencil,d=r.cull,g=r.instances,m={};this.options=r,s&&(this.uniforms=this.extractUniforms(s),Object.keys(s).forEach((function(e){m[e]=n.prop(e)})));var y={};Object.keys(o).forEach((function(e){y[e]=o[e].get()}));var b={attributes:y,frag:a,uniforms:m,vert:i,blend:{},primitive:WI[void 0===u?e.gl.TRIANGLES:u]};g&&(b.instances=g),l&&(b.count=l),c&&(b.elements=c.get()),this.initDepthDrawParams({depth:h},b),this.initBlendDrawParams({blend:f},b),this.initStencilDrawParams({stencil:p},b),this.initCullDrawParams({cull:d},b),this.drawCommand=n(b);var x=cb(b);x.blend=v(v({},x.blend),{},{enable:!1}),x.stencil=v(v({},x.stencil),{},{enable:!1}),this.drawPickCommand=n(x),this.drawParams=b}return x(t,[{key:"addUniforms",value:function(e){this.uniforms=v(v({},this.uniforms),this.extractUniforms(e))}},{key:"draw",value:function(e,t){if(!this.drawParams.attributes||0!==Object.keys(this.drawParams.attributes).length){var n=v(v({},this.uniforms),this.extractUniforms(e.uniforms||{})),r={};Object.keys(n).forEach((function(e){var t=g(n[e]);"boolean"===t||"number"===t||Array.isArray(n[e])||n[e].BYTES_PER_ELEMENT?r[e]=n[e]:r[e]=n[e].get()})),t?this.drawPickCommand(r):this.drawCommand(r)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach((function(e){e.destroy()})),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var r=t.depth;r&&(n.depth={enable:void 0===r.enable||!!r.enable,mask:void 0===r.mask||!!r.mask,func:$I[r.func||e.gl.LESS],range:r.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,n){var r=t.blend;if(r){var i=r.enable,a=r.func,o=r.equation,s=r.color,u=void 0===s?[0,0,0,0]:s;n.blend={enable:!!i,func:{srcRGB:tN[a&&a.srcRGB||e.gl.SRC_ALPHA],srcAlpha:tN[a&&a.srcAlpha||e.gl.SRC_ALPHA],dstRGB:tN[a&&a.dstRGB||e.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:tN[a&&a.dstAlpha||e.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:eN[o&&o.rgb||e.gl.FUNC_ADD],alpha:eN[o&&o.alpha||e.gl.FUNC_ADD]},color:u}}}},{key:"initStencilDrawParams",value:function(t,n){var r=t.stencil;if(r){var i=r.enable,a=r.mask,o=void 0===a?-1:a,s=r.func,u=void 0===s?{cmp:e.gl.ALWAYS,ref:0,mask:-1}:s,l=r.opFront,c=void 0===l?{fail:e.gl.KEEP,zfail:e.gl.KEEP,zpass:e.gl.KEEP}:l,h=r.opBack,f=void 0===h?{fail:e.gl.KEEP,zfail:e.gl.KEEP,zpass:e.gl.KEEP}:h;n.stencil={enable:!!i,mask:o,func:v(v({},u),{},{cmp:nN[u.cmp]}),opFront:{fail:rN[c.fail],zfail:rN[c.zfail],zpass:rN[c.zpass]},opBack:{fail:rN[f.fail],zfail:rN[f.zfail],zpass:rN[f.zpass]}}}}},{key:"initCullDrawParams",value:function(t,n){var r=t.cull;if(r){var i=r.enable,a=r.face,o=void 0===a?e.gl.BACK:a;n.cull={enable:!!i,face:iN[o]}}}},{key:"extractUniforms",value:function(e){var t=this,n={};return Object.keys(e).forEach((function(r){t.extractUniformsRecursively(r,e[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(e,t,n,r){var i=this;null===t||"number"==typeof t||"boolean"==typeof t||Array.isArray(t)&&"number"==typeof t[0]||jy(t)||""===t||"resize"in t?n["".concat(r&&r+".").concat(e)]=t:(Ny(t)&&Object.keys(t).forEach((function(a){i.extractUniformsRecursively(a,t[a],n,"".concat(r&&r+".").concat(e))})),Array.isArray(t)&&t.forEach((function(t,a){Object.keys(t).forEach((function(o){i.extractUniformsRecursively(o,t[o],n,"".concat(r&&r+".").concat(e,"[").concat(a,"]"))}))})))}}]),t}(),_N=function(){function t(n,r){_(this,t),E(this,"texture",void 0),E(this,"width",void 0),E(this,"height",void 0),E(this,"isDistroy",!1);var i=r.data,a=r.type,o=void 0===a?e.gl.UNSIGNED_BYTE:a,s=r.width,u=r.height,l=r.flipY,c=void 0!==l&&l,h=r.format,f=void 0===h?e.gl.RGBA:h,p=r.mipmap,d=void 0!==p&&p,v=r.wrapS,g=void 0===v?e.gl.CLAMP_TO_EDGE:v,m=r.wrapT,y=void 0===m?e.gl.CLAMP_TO_EDGE:m,b=r.aniso,x=void 0===b?0:b,S=r.alignment,C=void 0===S?1:S,T=r.premultiplyAlpha,A=void 0!==T&&T,M=r.mag,w=void 0===M?e.gl.NEAREST:M,k=r.min,O=void 0===k?e.gl.NEAREST:k,P=r.colorSpace,R=void 0===P?e.gl.BROWSER_DEFAULT_WEBGL:P,L=r.x,I=void 0===L?0:L,N=r.y,D=void 0===N?0:N,F=r.copy,B=void 0!==F&&F;this.width=s,this.height=u;var U={width:s,height:u,type:YI[o],format:ZI[f],wrapS:QI[g],wrapT:QI[y],mag:KI[w],min:KI[O],alignment:C,flipY:c,colorSpace:JI[R],premultiplyAlpha:A,aniso:x,x:I,y:D,copy:B};i&&(U.data=i),"number"==typeof d?U.mipmap=qI[d]:"boolean"==typeof d&&(U.mipmap=d),this.texture=n.texture(U)}return x(t,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.texture(e)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.texture.resize(t,n),this.width=t,this.height=n}},{key:"destroy",value:function(){this.isDistroy||this.texture.destroy(),this.isDistroy=!0}}]),t}(),bN=Qx()(pN=function(){function e(){var t=this;_(this,e),E(this,"extensionObject",void 0),E(this,"gl",void 0),E(this,"$container",void 0),E(this,"canvas",void 0),E(this,"width",void 0),E(this,"height",void 0),E(this,"isDirty",void 0),E(this,"createModel",(function(e){return new yN(t.gl,e)})),E(this,"createAttribute",(function(e){return new HI(t.gl,e)})),E(this,"createBuffer",(function(e){return new aN(t.gl,e)})),E(this,"createElements",(function(e){return new oN(t.gl,e)})),E(this,"createTexture2D",(function(e){return new _N(t.gl,e)})),E(this,"createFramebuffer",(function(e){return new sN(t.gl,e)})),E(this,"useFramebuffer",(function(e,n){t.gl({framebuffer:e?e.get():null})(n)})),E(this,"clear",(function(e){var n=e.color,r=e.depth,i=e.stencil,a=e.framebuffer,o=void 0===a?null:a,s={color:n,depth:r,stencil:i};s.framebuffer=null===o?o:o.get(),t.gl.clear(s)})),E(this,"viewport",(function(e){var n=e.x,r=e.y,i=e.width,a=e.height;t.gl._gl.viewport(n,r,i,a),t.width=i,t.height=a,t.gl._refresh()})),E(this,"readPixels",(function(e){var n=e.framebuffer,r={x:e.x,y:e.y,width:e.width,height:e.height};return n&&(r.framebuffer=n.get()),t.gl.read(r)})),E(this,"getViewportSize",(function(){return{width:t.gl._gl.drawingBufferWidth,height:t.gl._gl.drawingBufferHeight}})),E(this,"getContainer",(function(){return bd?t.canvas:null===(e=t.canvas)||void 0===e?void 0:e.parentElement;var e})),E(this,"getCanvas",(function(){return t.canvas})),E(this,"getGLContext",(function(){return t.gl._gl})),E(this,"destroy",(function(){t.gl.destroy()}))}var t;return x(e,[{key:"init",value:(t=y(regeneratorRuntime.mark((function e(t,n){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.canvas=t,e.next=3,new Promise((function(e,t){GI({canvas:r.canvas,attributes:{alpha:!0,antialias:n.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,stencil:n.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(n,r){!n&&r||t(n),e(r)}})}));case 3:this.gl=e.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(e){return!!this.getGLContext().getExtension(e)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var e=this.getGLContext();e.disable(e.CULL_FACE)}},{key:"setDirty",value:function(e){this.isDirty=e}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||pN,xN=function(){function e(t){_(this,e),E(this,"sceneService",void 0),E(this,"mapService",void 0),E(this,"controlService",void 0),E(this,"layerService",void 0),E(this,"iconService",void 0),E(this,"markerService",void 0),E(this,"popupService",void 0),E(this,"fontService",void 0),E(this,"interactionService",void 0),E(this,"container",void 0);var n=t.id,r=t.map,i=t.canvas,a=t.hasBaseMap,o=wP();this.container=o,r.setContainer(o,n,i,a),o.bind(YE.IRendererService).to(bN).inSingletonScope(),this.sceneService=o.get(YE.ISceneService),this.mapService=o.get(YE.IMapService),this.iconService=o.get(YE.IIconService),this.fontService=o.get(YE.IFontService),this.controlService=o.get(YE.IControlService),this.layerService=o.get(YE.ILayerService),this.markerService=o.get(YE.IMarkerService),this.interactionService=o.get(YE.IInteractionService),this.popupService=o.get(YE.IPopupService),bd?this.sceneService.initMiniScene(t):(this.initComponent(n),this.sceneService.init(t),this.initControl())}return x(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(e){return this.sceneService.exportPng(e)}},{key:"exportMap",value:function(e){return this.sceneService.exportPng(e)}},{key:"registerRenderService",value:function(e){var t=this;this.sceneService.loaded?new e(this).init():this.on("loaded",(function(){new e(t).init()}))}},{key:"setBgColor",value:function(e){this.mapService.setBgColor(e)}},{key:"addLayer",value:function(e){var t=kP(this.container);e.setContainer(t,this.container),this.sceneService.addLayer(e)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(e){return this.layerService.getLayer(e)}},{key:"getLayerByName",value:function(e){return this.layerService.getLayerByName(e)}},{key:"removeLayer",value:function(e,t){this.layerService.remove(e,t)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(e){this.layerService.setEnableRender(e)}},{key:"addIconFont",value:function(e,t){this.fontService.addIconFont(e,t)}},{key:"addIconFonts",value:function(e){var t=this;e.forEach((function(e){var n=N(e,2),r=n[0],i=n[1];t.fontService.addIconFont(r,i)}))}},{key:"addFontFace",value:function(e,t){this.sceneService.addFontFace(e,t)}},{key:"addImage",value:function(e,t){bd?this.iconService.addImageMini(e,t,this.sceneService):this.iconService.addImage(e,t)}},{key:"hasImage",value:function(e){return this.iconService.hasImage(e)}},{key:"removeImage",value:function(e){this.iconService.removeImage(e)}},{key:"addIconFontGlyphs",value:function(e,t){this.fontService.addIconGlyphs(t)}},{key:"addControl",value:function(e){this.controlService.addControl(e,this.container)}},{key:"removeControl",value:function(e){this.controlService.removeControl(e)}},{key:"getControlByName",value:function(e){return this.controlService.getControlByName(e)}},{key:"addMarker",value:function(e){this.markerService.addMarker(e)}},{key:"addMarkerLayer",value:function(e){this.markerService.addMarkerLayer(e)}},{key:"removeMarkerLayer",value:function(e){this.markerService.removeMarkerLayer(e)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(e){this.popupService.addPopup(e)}},{key:"on",value:function(e,t){-1===QP.indexOf(e)?this.mapService.on(e,t):this.sceneService.on(e,t)}},{key:"once",value:function(e,t){-1===QP.indexOf(e)?this.mapService.once(e,t):this.sceneService.once(e,t)}},{key:"off",value:function(e,t){-1===QP.indexOf(e)?this.mapService.off(e,t):this.sceneService.off(e,t)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(e){return this.mapService.getCenter(e)}},{key:"setCenter",value:function(e,t){return this.mapService.setCenter(e,t)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(e){return this.mapService.setPitch(e)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(e){this.mapService.setRotation(e)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(e){this.mapService.panTo(e)}},{key:"panBy",value:function(e,t){this.mapService.panBy(e,t)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(e){this.mapService.setZoom(e)}},{key:"fitBounds",value:function(e,t){var n=this.sceneService.getSceneConfig(),r=n.fitBoundsOptions,i=n.animate;this.mapService.fitBounds(e,t||v(v({},r),{},{animate:i}))}},{key:"setZoomAndCenter",value:function(e,t){this.mapService.setZoomAndCenter(e,t)}},{key:"setMapStyle",value:function(e){this.mapService.setMapStyle(e)}},{key:"setMapStatus",value:function(e){this.mapService.setMapStatus(e)}},{key:"pixelToLngLat",value:function(e){return this.mapService.pixelToLngLat(e)}},{key:"lngLatToPixel",value:function(e){return this.mapService.lngLatToPixel(e)}},{key:"containerToLngLat",value:function(e){return this.mapService.containerToLngLat(e)}},{key:"lngLatToContainer",value:function(e){return this.mapService.lngLatToContainer(e)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(e,t){this.container.bind(YE.IPostProcessingPass).to(e).whenTargetNamed(t)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(e){this.controlService.init({container:Td(e)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var e=this.sceneService.getSceneConfig(),t=e.logoVisible,n=e.logoPosition;t&&this.addControl(new tR({position:n}))}}]),e}(),EN=(dN=AP(YE.IGlobalConfigService),gN=j((vN=function(){function e(t){_(this,e),z(this,"configService",gN,this),E(this,"config",void 0),this.config=t}return x(e,[{key:"setContainer",value:function(e,t,n,r){e.bind(YE.MapConfig).toConstantValue(v(v({},this.config),{},{id:t,canvas:n,hasBaseMap:r})),e.bind(YE.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}()).prototype,"configService",[dN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vN),SN=H((function(e,t){e.exports=function(){function e(e){var r=[];return e.AMapUI&&r.push(t(e.AMapUI)),e.Loca&&r.push(n(e.Loca)),Promise.all(r)}function t(e){return new Promise((function(t,n){var i=[];if(e.plugins)for(var u=0;u<e.plugins.length;u+=1)-1==a.AMapUI.plugins.indexOf(e.plugins[u])&&i.push(e.plugins[u]);if(o.AMapUI===r.failed)n("前次请求 AMapUI 失败");else if(o.AMapUI===r.notload){o.AMapUI=r.loading,a.AMapUI.version=e.version||a.AMapUI.version,u=a.AMapUI.version;var l=document.body||document.head,c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/ui/"+u+"/main.js",c.onerror=function(e){o.AMapUI=r.failed,n("请求 AMapUI 失败")},c.onload=function(){if(o.AMapUI=r.loaded,i.length)window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}for(t();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()}));else for(t();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()},l.appendChild(c)}else o.AMapUI===r.loaded?e.version&&e.version!==a.AMapUI.version?n("不允许多个版本 AMapUI 混用"):i.length?window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()})):t():e.version&&e.version!==a.AMapUI.version?n("不允许多个版本 AMapUI 混用"):s.AMapUI.push((function(e){e?n(e):i.length?window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()})):t()}))}))}function n(e){return new Promise((function(t,n){if(a.AMap.version.startsWith("2.0"))n("Loca 暂不适配 JSAPI 2.0,请使用 1.4.15");else if(o.Loca===r.failed)n("前次请求 Loca 失败");else if(o.Loca===r.notload){o.Loca=r.loading,a.Loca.version=e.version||a.Loca.version;var i=a.Loca.version,u=a.key,l=document.body||document.head,c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/loca?v="+i+"&key="+u,c.onerror=function(e){o.Loca=r.failed,n("请求 AMapUI 失败")},c.onload=function(){for(o.Loca=r.loaded,t();s.Loca.length;)s.Loca.splice(0,1)[0]()},l.appendChild(c)}else o.Loca===r.loaded?e.version&&e.version!==a.Loca.version?n("不允许多个版本 Loca 混用"):t():e.version&&e.version!==a.Loca.version?n("不允许多个版本 Loca 混用"):s.Loca.push((function(e){e?n(e):n()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var r,i;(i=r||(r={})).notload="notload",i.loading="loading",i.loaded="loaded",i.failed="failed";var a={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},o={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]},u=[];return{load:function(t){return new Promise((function(n,i){if(o.AMap==r.failed)i("");else if(o.AMap==r.notload){var s=t.key,l=t.version,c=t.plugins;s?(window.AMap&&"lbs.amap.com"!==location.host&&i("禁止多种API加载方式混用"),a.key=s,a.AMap.version=l||a.AMap.version,a.AMap.plugins=c||a.AMap.plugins,o.AMap=r.loading,l=document.body||document.head,window.___onAPILoaded=function(a){if(delete window.___onAPILoaded,a)o.AMap=r.failed,i(a);else for(o.AMap=r.loaded,e(t).then((function(){n(window.AMap)})).catch(i);u.length;)u.splice(0,1)[0]()},(c=document.createElement("script")).type="text/javascript",c.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+a.AMap.version+"&key="+s+"&plugin="+a.AMap.plugins.join(","),c.onerror=function(e){o.AMap=r.failed,i(e)},l.appendChild(c)):i("请填写key")}else if(o.AMap==r.loaded)if(t.key&&t.key!==a.key)i("多个不一致的 key");else if(t.version&&t.version!==a.AMap.version)i("不允许多个版本 JSAPI 混用");else{if(s=[],t.plugins)for(l=0;l<t.plugins.length;l+=1)-1==a.AMap.plugins.indexOf(t.plugins[l])&&s.push(t.plugins[l]);s.length?window.AMap.plugin(s,(function(){e(t).then((function(){n(window.AMap)})).catch(i)})):e(t).then((function(){n(window.AMap)})).catch(i)}else if(t.key&&t.key!==a.key)i("多个不一致的 key");else if(t.version&&t.version!==a.AMap.version)i("不允许多个版本 JSAPI 混用");else{var h=[];if(t.plugins)for(l=0;l<t.plugins.length;l+=1)-1==a.AMap.plugins.indexOf(t.plugins[l])&&h.push(t.plugins[l]);!function(e){"function"==typeof e&&(o.AMap===r.loaded?e(window.AMap):u.push(e))}((function(){h.length?window.AMap.plugin(h,(function(){e(t).then((function(){n(window.AMap)})).catch(i)})):e(t).then((function(){n(window.AMap)})).catch(i)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,a={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},o={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]}}}}()})),CN=function(){function e(t){_(this,e),E(this,"size",1e4),this.size=t||1e4}return x(e,[{key:"setSize",value:function(e){this.size=e}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(e){return(180+e)/360*this.size}},{key:"mercatorYfromLat",value:function(e){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(e){return e/this.size*360-180}},{key:"latFromMercatorY",value:function(e){var t=180-360*(1-e/this.size);return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}},{key:"project",value:function(e){return[this.mercatorXfromLng(e[0]),this.mercatorYfromLat(e[1])]}},{key:"unproject",value:function(e){return[this.lngFromMercatorX(e[0]),this.latFromMercatorY(e[1])]}}]),e}();function TN(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={top:0,right:0,bottom:0,left:0};if("number"==typeof e)return{top:e,right:e,bottom:e,left:e};if(Array.isArray(e)){if(4===e.length)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(2===e.length)return{top:e[0],right:e[1],bottom:e[0],left:e[1]}}return v(v({},t),e)}(mN=e.Version||(e.Version={}))["GAODE1.x"]="GAODE1.x",mN["GAODE2.x"]="GAODE2.x",mN.MAPBOX="MAPBOX",mN.L7MAP="L7MAP",mN.SIMPLE="SIMPLE",mN.GLOBEL="GLOBEL";var AN,MN,wN,kN,ON,PN,RN,LN,IN,NN,DN,FN={dark:"amap://styles/2a09079c3daac9420ee53b67307a8006?isPublic=true",light:"amap://styles/1fd9f8ef9751298f11f5c56968312c70?isPublic=true",normal:"amap://styles/normal",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true"},BN=Math.PI/180,UN=function(){function e(){_(this,e),E(this,"projectionMatrix",IT()),E(this,"viewMatrix",IT()),E(this,"viewProjectionMatrix",IT()),E(this,"ViewProjectionMatrixUncentered",IT()),E(this,"viewUncenteredMatrix",IT()),E(this,"zoom",void 0),E(this,"center",void 0)}return x(e,[{key:"syncWithMapCamera",value:function(e){var t=e.zoom,n=void 0===t?1:t,r=e.pitch,i=void 0===r?0:r,a=e.bearing,o=void 0===a?0:a,s=e.center,u=void 0===s?[0,0]:s,l=e.offsetOrigin,c=void 0===l?[0,0]:l,h=e.cameraHeight,f=void 0===h?1:h,p=e.aspect,d=void 0===p?1:p,v=e.near,g=void 0===v?.1:v,m=e.far,y=void 0===m?1e3:m,_=e.fov,b=void 0===_?0:_;this.zoom=n,this.center=u;var x=i*BN,E=(360-o)*BN;qT(this.projectionMatrix,b,d,g,y);var S=oA(f*Math.sin(x)*Math.sin(E),-f*Math.sin(x)*Math.cos(E),f*Math.cos(x)),C=oA(-Math.cos(x)*Math.sin(E),Math.cos(x)*Math.cos(E),Math.sin(x));JT(this.viewMatrix,S,oA(0,0,0),C),this.viewUncenteredMatrix=NT(this.viewMatrix),zT(this.viewMatrix,this.viewMatrix,oA(-c[0],c[1],0)),UT(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),UT(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var e=N(this.center,2);return[e[0],e[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){var n=Math.max(Math.min(85.0511287798,e[1]),-85.0511287798),r=Math.PI/180,i=e[0]*r,a=n*r;a=Math.log(Math.tan(Math.PI/4+a/2));return[i=(256<<20)*(.5/Math.PI*i+.5)-215440491,a=-((256<<20)*(-.5/Math.PI*a+(r=.5))-106744817)]}}]),e}(),zN=["id","style","minZoom","maxZoom","token","mapInstance","plugin"],jN=0;window.forceWebGL=!0;var VN,GN,HN,WN,XN,YN,ZN,qN,KN,QN,JN,$N=!1,eD=[],tD=(AN=Qx(),MN=Kx(YE.IGlobalConfigService),wN=Kx(YE.MapConfig),kN=Kx(YE.ICoordinateSystemService),ON=Kx(YE.IEventEmitter),AN((LN=j((RN=function(){function t(){var n=this;_(this,t),E(this,"version",e.Version["GAODE1.x"]),E(this,"simpleMapCoord",new CN),E(this,"map",void 0),E(this,"bgColor","rgba(0, 0, 0, 0)"),z(this,"configService",LN,this),z(this,"config",IN,this),z(this,"coordinateSystemService",NN,this),z(this,"eventEmitter",DN,this),E(this,"markerContainer",void 0),E(this,"$mapContainer",void 0),E(this,"viewport",void 0),E(this,"cameraChangedCallback",void 0),E(this,"handleCameraChanged",(function(t){var r=t.camera,i=r.fov,a=r.near,o=r.far,s=r.height,u=r.pitch,l=r.rotation,c=r.aspect,h=r.position,f=n.getCenter(),p=f.lng,d=f.lat;if(n.emit("mapchange"),n.cameraChangedCallback){n.viewport.syncWithMapCamera({aspect:c,bearing:360-l,far:o,fov:i,cameraHeight:s,near:a,pitch:u,zoom:n.map.getZoom()-1,center:[p,d],offsetOrigin:[h.x,h.y]});var v=n.config.offsetZoom,g=void 0===v?12:v;n.viewport.getZoom()>g?n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.P20_OFFSET):n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.P20),n.cameraChangedCallback(n.viewport)}}))}var n;return x(t,[{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"addMarkerContainer",value:function(){var e=this.map.getContainer();if(null!==e){var t=e.getElementsByClassName("amap-maps")[0];this.markerContainer=wd("div","l7-marker-container",t)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(e,t){-1!==qP.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(e,t)}},{key:"off",value:function(e,t){-1!==qP.indexOf(e)?this.eventEmitter.off(e,t):this.map.off(e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var e;return null===(e=this.map.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var e=this.map.getSize();return[e.getWidth(),e.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(e){return this.map.setZoom(e+1)}},{key:"getCenter",value:function(e){if(null!=e&&e.padding){var t=this.getCenter(),n=N(this.getSize(),2),r=(n[0],n[1],TN(e.padding)),i=this.lngLatToPixel([t.lng,t.lat]),a=[(r.right-r.left)/2,(r.bottom-r.top)/2];return this.pixelToLngLat([i.x-a[0],i.y-a[1]])}var o=this.map.getCenter();return{lng:o.getLng(),lat:o.getLat()}}},{key:"setCenter",value:function(e,t){if(null!=t&&t.padding){var n=TN(t.padding),r=this.lngLatToPixel(e),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],a=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([a.lng,a.lat])}else this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var e=this.map.getBounds().toBounds(),t=e.getNorthEast(),n=e.getSouthWest(),r=this.getCenter(),i=r.lng>t.getLng()||r.lng<n.getLng()?180-t.getLng():t.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,t.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.get("zooms")[0]-1}},{key:"getMaxZoom",value:function(){return this.map.get("zooms")[1]-1}},{key:"setRotation",value:function(e){return this.map.setRotation(e)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy(e,t)}},{key:"fitBounds",value:function(e){this.map.setBounds(new AMap.Bounds([e[0][0],e[0][1],e[1][0],e[1][1]]))}},{key:"setZoomAndCenter",value:function(e,t){this.map.setZoomAndCenter(e,t)}},{key:"setMapStyle",value:function(e){this.map.setMapStyle(this.getMapStyle(e))}},{key:"setMapStatus",value:function(e){this.map.setStatus(e)}},{key:"pixelToLngLat",value:function(e){var t=this.map.pixelToLngLat(new AMap.Pixel(e[0],e[1]));return{lng:t.getLng(),lat:t.getLat()}}},{key:"lngLatToPixel",value:function(e){var t=this.map.lnglatToPixel(new AMap.LngLat(e[0],e[1]));return{x:t.getX(),y:t.getY()}}},{key:"containerToLngLat",value:function(e){var t=new AMap.Pixel(e[0],e[1]),n=this.map.containerToLngLat(t);return{lng:null==n?void 0:n.getLng(),lat:null==n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(e){var t=new AMap.LngLat(e[0],e[1]),n=this.map.lngLatToContainer(t);return{x:n.getX(),y:n.getY()}}},{key:"lngLatToCoord",value:function(e){var t=this.map.lngLatToGeodeticCoord(e);return[t.x,-t.y]}},{key:"lngLatToMercator",value:function(e,t){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),a=IT();return zT(a,a,oA(i[0],i[1],t)),jT(a,a,oA(r[0],r[1],r[2])),VT(a,a,n[0]),GT(a,a,n[1]),HT(a,a,n[2]),a}},{key:"init",value:(n=y(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s,u,l,c,h,f,p,d,g=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,a=t.minZoom,o=void 0===a?0:a,s=t.maxZoom,u=void 0===s?18:s,l=t.token,c=void 0===l?"15cd8a57710d40c9b7c0e3cc120f1200":l,h=t.mapInstance,f=t.plugin,p=void 0===f?[]:f,d=k(t,zN),e.next=3,new Promise((function(e){var t=function(){if(h)g.map=h,g.$mapContainer=g.map.getContainer(),setTimeout((function(){g.map.on("camerachange",g.handleCameraChanged),e()}),30);else{g.$mapContainer=g.creatAmapContainer(n);var t=v({mapStyle:g.getMapStyle(i),zooms:[o,u],viewMode:"3D"},d);t.zoom&&(t.zoom+=1);var r=new AMap.Map(g.$mapContainer,t);r.on("camerachange",g.handleCameraChanged),r.on("camerachange",(function(){setTimeout((function(){return g.handleAfterMapChange()}))})),g.map=r,setTimeout((function(){e()}),10)}};$N||h?$N&&window.AMap||h?t():eD.push(t):("15cd8a57710d40c9b7c0e3cc120f1200"===c&&console.warn(g.configService.getSceneWarninfo("MapToken")),$N=!0,p.push("Map3D"),SN.load({key:c,version:"1.4.15",plugins:p}).then((function(e){t(),eD.length&&(eD.forEach((function(e){return e()})),eD=[])})).catch((function(e){throw new Error(e)})))}));case 3:this.viewport=new UN;case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"meterToCoord",value:function(e,t){var n=AMap.GeometryUtil.distance(M(AMap.LngLat,D(e)),M(AMap.LngLat,D(t))),r=N(this.lngLatToCoord(e),2),i=r[0],a=r[1],o=N(this.lngLatToCoord(t),2),s=o[0],u=o[1];return Math.sqrt(Math.pow(i-s,2)+Math.pow(a-u,2))/n}},{key:"exportMap",value:function(e){var t,n=null===(t=this.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-layer")[0];return"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"destroy",value:function(){var e,t;this.map.destroy(),null===(e=this.$mapContainer)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$mapContainer),delete window.initAMap;var n=document.getElementById("amap-script");n&&document.head.removeChild(n)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"handleAfterMapChange",value:function(){this.emit("mapAfterFrameChange")}},{key:"getMapStyle",value:function(e){return FN[e]?FN[e]:e}},{key:"creatAmapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_amap_div"+jN++,t.appendChild(n),n}}]),t}()).prototype,"configService",[MN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IN=j(RN.prototype,"config",[wN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NN=j(RN.prototype,"coordinateSystemService",[kN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DN=j(RN.prototype,"eventEmitter",[ON],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PN=RN))||PN),nD=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.apply(this,arguments)}return x(n,[{key:"getServiceConstructor",value:function(){return tD}}]),n}(EN),rD={dark:"amap://styles/dark",light:"amap://styles/light",normal:"amap://styles/normal",blank:"amap://styles/1a91e7ec761981d85b35f3099ff781a3"},iD=function(){function e(){_(this,e),E(this,"projectionMatrix",IT()),E(this,"viewMatrix",IT()),E(this,"viewProjectionMatrix",IT()),E(this,"ViewProjectionMatrixUncentered",IT()),E(this,"viewUncenteredMatrix",IT()),E(this,"zoom",void 0),E(this,"center",void 0)}return x(e,[{key:"syncWithMapCamera",value:function(e){var t=e.zoom,n=void 0===t?1:t,r=e.center,i=void 0===r?[0,0]:r,a=e.offsetOrigin,o=void 0===a?[0,0]:a,s=e.cameraPosition,u=void 0===s?[0,0,0]:s,l=e.up,c=void 0===l?[0,1,0]:l,h=e.lookAt,f=void 0===h?[0,0,0]:h,p=e.aspect,d=void 0===p?1:p,v=e.near,g=void 0===v?.1:v,m=e.far,y=void 0===m?1e3:m,_=e.fov,b=void 0===_?45:_;this.zoom=n,this.center=i,qT(this.projectionMatrix,b/180*Math.PI,d,g,y);var x=oA.apply(kA,D(u)),E=oA.apply(kA,D(f)),S=oA.apply(kA,D(c));JT(this.viewMatrix,x,E,S),this.viewUncenteredMatrix=NT(this.viewMatrix),zT(this.viewMatrix,this.viewMatrix,oA(-o[0],o[1],0)),UT(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),UT(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var e=N(this.center,2);return[e[0],e[1]]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){var n=Math.max(Math.min(85.0511287798,e[1]),-85.0511287798),r=Math.PI/180,i=e[0]*r,a=n*r;a=Math.log(Math.tan(Math.PI/4+a/2));return[i=(256<<20)*(.5/Math.PI*i+.5)-215440491,a=-((256<<20)*(-.5/Math.PI*a+(r=.5))-106744817)]}}]),e}(),aD=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"],oD=0;window.forceWebGL=!0;var sD=!1,uD=[],lD=(VN=Qx(),GN=Kx(YE.IGlobalConfigService),HN=Kx(YE.MapConfig),WN=Kx(YE.ICoordinateSystemService),XN=Kx(YE.IEventEmitter),VN((qN=j((ZN=function(){function t(){var n=this;_(this,t),E(this,"version",e.Version["GAODE2.x"]),E(this,"simpleMapCoord",new CN),E(this,"map",void 0),E(this,"sceneCenter",void 0),E(this,"sceneCenterMKT",void 0),E(this,"bgColor","rgba(0, 0, 0, 0)"),z(this,"configService",qN,this),z(this,"config",KN,this),z(this,"coordinateSystemService",QN,this),z(this,"eventEmitter",JN,this),E(this,"markerContainer",void 0),E(this,"$mapContainer",void 0),E(this,"viewport",void 0),E(this,"cameraChangedCallback",void 0),E(this,"handleViewChanged",(function(t){var r=n.map.customCoords.getCameraParams(),i=r.fov,a=r.near,o=r.far,s=r.aspect,u=r.position,l=r.lookAt,c=r.up;n.emit("mapchange");var h=t.zoom,f=n.map.customCoords.getCenter();n.cameraChangedCallback&&(n.viewport.syncWithMapCamera({aspect:s,far:o,fov:i,cameraPosition:u,lookAt:l,up:c,near:a,zoom:h-1,center:f,offsetOrigin:[u[0],u[1]]}),n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.P20_2),n.cameraChangedCallback(n.viewport))}))}var n;return x(t,[{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"setCustomCoordCenter",value:function(e){var t;this.sceneCenter=e,this.sceneCenterMKT=(t=this.map.getProjection()).project.apply(t,D(this.sceneCenter))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMKT}},{key:"lngLatToCoord",value:function(e){var t=this.map.getProjection().project;return this.sceneCenter||(this.map.customCoords.setCenter(e),this.setCustomCoordCenter(e)),this._sub(t(e[0],e[1]),this.sceneCenterMKT)}},{key:"lngLatToCoords",value:function(e){var t=this;return e.map((function(e){return"number"==typeof e[0]?t.lngLatToCoord(e):e.map((function(e){return t.lngLatToCoord(e)}))}))}},{key:"addMarkerContainer",value:function(){if(this.map){var e=this.map.getContainer();if(null!==e){var t=e.getElementsByClassName("amap-maps")[0];t.style.zIndex="auto",this.markerContainer=wd("div","l7-marker-container2",t)}}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(e,t){-1!==qP.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(e,t)}},{key:"off",value:function(e,t){-1!==qP.indexOf(e)?this.eventEmitter.off(e,t):this.map.off(e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var e;return null===(e=this.map.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var e=this.map.getSize();return[e.getWidth(),e.getHeight()]}},{key:"getType",value:function(){return"amap2"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(e){return this.map.setZoom(e+1)}},{key:"getCenter",value:function(e){if(null!=e&&e.padding){var t=this.getCenter(),n=N(this.getSize(),2),r=(n[0],n[1],TN(e.padding)),i=this.lngLatToPixel([t.lng,t.lat]),a=[(r.right-r.left)/2,(r.bottom-r.top)/2];return this.pixelToLngLat([i.x-a[0],i.y-a[1]])}var o=this.map.getCenter();return{lng:o.getLng(),lat:o.getLat()}}},{key:"setCenter",value:function(e,t){if(null!=t&&t.padding){var n=TN(t.padding),r=this.lngLatToPixel(e),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],a=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([a.lng,a.lat])}else this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var e=this.map.getBounds(),t=e.getNorthEast(),n=e.getSouthWest(),r=this.getCenter(),i=r.lng>t.getLng()||r.lng<n.getLng()?180-t.getLng():t.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,t.getLat()]]}},{key:"getMinZoom",value:function(){return this.map.getZooms()[0]-1}},{key:"getMaxZoom",value:function(){return this.map.getZooms()[1]-1}},{key:"setRotation",value:function(e){return this.map.setRotation(e)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy(e,t)}},{key:"fitBounds",value:function(e){this.map.setBounds(new AMap.Bounds([e[0][0],e[0][1],e[1][0],e[1][1]]))}},{key:"setZoomAndCenter",value:function(e,t){this.map.setZoomAndCenter(e,t)}},{key:"setMapStyle",value:function(e){this.map.setMapStyle(this.getMapStyle(e))}},{key:"setMapStatus",value:function(e){this.map.setStatus(e)}},{key:"pixelToLngLat",value:function(e){var t=this.map.pixelToLngLat(new AMap.Pixel(e[0],e[1]));return{lng:t.getLng(),lat:t.getLat()}}},{key:"lngLatToPixel",value:function(e){var t=this.map.lnglatToPixel(new AMap.LngLat(e[0],e[1]));return{x:t.getX(),y:t.getY()}}},{key:"containerToLngLat",value:function(e){var t=new AMap.Pixel(e[0],e[1]),n=this.map.containerToLngLat(t);return{lng:null==n?void 0:n.getLng(),lat:null==n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(e){var t=new AMap.LngLat(e[0],e[1]),n=this.map.lngLatToContainer(t);return{x:n.getX(),y:n.getY()}}},{key:"lngLatToMercator",value:function(e,t){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.map.customCoords.lngLatToCoord(e),a=IT();return zT(a,a,oA(i[0],i[1],t)),jT(a,a,oA(r[0],r[1],r[2])),VT(a,a,n[0]),GT(a,a,n[1]),HT(a,a,n[2]),a}},{key:"init",value:(n=y(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s,u,l,c,h,f,p,d,g,m,y=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,a=t.minZoom,o=void 0===a?0:a,s=t.maxZoom,u=void 0===s?18:s,l=t.token,c=void 0===l?"ff533602d57df6f8ab3b0fea226ae52f":l,h=t.mapInstance,f=t.plugin,p=void 0===f?[]:f,d=t.version,g=void 0===d?"2.0":d,m=k(t,aD),e.next=3,new Promise((function(e){var t=function(){if(h){var t;y.map=h,y.$mapContainer=y.map.getContainer();var r=y.map.getCenter();null===(t=y.map.customCoords)||void 0===t||t.setCenter([r.lng,r.lat]),y.setCustomCoordCenter([r.lng,r.lat]),setTimeout((function(){y.map.on("viewchange",y.handleViewChanged),e()}),30)}else{y.$mapContainer=y.creatAmapContainer(n);var a=v({mapStyle:y.getMapStyle(i),zooms:[o,u],viewMode:"3D"},m);a.zoom&&(a.zoom+=1);var s=new AMap.Map(y.$mapContainer,a);y.map=s;var l=s.getCenter();s.customCoords.setCenter([l.lng,l.lat]),y.setCustomCoordCenter([l.lng,l.lat]),s.on("viewchange",y.handleViewChanged),setTimeout((function(){e()}),10)}};y.viewport=new iD,sD||h?sD&&window.AMap||h?t():uD.push(t):("ff533602d57df6f8ab3b0fea226ae52f"===c&&console.warn(y.configService.getSceneWarninfo("MapToken")),sD=!0,p.push("Map3D"),SN.load({key:c,version:g,plugins:p}).then((function(e){t(),uD.length&&(uD.forEach((function(e){return e()})),uD=[])})).catch((function(e){throw new Error(e)})))}));case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"meterToCoord",value:function(e,t){var n=AMap.GeometryUtil.distance(M(AMap.LngLat,D(e)),M(AMap.LngLat,D(t))),r=N(this.lngLatToCoord(e),2),i=r[0],a=r[1],o=N(this.lngLatToCoord(t),2),s=o[0],u=o[1];return Math.sqrt(Math.pow(i-s,2)+Math.pow(a-u,2))/n}},{key:"exportMap",value:function(e){var t,n=null===(t=this.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-layer")[0];return"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"destroy",value:function(){var e,t;this.map.destroy(),null===(e=this.$mapContainer)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$mapContainer),delete window.initAMap;var n=document.getElementById("amap-script");n&&document.head.removeChild(n)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"initViewPort",value:function(){var t,n=null===(t=this.map.customCoords)||void 0===t?void 0:t.getCameraParams(),r=n.fov,i=n.near,a=n.far,o=n.aspect,s=n.position,u=n.lookAt,l=n.up;this.emit("mapchange");var c=this.map.customCoords.getCenter(),h=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:o,far:a,fov:r,cameraPosition:s,lookAt:u,near:i,up:l,zoom:h-1,center:c,offsetOrigin:[s[0],s[1]]}),this.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(e,t){var n=[0,0];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}},{key:"getMapStyle",value:function(e){return rD[e]?rD[e]:e}},{key:"creatAmapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_amap_div"+oD++,t.appendChild(n),n}}]),t}()).prototype,"configService",[GN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KN=j(ZN.prototype,"config",[HN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QN=j(ZN.prototype,"coordinateSystemService",[WN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JN=j(ZN.prototype,"eventEmitter",[XN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YN=ZN))||YN),cD=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.apply(this,arguments)}return x(n,[{key:"getServiceConstructor",value:function(){return lD}}]),n}(EN);er({target:"Math",stat:!0},{sign:nM}),er({target:"String",proto:!0,forced:sR("sub")},{sub:function(){return oR(this,"sub","","")}});var hD,fD=pD;function pD(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=n,this.p2y=r}function dD(e,t,n){var r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}function vD(e,t,n){return Math.min(n,Math.max(t,e))}function gD(e,t,n){return e*(1-n)+t*n}function mD(e,t,n,r){var i=new fD(e,t,n,r);return function(e){return i.solve(e)}}pD.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},pD.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},pD.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},pD.prototype.solveCurveX=function(e,t){var n,r,i,a,o;for(void 0===t&&(t=1e-6),i=e,o=0;o<8;o++){if(a=this.sampleCurveX(i)-e,Math.abs(a)<t)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=a/s}if((i=e)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(a=this.sampleCurveX(i),Math.abs(a-e)<t)return i;e>a?n=i:r=i,i=.5*(r-n)+n}return i},pD.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var yD=mD(.25,.1,.25,1);function _D(){return!(bd||!Ed.matchMedia)&&(null==hD&&(hD=Ed.matchMedia("(prefers-reduced-motion: reduce)")),hD.matches)}function bD(e,t){var n,r={},i=U(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;a in e&&(r[a]=e[a])}}catch(e){i.e(e)}finally{i.f()}return r}var xD=bd?Date.now.bind(Date):Ed.performance&&Ed.performance.now?Ed.performance.now.bind(Ed.performance):Date.now.bind(Date),ED=Ed.requestAnimationFrame||Ed.mozRequestAnimationFrame||Ed.webkitRequestAnimationFrame||Ed.msRequestAnimationFrame,SD=Ed.cancelAnimationFrame||Ed.mozCancelAnimationFrame||Ed.webkitCancelAnimationFrame||Ed.msCancelAnimationFrame;function CD(e){var t=ED(e);return{cancel:function(){return SD(t)}}}var TD=function(){function e(t,n){if(_(this,e),E(this,"lng",void 0),E(this,"lat",void 0),isNaN(t)||isNaN(n))throw new Error("Invalid LngLat object: (".concat(t,", ").concat(n,")"));if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return x(e,[{key:"wrap",value:function(){return new e(dD(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(e){var t=Math.PI/180,n=this.lat*t,r=e.lat*t,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return 6371008.8*Math.acos(Math.min(i,1))}}],[{key:"convert",value:function(t){if(t instanceof e)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new e(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"===g(t)&&null!==t){var n="lng"in t?t.lng:t.lon;return new e(Number(n),Number(t.lat))}throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),e}(),AD=function(){function e(t,n){_(this,e),E(this,"ne",void 0),E(this,"sw",void 0),t&&(n?this.setSouthWest(t).setNorthEast(n):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}return x(e,[{key:"setNorthEast",value:function(e){return this.ne=e instanceof TD?new TD(e.lng,e.lat):TD.convert(e),this}},{key:"setSouthWest",value:function(e){return this.sw=e instanceof TD?new TD(e.lng,e.lat):TD.convert(e),this}},{key:"extend",value:function(t){var n,r,i=this.sw,a=this.ne;if(t instanceof TD)n=t,r=t;else{if(!(t instanceof e)){if(Array.isArray(t)){if(4===t.length||t.every(Array.isArray)){var o=t;return this.extend(e.convert(o))}var s=t;return this.extend(TD.convert(s))}return this}if(n=t.sw,r=t.ne,!n||!r)return this}return i||a?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),a.lng=Math.max(r.lng,a.lng),a.lat=Math.max(r.lat,a.lat)):(this.sw=new TD(n.lng,n.lat),this.ne=new TD(r.lng,r.lat)),this}},{key:"getCenter",value:function(){return new TD((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new TD(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new TD(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(e){var t=TD.convert(e),n=t.lng,r=t.lat,i=this.sw.lat<=r&&r<=this.ne.lat,a=this.sw.lng<=n&&n<=this.ne.lng;return this.sw.lng>this.ne.lng&&(a=this.sw.lng>=n&&n>=this.ne.lng),i&&a}}],[{key:"convert",value:function(t){return t instanceof e?t:new e(t)}}]),e}(),MD=function(){function e(t,n){_(this,e),E(this,"x",void 0),E(this,"y",void 0),this.x=t,this.y=n}return x(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"_add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"add",value:function(e){return this.clone()._add(e)}},{key:"_sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"sub",value:function(e){return this.clone()._sub(e)}},{key:"_multByPoint",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multByPoint",value:function(e){return this.clone()._multByPoint(e)}},{key:"_divByPoint",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divByPoint",value:function(e){return this.clone()._divByPoint(e)}},{key:"_mult",value:function(e){return this.x*=e,this.y*=e,this}},{key:"mult",value:function(e){return this.clone()._mult(e)}},{key:"_div",value:function(e){return this.x/=e,this.y/=e,this}},{key:"div",value:function(e){return this.clone()._div(e)}},{key:"_rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,i=n*this.x+t*this.y;return this.x=r,this.y=i,this}},{key:"rotate",value:function(e){return this.clone()._rotate(e)}},{key:"_rotateAround",value:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.x+n*(this.x-t.x)-r*(this.y-t.y),a=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=i,this.y=a,this}},{key:"roateAround",value:function(e,t){return this.clone()._rotateAround(e,t)}},{key:"_matMult",value:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this}},{key:"matMult",value:function(e){return this.clone()._matMult(e)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var e=this.y;return this.y=this.x,this.x=-e,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"dist",value:function(e){return Math.sqrt(this.distSqr(e))}},{key:"distSqr",value:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(e){return Math.atan2(this.y-e.y,this.x-e.x)}},{key:"angleWith",value:function(e){return this.angleWithSep(e.x,e.y)}},{key:"angleWithSep",value:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)}}],[{key:"convert",value:function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t}}]),e}();er({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return We(URL.prototype.toString,this)}}),Ih("Float64",(function(e){return function(t,n,r){return e(this,t,n,r)}})),Ih("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var wD=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(_(this,e),E(this,"top",void 0),E(this,"bottom",void 0),E(this,"left",void 0),E(this,"right",void 0),isNaN(t)||t<0||isNaN(n)||n<0||isNaN(r)||r<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=r,this.right=i}return x(e,[{key:"interpolate",value:function(e,t,n){return null!=t.top&&null!=e.top&&(this.top=gD(e.top,t.top,n)),null!=t.bottom&&null!=e.bottom&&(this.bottom=gD(e.bottom,t.bottom,n)),null!=t.left&&null!=e.left&&(this.left=gD(e.left,t.left,n)),null!=t.right&&null!=e.right&&(this.right=gD(e.right,t.right,n)),this}},{key:"getCenter",value:function(e,t){var n=vD((this.left+e-this.right)/2,0,e),r=vD((this.top+t-this.bottom)/2,0,t);return new MD(n,r)}},{key:"equals",value:function(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}},{key:"clone",value:function(){return new e(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),e}(),kD=2*Math.PI*6371008.8;function OD(e){return kD*Math.cos(e*Math.PI/180)}function PD(e){return(180+e)/360}function RD(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function LD(e,t){return e/OD(t)}function ID(e){var t=180-360*e;return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}var ND=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_(this,e),E(this,"x",void 0),E(this,"y",void 0),E(this,"z",void 0),this.x=+t,this.y=+n,this.z=+r}return x(e,[{key:"toLngLat",value:function(){return new TD(360*this.x-180,ID(this.y))}},{key:"toAltitude",value:function(){return e=this.z,t=this.y,e*OD(ID(t));var e,t}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/kD*(e=ID(this.y),1/Math.cos(e*Math.PI/180));var e}}],[{key:"fromLngLat",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=TD.convert(t);return new e(PD(r.lng),RD(r.lat),LD(n,r.lat))}}]),e}(),DD=function(){function e(t,n,r,i,a){_(this,e),E(this,"tileSize",void 0),E(this,"tileZoom",void 0),E(this,"lngRange",void 0),E(this,"latRange",void 0),E(this,"maxValidLatitude",void 0),E(this,"scale",void 0),E(this,"width",void 0),E(this,"height",void 0),E(this,"angle",void 0),E(this,"rotationMatrix",void 0),E(this,"pixelsToGLUnits",void 0),E(this,"cameraToCenterDistance",void 0),E(this,"mercatorMatrix",void 0),E(this,"projMatrix",void 0),E(this,"invProjMatrix",void 0),E(this,"alignedProjMatrix",void 0),E(this,"pixelMatrix",void 0),E(this,"pixelMatrixInverse",void 0),E(this,"glCoordMatrix",void 0),E(this,"labelPlaneMatrix",void 0),E(this,"_fov",void 0),E(this,"_pitch",void 0),E(this,"_zoom",void 0),E(this,"_renderWorldCopies",void 0),E(this,"_minZoom",void 0),E(this,"_maxZoom",void 0),E(this,"_minPitch",void 0),E(this,"_maxPitch",void 0),E(this,"_center",void 0),E(this,"zoomFraction",void 0),E(this,"unmodified",void 0),E(this,"edgeInsets",void 0),E(this,"constraining",void 0),E(this,"posMatrixCache",void 0),E(this,"alignedPosMatrixCache",void 0),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===a||a,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new TD(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new wD,this.posMatrixCache={},this.alignedPosMatrixCache={}}return x(e,[{key:"minZoom",get:function(){return this._minZoom},set:function(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}},{key:"minPitch",get:function(){return this._minPitch},set:function(e){this._minPitch!==e&&(this._minPitch=e,this._pitch=Math.max(this._pitch,e))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(e){this._maxPitch!==e&&(this._maxPitch=e,this._pitch=Math.min(this._pitch,e))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new MD(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(e){var t,n=-dD(e,-180,180)*Math.PI/180;this.angle!==n&&(this.unmodified=!1,this.angle=n,this.calcMatrices(),this.rotationMatrix=(t=new RT(4),RT!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t),function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),u=Math.cos(n);e[0]=r*u+a*s,e[1]=i*u+o*s,e[2]=r*-s+a*u,e[3]=i*-s+o*u}(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(e){var t=vD(e,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==t&&(this.unmodified=!1,this._pitch=t,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this.unmodified=!1,this._fov=e/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(e){var t=Math.min(Math.max(e,this._minZoom),this._maxZoom);this._zoom!==t&&(this.unmodified=!1,this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this.unmodified=!1,this._center=e,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(e){this.edgeInsets.equals(e)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,e,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var t=new e(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t.center=this._center,t.zoom=this.zoom,t.angle=this.angle,t.fov=this._fov,t.pitch=this._pitch,t.unmodified=this.unmodified,t.edgeInsets=this.edgeInsets.clone(),t.calcMatrices(),t}},{key:"isPaddingEqual",value:function(e){return this.edgeInsets.equals(e)}},{key:"interpolatePadding",value:function(e,t,n){this.unmodified=!1,this.edgeInsets.interpolate(e,t,n),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(e){var t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}},{key:"resize",value:function(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(e){return Math.pow(2,e)}},{key:"scaleZoom",value:function(e){return Math.log(e)/Math.LN2}},{key:"project",value:function(e){var t=vD(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new MD(PD(e.lng)*this.worldSize,RD(t)*this.worldSize)}},{key:"unproject",value:function(e){return new ND(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(e,t){var n=this.pointCoordinate(t),r=this.pointCoordinate(this.centerPoint),i=this.locationCoordinate(e),a=new ND(i.x-(n.x-r.x),i.y-(n.y-r.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(e){var t=new Float64Array([e.x,e.y,0,1]),n=new Float64Array([e.x,e.y,1,1]);RA(t,t,this.pixelMatrixInverse),RA(n,n,this.pixelMatrixInverse);var r=t[3],i=n[3],a=t[0]/r,o=n[0]/i,s=t[1]/r,u=n[1]/i,l=t[2]/r,c=n[2]/i,h=l===c?0:(0-l)/(c-l);return new ND(gD(a,o,h)/this.worldSize,gD(s,u,h)/this.worldSize)}},{key:"getBounds",value:function(){return(new AD).extend(this.pointLocation(new MD(0,0))).extend(this.pointLocation(new MD(this.width,0))).extend(this.pointLocation(new MD(this.width,this.height))).extend(this.pointLocation(new MD(0,this.height)))}},{key:"getMaxBounds",value:function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new AD([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}},{key:"setMaxBounds",value:function(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new MD(0,0)),t=new Float32Array([e.x*this.worldSize,e.y*this.worldSize,0,1]);return RA(t,t,this.pixelMatrix)[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var e=this._pitch,t=Math.tan(e)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new MD(0,t))}},{key:"getCameraQueryGeometry",value:function(e){var t=this.getCameraPoint();if(1===e.length)return[e[0],t];var n,r=t.x,i=t.y,a=t.x,o=t.y,s=U(e);try{for(s.s();!(n=s.n()).done;){var u=n.value;r=Math.min(r,u.x),i=Math.min(i,u.y),a=Math.max(a,u.x),o=Math.max(o,u.y)}}catch(e){s.e(e)}finally{s.f()}return[new MD(r,i),new MD(a,i),new MD(a,o),new MD(r,o),new MD(r,i)]}},{key:"coordinatePoint",value:function(e){var t=PA(e.x*this.worldSize,e.y*this.worldSize,0,1);return RA(t,t,this.pixelMatrix),new MD(t[0]/t[3],t[1]/t[3])}},{key:"locationPoint",value:function(e){return this.coordinatePoint(this.locationCoordinate(e))}},{key:"pointLocation",value:function(e){return this.coordinateLocation(this.pointCoordinate(e))}},{key:"locationCoordinate",value:function(e){return ND.fromLngLat(e)}},{key:"coordinateLocation",value:function(e){return e.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(this.center&&this.width&&this.height&&!this.constraining){this.constraining=!0;var e,t,n,r,i=-90,a=90,o=-180,s=180,u=this.size,l=this.unmodified;if(this.latRange){var c=this.latRange;i=RD(c[1])*this.worldSize,e=(a=RD(c[0])*this.worldSize)-i<u.y?u.y/(a-i):0}if(this.lngRange){var h=this.lngRange;o=PD(h[0])*this.worldSize,t=(s=PD(h[1])*this.worldSize)-o<u.x?u.x/(s-o):0}var f=this.point,p=Math.max(t||0,e||0);if(p)return this.center=this.unproject(new MD(t?(s+o)/2:f.x,e?(a+i)/2:f.y)),bd?this.zoom=Math.max(this.zoom,Math.max(-1,this.minZoom)):this.zoom+=this.scaleZoom(p),this.unmodified=l,void(this.constraining=!1);if(this.latRange){var d=f.y,v=u.y/2;d-v<i&&(r=i+v),d+v>a&&(r=a-v)}if(this.lngRange){var g=f.x,m=u.x/2;g-m<o&&(n=o+m),g+m>s&&(n=s-m)}void 0===n&&void 0===r||(this.center=this.unproject(new MD(void 0!==n?n:f.x,void 0!==r?r:f.y))),this.unmodified=l,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(this.height){var e=this._fov/2,t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(e)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+t.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(vD(Math.PI-n-r,.01,Math.PI-.01)),a=this.point,o=a.x,s=a.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),l=this.height/50,c=new Float64Array(16);qT(c,this._fov,this.width/this.height,l,u),c[8]=2*-t.x/this.width,c[9]=2*t.y/this.height,jT(c,c,[1,-1,1]),zT(c,c,[0,0,-this.cameraToCenterDistance]),VT(c,c,this._pitch),HT(c,c,this.angle),zT(c,c,[-o,-s,0]),this.mercatorMatrix=jT([],c,[this.worldSize,this.worldSize,this.worldSize]),jT(c,c,[1,1,LD(1,this.center.lat)*this.worldSize,1]),this.projMatrix=c,this.invProjMatrix=BT([],this.projMatrix);var h=this.width%2/2,f=this.height%2/2,p=Math.cos(this.angle),d=Math.sin(this.angle),v=o-Math.round(o)+p*h+d*f,g=s-Math.round(s)+p*f+d*h,m=new Float64Array(c);if(zT(m,m,[v>.5?v-1:v,g>.5?g-1:g,0]),this.alignedProjMatrix=m,jT(c=IT(),c,[this.width/2,-this.height/2,1]),zT(c,c,[1,-1,0]),this.labelPlaneMatrix=c,jT(c=IT(),c,[1,-1,1]),zT(c,c,[-1,-1,0]),jT(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c,this.pixelMatrix=UT(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(c=BT(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}]),e}(),FD=x((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_(this,e),E(this,"type",void 0),QA(this,n),this.type=t})),BD=function(e){S(n,e);var t=R(n);function n(e){var r;_(this,n),E(O(r=t.call(this)),"transform",void 0),E(O(r),"options",void 0),E(O(r),"moving",void 0),E(O(r),"zooming",void 0),E(O(r),"rotating",void 0),E(O(r),"pitching",void 0),E(O(r),"padding",void 0),E(O(r),"bearingSnap",void 0),E(O(r),"easeEndTimeoutID",void 0),E(O(r),"easeStart",void 0),E(O(r),"easeOptions",void 0),E(O(r),"easeId",void 0),E(O(r),"onEaseFrame",void 0),E(O(r),"onEaseEnd",void 0),E(O(r),"easeFrameId",void 0),E(O(r),"pitchEnabled",void 0),E(O(r),"rotateEnabled",void 0),E(O(r),"renderFrameCallback",(function(){var e=Math.min((xD()-r.easeStart)/r.easeOptions.duration,1);r.onEaseFrame(r.easeOptions.easing(e)),e<1?r.easeFrameId=r.requestRenderFrame(r.renderFrameCallback):r.stop()})),r.options=e;var i=e.minZoom,a=e.maxZoom,o=e.minPitch,s=e.maxPitch,u=e.renderWorldCopies;return r.moving=!1,r.zooming=!1,r.bearingSnap=e.bearingSnap,r.pitchEnabled=e.pitchEnabled,r.rotateEnabled=e.rotateEnabled,r.transform=new DD(i,a,o,s,u),r}return x(n,[{key:"requestRenderFrame",value:function(e){return 0}},{key:"cancelRenderFrame",value:function(e){}},{key:"getCenter",value:function(){var e=this.transform.center,t=e.lng,n=e.lat;return new TD(t,n)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(e,t){return this.jumpTo({center:e},t)}},{key:"setPitch",value:function(e,t){return this.jumpTo({pitch:e},t),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(e,t,n){return this.easeTo(QA({center:e},t),n)}},{key:"zoomOut",value:function(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}},{key:"setBearing",value:function(e,t){return this.jumpTo({bearing:e},t),this}},{key:"setZoom",value:function(e,t){return this.jumpTo({zoom:e},t),this}},{key:"zoomIn",value:function(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}},{key:"zoomTo",value:function(e,t,n){return this.easeTo(QA({zoom:e},t),n)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(e,t){return this.jumpTo({padding:e},t),this}},{key:"rotateTo",value:function(e,t,n){return this.easeTo(QA({bearing:e},t),n)}},{key:"resetNorth",value:function(e,t){return this.rotateTo(0,QA({duration:1e3},e),t),this}},{key:"resetNorthPitch",value:function(e,t){return this.easeTo(QA({bearing:0,pitch:0,duration:1e3},e),t),this}},{key:"fitBounds",value:function(e,t,n){return this.fitInternal(this.cameraForBounds(e,t),t,n)}},{key:"cameraForBounds",value:function(e,t){return e=AD.convert(e),this.cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),0,t)}},{key:"snapToNorth",value:function(e,t){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(e,t):this}},{key:"jumpTo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;this.stop();var n=this.transform,r=!1,i=!1,a=!1;return e.zoom&&n.zoom!==+e.zoom&&(r=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=TD.convert(e.center)),e.bearing&&n.bearing!==+e.bearing&&(i=!0,n.bearing=+e.bearing),e.pitch&&n.pitch!==+e.pitch&&(a=!0,n.pitch=+e.pitch),null==e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),this.emit("movestart",new FD("movestart",t)),this.emit("move",new FD("move",t)),r&&(this.emit("zoomstart",new FD("zoomstart",t)),this.emit("zoom",new FD("zoom",t)),this.emit("zoomend",new FD("zoomend",t))),i&&(this.emit("rotatestart",new FD("rotatestart",t)),this.emit("rotate",new FD("rotate",t)),this.emit("rotateend",new FD("rotateend",t))),a&&(this.emit("pitchstart",new FD("pitchstart",t)),this.emit("pitch",new FD("pitch",t)),this.emit("pitchend",new FD("pitchend",t))),this.emit("moveend",new FD("moveend",t))}},{key:"easeTo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;(!1===(t=QA({offset:[0,0],duration:500,easing:yD},t)).animate||!t.essential&&_D())&&(t.duration=0);var r=this.transform,i=this.getZoom(),a=this.getBearing(),o=this.getPitch(),s=this.getPadding(),u=t.zoom?+t.zoom:i,l=t.bearing?this.normalizeBearing(t.bearing,a):a,c=t.pitch?+t.pitch:o,h=t.padding?t.padding:r.padding,f=MD.convert(t.offset),p=r.centerPoint.add(f),d=r.pointLocation(p),v=TD.convert(t.center||d);this.normalizeCenter(v);var g,m,y=r.project(d),_=r.project(v).sub(y),b=r.zoomScale(u-i);t.around&&(g=TD.convert(t.around),m=r.locationPoint(g));var x={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||u!==i,this.rotating=this.rotating||a!==l,this.pitching=this.pitching||c!==o,this.padding=!r.isPaddingEqual(h),this.easeId=t.easeId,this.prepareEase(n,t.noMoveStart,x),clearTimeout(this.easeEndTimeoutID),this.ease((function(t){if(e.zooming&&(r.zoom=gD(i,u,t)),e.rotating&&e.rotateEnabled&&(r.bearing=gD(a,l,t)),e.pitching&&e.pitchEnabled&&(r.pitch=gD(o,c,t)),e.padding&&(r.interpolatePadding(s,h,t),p=r.centerPoint.add(f)),g)r.setLocationAtPoint(g,m);else{var d=r.zoomScale(r.zoom-i),v=u>i?Math.min(2,b):Math.max(.5,b),x=Math.pow(v,1-t),E=r.unproject(y.add(_.mult(t*x)).mult(d));r.setLocationAtPoint(r.renderWorldCopies?E.wrap():E,p)}e.fireMoveEvents(n)}),(function(t){e.afterEase(n,t)}),t),this}},{key:"flyTo",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(!t.essential&&_D()){var r=bD(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,n)}this.stop(),t=QA({offset:[0,0],speed:1.2,curve:1.42,easing:yD},t);var i=this.transform,a=this.getZoom(),o=this.getBearing(),s=this.getPitch(),u=this.getPadding(),l=t.zoom?vD(+t.zoom,i.minZoom,i.maxZoom):a,c=t.bearing?this.normalizeBearing(t.bearing,o):o,h=t.pitch?+t.pitch:s,f="padding"in t?t.padding:i.padding,p=i.zoomScale(l-a),d=MD.convert(t.offset),v=i.centerPoint.add(d),g=i.pointLocation(v),m=TD.convert(t.center||g);this.normalizeCenter(m);var y=i.project(g),_=i.project(m).sub(y),b=t.curve,x=Math.max(i.width,i.height),E=x/p,S=_.mag();if("minZoom"in t){var C=vD(Math.min(t.minZoom,a,l),i.minZoom,i.maxZoom),T=x/i.zoomScale(C-a);b=Math.sqrt(T/S*2)}var A=b*b;function M(e){var t=(E*E-x*x+(e?-1:1)*A*A*S*S)/(2*(e?E:x)*A*S);return Math.log(Math.sqrt(t*t+1)-t)}function w(e){return(Math.exp(e)-Math.exp(-e))/2}function k(e){return(Math.exp(e)+Math.exp(-e))/2}function O(e){return w(e)/k(e)}var P=M(0),R=function(e){return k(P)/k(P+b*e)},L=function(e){return x*((k(P)*O(P+b*e)-w(P))/A)/S},I=(M(1)-P)/b;if(Math.abs(S)<1e-6||!isFinite(I)){if(Math.abs(x-E)<1e-6)return this.easeTo(t,n);var N=E<x?-1:1;I=Math.abs(Math.log(E/x))/b,L=function(){return 0},R=function(e){return Math.exp(N*b*e)}}if("duration"in t)t.duration=+t.duration;else{var D="screenSpeed"in t?+t.screenSpeed/b:+t.speed;t.duration=1e3*I/D}return t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this.zooming=!0,this.rotating=o!==c,this.pitching=h!==s,this.padding=!i.isPaddingEqual(f),this.prepareEase(n,!1),this.ease((function(t){var r=t*I,p=1/R(r);i.zoom=1===t?l:a+i.scaleZoom(p),e.rotating&&(i.bearing=gD(o,c,t)),e.pitching&&(i.pitch=gD(s,h,t)),e.padding&&(i.interpolatePadding(u,f,t),v=i.centerPoint.add(d));var g=1===t?m:i.unproject(y.add(_.mult(L(r))).mult(p));i.setLocationAtPoint(i.renderWorldCopies?g.wrap():g,v),e.fireMoveEvents(n)}),(function(){return e.afterEase(n)}),t),this}},{key:"fitScreenCoordinates",value:function(e,t,n,r,i){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation(MD.convert(e)),this.transform.pointLocation(MD.convert(t)),n,r),r,i)}},{key:"stop",value:function(e,t){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var n=this.onEaseEnd;delete this.onEaseEnd,n.call(this,t)}return this}},{key:"normalizeBearing",value:function(e,t){e=dD(e,-180,180);var n=Math.abs(e-t);return Math.abs(e-360-t)<n&&(e-=360),Math.abs(e+360-t)<n&&(e+=360),e}},{key:"normalizeCenter",value:function(e){var t=this.transform;if(t.renderWorldCopies&&!t.lngRange){var n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}}},{key:"fireMoveEvents",value:function(e){this.emit("move",new FD("move",e)),this.zooming&&this.emit("zoom",new FD("zoom",e)),this.rotating&&this.emit("rotate",new FD("rotate",e)),this.pitching&&this.emit("rotate",new FD("pitch",e))}},{key:"prepareEase",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.moving=!0,t||n.moving||this.emit("movestart",new FD("movestart",e)),this.zooming&&!n.zooming&&this.emit("zoomstart",new FD("zoomstart",e)),this.rotating&&!n.rotating&&this.emit("rotatestart",new FD("rotatestart",e)),this.pitching&&!n.pitching&&this.emit("pitchstart",new FD("pitchstart",e))}},{key:"afterEase",value:function(e,t){if(!this.easeId||!t||this.easeId!==t){delete this.easeId;var n=this.zooming,r=this.rotating,i=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,n&&this.emit("zoomend",new FD("zoomend",e)),r&&this.emit("rotateend",new FD("rotateend",e)),i&&this.emit("pitchend",new FD("pitchend",e)),this.emit("moveend",new FD("moveend",e))}}},{key:"ease",value:function(e,t,n){!1===n.animate||0===n.duration?(e(1),t()):(this.easeStart=xD(),this.easeOptions=n,this.onEaseFrame=e,this.onEaseEnd=t,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(e,t,n,r){var i={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=QA({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var a=r.padding;r.padding={top:a,bottom:a,right:a,left:a}}r.padding=QA(i,r.padding);var o=this.transform,s=o.padding,u=o.project(TD.convert(e)),l=o.project(TD.convert(t)),c=u.rotate(-n*Math.PI/180),h=l.rotate(-n*Math.PI/180),f=new MD(Math.max(c.x,h.x),Math.max(c.y,h.y)),p=new MD(Math.min(c.x,h.x),Math.min(c.y,h.y)),d=f.sub(p),v=(o.width-(s.left+s.right+r.padding.left+r.padding.right))/d.x,g=(o.height-(s.top+s.bottom+r.padding.top+r.padding.bottom))/d.y;if(!(g<0||v<0)){var m=Math.min(o.scaleZoom(o.scale*Math.min(v,g)),r.maxZoom),y=MD.convert(r.offset),_=(r.padding.left-r.padding.right)/2,b=(r.padding.top-r.padding.bottom)/2,x=new MD(y.x+_,y.y+b).mult(o.scale/o.zoomScale(m));return{center:o.unproject(u.add(l).div(2).sub(x)),zoom:m,bearing:n}}}},{key:"fitInternal",value:function(e,t,n){return e?(delete(t=QA(e,t)).padding,t.linear?this.easeTo(t,n):this.flyTo(t,n)):this}}]),n}(jb);hR(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: -moz-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: -moz-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var UD={create:function(e,t,n){var r=Ed.document.createElement(e);return void 0!==t&&(r.className=t),n&&n.appendChild(r),r},createNS:function(e,t){return Ed.document.createElementNS(e,t)}},zD=Ed.document&&Ed.document.documentElement.style;function jD(e){if(!zD)return e[0];var t,n=U(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r in zD)return r}}catch(e){n.e(e)}finally{n.f()}return e[0]}var VD,GD=jD(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);UD.disableDrag=function(){zD&&GD&&(VD=zD[GD],zD[GD]="none")},UD.enableDrag=function(){zD&&GD&&(zD[GD]=VD)};var HD=jD(["transform","WebkitTransform"]);UD.setTransform=function(e,t){e.style[HD]=t};var WD=!1;try{var XD=Object.defineProperty({},"passive",{get:function(){WD=!0}});Ed.addEventListener("test",XD,XD),Ed.removeEventListener("test",XD,XD)}catch(e){WD=!1}UD.addEventListener=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&WD?e.addEventListener(t,n,r):e.addEventListener(t,n,r.capture)},UD.removeEventListener=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&WD?e.removeEventListener(t,n,r):e.removeEventListener(t,n,r.capture)};var YD=function e(t){t.preventDefault(),t.stopPropagation(),Ed.removeEventListener("click",e,!0)};UD.suppressClick=function(){bd||(Ed.addEventListener("click",YD,!0),setTimeout((function(){Ed.removeEventListener("click",YD,!0)}),0))},UD.mousePos=function(e,t){if(bd)return new MD(t.clientX-e.left-0,t.clientY-e.top-0);var n=e.getBoundingClientRect();return new MD(t.clientX-n.left-e.clientLeft,t.clientY-n.top-e.clientTop)},UD.touchPos=function(e,t){if(bd){var n,r=[],i=U(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;r.push(new MD(a.clientX-e.left,a.clientY-e.top))}}catch(e){i.e(e)}finally{i.f()}return r}var o,s=e.getBoundingClientRect(),u=[],l=U(t);try{for(l.s();!(o=l.n()).done;){var c=o.value;u.push(new MD(c.clientX-s.left-e.clientLeft,c.clientY-s.top-e.clientTop))}}catch(e){l.e(e)}finally{l.f()}return u},UD.mouseButton=function(e){return bd&&void 0!==Ed.InstallTrigger&&2===e.button&&e.ctrlKey&&Ed.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},UD.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};var ZD=function(e){S(n,e);var t=R(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};_(this,n);var s=UD.mousePos(r.getCanvasContainer(),i),u=r.unproject(s);return E(O(a=t.call(this,e,QA({point:s,lngLat:u,originalEvent:i},o))),"type",void 0),E(O(a),"target",void 0),E(O(a),"originalEvent",void 0),E(O(a),"point",void 0),E(O(a),"lngLat",void 0),E(O(a),"defaultPrevented",void 0),a.defaultPrevented=!1,a.target=r,a}return x(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(FD),qD=function(e){S(n,e);var t=R(n);function n(e,r,i){var a;_(this,n);var o="touchend"===e?i.changedTouches:i.touches,s=UD.touchPos(r.getCanvasContainer(),o),u=s.map((function(e){return r.unproject(e)})),l=s.reduce((function(e,t,n,r){return e.add(t.div(r.length))}),new MD(0,0)),c=r.unproject(l);return E(O(a=t.call(this,e,{points:s,point:l,lngLats:u,lngLat:c,originalEvent:i})),"type",void 0),E(O(a),"target",void 0),E(O(a),"originalEvent",void 0),E(O(a),"lngLat",void 0),E(O(a),"point",void 0),E(O(a),"points",void 0),E(O(a),"lngLats",void 0),E(O(a),"defaultPrevented",void 0),a.defaultPrevented=!1,a}return x(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(FD),KD=function(e){S(n,e);var t=R(n);function n(e,r,i){var a;return _(this,n),E(O(a=t.call(this,e,{originalEvent:i})),"type",void 0),E(O(a),"originalEvent",void 0),E(O(a),"defaultPrevented",void 0),E(O(a),"target",void 0),a.defaultPrevented=!1,a}return x(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(FD),QD=function(){function e(t){_(this,e),E(this,"map",void 0),E(this,"delayContextMenu",void 0),E(this,"contextMenuEvent",void 0),this.map=t}return x(e,[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(e){this.map.emit(e.type,new ZD(e.type,this.map,e))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new ZD("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(e){this.delayContextMenu?this.contextMenuEvent=e:this.map.emit(e.type,new ZD(e.type,this.map,e)),this.map.listeners("contextmenu")&&e.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}]),e}(),JD=function(){function e(t,n){_(this,e),E(this,"map",void 0),E(this,"el",void 0),E(this,"container",void 0),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"startPos",void 0),E(this,"lastPos",void 0),E(this,"box",void 0),E(this,"clickTolerance",void 0),this.map=t,this.el=t.getCanvasContainer(),this.container=t.getContainer(),this.clickTolerance=n.clickTolerance||1}return x(e,[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"mousedown",value:function(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(UD.disableDrag(),this.startPos=this.lastPos=t,this.active=!0)}},{key:"mousemoveWindow",value:function(e,t){if(this.active){var n=t;if(!(this.lastPos.equals(n)||!this.box&&n.dist(this.startPos)<this.clickTolerance)){var r=this.startPos;this.lastPos=n,this.box||(this.box=UD.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",e));var i=Math.min(r.x,n.x),a=Math.max(r.x,n.x),o=Math.min(r.y,n.y),s=Math.max(r.y,n.y);UD.setTransform(this.box,"translate(".concat(i,"px,").concat(o,"px)")),this.box&&(this.box.style.width="".concat(a-i,"px"),this.box.style.height="".concat(s-o,"px"))}}}},{key:"mouseupWindow",value:function(e,t){var n=this;if(this.active&&0===e.button){var r=this.startPos,i=t;if(this.reset(),UD.suppressClick(),r.x!==i.x||r.y!==i.y)return this.map.emit("boxzoomend",new FD("boxzoomend",{originalEvent:e})),{cameraAnimation:function(e){return e.fitScreenCoordinates(r,i,n.map.getBearing(),{linear:!0})}};this.fireEvent("boxzoomcancel",e)}}},{key:"keydown",value:function(e){this.active&&27===e.keyCode&&(this.reset(),this.fireEvent("boxzoomcancel",e))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(UD.remove(this.box),this.box=null),UD.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(e,t){return this.map.emit(e,new FD(e,{originalEvent:t}))}}]),e}(),$D=function(){function e(){_(this,e),E(this,"enabled",void 0),E(this,"active",void 0),this.reset()}return x(e,[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(e,t){return e.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),eF=function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"type","renderFrame"),E(O(e),"timeStamp",void 0),e}return x(n)}(FD),tF={linearity:.3,easing:mD(0,0,.3,1)},nF=QA({deceleration:2500,maxSpeed:1400},tF),rF=QA({deceleration:20,maxSpeed:1400},tF),iF=QA({deceleration:1e3,maxSpeed:360},tF),aF=QA({deceleration:1e3,maxSpeed:90},tF),oF=function(){function e(t){_(this,e),E(this,"map",void 0),E(this,"inertiaBuffer",void 0),this.map=t,this.clear()}return x(e,[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(e){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:xD(),settings:e})}},{key:"drainInertiaBuffer",value:function(){for(var e=this.inertiaBuffer,t=xD();e.length>0&&t-e[0].time>160;)e.shift()}},{key:"onMoveEnd",value:function(e){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var t,n={zoom:0,bearing:0,pitch:0,pan:new MD(0,0),pinchAround:void 0,around:void 0},r=U(this.inertiaBuffer);try{for(r.s();!(t=r.n()).done;){var i=t.value.settings;n.zoom+=i.zoomDelta||0,n.bearing+=i.bearingDelta||0,n.pitch+=i.pitchDelta||0,i.panDelta&&n.pan._add(i.panDelta),i.around&&(n.around=i.around),i.pinchAround&&(n.pinchAround=i.pinchAround)}}catch(e){r.e(e)}finally{r.f()}var a=this.inertiaBuffer[this.inertiaBuffer.length-1].time-this.inertiaBuffer[0].time,o={};if(n.pan.mag()){var s=uF(n.pan.mag(),a,QA({},nF,e||{}));o.offset=n.pan.mult(s.amount/n.pan.mag()),o.center=this.map.transform.center,sF(o,s)}if(n.zoom){var u=uF(n.zoom,a,rF);o.zoom=this.map.transform.zoom+u.amount,sF(o,u)}if(n.bearing){var l=uF(n.bearing,a,iF);o.bearing=this.map.transform.bearing+vD(l.amount,-179,179),sF(o,l)}if(n.pitch){var c=uF(n.pitch,a,aF);o.pitch=this.map.transform.pitch+c.amount,sF(o,c)}if(o.zoom||o.bearing){var h=void 0===n.pinchAround?n.around:n.pinchAround;o.around=h?this.map.unproject(h):this.map.getCenter()}return this.clear(),QA(o,{noMoveStart:!0})}}}]),e}();function sF(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function uF(e,t,n){var r=n.maxSpeed,i=n.linearity,a=n.deceleration,o=vD(e*i/(t/1e3),-r,r),s=Math.abs(o)/(a*i);return{easing:n.easing,duration:1e3*s,amount:o*(s/2)}}var lF={panStep:100,bearingStep:15,pitchStep:10},cF=function(){function e(){_(this,e),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"panStep",void 0),E(this,"bearingStep",void 0),E(this,"pitchStep",void 0);var t=lF;this.panStep=t.panStep,this.bearingStep=t.bearingStep,this.pitchStep=t.pitchStep}return x(e,[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(e){var t=this;if(!(e.altKey||e.ctrlKey||e.metaKey)){var n=0,r=0,i=0,a=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),a=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),a=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),o=1);break;default:return}return{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:hF,zoom:n?Math.round(u)+n*(e.shiftKey?2:1):u,bearing:s.getBearing()+r*t.bearingStep,pitch:s.getPitch()+i*t.pitchStep,offset:[-a*t.panStep,-o*t.panStep],center:s.getCenter()},{originalEvent:e})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function hF(e){return e*(2-e)}var fF,pF=function(){function e(t,n){_(this,e),E(this,"mousedownPos",void 0),E(this,"clickTolerance",void 0),E(this,"map",void 0),this.map=t,this.clickTolerance=n.clickTolerance}return x(e,[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(e){return this.firePreventable(new KD(e.type,this.map,e))}},{key:"mousedown",value:function(e,t){return this.mousedownPos=t,this.firePreventable(new ZD(e.type,this.map,e))}},{key:"mouseup",value:function(e){this.map.emit(e.type,new ZD(e.type,this.map,e))}},{key:"click",value:function(e,t){this.mousedownPos&&this.mousedownPos.dist(t)>=this.clickTolerance||this.map.emit(e.type,new ZD(e.type,this.map,e))}},{key:"dblclick",value:function(e){return this.firePreventable(new ZD(e.type,this.map,e))}},{key:"mouseover",value:function(e){this.map.emit(e.type,new ZD(e.type,this.map,e))}},{key:"mouseout",value:function(e){this.map.emit(e.type,new ZD(e.type,this.map,e))}},{key:"touchstart",value:function(e){return this.firePreventable(new qD(e.type,this.map,e))}},{key:"touchmove",value:function(e){this.map.emit(e.type,new qD(e.type,this.map,e))}},{key:"touchend",value:function(e){this.map.emit(e.type,new qD(e.type,this.map,e))}},{key:"touchcancel",value:function(e){this.map.emit(e.type,new qD(e.type,this.map,e))}},{key:"firePreventable",value:function(e){if(this.map.emit(e.type,e),e.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}]),e}(),dF=(E(fF={},0,1),E(fF,2,2),fF);var vF=function(){function e(t){_(this,e),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"lastPoint",void 0),E(this,"eventButton",void 0),E(this,"moved",void 0),E(this,"clickTolerance",void 0),this.reset(),this.clickTolerance=t.clickTolerance||1}return x(e,[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(e,t){if(!this.lastPoint){var n=UD.mouseButton(e);this.correctButton(e,n)&&(this.lastPoint=t,this.eventButton=n)}}},{key:"mousemoveWindow",value:function(e,t){var n=this.lastPoint;if(n)if(e.preventDefault(),function(e,t){var n=dF[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this.eventButton))this.reset();else if(this.moved||!(t.dist(n)<this.clickTolerance))return this.moved=!0,this.lastPoint=t,this.move(n,t)}},{key:"mouseupWindow",value:function(e){this.lastPoint&&(UD.mouseButton(e)===this.eventButton&&(this.moved&&UD.suppressClick(),this.reset()))}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(e,t){return!1}},{key:"move",value:function(e,t){}}]),e}(),gF=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.apply(this,arguments)}return x(n,[{key:"mousedown",value:function(e,t){I(C(n.prototype),"mousedown",this).call(this,e,t),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(e,t){return{around:t,panDelta:t.sub(e)}}},{key:"correctButton",value:function(e,t){return 0===t&&!e.ctrlKey}}]),n}(vF),mF=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.apply(this,arguments)}return x(n,[{key:"correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"move",value:function(e,t){var n=-.5*(t.y-e.y);if(n)return this.active=!0,{pitchDelta:n}}},{key:"contextmenu",value:function(e){e.preventDefault()}}]),n}(vF),yF=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.apply(this,arguments)}return x(n,[{key:"contextmenu",value:function(e){e.preventDefault()}},{key:"correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"move",value:function(e,t){var n=.8*(t.x-e.x);if(n)return this.active=!0,{bearingDelta:n}}}]),n}(vF),_F=function(){function e(t,n){var r=this;_(this,e),E(this,"map",void 0),E(this,"el",void 0),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"zooming",void 0),E(this,"aroundCenter",void 0),E(this,"around",void 0),E(this,"aroundPoint",void 0),E(this,"type",void 0),E(this,"lastValue",void 0),E(this,"timeout",void 0),E(this,"finishTimeout",void 0),E(this,"lastWheelEvent",void 0),E(this,"lastWheelEventTime",void 0),E(this,"startZoom",void 0),E(this,"targetZoom",void 0),E(this,"delta",void 0),E(this,"easing",void 0),E(this,"prevEase",void 0),E(this,"frameId",void 0),E(this,"handler",void 0),E(this,"defaultZoomRate",void 0),E(this,"wheelZoomRate",void 0),E(this,"onScrollFrame",(function(){if(r.frameId&&(r.frameId=null,r.isActive())){var e=r.map.transform;if(0!==r.delta){var t="wheel"===r.type&&Math.abs(r.delta)>4.000244140625?r.wheelZoomRate:r.defaultZoomRate,n=2/(1+Math.exp(-Math.abs(r.delta*t)));r.delta<0&&0!==n&&(n=1/n);var i="number"==typeof r.targetZoom?e.zoomScale(r.targetZoom):e.scale;r.targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(i*n))),"wheel"===r.type&&(r.startZoom=e.zoom,r.easing=r.smoothOutEasing(200)),r.delta=0}var a,o="number"==typeof r.targetZoom?r.targetZoom:e.zoom,s=r.startZoom,u=r.easing,l=!1;if("wheel"===r.type&&s&&u){var c=Math.min((xD()-r.lastWheelEventTime)/200,1);a=gD(s,o,u(c)),c<1?r.frameId||(r.frameId=!0):l=!0}else a=o,l=!0;return r.active=!0,l&&(r.active=!1,r.finishTimeout=setTimeout((function(){r.zooming=!1,r.handler.triggerRenderFrame(),delete r.targetZoom,delete r.finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!l,zoomDelta:a-e.zoom,around:r.aroundPoint,originalEvent:r.lastWheelEvent}}})),this.map=t,this.el=t.getCanvasContainer(),this.handler=n,this.delta=0,this.defaultZoomRate=.01,this.wheelZoomRate=1/450}return x(e,[{key:"setZoomRate",value:function(e){this.defaultZoomRate=e}},{key:"setWheelZoomRate",value:function(e){this.wheelZoomRate=e}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||void 0!==this.finishTimeout}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(e){this.isEnabled()||(this.enabled=!0,this.aroundCenter=e&&"center"===e.around)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"wheel",value:function(e){if(this.isEnabled()){var t=e.deltaMode===window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,n=xD(),r=n-(this.lastWheelEventTime||0);this.lastWheelEventTime=n,0!==t&&t%4.000244140625==0?this.type="wheel":0!==t&&Math.abs(t)<4?this.type="trackpad":r>400?(this.type=null,this.lastValue=t,this.timeout=setTimeout(this.onTimeout,40,e)):this.type||(this.type=Math.abs(r*t)<200?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,t+=this.lastValue)),e.shiftKey&&t&&(t/=4),this.type&&(this.lastWheelEvent=e,this.delta-=t,this.active||this.start(e)),e.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(e){this.type="wheel",this.delta-=this.lastValue,!this.active&&this.start&&this.start(e)}},{key:"start",value:function(e){if(this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var t=UD.mousePos(this.el,e);this.around=TD.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(t)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(e){var t=yD;if(this.prevEase){var n=this.prevEase,r=(xD()-n.start)/n.duration,i=n.easing(r+.01)-n.easing(r),a=.27/Math.sqrt(i*i+1e-4)*.01;t=mD(a,Math.sqrt(.0729-a*a),.25,1)}return this.prevEase={start:xD(),duration:e,easing:t},t}}]),e}(),bF=function(){function e(t,n){_(this,e),E(this,"clickZoom",void 0),E(this,"tapZoom",void 0),this.clickZoom=t,this.tapZoom=n}return x(e,[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}]),e}(),xF=function(){function e(t,n,r){_(this,e),E(this,"inertiaOptions",void 0),E(this,"el",void 0),E(this,"mousePan",void 0),E(this,"touchPan",void 0),this.el=t,this.mousePan=n,this.touchPan=r}return x(e,[{key:"enable",value:function(e){this.inertiaOptions=e||{},this.mousePan.enable(),this.touchPan.enable(),bd||this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),bd||this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}]),e}(),EF=function(){function e(t,n,r){_(this,e),E(this,"mouseRotate",void 0),E(this,"mousePitch",void 0),E(this,"pitchWithRotate",void 0),this.pitchWithRotate=t.pitchWithRotate,this.mouseRotate=n,this.mousePitch=r}return x(e,[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}]),e}(),SF=function(){function e(t,n,r,i){_(this,e),E(this,"el",void 0),E(this,"touchZoom",void 0),E(this,"touchRotate",void 0),E(this,"tapDragZoom",void 0),E(this,"rotationDisabled",void 0),E(this,"enabled",void 0),this.el=t,this.touchZoom=n,this.touchRotate=r,this.tapDragZoom=i,this.rotationDisabled=!1,this.enabled=!0}return x(e,[{key:"enable",value:function(e){this.touchZoom.enable(e),this.rotationDisabled||this.touchRotate.enable(e),this.tapDragZoom.enable(),bd||this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),bd||this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}]),e}();function CF(e,t){for(var n={},r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}var TF=function(){function e(t){_(this,e),E(this,"numTouches",void 0),E(this,"centroid",void 0),E(this,"startTime",void 0),E(this,"aborted",void 0),E(this,"touches",void 0),this.reset(),this.numTouches=t.numTouches}return x(e,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(e,t,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){var t,n=new MD(0,0),r=U(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n._add(i)}}catch(e){r.e(e)}finally{r.f()}return n.div(e.length)}(t),this.touches=CF(n,t)))}},{key:"touchmove",value:function(e,t,n){if(!this.aborted&&this.centroid){var r=CF(n,t);for(var i in this.touches)if(this.touches[i]){var a=this.touches[i],o=r[i];(!o||o.dist(a)>30)&&(this.aborted=!0)}}}},{key:"touchend",value:function(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}}}]),e}(),AF=function(){function e(t){_(this,e),E(this,"singleTap",void 0),E(this,"numTaps",void 0),E(this,"lastTime",void 0),E(this,"lastTap",void 0),E(this,"count",void 0),this.singleTap=new TF(t),this.numTaps=t.numTaps,this.reset()}return x(e,[{key:"reset",value:function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(e,t,n){this.singleTap.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.singleTap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this.singleTap.touchend(e,t,n);if(r){var i=e.timeStamp-this.lastTime<500,a=!this.lastTap||this.lastTap.dist(r)<30;if(i&&a||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}]),e}(),MF=function(){function e(){_(this,e),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"swipePoint",void 0),E(this,"swipeTouch",void 0),E(this,"tapTime",void 0),E(this,"tap",void 0),this.tap=new AF({numTouches:1,numTaps:1}),this.reset()}return x(e,[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(e,t,n){this.swipePoint||(this.tapTime&&e.timeStamp-this.tapTime>500&&this.reset(),this.tapTime?n.length>0&&(this.swipePoint=t[0],this.swipeTouch=n[0].identifier):this.tap.touchstart(e,t,n))}},{key:"touchmove",value:function(e,t,n){if(this.tapTime){if(this.swipePoint){if(n[0].identifier!==this.swipeTouch)return;var r=t[0],i=r.y-this.swipePoint.y;return this.swipePoint=r,e.preventDefault(),this.active=!0,{zoomDelta:i/128}}}else this.tap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){this.tapTime?this.swipePoint&&0===n.length&&this.reset():this.tap.touchend(e,t,n)&&(this.tapTime=e.timeStamp)}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),wF=function(){function e(){_(this,e),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"zoomIn",void 0),E(this,"zoomOut",void 0),this.zoomIn=new AF({numTouches:1,numTaps:2}),this.zoomOut=new AF({numTouches:2,numTaps:1}),this.reset()}return x(e,[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(e,t,n){this.zoomIn.touchstart(e,t,n),this.zoomOut.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.zoomIn.touchmove(e,t,n),this.zoomOut.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this,i=this.zoomIn.touchend(e,t,n),a=this.zoomOut.touchend(e,t,n);return i?(this.active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}}):a?(this.active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(a)},{originalEvent:e})}}):void 0}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),kF=function(){function e(t){_(this,e),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"touches",void 0),E(this,"minTouches",void 0),E(this,"clickTolerance",void 0),E(this,"sum",void 0),this.minTouches=1,this.clickTolerance=t.clickTolerance||1,this.reset()}return x(e,[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new MD(0,0)}},{key:"touchstart",value:function(e,t,n){return this.calculateTransform(e,t,n)}},{key:"touchmove",value:function(e,t,n){if(this.active)return e.preventDefault(),this.calculateTransform(e,t,n)}},{key:"touchend",value:function(e,t,n){this.calculateTransform(e,t,n),this.active&&n.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(e,t,n){n.length>0&&(this.active=!0);var r=CF(n,t),i=new MD(0,0),a=new MD(0,0),o=0;for(var s in r)if(r[s]){var u=r[s],l=this.touches[s];l&&(i._add(u),a._add(u.sub(l)),o++,r[s]=u)}if(this.touches=r,!(o<this.minTouches)&&a.mag()){var c=a.div(o);if(this.sum._add(c),!(this.sum.mag()<this.clickTolerance))return{around:i.div(o),panDelta:c}}}}]),e}(),OF=function(){function e(){_(this,e),E(this,"enabled",void 0),E(this,"active",void 0),E(this,"firstTwoTouches",void 0),E(this,"vector",void 0),E(this,"startVector",void 0),E(this,"aroundCenter",void 0),this.reset()}return x(e,[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(e){}},{key:"move",value:function(e,t,n){}},{key:"touchstart",value:function(e,t,n){this.firstTwoTouches||n.length<2||(this.firstTwoTouches=[n[0].identifier,n[1].identifier],this.start([t[0],t[1]]))}},{key:"touchmove",value:function(e,t,n){if(this.firstTwoTouches){e.preventDefault();var r=N(this.firstTwoTouches,2),i=r[0],a=r[1],o=PF(n,t,i),s=PF(n,t,a);if(o&&s){var u=this.aroundCenter?null:o.add(s).div(2);return this.move([o,s],u,e)}}}},{key:"touchend",value:function(e,t,n){if(this.firstTwoTouches){var r=N(this.firstTwoTouches,2),i=r[0],a=r[1],o=PF(n,t,i),s=PF(n,t,a);o&&s||(this.active&&UD.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(e){this.enabled=!0,this.aroundCenter=!!e&&"center"===e.around}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function PF(e,t,n){for(var r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function RF(e){return Math.abs(e.y)>Math.abs(e.x)}var LF=function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"valid",void 0),E(O(e),"firstMove",void 0),E(O(e),"lastPoints",void 0),e}return x(n,[{key:"reset",value:function(){I(C(n.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(e){this.lastPoints=e,RF(e[0].sub(e[1]))&&(this.valid=!1)}},{key:"move",value:function(e,t,n){var r=e[0].sub(this.lastPoints[0]),i=e[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(r,i,n.timeStamp),this.valid){this.lastPoints=e,this.active=!0;return{pitchDelta:-.5*((r.y+i.y)/2)}}}},{key:"gestureBeginsVertically",value:function(e,t,n){if(void 0!==this.valid)return this.valid;var r=e.mag()>=2,i=t.mag()>=2;if(r||i){if(!r||!i)return void 0===this.firstMove&&(this.firstMove=n),n-this.firstMove<100&&void 0;var a=e.y>0==t.y>0;return RF(e)&&RF(t)&&a}}}]),n}(OF);function IF(e,t){return 180*e.angleWith(t)/Math.PI}var NF=function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"minDiameter",void 0),e}return x(n,[{key:"reset",value:function(){I(C(n.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(e){this.startVector=this.vector=e[0].sub(e[1]),this.minDiameter=e[0].dist(e[1])}},{key:"move",value:function(e,t){var n=this.vector;if(this.vector=e[0].sub(e[1]),this.active||!this.isBelowThreshold(this.vector))return this.active=!0,{bearingDelta:IF(this.vector,n),pinchAround:t}}},{key:"isBelowThreshold",value:function(e){this.minDiameter=Math.min(this.minDiameter,e.mag());var t=25/(Math.PI*this.minDiameter)*360,n=IF(e,this.startVector);return Math.abs(n)<t}}]),n}(OF);function DF(e,t){return Math.log(e/t)/Math.LN2}var FF=function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"distance",void 0),E(O(e),"startDistance",void 0),e}return x(n,[{key:"reset",value:function(){I(C(n.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(e){this.startDistance=this.distance=e[0].dist(e[1])}},{key:"move",value:function(e,t){var n=this.distance;if(this.distance=e[0].dist(e[1]),this.active||!(Math.abs(DF(this.distance,this.startDistance))<.1))return this.active=!0,{zoomDelta:DF(this.distance,n),pinchAround:t}}}]),n}(OF),BF=function(e){return e.zoom||e.drag||e.pitch||e.rotate};function UF(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var zF=function(){function e(t,n){var r=this;_(this,e),E(this,"map",void 0),E(this,"el",void 0),E(this,"handlers",void 0),E(this,"eventsInProgress",void 0),E(this,"frameId",void 0),E(this,"inertia",void 0),E(this,"bearingSnap",void 0),E(this,"handlersById",void 0),E(this,"updatingCamera",void 0),E(this,"changes",void 0),E(this,"previousActiveHandlers",void 0),E(this,"bearingChanged",void 0),E(this,"rotateEnabled",void 0),E(this,"pitchEnabled",void 0),E(this,"listeners",void 0),E(this,"handleWindowEvent",(function(e){r.handleEvent(e,"".concat(e.type,"Window"))})),E(this,"handleEvent",(function(e,t){if("blur"!==e.type){r.updatingCamera=!0;var n,i="renderFrame"===e.type?void 0:e,a={needsRenderFrame:!1},o={},s={},u=e.touches?r.getMapTouches(e.touches):void 0,l=u?UD.touchPos(r.el,u):UD.mousePos(r.el,e),c=U(r.handlers);try{for(c.s();!(n=c.n()).done;){var h=n.value,f=h.handlerName,p=h.handler,d=h.allowed;if(p.isEnabled()){var v=void 0;if(r.blockedByActive(s,d,f))p.reset();else{var g=t||e.type;p&&p[g]&&(v=p[g](e,l,u),r.mergeIHandlerResult(a,o,v,f,i),v&&v.needsRenderFrame&&r.triggerRenderFrame())}(v||p.isActive())&&(s[f]=p)}}}catch(e){c.e(e)}finally{c.f()}var m={};for(var y in r.previousActiveHandlers)s[y]||(m[y]=i);r.previousActiveHandlers=s,(Object.keys(m).length||UF(a))&&(r.changes.push([a,o,m]),r.triggerRenderFrame()),(Object.keys(s).length||UF(a))&&r.map.stop(!0),r.updatingCamera=!1;var _=a.cameraAnimation;_&&(r.inertia.clear(),r.fireEvents({},{}),r.changes=[],_(r.map))}else r.stop()})),this.map=t,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new oF(t),this.bearingSnap=n.bearingSnap,this.rotateEnabled=n.rotateEnabled,this.pitchEnabled=n.pitchEnabled,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(n);var i=this.el;if(this.listeners=[],bd)Ed.document.addEventListener("touchstart",(function(e){r.handleEvent(e)}),{}),Ed.document.addEventListener("touchmove",(function(e){r.handleEvent(e)}),{}),Ed.document.addEventListener("touchend",(function(e){r.handleEvent(e)}),{}),Ed.document.addEventListener("touchcancel",(function(e){r.handleEvent(e)}),{});else{this.listeners=[[i,"touchstart",{passive:!1}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];var a,o=U(this.listeners);try{for(o.s();!(a=o.n()).done;){var s=N(a.value,3),u=s[0],l=s[1],c=s[2];UD.addEventListener(u,l,u===window.document?this.handleWindowEvent:this.handleEvent,c)}}catch(e){o.e(e)}finally{o.f()}}}return x(e,[{key:"destroy",value:function(){var e,t=U(this.listeners);try{for(t.s();!(e=t.n()).done;){var n=N(e.value,3),r=n[0],i=n[1],a=n[2];UD.removeEventListener(r,i,r===window.document?this.handleWindowEvent:this.handleEvent,a)}}catch(e){t.e(e)}finally{t.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var e,t=U(this.handlers);try{for(t.s();!(e=t.n()).done;){e.value.handler.reset()}}catch(e){t.e(e)}finally{t.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var e,t=U(this.handlers);try{for(t.s();!(e=t.n()).done;){if(e.value.handler.isActive())return!0}}catch(e){t.e(e)}finally{t.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean(BF(this.eventsInProgress))||this.isZooming()}},{key:"mergeIHandlerResult",value:function(e,t,n,r,i){if(n){QA(e,n);var a={handlerName:r,originalEvent:n.originalEvent||i};void 0!==n.zoomDelta&&(t.zoom=a),void 0!==n.panDelta&&(t.drag=a),void 0!==n.pitchDelta&&(t.pitch=a),void 0!==n.bearingDelta&&(t.rotate=a)}}},{key:"triggerRenderFrame",value:function(){var e=this;void 0===this.frameId&&(this.frameId=this.map.requestRenderFrame((function(t){delete e.frameId,e.handleEvent(new eF("renderFrame",{timeStamp:t})),e.applyChanges()})))}},{key:"addDefaultHandlers",value:function(e){var t=this.map,n=t.getCanvasContainer();this.add("mapEvent",new pF(t,e));var r=t.boxZoom=new JD(t,e);this.add("boxZoom",r);var i=new wF,a=new $D;t.doubleClickZoom=new bF(a,i),this.add("tapZoom",i),this.add("clickZoom",a);var o=new MF;this.add("tapDragZoom",o);var s=t.touchPitch=new LF;this.add("touchPitch",s);var u=new mF(e),l=new yF(e);t.dragRotate=new EF(e,u,l),this.add("mouseRotate",u,["mousePitch"]),this.add("mousePitch",l,["mouseRotate"]);var c=new gF(e),h=new kF(e);t.dragPan=new xF(n,c,h),this.add("mousePan",c),this.add("touchPan",h,["touchZoom","touchRotate"]);var f=new NF,p=new FF;t.touchZoomRotate=new SF(n,p,f,o),this.add("touchRotate",f,["touchPan","touchZoom"]),this.add("touchZoom",p,["touchPan","touchRotate"]);var d=t.scrollZoom=new _F(t,this);this.add("scrollZoom",d,["mousePan"]);var v=t.keyboard=new cF;this.add("keyboard",v),this.add("blockableMapEvent",new QD(t));for(var g=0,m=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];g<m.length;g++){var y=m[g];e.interactive&&e[y]&&t[y].enable(e[y])}}},{key:"add",value:function(e,t,n){this.handlers.push({handlerName:e,handler:t,allowed:n}),this.handlersById[e]=t}},{key:"blockedByActive",value:function(e,t,n){for(var r in e)if(r!==n&&(!t||t.indexOf(r)<0))return!0;return!1}},{key:"getMapTouches",value:function(e){var t,n=[],r=U(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=i.target;(bd||this.el.contains(a))&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"applyChanges",value:function(){var e,t={},n={},r={},i=U(this.changes);try{for(i.s();!(e=i.n()).done;){var a=N(e.value,3),o=a[0],s=a[1],u=a[2];o.panDelta&&(t.panDelta=(t.panDelta||new MD(0,0))._add(o.panDelta)),o.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+o.zoomDelta),o.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+o.bearingDelta),o.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+o.pitchDelta),void 0!==o.around&&(t.around=o.around),void 0!==o.pinchAround&&(t.pinchAround=o.pinchAround),o.noInertia&&(t.noInertia=o.noInertia),QA(n,s),QA(r,u)}}catch(e){i.e(e)}finally{i.f()}this.updateMapTransform(t,n,r),this.changes=[]}},{key:"updateMapTransform",value:function(e,t,n){var r=this.map,i=r.transform;if(!UF(e))return this.fireEvents(t,n);var a=e.panDelta,o=e.zoomDelta,s=e.bearingDelta,u=e.pitchDelta,l=e.pinchAround,c=e.around;void 0!==l&&(c=l),r.stop(!0),c=c||r.transform.centerPoint;var h=i.pointLocation(a?c.sub(a):c);s&&this.rotateEnabled&&(i.bearing+=s),u&&this.pitchEnabled&&(i.pitch+=u),o&&(i.zoom+=o),i.setLocationAtPoint(h,c),this.map.update(),e.noInertia||this.inertia.record(e),this.fireEvents(t,n)}},{key:"fireEvents",value:function(e,t){var n=this,r=BF(this.eventsInProgress),i=BF(e),a={};for(var o in e)if(e[o]){var s=e[o].originalEvent;this.eventsInProgress[o]||(a["".concat(o,"start")]=s),this.eventsInProgress[o]=e[o]}for(var u in!r&&i&&this.fireEvent("movestart",i.originalEvent),a)a[u]&&this.fireEvent(u,a[u]);for(var l in e.rotate&&(this.bearingChanged=!0),i&&this.fireEvent("move",i.originalEvent),e)if(e[l]){var c=e[l].originalEvent;this.fireEvent(l,c)}var h,f={};for(var p in this.eventsInProgress)if(this.eventsInProgress[p]){var d=this.eventsInProgress[p],v=d.handlerName,g=d.originalEvent;this.handlersById[v].isActive()||(delete this.eventsInProgress[p],h=t[v]||g,f["".concat(p,"end")]=h)}for(var m in f)f[m]&&this.fireEvent(m,f[m]);var y=BF(this.eventsInProgress);if((r||i)&&!y){this.updatingCamera=!0;var _=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),b=function(e){return 0!==e&&-n.bearingSnap<e&&e<n.bearingSnap};_?(b(_.bearing||this.map.getBearing())&&(_.bearing=0),this.map.easeTo(_,{originalEvent:h})):(this.map.emit("moveend",new FD("moveend",{originalEvent:h})),b(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(e,t){this.map.emit(e,new FD(e,t?{originalEvent:t}:{}))}}]),e}(),jF=function(){return am.Date.now()},VF=Math.max,GF=Math.min;var HF=function(e,t,n){var r,i,a,o,s,u,l=0,c=!1,h=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=r,a=i;return r=i=void 0,l=t,o=e.apply(a,n)}function d(e){return l=e,s=setTimeout(g,t),c?p(e):o}function v(e){var n=e-u;return void 0===u||n>=t||n<0||h&&e-l>=a}function g(){var e=jF();if(v(e))return m(e);s=setTimeout(g,function(e){var n=t-(e-u);return h?GF(n,a-(e-l)):n}(e))}function m(e){return s=void 0,f&&r?p(e):(r=i=void 0,o)}function y(){var e=jF(),n=v(e);if(r=arguments,i=this,u=e,n){if(void 0===s)return d(u);if(h)return clearTimeout(s),s=setTimeout(g,t),p(u)}return void 0===s&&(s=setTimeout(g,t)),o}return t=UP(t)||0,gm(n)&&(c=!!n.leading,a=(h="maxWait"in n)?VF(UP(n.maxWait)||0,t):a,f="trailing"in n?!!n.trailing:f),y.cancel=function(){void 0!==s&&clearTimeout(s),l=0,r=u=i=s=void 0},y.flush=function(){return void 0===s?o:m(jF())},y};var WF,XF,YF,ZF,qF,KF,QF,JF,$F,eB,tB,nB=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return gm(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),HF(e,t,{leading:r,maxWait:t,trailing:i})},rB=function(){function e(t){var n=this;_(this,e),E(this,"map",void 0),E(this,"updateHash",void 0),E(this,"hashName",void 0),E(this,"onHashChange",(function(){var e=n.getCurrentHash();if(e.length>=3&&!e.some((function(e){return isNaN(+e)}))){var t=n.map.dragRotate.isEnabled()&&n.map.touchZoomRotate.isEnabled()?+(e[3]||0):n.map.getBearing();return n.map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1})),E(this,"getCurrentHash",(function(){var e,t=window.location.hash.replace("#","");return n.hashName?(t.split("&").map((function(e){return e.split("=")})).forEach((function(t){t[0]===n.hashName&&(e=t)})),(e&&e[1]||"").split("/")):t.split("/")})),E(this,"updateHashUnthrottled",(function(){var e=n.getHashString();try{window.history.replaceState(window.history.state,"",e)}catch(e){}})),this.hashName=t&&encodeURIComponent(t),this.updateHash=nB(this.updateHashUnthrottled,300)}return x(e,[{key:"addTo",value:function(e){return this.map=e,Ed.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return Ed.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(e){var t=this.map.getCenter(),n=Math.round(100*this.map.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,r),a=Math.round(t.lng*i)/i,o=Math.round(t.lat*i)/i,s=this.map.getBearing(),u=this.map.getPitch(),l="";if(l+=e?"/".concat(a,"/").concat(o,"/").concat(n):"".concat(n,"/").concat(o,"/").concat(a),(s||u)&&(l+="/".concat(Math.round(10*s)/10)),u&&(l+="/".concat(Math.round(u))),this.hashName){var c=this.hashName,h=!1,f=window.location.hash.slice(1).split("&").map((function(e){var t=e.split("=")[0];return t===c?(h=!0,"".concat(t,"=").concat(l)):e})).filter((function(e){return e}));return h||f.push("".concat(c,"=").concat(l)),"#".concat(f.join("&"))}return"#".concat(l)}}]),e}(),iB=null,aB=[],oB=(Ed.performance,function(e){var t=e;if(null!=iB){var n=t-iB;aB.push(n)}iB=t}),sB=function(){function e(){_(this,e),E(this,"queue",void 0),E(this,"id",void 0),E(this,"cleared",void 0),E(this,"currentlyRunning",void 0),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}return x(e,[{key:"add",value:function(e){var t=++this.id;return this.queue.push({callback:e,id:t,cancelled:!1}),t}},{key:"remove",value:function(e){var t,n=this.currentlyRunning,r=U(n?this.queue.concat(n):this.queue);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.id===e)return void(i.cancelled=!0)}}catch(e){r.e(e)}finally{r.f()}}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.currentlyRunning=this.queue;this.queue=[];var n,r=U(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.cancelled&&(i.callback(e),this.cleared))break}}catch(e){r.e(e)}finally{r.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}]),e}(),uB={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},lB=function(e){S(n,e);var t=R(n);function n(e){var r;if(_(this,n),E(O(r=t.call(this,QA({},uB,e))),"doubleClickZoom",void 0),E(O(r),"dragRotate",void 0),E(O(r),"dragPan",void 0),E(O(r),"touchZoomRotate",void 0),E(O(r),"scrollZoom",void 0),E(O(r),"keyboard",void 0),E(O(r),"touchPitch",void 0),E(O(r),"boxZoom",void 0),E(O(r),"handlers",void 0),E(O(r),"container",void 0),E(O(r),"canvas",void 0),E(O(r),"canvasContainer",void 0),E(O(r),"renderTaskQueue",new sB),E(O(r),"frame",void 0),E(O(r),"trackResize",!0),E(O(r),"hash",void 0),E(O(r),"onWindowOnline",(function(){r.update()})),E(O(r),"onWindowResize",(function(e){r.trackResize&&r.resize({originalEvent:e}).update()})),bd?r.initMiniContainer():r.initContainer(),r.resize(),r.handlers=new zF(O(r),r.options),"undefined"!=typeof window&&(window.addEventListener("online",r.onWindowOnline,!1),window.addEventListener("resize",r.onWindowResize,!1),window.addEventListener("orientationchange",r.onWindowResize,!1)),!bd){var i="string"==typeof e.hash&&e.hash||void 0;e.hash&&(r.hash=new rB(i).addTo(O(r)))}return r.hash&&r.hash.onHashChange()||(r.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(r.resize(),r.fitBounds(e.bounds,QA({},e.fitBoundsOptions,{duration:0})))),r}return x(n,[{key:"resize",value:function(e){var t=this.containerDimensions(),n=t[0],r=t[1];if(this.transform.resize(n,r),bd)return this;var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new Ed.Event("movestart",e)),this.emit("move",new Ed.Event("move",e))),this.emit("resize",new Ed.Event("resize",e)),i&&this.emit("moveend",new Ed.Event("moveend",e)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(e){return this.transform.locationPoint(TD.convert(e))}},{key:"unproject",value:function(e){return this.transform.pointLocation(MD.convert(e))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(e){this.transform.setMaxBounds(AD.convert(e))}},{key:"setStyle",value:function(e){}},{key:"setMinZoom",value:function(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(e){if((e=null==e?60:e)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(e){this.transform.renderWorldCopies=!!e}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(e){return this.update(),this.renderTaskQueue.add(e)}},{key:"cancelRenderFrame",value:function(e){return this.renderTaskQueue.remove(e)}},{key:"triggerRepaint",value:function(){var e=this;this.frame||(this.frame=CD((function(t){oB(t),e.frame=null,e.update(t)})))}},{key:"update",value:function(e){var t=this;this.frame||(this.frame=CD((function(n){oB(n),t.frame=null,t.renderTaskQueue.run(e)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var e=this.container;e.classList.add("l7-map");var t=this.canvasContainer=wd("div","l7-canvas-container",e);this.options.interactive&&t.classList.add("l7-interactive")}},{key:"initMiniContainer",value:function(){this.container=this.options.canvas,this.canvasContainer=this.container}},{key:"containerDimensions",value:function(){var e=0,t=0;return this.container&&(bd?(e=this.container.width/Ed.devicePixelRatio,t=this.container.height/Ed.devicePixelRatio):(e=this.container.clientWidth,t=this.container.clientHeight)),[e,t]}}]),n}(BD),cB={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},hB=function(e){S(n,e);var t=R(n);function n(e){var r;return _(this,n),E(O(r=t.call(this,QA({},cB,e))),"doubleClickZoom",void 0),E(O(r),"dragRotate",void 0),E(O(r),"dragPan",void 0),E(O(r),"touchZoomRotate",void 0),E(O(r),"scrollZoom",void 0),E(O(r),"keyboard",void 0),E(O(r),"touchPitch",void 0),E(O(r),"boxZoom",void 0),E(O(r),"handlers",void 0),E(O(r),"container",void 0),E(O(r),"canvas",void 0),E(O(r),"canvasContainer",void 0),E(O(r),"renderTaskQueue",new sB),E(O(r),"frame",void 0),E(O(r),"trackResize",!0),E(O(r),"onWindowOnline",(function(){r.update()})),E(O(r),"onWindowResize",(function(e){r.trackResize&&r.resize({originalEvent:e}).update()})),r.initContainer(),r.resize(),r.handlers=new zF(O(r),r.options),"undefined"!=typeof window&&(window.addEventListener("online",r.onWindowOnline,!1),window.addEventListener("resize",r.onWindowResize,!1),window.addEventListener("orientationchange",r.onWindowResize,!1)),r}return x(n,[{key:"resize",value:function(e){var t=this.containerDimensions(),n=t[0],r=t[1];this.transform.resize(n,r);var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new Event("movestart",e)),this.emit("move",new Event("move",e))),this.emit("resize",new Event("resize",e)),i&&this.emit("moveend",new Event("moveend",e)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(e){return this.transform.locationPoint(TD.convert(e))}},{key:"unproject",value:function(e){return this.transform.pointLocation(MD.convert(e))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(e){this.transform.setMaxBounds(AD.convert(e))}},{key:"setStyle",value:function(e){}},{key:"setMinZoom",value:function(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(e){if((e=null==e?60:e)>60)throw new Error("maxPitch must be less than or equal to ".concat(60));if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(e){this.transform.renderWorldCopies=!!e}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(e){return this.update(),this.renderTaskQueue.add(e)}},{key:"cancelRenderFrame",value:function(e){return this.renderTaskQueue.remove(e)}},{key:"triggerRepaint",value:function(){var e=this;this.frame||(this.frame=CD((function(t){oB(t),e.frame=null,e.update(t)})))}},{key:"update",value:function(e){var t=this;this.frame||(this.frame=CD((function(n){oB(n),t.frame=null,t.renderTaskQueue.run(e)})))}},{key:"initContainer",value:function(){if("string"==typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var e=this.container;e.classList.add("l7-map");var t=this.canvasContainer=wd("div","l7-canvas-container",e);this.options.interactive&&t.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var e=0,t=0;return this.container&&(e=this.container.clientWidth||400,t=this.container.clientHeight||300),[e,t]}},{key:"resizeCanvas",value:function(e,t){var n=zd||1;this.canvas.width=n*e,this.canvas.height=n*t,this.canvas.style.width="".concat(e,"px"),this.canvas.style.height="".concat(t,"px")}}]),n}(BD),fB=function(){function e(){_(this,e),E(this,"xzReg",.6*-Math.PI),E(this,"yReg",.2*Math.PI),E(this,"earthCameraRadius",200),E(this,"earthCameraZoom",1),E(this,"cameraPosition",iA()),E(this,"viewport",void 0),E(this,"projectionMatrix",IT()),E(this,"modelMatrix",IT()),E(this,"viewMatrix",IT()),E(this,"viewProjectionMatrix",IT()),E(this,"ViewProjectionMatrixUncentered",IT()),E(this,"viewUncenteredMatrix",IT())}return x(e,[{key:"syncWithMapCamera",value:function(e){var t=e.viewportHeight,n=void 0===t?1:t,r=e.viewportWidth,i=(void 0===r?1:r)/n;qT(this.projectionMatrix,20,i,.1,1e4);var a=this.earthCameraRadius*Math.cos(this.xzReg),o=this.earthCameraRadius*Math.sin(this.xzReg),s=this.earthCameraRadius*Math.sin(this.yReg);this.cameraPosition=oA(a,s,o),vA(this.cameraPosition,this.cameraPosition),uA(this.cameraPosition,this.cameraPosition,oA(this.earthCameraRadius,this.earthCameraRadius,this.earthCameraRadius)),cA(this.cameraPosition,this.cameraPosition,this.earthCameraZoom);var u=iA();mA(u,this.cameraPosition,oA(0,1,0));var l=oA(0,1,0);mA(l,u,this.cameraPosition);var c=oA(0,0,0);JT(this.viewMatrix,this.cameraPosition,c,l),this.viewUncenteredMatrix=NT(this.viewMatrix),UT(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),UT(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"rotateY",value:function(e){this.xzReg+=e*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"rotateX",value:function(e){this.yReg+=e*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"scaleZoom",value:function(e){this.earthCameraZoom+=e,this.earthCameraZoom=Math.max(this.earthCameraZoom,.6)}},{key:"getZoom",value:function(){return 4}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[0,0]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return this.modelMatrix}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),pB={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},dB=["id","attributionControl","style","rotation","mapInstance"],vB={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},gB=(WF=Qx(),XF=Kx(YE.MapConfig),YF=Kx(YE.IGlobalConfigService),ZF=Kx(YE.ICoordinateSystemService),qF=Kx(YE.IEventEmitter),WF((JF=j((QF=function(){function t(){var n=this;_(this,t),E(this,"version",e.Version.GLOBEL),E(this,"map",void 0),E(this,"simpleMapCoord",new CN),E(this,"dragging",!1),E(this,"bgColor","#000"),z(this,"config",JF,this),z(this,"configService",$F,this),z(this,"coordinateSystemService",eB,this),z(this,"eventEmitter",tB,this),E(this,"viewport",void 0),E(this,"markerContainer",void 0),E(this,"cameraChangedCallback",void 0),E(this,"$mapContainer",void 0),E(this,"handleCameraChanging",void 0),E(this,"handleCameraTimer",void 0),E(this,"handleCameraChanged",(function(t){n.emit("mapchange");n.handleCameraChanging=!0,n.handleCameraTimer&&clearTimeout(n.handleCameraTimer),n.handleCameraTimer=setTimeout((function(){n.handleCameraChanging=!1}),2e3);t.type&&t.originalEvent&&("wheel"===t.originalEvent.type&&n.viewport.scaleZoom(.01*Math.sign(t.originalEvent.wheelDelta)*-1),Math.abs(t.originalEvent.movementX)>Math.abs(t.originalEvent.movementY)?t.originalEvent.movementX>0?n.viewport.rotateY(.02):t.originalEvent.movementX<0&&n.viewport.rotateY(-.02):t.originalEvent.movementY>0?n.viewport.rotateX(.02):t.originalEvent.movementY<0&&n.viewport.rotateX(-.02));var r=n.config.offsetCoordinate,i=void 0===r||r;n.viewport.syncWithMapCamera({viewportHeight:n.map.transform.height,viewportWidth:n.map.transform.width}),n.viewport.getZoom()>12&&i?n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT_OFFSET):n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT),n.cameraChangedCallback(n.viewport)}))}var n;return x(t,[{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"addMarkerContainer",value:function(){var e=this.map.getCanvasContainer();this.markerContainer=wd("div","l7-marker-container",e),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(e,t){-1!==qP.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(vB[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(vB[e]||e,t),this.eventEmitter.off(e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var e=this.map.transform;return[e.width,e.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(e){return this.map.setZoom(e)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(e){this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(e){this.map.setBearing(e)}},{key:"zoomIn",value:function(e,t){this.map.zoomIn(e,t)}},{key:"zoomOut",value:function(e,t){this.map.zoomOut(e,t)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.panTo([e,t])}},{key:"fitBounds",value:function(e,t){this.map.fitBounds(e,t)}},{key:"setMaxZoom",value:function(e){this.map.setMaxZoom(e)}},{key:"setMinZoom",value:function(e){this.map.setMinZoom(e)}},{key:"setMapStatus",value:function(e){!0===e.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===e.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===e.dragEnable&&this.map.dragPan.disable(),!0===e.dragEnable&&this.map.dragPan.enable(),!1===e.rotateEnable&&this.map.dragRotate.disable(),!0===e.dragEnable&&this.map.dragRotate.enable(),!1===e.keyboardEnable&&this.map.keyboard.disable(),!0===e.keyboardEnable&&this.map.keyboard.enable(),!1===e.zoomEnable&&this.map.scrollZoom.disable(),!0===e.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(e,t){this.map.flyTo({zoom:e,center:t})}},{key:"setMapStyle",value:function(e){this.map.setStyle(this.getMapStyle(e))}},{key:"pixelToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToPixel",value:function(e){return this.map.project(e)}},{key:"containerToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToContainer",value:function(e){return this.map.project(e)}},{key:"lngLatToMercator",value:function(e,t){throw new Error("not implement")}},{key:"getModelMatrix",value:function(e,t,n){throw new Error("not implement")}},{key:"init",value:(n=y(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,t.attributionControl,i=t.style,a=void 0===i?"light":i,o=t.rotation,s=void 0===o?0:o,t.mapInstance,u=k(t,dB),this.viewport=new fB,this.$mapContainer=this.creatAmapContainer(r),this.map=new hB(v({container:this.$mapContainer,style:this.getMapStyle(a),bearing:s},u)),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged({});case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"destroy",value:function(){var e,t;null===(e=this.$mapContainer)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"rotateY",value:function(e){var t=e||{},n=t.force,r=void 0!==n&&n,i=t.reg,a=void 0===i?.01:i;this.handleCameraChanging&&!r||this.viewport&&(this.viewport.rotateY(a),this.viewport.syncWithMapCamera({viewportHeight:this.map.transform.height,viewportWidth:this.map.transform.width}),this.cameraChangedCallback(this.viewport))}},{key:"creatAmapContainer",value:function(e){var t=e;return"string"==typeof e&&(t=document.getElementById(e)),t}},{key:"getMapStyle",value:function(e){return"string"!=typeof e?e:pB[e]?pB[e]:e}}]),t}()).prototype,"config",[XF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$F=j(QF.prototype,"configService",[YF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eB=j(QF.prototype,"coordinateSystemService",[ZF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tB=j(QF.prototype,"eventEmitter",[qF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KF=QF))||KF),mB=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.apply(this,arguments)}return x(n,[{key:"getServiceConstructor",value:function(){return gB}}]),n}(EN);function yB(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function bB(e,t,n){return t&&_B(e.prototype,t),n&&_B(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function xB(e){return(xB="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function EB(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function SB(e,t){if(t&&("object"===xB(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return EB(e)}function CB(e){return(CB=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function TB(e,t){return(TB=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function AB(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function MB(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return AB(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?AB(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wB(e,t){var n,r,i,a=RA([],t,e);return n=a,r=a,i=1/a[3],n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=r[3]*i,a}function kB(e,t){if(!e)throw new Error(t||"viewport-mercator-project: assertion failed.")}var OB=Math.PI,PB=OB/4,RB=OB/180,LB=180/OB;function IB(e){return Math.pow(2,e)}function NB(e,t){var n=MB(e,2),r=n[0],i=n[1];kB(Number.isFinite(r)&&Number.isFinite(t)),kB(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var a=i*RB;return[(t*=512)*(r*RB+OB)/(2*OB),t*(OB-Math.log(Math.tan(PB+.5*a)))/(2*OB)]}function DB(e,t){var n=MB(e,2),r=n[0],i=n[1],a=r/(t*=512)*(2*OB)-OB,o=2*(Math.atan(Math.exp(OB-i/t*(2*OB)))-PB);return[a*LB,o*LB]}function FB(e){var t=e.latitude,n=e.longitude,r=e.zoom,i=e.scale,a=e.highPrecision,o=void 0!==a&&a;i=void 0!==i?i:IB(r),kB(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i));var s={},u=512*i,l=Math.cos(t*RB),c=u/360,h=c/l,f=u/4003e4/l;if(s.pixelsPerMeter=[f,-f,f],s.metersPerPixel=[1/f,-1/f,1/f],s.pixelsPerDegree=[c,-h,f],s.degreesPerPixel=[1/c,-1/h,1/f],o){var p=RB*Math.tan(t*RB)/l,d=c*p/2,v=u/4003e4*p,g=v/h*f;s.pixelsPerDegree2=[0,-d,v],s.pixelsPerMeter2=[g,0,g]}return s}function BB(e){var t=e.height,n=e.pitch,r=e.bearing,i=e.altitude,a=e.center,o=void 0===a?null:a,s=e.flipY,u=void 0!==s&&s,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return zT(l,l,[0,0,-i]),jT(l,l,[1,1,1/t]),VT(l,l,-n*RB),HT(l,l,r*RB),u&&jT(l,l,[1,-1,1]),o&&zT(l,l,dA([],o)),l}function UB(e){var t=e.width,n=e.height,r=e.pitch,i=function(e){var t=e.width,n=e.height,r=e.altitude,i=void 0===r?1.5:r,a=e.pitch,o=void 0===a?0:a,s=e.nearZMultiplier,u=void 0===s?1:s,l=e.farZMultiplier,c=void 0===l?1:l,h=o*RB,f=Math.atan(.5/i),p=Math.sin(f)*i/Math.sin(Math.PI/2-h-f),d=Math.cos(Math.PI/2-h)*p+i;return{fov:2*Math.atan(n/2/i),aspect:t/n,focalDistance:i,near:u,far:d*c}}({width:t,height:n,altitude:e.altitude,pitch:r,nearZMultiplier:e.nearZMultiplier,farZMultiplier:e.farZMultiplier}),a=i.fov,o=i.aspect,s=i.near,u=i.far;return qT([],a,o,s,u)}function zB(e,t){var n=MB(e,3),r=n[0],i=n[1],a=n[2],o=void 0===a?0:a;return kB(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(o)),wB(t,[r,i,o,1])}function jB(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=MB(e,3),i=r[0],a=r[1],o=r[2];if(kB(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(o)){var s=wB(t,[i,a,o,1]);return s}var u=wB(t,[i,a,0,1]),l=wB(t,[i,a,1,1]),c=u[2],h=l[2],f=c===h?0:((n||0)-c)/(h-c);return zA([],u,l,f)}var VB=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function GB(e){var t=e.width,n=e.height,r=e.bounds,i=e.minExtent,a=void 0===i?0:i,o=e.maxZoom,s=void 0===o?24:o,u=e.padding,l=void 0===u?0:u,c=e.offset,h=void 0===c?[0,0]:c,f=MB(r,2),p=MB(f[0],2),d=p[0],v=p[1],g=MB(f[1],2),m=g[0],y=g[1];if(Number.isFinite(l)){l={top:l,bottom:l,left:l,right:l}}else kB(Number.isFinite(l.top)&&Number.isFinite(l.bottom)&&Number.isFinite(l.left)&&Number.isFinite(l.right));var _=new tU({width:t,height:n,longitude:0,latitude:0,zoom:0}),b=_.project([d,y]),x=_.project([m,v]),E=[Math.max(Math.abs(x[0]-b[0]),a),Math.max(Math.abs(x[1]-b[1]),a)],S=[t-l.left-l.right-2*Math.abs(h[0]),n-l.top-l.bottom-2*Math.abs(h[1])];kB(S[0]>0&&S[1]>0);var C=S[0]/E[0],T=S[1]/E[1],A=(l.right-l.left)/2/C,M=(l.bottom-l.top)/2/T,w=[(x[0]+b[0])/2+A,(x[1]+b[1])/2+M],k=_.unproject(w),O=_.zoom+Math.log2(Math.abs(Math.min(C,T)));return{longitude:k[0],latitude:k[1],zoom:Math.min(O,s)}}var HB,WB,XB,YB,ZB,qB,KB,QB,JB,$B,eU,tU=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,i=n.height,a=n.latitude,o=void 0===a?0:a,s=n.longitude,u=void 0===s?0:s,l=n.zoom,c=void 0===l?0:l,h=n.pitch,f=void 0===h?0:h,p=n.bearing,d=void 0===p?0:p,v=n.altitude,g=void 0===v?1.5:v,m=n.nearZMultiplier,y=n.farZMultiplier;yB(this,t),r=r||1,i=i||1;var _=IB(c);g=Math.max(.75,g);var b=NB([u,o],_);b[2]=0;var x=UB({width:r,height:i,pitch:f,bearing:d,altitude:g,nearZMultiplier:m||1/i,farZMultiplier:y||1.01}),E=BB({height:i,center:b,pitch:f,bearing:d,altitude:g,flipY:!0});return(e=SB(this,CB(t).call(this,{width:r,height:i,viewMatrix:E,projectionMatrix:x}))).latitude=o,e.longitude=u,e.zoom=c,e.pitch=f,e.bearing=d,e.altitude=g,e.scale=_,e.center=b,e.pixelsPerMeter=FB(EB(EB(e))).pixelsPerMeter[2],Object.freeze(EB(EB(e))),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&TB(e,t)}(t,e),bB(t,[{key:"projectFlat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return NB(e,t)}},{key:"unprojectFlat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return DB(e,t)}},{key:"getMapCenterByLngLatPosition",value:function(e){var t,n,r=e.lngLat,i=jB(e.pos,this.pixelUnprojectionMatrix),a=DA([],NB(r,this.scale),((t=[])[0]=-(n=i)[0],t[1]=-n[1],t));return DB(DA([],this.center,a),this.scale)}},{key:"getLocationAtPoint",value:function(e){var t=e.lngLat,n=e.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:n})}},{key:"fitBounds",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,a=GB(Object.assign({width:r,height:i,bounds:e},n)),o=a.longitude,s=a.latitude,u=a.zoom;return new t({width:r,height:i,longitude:o,latitude:s,zoom:u})}}]),t}(function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width,r=t.height,i=t.viewMatrix,a=void 0===i?VB:i,o=t.projectionMatrix,s=void 0===o?VB:o;yB(this,e),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=s;var u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];UT(u,u,this.projectionMatrix),UT(u,u,this.viewMatrix),this.viewProjectionMatrix=u;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];jT(l,l,[this.width/2,-this.height/2,1]),zT(l,l,[1,-1,0]),UT(l,l,this.viewProjectionMatrix);var c=BT([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l);if(!c)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=c,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return bB(e,[{key:"equals",value:function(t){return t instanceof e&&(t.width===this.width&&t.height===this.height&&eA(t.projectionMatrix,this.projectionMatrix)&&eA(t.viewMatrix,this.viewMatrix))}},{key:"project",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=this.projectPosition(e),a=zB(i,this.pixelProjectionMatrix),o=MB(a,2),s=o[0],u=o[1],l=r?u:this.height-u;return 2===e.length?[s,l]:[s,l,a[2]]}},{key:"unproject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=t.targetZ,a=MB(e,3),o=a[0],s=a[1],u=a[2],l=r?s:this.height-s,c=i&&i*this.pixelsPerMeter,h=jB([o,l,u],this.pixelUnprojectionMatrix,c),f=this.unprojectPosition(h),p=MB(f,3),d=p[0],v=p[1],g=p[2];return Number.isFinite(u)?[d,v,g]:Number.isFinite(i)?[d,v,i]:[d,v]}},{key:"projectPosition",value:function(e){var t=MB(this.projectFlat(e),2);return[t[0],t[1],(e[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(e){var t=MB(this.unprojectFlat(e),2);return[t[0],t[1],(e[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]||this.scale;return e}},{key:"unprojectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]||this.scale;return e}}]),e}()),nU=function(){function e(){_(this,e),E(this,"viewport",void 0)}return x(e,[{key:"syncWithMapCamera",value:function(e){var t=e.center,n=e.zoom,r=e.pitch,i=e.bearing,a=e.viewportHeight,o=e.viewportWidth;this.viewport=new tU({width:o,height:a,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),rU={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},iU=["id","attributionControl","style","rotation","mapInstance","version","mapSize"],aU=["id","attributionControl","style","rotation","mapInstance","canvas","hasBaseMap"],oU={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},sU=(HB=Qx(),WB=Kx(YE.MapConfig),XB=Kx(YE.IGlobalConfigService),YB=Kx(YE.ICoordinateSystemService),ZB=Kx(YE.IEventEmitter),HB((QB=j((KB=function(){function t(){var n=this;_(this,t),E(this,"version",e.Version.L7MAP),E(this,"map",void 0),E(this,"simpleMapCoord",new CN),E(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),z(this,"config",QB,this),z(this,"configService",JB,this),z(this,"coordinateSystemService",$B,this),z(this,"eventEmitter",eU,this),E(this,"viewport",void 0),E(this,"markerContainer",void 0),E(this,"cameraChangedCallback",void 0),E(this,"$mapContainer",void 0),E(this,"handleMiniCameraChanged",(function(t,r,i,a,o){var s=n.config.offsetCoordinate,u=void 0===s||s;n.viewport.syncWithMapCamera({bearing:a,center:[t,r],viewportHeight:n.map.transform.height,pitch:o,viewportWidth:n.map.transform.width,zoom:i,cameraHeight:0}),n.viewport.getZoom()>12&&u?n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT_OFFSET):n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT),n.cameraChangedCallback(n.viewport)})),E(this,"handleCameraChanged",(function(){var t=n.map.getCenter(),r=t.lat,i=t.lng,a=n.config.offsetCoordinate,o=void 0===a||a;n.emit("mapchange"),n.viewport.syncWithMapCamera({bearing:n.map.getBearing(),center:[i,r],viewportHeight:n.map.transform.height,pitch:n.map.getPitch(),viewportWidth:n.map.transform.width,zoom:n.map.getZoom(),cameraHeight:0}),n.viewport.getZoom()>12&&o?n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT_OFFSET):n.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT),n.cameraChangedCallback(n.viewport)}))}var n,r;return x(t,[{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"addMarkerContainer",value:function(){var e=this.map.getCanvasContainer();this.markerContainer=wd("div","l7-marker-container",e),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(e,t){-1!==qP.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(oU[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(oU[e]||e,t),this.eventEmitter.off(e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===e.Version.SIMPLE)return this.simpleMapCoord.getSize();var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(e){return this.map.setZoom(e)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(e){this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(e){this.map.setBearing(e)}},{key:"zoomIn",value:function(e,t){this.map.zoomIn(e,t)}},{key:"zoomOut",value:function(e,t){this.map.zoomOut(e,t)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.panTo([e,t])}},{key:"fitBounds",value:function(e,t){this.map.fitBounds(e,t)}},{key:"setMaxZoom",value:function(e){this.map.setMaxZoom(e)}},{key:"setMinZoom",value:function(e){this.map.setMinZoom(e)}},{key:"setMapStatus",value:function(e){!0===e.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===e.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===e.dragEnable&&this.map.dragPan.disable(),!0===e.dragEnable&&this.map.dragPan.enable(),!1===e.rotateEnable&&this.map.dragRotate.disable(),!0===e.dragEnable&&this.map.dragRotate.enable(),!1===e.keyboardEnable&&this.map.keyboard.disable(),!0===e.keyboardEnable&&this.map.keyboard.enable(),!1===e.zoomEnable&&this.map.scrollZoom.disable(),!0===e.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(e,t){this.map.flyTo({zoom:e,center:t})}},{key:"setMapStyle",value:function(e){this.map.setStyle(this.getMapStyle(e))}},{key:"pixelToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToPixel",value:function(e){return this.map.project(e)}},{key:"containerToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToContainer",value:function(e){return this.map.project(e)}},{key:"lngLatToMercator",value:function(e,t){throw new Error("not implement")}},{key:"getModelMatrix",value:function(e,t,n){throw new Error("not implement")}},{key:"init",value:(r=y(regeneratorRuntime.mark((function t(){var n,r,i,a,o,s,u,l,c,h,f,p,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=this.config,r=n.id,i=void 0===r?"map":r,n.attributionControl,a=n.style,o=void 0===a?"light":a,s=n.rotation,u=void 0===s?0:s,l=n.mapInstance,c=n.version,h=void 0===c?"L7MAP":c,f=n.mapSize,p=void 0===f?1e4:f,d=k(n,iU),this.viewport=new nU,this.version=h,this.simpleMapCoord.setSize(p),h===e.Version.SIMPLE&&d.center&&(d.center=this.simpleMapCoord.unproject(d.center)),l?(this.map=l,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(i),this.map=new lB(v({container:this.$mapContainer,style:this.getMapStyle(o),bearing:u},d))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"initMiniMap",value:(n=y(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s,u,l,c,h,f=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=this.config).id,t.attributionControl,n=t.style,r=void 0===n?"light":n,i=t.rotation,a=void 0===i?0:i,t.mapInstance,o=t.canvas,s=void 0===o?null:o,u=t.hasBaseMap,l=void 0!==u&&u,c=k(t,aU),this.viewport=new nU,this.$mapContainer=s,this.map=new lB(v({container:this.$mapContainer,style:this.getMapStyle(r),bearing:a,canvas:s},c)),l?(h=this.map.getCenter(),this.handleMiniCameraChanged(h.lng,h.lat,this.map.getZoom(),this.map.getBearing(),this.map.getPitch()),Ed.document.addEventListener("mapCameaParams",(function(e){var t=e.e,n=t.longitude,r=t.latitude,i=t.scale,a=t.bearing,o=t.pitch;f.handleMiniCameraChanged(n,r,i-1.25,a,o)}))):(this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged());case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"destroy",value:function(){var e,t;null===(e=this.$mapContainer)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"creatAmapContainer",value:function(e){var t=e;return"string"==typeof e&&(t=document.getElementById(e)),t}},{key:"getMapStyle",value:function(e){return"string"!=typeof e?e:rU[e]?rU[e]:e}}]),t}()).prototype,"config",[WB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JB=j(KB.prototype,"configService",[XB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$B=j(KB.prototype,"coordinateSystemService",[YB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eU=j(KB.prototype,"eventEmitter",[ZB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qB=KB))||qB),uU=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.apply(this,arguments)}return x(n,[{key:"getServiceConstructor",value:function(){return sU}}]),n}(EN);hR(".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:-moz-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-moz-box-shadow:0 0 2px rgba(0,0,0,.1);-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;-moz-animation:mapboxgl-spin 2s infinite linear;-o-animation:mapboxgl-spin 2s infinite linear;-ms-animation:mapboxgl-spin 2s infinite linear;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@-moz-keyframes mapboxgl-spin{0%{-moz-transform:rotate(0deg)}to{-moz-transform:rotate(1turn)}}@-o-keyframes mapboxgl-spin{0%{-o-transform:rotate(0deg)}to{-o-transform:rotate(1turn)}}@-ms-keyframes mapboxgl-spin{0%{-ms-transform:rotate(0deg)}to{-ms-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-flex;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:\"\";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;-moz-animation:mapboxgl-user-location-dot-pulse 2s infinite;-ms-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px;box-sizing:border-box;box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@-ms-keyframes mapboxgl-user-location-dot-pulse{0%{-ms-transform:scale(1);opacity:1}70%{-ms-transform:scale(3);opacity:0}to{-ms-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{transform:scale(1);opacity:1}70%{transform:scale(3);opacity:0}to{transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}");var lU,cU,hU,fU,pU,dU,vU,gU,mU,yU,_U,bU=function(){function e(){_(this,e),E(this,"viewport",void 0)}return x(e,[{key:"syncWithMapCamera",value:function(e){var t=e.center,n=e.zoom,r=e.pitch,i=e.bearing,a=e.viewportHeight,o=e.viewportWidth;this.viewport=new tU({width:o,height:a,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),xU={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},EU=["id","attributionControl","style","token","rotation","mapInstance"];window.mapboxgl=t;var SU={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},CU=0,TU="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",AU=(lU=Qx(),cU=Kx(YE.MapConfig),hU=Kx(YE.IGlobalConfigService),fU=Kx(YE.ICoordinateSystemService),pU=Kx(YE.IEventEmitter),lU((gU=j((vU=function(){function n(){var t=this;_(this,n),E(this,"version",e.Version.MAPBOX),E(this,"map",void 0),E(this,"simpleMapCoord",new CN),E(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),z(this,"config",gU,this),z(this,"configService",mU,this),z(this,"coordinateSystemService",yU,this),z(this,"eventEmitter",_U,this),E(this,"viewport",void 0),E(this,"markerContainer",void 0),E(this,"cameraChangedCallback",void 0),E(this,"$mapContainer",void 0),E(this,"handleCameraChanged",(function(){var n=t.map.getCenter().wrap(),r=n.lat,i=n.lng;t.emit("mapchange"),t.viewport.syncWithMapCamera({bearing:t.map.getBearing(),center:[i,r],viewportHeight:t.map.transform.height,pitch:t.map.getPitch(),viewportWidth:t.map.transform.width,zoom:t.map.getZoom(),cameraHeight:0});var a=t.config.offsetZoom,o=void 0===a?12:a;t.viewport.getZoom()>o?t.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT_OFFSET):t.coordinateSystemService.setCoordinateSystem(e.CoordinateSystem.LNGLAT),t.cameraChangedCallback(t.viewport)}))}var r;return x(n,[{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"addMarkerContainer",value:function(){var e=this.map.getCanvasContainer();this.markerContainer=wd("div","l7-marker-container",e),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(e,t){-1!==qP.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(SU[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(SU[e]||e,t),this.eventEmitter.off(e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var e=this.map.transform;return[e.width,e.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(e){return this.map.setZoom(e)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(e){this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(e){this.map.setBearing(e)}},{key:"zoomIn",value:function(e,t){this.map.zoomIn(e,t)}},{key:"zoomOut",value:function(e,t){this.map.zoomOut(e,t)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(e,t){this.panTo([e,t])}},{key:"fitBounds",value:function(e,t){this.map.fitBounds(e,t)}},{key:"setMaxZoom",value:function(e){this.map.setMaxZoom(e)}},{key:"setMinZoom",value:function(e){this.map.setMinZoom(e)}},{key:"setMapStatus",value:function(e){!0===e.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===e.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===e.dragEnable&&this.map.dragPan.disable(),!0===e.dragEnable&&this.map.dragPan.enable(),!1===e.rotateEnable&&this.map.dragRotate.disable(),!0===e.rotateEnable&&this.map.dragRotate.enable(),!1===e.keyboardEnable&&this.map.keyboard.disable(),!0===e.keyboardEnable&&this.map.keyboard.enable(),!1===e.zoomEnable&&this.map.scrollZoom.disable(),!0===e.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(e,t){this.map.flyTo({zoom:e,center:t})}},{key:"setMapStyle",value:function(e){this.map.setStyle(this.getMapStyle(e))}},{key:"pixelToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToPixel",value:function(e){return this.map.project(e)}},{key:"containerToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToContainer",value:function(e){return this.map.project(e)}},{key:"lngLatToCoord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(e,0),r=n.x,i=n.y;return[r-t.x,i-t.y]}},{key:"lngLatToMercator",value:function(e,t){var n=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,a=n.y,o=void 0===a?0:a,s=n.z;return{x:i,y:o,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},a=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),o=a.meterInMercatorCoordinateUnits(),s=IT();return zT(s,s,oA(a.x-i.x,a.y-i.y,a.z||0-i.z)),jT(s,s,oA(o*r[0],-o*r[1],o*r[2])),VT(s,s,n[0]),GT(s,s,n[1]),HT(s,s,n[2]),s}},{key:"init",value:(r=y(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s,u,l,c,h,f,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.attributionControl,a=void 0!==i&&i,o=t.style,s=void 0===o?"light":o,u=t.token,l=void 0===u?TU:u,c=t.rotation,h=void 0===c?0:c,f=t.mapInstance,p=k(t,EU),this.viewport=new bU,f||window.mapboxgl||console.error(this.configService.getSceneWarninfo("SDK")),l!==TU||"blank"===s||window.mapboxgl.accessToken||f||console.warn(this.configService.getSceneWarninfo("MapToken")),f||window.mapboxgl.accessToken||(window.mapboxgl.accessToken=l),f?(this.map=f,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(r),this.map=new window.mapboxgl.Map(v({container:this.$mapContainer,style:this.getMapStyle(s),attributionControl:a,bearing:h},p))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"destroy",value:function(){var e,t;null===(e=this.$mapContainer)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(e,n){var r=new t.LngLat(e[0],e[1]),i=new t.LngLat(n[0],n[1]),a=r.distanceTo(i),o=t.MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),s=t.MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),u=o.x,l=o.y,c=s.x,h=s.y;return 4194304*Math.sqrt(Math.pow(u-c,2)+Math.pow(l-h,2))*2/a}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"creatAmapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_mapbox_div"+CU++,t.appendChild(n),n}},{key:"getMapStyle",value:function(e){return"string"!=typeof e?e:xU[e]?xU[e]:e}}]),n}()).prototype,"config",[cU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mU=j(vU.prototype,"configService",[hU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yU=j(vU.prototype,"coordinateSystemService",[fU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_U=j(vU.prototype,"eventEmitter",[pU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dU=vU))||dU),MU=function(e){S(n,e);var t=R(n);function n(){return _(this,n),t.apply(this,arguments)}return x(n,[{key:"getServiceConstructor",value:function(){return AU}}]),n}(EN);var wU,kU=function(e){return void 0===e},OU=(E(wU={},e.BlendType.additive,{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE,srcAlpha:1,dstAlpha:1}}),E(wU,e.BlendType.none,{enable:!1}),E(wU,e.BlendType.normal,{enable:!0,func:{srcRGB:e.gl.SRC_ALPHA,dstRGB:e.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),E(wU,e.BlendType.subtractive,{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE,srcAlpha:e.gl.ZERO,dstAlpha:e.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:e.gl.FUNC_SUBTRACT,alpha:e.gl.FUNC_SUBTRACT}}),E(wU,e.BlendType.max,{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE},equation:{rgb:e.gl.MAX_EXT}}),E(wU,e.BlendType.min,{enable:!0,func:{srcRGB:e.gl.ONE,dstRGB:e.gl.ONE},equation:{rgb:e.gl.MIN_EXT}}),wU);var PU=function(e){return"number"==typeof e||yy(e)&&"[object Number]"==vm(e)};function RU(e,t,n,r,i){t.updateStyleAttribute(e,n,r,i)}function LU(e,t){e.opacity&&IU("opacity",t,e.opacity),e.strokeWidth&&IU("strokeWidth",t,e.strokeWidth),e.strokeOpacity&&IU("strokeOpacity",t,e.strokeOpacity),e.stroke&&function(e,t,n){g_(n)?RU(e,t,n,void 0):Cy(n)&&2===n.length&&(g_(n[0])&&mm(n[1])||g_(n[0])&&Cy(n[1])&&n[1].length>0)?RU(e,t,n[0],n[1]):RU(e,t,"#fff",void 0)}("stroke",t,e.stroke),e.offsets&&NU("offsets",t,e.offsets),e.textOffset&&NU("textOffset",t,e.textOffset),e.thetaOffset&&IU("thetaOffset",t,e.thetaOffset)}function IU(e,t,n){g_(n)?RU(e,t,n,(function(e){return e})):PU(n)?RU(e,t,[n],void 0):Cy(n)&&2===n.length&&(g_(n[0])&&mm(n[1])||g_(n[0])&&Cy(n[1])&&PU(n[1][0])&&PU(n[1][1]))?RU(e,t,n[0],n[1]):RU(e,t,[1],void 0)}function NU(e,t,n){g_(n)?RU(e,t,n,(function(e){return e})):Cy(n)&&2===n.length&&g_(n[0])&&mm(n[1])?RU(e,t,n[0],n[1]):Cy(n)&&2===n.length&&PU(n[0])&&PU(n[1])?RU(e,t,n,void 0):RU(e,t,[0,0],void 0)}function DU(e){return e.map((function(e){return"string"==typeof e&&(e=[e,{}]),e}))}function FU(e,t,n,r){var i=e.multiPassRenderer,a=e.getLayerConfig();a.enablePicking;return a.enableTAA?i.add(r("taa")):i.add(r("render")),DU(t).forEach((function(e){var t=N(e,2),r=t[0],a=t[1];i.add(n(r),a)})),i.add(n("copy")),i}var BU=Nn.includes;er({target:"Array",proto:!0},{includes:function(e){return BU(this,e,arguments.length>1?arguments[1]:void 0)}}),Hs("includes");var UU=Z.TypeError,zU=function(e){if(rs(e))throw UU("The method doesn't accept regular expressions");return e},jU=Pe("match"),VU=ae("".indexOf);er({target:"String",proto:!0,forced:!function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[jU]=!1,"/./"[e](t)}catch(e){}}return!1}("includes")},{includes:function(e){return!!~VU(Ia(se(this)),Ia(zU(e)),arguments.length>1?arguments[1]:void 0)}});var GU=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];var HU,WU,XU,YU=["passes"],ZU=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],qU=0,KU=(HU=AP(YE.IGlobalConfigService),XU=j((WU=function(t){S(a,t);var n,r,i=R(a);function a(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _(this,a),E(O(e=i.call(this)),"id","".concat(qU++)),E(O(e),"name","".concat(qU)),E(O(e),"type",void 0),E(O(e),"visible",!0),E(O(e),"zIndex",0),E(O(e),"minZoom",void 0),E(O(e),"maxZoom",void 0),E(O(e),"inited",!1),E(O(e),"layerModelNeedUpdate",!1),E(O(e),"pickedFeatureID",null),E(O(e),"selectedFeatureID",null),E(O(e),"styleNeedUpdate",!1),E(O(e),"rendering",void 0),E(O(e),"clusterZoom",0),E(O(e),"layerType",void 0),E(O(e),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),E(O(e),"hooks",{init:new Ub,afterInit:new Ub,beforeRender:new Ub,beforeRenderData:new Bb,afterRender:new Lb,beforePickingEncode:new Lb,afterPickingEncode:new Lb,beforeHighlight:new Lb(["pickedColor"]),afterHighlight:new Lb,beforeSelect:new Lb(["pickedColor"]),afterSelect:new Lb,beforeDestroy:new Lb,afterDestroy:new Lb}),E(O(e),"models",[]),E(O(e),"multiPassRenderer",void 0),E(O(e),"plugins",void 0),E(O(e),"sourceOption",void 0),E(O(e),"layerModel",void 0),E(O(e),"shapeOption",void 0),E(O(e),"sceneContainer",void 0),E(O(e),"layerChildren",[]),z(O(e),"configService",XU,O(e)),E(O(e),"shaderModuleService",void 0),E(O(e),"cameraService",void 0),E(O(e),"coordinateService",void 0),E(O(e),"iconService",void 0),E(O(e),"fontService",void 0),E(O(e),"pickingService",void 0),E(O(e),"rendererService",void 0),E(O(e),"layerService",void 0),E(O(e),"interactionService",void 0),E(O(e),"mapService",void 0),E(O(e),"styleAttributeService",void 0),E(O(e),"layerSource",void 0),E(O(e),"postProcessingPassFactory",void 0),E(O(e),"normalPassFactory",void 0),E(O(e),"animateOptions",{enable:!1}),E(O(e),"container",void 0),E(O(e),"encodedData",void 0),E(O(e),"configSchema",void 0),E(O(e),"currentPickId",null),E(O(e),"rawConfig",void 0),E(O(e),"needUpdateConfig",void 0),E(O(e),"pendingStyleAttributes",[]),E(O(e),"scaleOptions",{}),E(O(e),"animateStartTime",void 0),E(O(e),"aniamateStatus",!1),E(O(e),"bottomColor","rgba(0, 0, 0, 0)"),E(O(e),"isDestroied",!1),E(O(e),"sourceEvent",(function(){e.dataState.dataSourceNeedUpdate=!0;var t=e.getLayerConfig(),n=t.autoFit,r=t.fitBoundsOptions;n&&e.fitBounds(r),e.emit("dataUpdate"),e.reRender()})),e.name=t.name||e.id,e.zIndex=t.zIndex||0,e.rawConfig=t,e}return x(a,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(e){if(this.inited){var t=this.container.get(YE.SceneID);LU(e,this),this.configService.setLayerConfig(t,this.id,v(v(v({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),e)),this.needUpdateConfig={}}else this.needUpdateConfig=v(v({},this.needUpdateConfig),e)}},{key:"setContainer",value:function(e,t){this.container=e,this.sceneContainer=t}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(e){this.bottomColor=e}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(e){return this.plugins.push(e),this}},{key:"init",value:function(){var e=this,t=this.container.get(YE.SceneID);this.configService.setLayerConfig(t,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(YE.IIconService),this.fontService=this.container.get(YE.IFontService),this.rendererService=this.container.get(YE.IRendererService),this.layerService=this.container.get(YE.ILayerService),this.interactionService=this.container.get(YE.IInteractionService),this.pickingService=this.container.get(YE.IPickingService),this.mapService=this.container.get(YE.IMapService);var n=this.getLayerConfig(),r=n.enableMultiPassRenderer,i=n.passes;r&&null!=i&&i.length&&i.length>0&&this.mapService.on("mapAfterFrameChange",(function(){e.renderLayers()})),this.cameraService=this.container.get(YE.ICameraService),this.coordinateService=this.container.get(YE.ICoordinateSystemService),this.shaderModuleService=this.container.get(YE.IShaderModuleService),this.postProcessingPassFactory=this.container.get(YE.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(YE.IFactoryNormalPass),this.styleAttributeService=this.container.get(YE.IStyleAttributeService),this.multiPassRenderer=this.container.get(YE.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach((function(t){var n=t.attributeName,r=t.attributeField,i=t.attributeValues,a=t.updateOptions;e.styleAttributeService.updateStyleAttribute(n,{scale:v({field:r},e.splitValuesAndCallbackInAttribute(i,e.getLayerConfig()[n]))},a)})),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(YE.ILayerPlugin);var a,o=U(this.plugins);try{for(o.s();!(a=o.n()).done;){a.value.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(e){o.e(e)}finally{o.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(v(v({},this.getDefaultConfig()),this.rawConfig));var e=this.getLayerConfig().animateOption;null!=e&&e.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(e,t,n){return this.updateStyleAttribute("color",e,t,n),this}},{key:"texture",value:function(e,t,n){return this.updateStyleAttribute("texture",e,t,n),this}},{key:"rotate",value:function(e,t,n){return this.updateStyleAttribute("rotate",e,t,n),this}},{key:"size",value:function(e,t,n){return this.updateStyleAttribute("size",e,t,n),this}},{key:"filter",value:function(e,t,n){return this.updateStyleAttribute("filter",e,t,n),this}},{key:"shape",value:function(e,t,n){var r,i,a,o=null===(r=this.styleAttributeService)||void 0===r||null===(i=r.getLayerStyleAttribute("shape"))||void 0===i||null===(a=i.scale)||void 0===a?void 0:a.field,s=e;return this.shapeOption={field:e,values:t},this.updateStyleAttribute("shape",e,t,n),function(e,t,n){"string"==typeof t&&"string"==typeof n&&t!==n&&GU.map((function(r){r.includes(t)&&r.includes(n)&&(e.dataState.dataSourceNeedUpdate=!0)}))}(this,o,s),this}},{key:"label",value:function(e,t,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:e,attributeValues:t,updateOptions:n}),this}},{key:"animate",value:function(e){var t={};return gm(e)?(t.enable=!0,t=v(v({},t),e)):t.enable=e,this.updateLayerConfig({animateOption:t}),this}},{key:"source",value:function(e,t){return null!=e&&e.data?(this.setSource(e),this):(this.sourceOption={data:e,options:t},this.clusterZoom=0,this)}},{key:"setData",value:function(e,t){var n=this;return this.inited?this.layerSource.setData(e,t):this.on("inited",(function(){n.layerSource.setData(e,t)})),this}},{key:"style",value:function(e){var t=this,n=e.passes,r=k(e,YU);return n&&DU(n).forEach((function(e){var n=t.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(e[0]);n&&n.updateOptions(e[1])})),this.rawConfig=v(v({},this.rawConfig),r),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(e,t){return gm(e)?this.scaleOptions=v(v({},this.scaleOptions),e):this.scaleOptions[e]=t,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return 0!==this.getEncodedData().length&&this.renderModels(),this}},{key:"renderMultiPass",value:(r=y(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.getEncodedData().length){e.next=7;break}if(!this.multiPassRenderer||!this.multiPassRenderer.getRenderFlag()){e.next=6;break}return e.next=4,this.multiPassRenderer.render();case 4:e.next=7;break;case 6:this.multiPassRenderer,this.renderModels();case 7:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"active",value:function(e){var t={};return t.enableHighlight=!!gm(e)||e,gm(e)?(t.enableHighlight=!0,e.color&&(t.highlightColor=e.color),e.mix&&(t.activeMix=e.mix)):t.enableHighlight=!!e,this.updateLayerConfig(t),this}},{key:"setActive",value:function(e,t){var n=this;if(gm(e)){var r=e.x,i=void 0===r?0:r,a=e.y,o=void 0===a?0:a;this.updateLayerConfig({highlightColor:gm(t)?t.color:this.getLayerConfig().highlightColor,activeMix:gm(t)?t.mix:this.getLayerConfig().activeMix}),this.pick({x:i,y:o})}else this.updateLayerConfig({pickedFeatureID:e,highlightColor:gm(t)?t.color:this.getLayerConfig().highlightColor,activeMix:gm(t)?t.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(mg(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"select",value:function(e){var t={};return t.enableSelect=!!gm(e)||e,gm(e)?(t.enableSelect=!0,e.color&&(t.selectColor=e.color),e.mix&&(t.selectMix=e.mix)):t.enableSelect=!!e,this.updateLayerConfig(t),this}},{key:"setSelect",value:function(e,t){var n=this;if(gm(e)){var r=e.x,i=void 0===r?0:r,a=e.y,o=void 0===a?0:a;this.updateLayerConfig({selectColor:gm(t)?t.color:this.getLayerConfig().selectColor,selectMix:gm(t)?t.mix:this.getLayerConfig().selectMix}),this.pick({x:i,y:o})}else this.updateLayerConfig({pickedFeatureID:e,selectColor:gm(t)?t.color:this.getLayerConfig().selectColor,selectMix:gm(t)?t.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(mg(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"setBlend",value:function(e){return this.updateLayerConfig({blend:e}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(e){return this.zIndex=e,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(e){this.currentPickId=e}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(e){this.selectedFeatureID=e}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var e=this.mapService.getZoom(),t=this.getLayerConfig(),n=t.visible,r=t.minZoom,i=void 0===r?-1/0:r,a=t.maxZoom;return!!n&&e>=i&&e<=(void 0===a?1/0:a)}},{key:"setMultiPass",value:function(e,t){if(this.updateLayerConfig({enableMultiPassRenderer:e}),t&&this.updateLayerConfig({passes:t}),e){var n=this.getLayerConfig().passes,r=void 0===n?[]:n;this.multiPassRenderer=FU(this,r,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var i=this.rendererService.getViewportSize(),a=i.width,o=i.height;this.multiPassRenderer.resize(a,o)}return this}},{key:"setMinZoom",value:function(e){return this.updateLayerConfig({minZoom:e}),this}},{key:"getMinZoom",value:function(){return this.getLayerConfig().minZoom}},{key:"getMaxZoom",value:function(){return this.getLayerConfig().maxZoom}},{key:"get",value:function(e){return this.getLayerConfig()[e]}},{key:"setMaxZoom",value:function(e){return this.updateLayerConfig({maxZoom:e}),this}},{key:"setAutoFit",value:function(e){return this.updateLayerConfig({autoFit:e}),this}},{key:"fitBounds",value:function(e){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var t=this.getSource().extent;return t.some((function(e){return Math.abs(e)===1/0}))||this.mapService.fitBounds([[t[0],t[1]],[t[2],t[3]]],e),this}},{key:"destroy",value:function(){this.isDestroied||(this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach((function(e){return e.destroy()})),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter((function(e){return e.needRescale||e.needRemapping||e.needRegenerateVertices})).length}},{key:"setSource",value:function(e){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=e,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var t=this.mapService.getZoom();this.layerSource.updateClusterData(t)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(e){this.encodedData=e}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(e){return this.styleAttributeService.getLayerAttributeScale(e)}},{key:"getLegendItems",value:function(e){var t=this.styleAttributeService.getLayerAttributeScale(e);return t?t.invertExtent?t.range().map((function(n){return E({value:t.invertExtent(n)},e,n)})):t.ticks?t.ticks().map((function(n){return E({value:n},e,t(n))})):null!=t&&t.domain?t.domain().filter((function(e){return!kU(e)})).map((function(n){return E({value:n},e,t(n))})):[]:[]}},{key:"pick",value:function(e){var t=e.x,n=e.y;this.interactionService.triggerHover({x:t,y:n})}},{key:"boxSelect",value:function(e,t){this.pickingService.boxPickLayer(this,e,t)}},{key:"buildLayerModel",value:function(t){var n=t.moduleName,r=t.vertexShader,i=t.fragmentShader,a=t.triangulation,o=t.segmentNumber,s=k(t,ZU);this.shaderModuleService.registerModule(n,{vs:r,fs:i});var u=this.shaderModuleService.getModule(n),l=u.vs,c=u.fs,h=u.uniforms,f=this.rendererService.createModel,p=this.styleAttributeService.createAttributesAndIndices(this.encodedData,a,o);return f(v({attributes:p.attributes,uniforms:h,fs:c,vs:l,elements:p.elements,blend:OU[e.BlendType.normal]},s))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(e){var t=this.getLayerConfig(),n=t.enableHighlight,r=void 0===n||n,i=t.enableSelect,a=void 0===i||i,o=-1!==this.eventNames().indexOf(e)||-1!==this.eventNames().indexOf("un"+e);return"click"!==e&&"dblclick"!==e||!a||(o=!0),"mousemove"!==e||!r&&-1===this.eventNames().indexOf("mouseenter")&&-1===this.eventNames().indexOf("unmousemove")&&-1===this.eventNames().indexOf("mouseout")||(o=!0),this.isVisible()&&o}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:(n=y(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.render();case 2:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"renderModels",value:function(e){var t=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach((function(n){n.draw({uniforms:t.layerModel.getUninforms()},e)}))),this}},{key:"updateStyleAttribute",value:function(e,t,n,r){this.inited?this.styleAttributeService.updateStyleAttribute(e,{scale:v({field:t},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[t]))},r):this.pendingStyleAttributes.push({attributeName:e,attributeField:t,attributeValues:n,updateOptions:r})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(e){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(e,t){return{values:mm(e)?void 0:e||t,callback:mm(e)?e:void 0}}}]),a}(jb)).prototype,"configService",[HU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WU);var QU=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1};var JU=function(e,t,n,r,i,a){var o=1&n,s=e.length,u=t.length;if(s!=u&&!(o&&u>s))return!1;var l=a.get(e),c=a.get(t);if(l&&c)return l==t&&c==e;var h=-1,f=!0,p=2&n?new ek:void 0;for(a.set(e,t),a.set(t,e);++h<s;){var d=e[h],v=t[h];if(r)var g=o?r(v,d,h,t,e,a):r(d,v,h,e,t,a);if(void 0!==g){if(g)continue;f=!1;break}if(p){if(!QU(t,(function(e,t){if(!sk(p,t)&&(d===e||i(d,e,n,r,a)))return p.push(t)}))){f=!1;break}}else if(d!==v&&!i(d,v,n,r,a)){f=!1;break}}return a.delete(e),a.delete(t),f};var $U=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n},ez=om?om.prototype:void 0,tz=ez?ez.valueOf:void 0;var nz=function(e,t,n,r,i,a,o){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new oy(e),new oy(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Hg(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=$U;case"[object Set]":var u=1&r;if(s||(s=lk),e.size!=t.size&&!u)return!1;var l=o.get(e);if(l)return l==t;r|=2,o.set(e,t);var c=JU(s(e),s(t),r,i,a,o);return o.delete(e),c;case"[object Symbol]":if(tz)return tz.call(e)==tz.call(t)}return!1},rz=Object.prototype.hasOwnProperty;var iz=function(e,t,n,r,i,a){var o=1&n,s=I_(e),u=s.length;if(u!=I_(t).length&&!o)return!1;for(var l=u;l--;){var c=s[l];if(!(o?c in t:rz.call(t,c)))return!1}var h=a.get(e),f=a.get(t);if(h&&f)return h==t&&f==e;var p=!0;a.set(e,t),a.set(t,e);for(var d=o;++l<u;){var v=e[c=s[l]],g=t[c];if(r)var m=o?r(g,v,c,t,e,a):r(v,g,c,e,t,a);if(!(void 0===m?v===g||i(v,g,n,r,a):m)){p=!1;break}d||(d="constructor"==c)}if(p&&!d){var y=e.constructor,_=t.constructor;y==_||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof _&&_ instanceof _||(p=!1)}return a.delete(e),a.delete(t),p},az=Object.prototype.hasOwnProperty;var oz=function(e,t,n,r,i,a){var o=Cy(e),s=Cy(t),u=o?"[object Array]":X_(e),l=s?"[object Array]":X_(t),c="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),h="[object Object]"==(l="[object Arguments]"==l?"[object Object]":l),f=u==l;if(f&&ky(e)){if(!ky(t))return!1;o=!0,c=!1}if(f&&!c)return a||(a=new ey),o||jy(e)?JU(e,t,n,r,i,a):nz(e,t,u,n,r,i,a);if(!(1&n)){var p=c&&az.call(e,"__wrapped__"),d=h&&az.call(t,"__wrapped__");if(p||d){var v=p?e.value():e,g=d?t.value():t;return a||(a=new ey),i(v,g,n,r,a)}}return!!f&&(a||(a=new ey),iz(e,t,n,r,i,a))};var sz=function e(t,n,r,i,a){return t===n||(null==t||null==n||!yy(t)&&!yy(n)?t!=t&&n!=n:oz(t,n,r,i,e,a))};var uz,lz,cz,hz,fz,pz=function(e,t){return sz(e,t)},dz=(uz=AP(YE.IGlobalConfigService),cz=j((lz=function(){function t(n){_(this,t),E(this,"triangulation",void 0),E(this,"createTexture2D",void 0),E(this,"layer",void 0),E(this,"dataTexture",void 0),E(this,"DATA_TEXTURE_WIDTH",void 0),E(this,"rowCount",void 0),E(this,"cacheStyleProperties",void 0),E(this,"cellLength",void 0),E(this,"cellProperties",void 0),E(this,"cellTypeLayout",void 0),E(this,"stylePropertyesExist",void 0),E(this,"dataTextureTest",void 0),z(this,"configService",cz,this),E(this,"shaderModuleService",void 0),E(this,"rendererService",void 0),E(this,"iconService",void 0),E(this,"fontService",void 0),E(this,"styleAttributeService",void 0),E(this,"mapService",void 0),E(this,"cameraService",void 0),E(this,"layerService",void 0),this.layer=n,this.rendererService=n.getContainer().get(YE.IRendererService),this.shaderModuleService=n.getContainer().get(YE.IShaderModuleService),this.styleAttributeService=n.getContainer().get(YE.IStyleAttributeService),this.mapService=n.getContainer().get(YE.IMapService),this.iconService=n.getContainer().get(YE.IIconService),this.fontService=n.getContainer().get(YE.IFontService),this.cameraService=n.getContainer().get(YE.ICameraService),this.layerService=n.getContainer().get(YE.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:e.gl.NEAREST,min:e.gl.NEAREST,width:1,height:1}))}return x(t,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(e){var t=!1;return pz(e.thetaOffset,this.cacheStyleProperties.thetaOffset)||(t=!0,this.cacheStyleProperties.thetaOffset=e.thetaOffset),pz(e.opacity,this.cacheStyleProperties.opacity)||(t=!0,this.cacheStyleProperties.opacity=e.opacity),pz(e.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(t=!0,this.cacheStyleProperties.strokeOpacity=e.strokeOpacity),pz(e.strokeWidth,this.cacheStyleProperties.strokeWidth)||(t=!0,this.cacheStyleProperties.strokeWidth=e.strokeWidth),pz(e.stroke,this.cacheStyleProperties.stroke)||(t=!0,this.cacheStyleProperties.stroke=e.stroke),pz(e.offsets,this.cacheStyleProperties.offsets)||(t=!0,this.cacheStyleProperties.offsets=e.offsets),void 0===this.dataTexture&&(t=!0),t}},{key:"judgeStyleAttributes",value:function(e){this.clearLastCalRes(),void 0===e.opacity||PU(e.opacity)||(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),void 0===e.strokeOpacity||PU(e.strokeOpacity)||(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),void 0===e.strokeWidth||PU(e.strokeWidth)||(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),void 0===e.stroke||this.isStaticColor(e.stroke)||(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),void 0===e.offsets||this.isOffsetStatic(e.offsets)||(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),void 0===e.thetaOffset||PU(e.thetaOffset)||(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(e){return!!g_(e)&&!!tg(e)}},{key:"getStrokeColor",value:function(e){if(this.isStaticColor(e)){var t=vg(e);return t[0]=t[0]?t[0]:0,t[1]=t[1]?t[1]:0,t[2]=t[2]?t[2]:0,t[3]=t[3]?t[3]:0,t}return[0,0,0,0]}},{key:"isOffsetStatic",value:function(e){return!!(Cy(e)&&2===e.length&&PU(e[0])&&PU(e[1]))}},{key:"patchMod",value:function(e,t){for(var n=0;n<t;n++)e.push(-1)}},{key:"patchData",value:function(e,t,n){var r,i=U(n);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=a.attr,s=a.count,u=t[o];void 0!==u?"stroke"===o?e.push.apply(e,D(vg(u))):"offsets"===o?this.isOffsetStatic(u)?e.push(-u[0],u[1]):e.push(0,0):e.push(PU(u)?u:1):this.patchMod(e,s)}}catch(e){i.e(e)}finally{i.f()}}},{key:"calDataFrame",value:function(e,t,n){for(var r=t.length,i=Math.ceil(r*e/this.DATA_TEXTURE_WIDTH),a=i*this.DATA_TEXTURE_WIDTH,o=[],s=0;s<r;s++){var u=t[s];this.patchData(o,u,n)}for(var l=o.length;l<a;l++)o.push(-1);return{data:o,width:this.DATA_TEXTURE_WIDTH,height:i}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig().blend,n=void 0===t?"normal":t;return OU[e.BlendType[n]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.duration||4,e.interval||.2,e.trailLength||.1]}},{key:"startModelAnimate",value:function(){this.layer.getLayerConfig().animateOption.enable&&this.layer.setAnimateStartTime()}}]),t}()).prototype,"configService",[uz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lz);!function(e){e[e.solid=0]="solid",e[e.dash=1]="dash"}(hz||(hz={})),function(e){e.ALWAYS="always",e.DRAGEND="dragend"}(fz||(fz={}));var vz={canvas:function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"updateMode",fz.ALWAYS),E(O(e),"canvas",void 0),E(O(e),"ctx",void 0),E(O(e),"prevSize",void 0),E(O(e),"renderUpdate",(function(){var t=e.layer.getLayerConfig(),n=t.zIndex,r=void 0===n?10:n,i=t.update,a=void 0===i?fz.ALWAYS:i,o=t.animateOption,s=void 0===o?{enable:!1,duration:20}:o;+e.canvas.style.zIndex===r&&(e.canvas.style.zIndex=r+""),e.updateMode!==a&&(e.updateMode=a,e.unBindListener(),e.bindListener()),e.updateMode===fz.ALWAYS&&s.enable&&e.renderCanvas()})),E(O(e),"unBindListener",(function(){e.mapService.off("mapchange",e.renderCanvas),e.mapService.off("zoomstart",e.clearCanvas),e.mapService.off("zoomend",e.renderCanvas),e.mapService.off("movestart",e.clearCanvas),e.mapService.off("moveend",e.renderCanvas)})),E(O(e),"bindListener",(function(){e.updateMode===fz.ALWAYS?e.mapService.on("mapchange",e.renderCanvas):(e.mapService.on("zoomstart",e.clearCanvas),e.mapService.on("zoomend",e.renderCanvas),e.mapService.on("movestart",e.clearCanvas),e.mapService.on("moveend",e.renderCanvas))})),E(O(e),"clearCanvas",(function(){if(e.ctx){var t=e.rendererService.getViewportSize(),n=t.width,r=t.height;e.ctx.clearRect(0,0,n,r)}})),E(O(e),"renderCanvas",(function(){var t=e.rendererService.getViewportSize(),n=t.width,r=t.height;if(e.prevSize[0]!==n||e.prevSize[1]!==r){e.prevSize=[n,r];var i=N(e.mapService.getSize(),2),a=i[0],o=i[1];e.canvas.width=n,e.canvas.height=r,e.canvas.style.width=a+"px",e.canvas.style.height=o+"px"}var s=e.layer.getLayerConfig().drawingOnCanvas;e.ctx&&s({canvas:e.canvas,ctx:e.ctx,mapService:e.mapService,size:[n,r]})})),e}return x(n,[{key:"clearModels",value:function(){this.canvas&&(document.removeChild(this.canvas),this.canvas=null),this.unBindListener()}},{key:"initModels",value:function(){var e=this.layer.getLayerConfig().update,t=void 0===e?fz.ALWAYS:e;return this.updateMode=t,this.initCanvas(),this.renderCanvas(),this.bindListener(),this.mapService.getContainer(),[]}},{key:"initCanvas",value:function(){var e,t=this.layer.getLayerConfig().zIndex,n=N(this.mapService.getSize(),2),r=n[0],i=n[1],a=this.rendererService.getViewportSize(),o=a.width,s=a.height;this.prevSize=[o,s];var u=document.createElement("canvas");this.canvas=u,u.width=o,u.height=s,u.style.pointerEvents="none",u.style.width=r+"px",u.style.height=i+"px",u.style.position="absolute",u.style.top="0",u.style.left="0",u.style.zIndex=t+"",null===(e=this.mapService.getContainer())||void 0===e||e.appendChild(u);var l=u.getContext("2d");this.ctx=l}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){}}]),n}(dz)},gz=function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"type","CanvasLayer"),e}return x(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new vz[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{canvas:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"canvas"}}]),n}(KU),mz=_z,yz=_z;function _z(e,t,n){n=n||2;var r,i,a,o,s,u,l,c=t&&t.length,h=c?t[0]*n:e.length,f=bz(e,0,h,n,!0),p=[];if(!f||f.next===f.prev)return p;if(c&&(f=function(e,t,n,r){var i,a,o,s,u,l=[];for(i=0,a=t.length;i<a;i++)o=t[i]*r,s=i<a-1?t[i+1]*r:e.length,(u=bz(e,o,s,r,!1))===u.next&&(u.steiner=!0),l.push(Pz(u));for(l.sort(Mz),i=0;i<l.length;i++)n=xz(n=wz(l[i],n),n.next);return n}(e,t,f,n)),e.length>80*n){r=a=e[0],i=o=e[1];for(var d=n;d<h;d+=n)(s=e[d])<r&&(r=s),(u=e[d+1])<i&&(i=u),s>a&&(a=s),u>o&&(o=u);l=0!==(l=Math.max(a-r,o-i))?1/l:0}return Ez(f,p,n,r,i,l),p}function bz(e,t,n,r,i){var a,o;if(i===Hz(e,t,n,r)>0)for(a=t;a<n;a+=r)o=jz(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=jz(a,e[a],e[a+1],o);return o&&Nz(o,o.next)&&(Vz(o),o=o.next),o}function xz(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!Nz(r,r.next)&&0!==Iz(r.prev,r,r.next))r=r.next;else{if(Vz(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function Ez(e,t,n,r,i,a,o){if(e){!o&&a&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=Oz(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,a,o,s,u,l=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<l&&(s++,r=r.nextZ);t++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,l*=2}while(o>1)}(i)}(e,r,i,a);for(var s,u,l=e;e.prev!==e.next;)if(s=e.prev,u=e.next,a?Cz(e,r,i,a):Sz(e))t.push(s.i/n),t.push(e.i/n),t.push(u.i/n),Vz(e),e=u.next,l=u.next;else if((e=u)===l){o?1===o?Ez(e=Tz(xz(e),t,n),t,n,r,i,a,2):2===o&&Az(e,t,n,r,i,a):Ez(xz(e),t,n,r,i,a,1);break}}}function Sz(e){var t=e.prev,n=e,r=e.next;if(Iz(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(Rz(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Iz(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Cz(e,t,n,r){var i=e.prev,a=e,o=e.next;if(Iz(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,u=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,l=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,c=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,h=Oz(s,u,t,n,r),f=Oz(l,c,t,n,r),p=e.prevZ,d=e.nextZ;p&&p.z>=h&&d&&d.z<=f;){if(p!==e.prev&&p!==e.next&&Rz(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&Iz(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,d!==e.prev&&d!==e.next&&Rz(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&Iz(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&Rz(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&Iz(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;d&&d.z<=f;){if(d!==e.prev&&d!==e.next&&Rz(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&Iz(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function Tz(e,t,n){var r=e;do{var i=r.prev,a=r.next.next;!Nz(i,a)&&Dz(i,r,r.next,a)&&Uz(i,a)&&Uz(a,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(a.i/n),Vz(r),Vz(r.next),r=e=a),r=r.next}while(r!==e);return xz(r)}function Az(e,t,n,r,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Lz(o,s)){var u=zz(o,s);return o=xz(o,o.next),u=xz(u,u.next),Ez(o,t,n,r,i,a),void Ez(u,t,n,r,i,a)}s=s.next}o=o.next}while(o!==e)}function Mz(e,t){return e.x-t.x}function wz(e,t){var n=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===o)return n;var u,l=n,c=n.x,h=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&Rz(a<h?i:o,a,c,h,a<h?o:i,a,r.x,r.y)&&(u=Math.abs(a-r.y)/(i-r.x),Uz(r,e)&&(u<f||u===f&&(r.x>n.x||r.x===n.x&&kz(n,r)))&&(n=r,f=u)),r=r.next}while(r!==l);return n}(e,t);if(!n)return t;var r=zz(n,e),i=xz(n,n.next);return xz(r,r.next),t===n?i:t}function kz(e,t){return Iz(e.prev,e,t.prev)<0&&Iz(t.next,e,e.next)<0}function Oz(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Pz(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Rz(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function Lz(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Dz(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Uz(e,t)&&Uz(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Iz(e.prev,e,t.prev)||Iz(e,t.prev,t))||Nz(e,t)&&Iz(e.prev,e,e.next)>0&&Iz(t.prev,t,t.next)>0)}function Iz(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Nz(e,t){return e.x===t.x&&e.y===t.y}function Dz(e,t,n,r){var i=Bz(Iz(e,t,n)),a=Bz(Iz(e,t,r)),o=Bz(Iz(n,r,e)),s=Bz(Iz(n,r,t));return i!==a&&o!==s||(!(0!==i||!Fz(e,n,t))||(!(0!==a||!Fz(e,r,t))||(!(0!==o||!Fz(n,e,r))||!(0!==s||!Fz(n,t,r)))))}function Fz(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Bz(e){return e>0?1:e<0?-1:0}function Uz(e,t){return Iz(e.prev,e,e.next)<0?Iz(e,t,e.next)>=0&&Iz(e,e.prev,t)>=0:Iz(e,t,e.prev)<0||Iz(e,e.next,t)<0}function zz(e,t){var n=new Gz(e.i,e.x,e.y),r=new Gz(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function jz(e,t,n,r){var i=new Gz(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Vz(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Gz(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Hz(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}_z.deviation=function(e,t,n,r){var i=t&&t.length,a=i?t[0]*n:e.length,o=Math.abs(Hz(e,0,a,n));if(i)for(var s=0,u=t.length;s<u;s++){var l=t[s]*n,c=s<u-1?t[s+1]*n:e.length;o-=Math.abs(Hz(e,l,c,n))}var h=0;for(s=0;s<r.length;s+=3){var f=r[s]*n,p=r[s+1]*n,d=r[s+2]*n;h+=Math.abs((e[f]-e[d])*(e[p+1]-e[f+1])-(e[f]-e[p])*(e[d+1]-e[f+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},_z.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<t;o++)n.vertices.push(e[i][a][o]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n},mz.default=yz;function Wz(e){return e/180*Math.acos(-1)}function Xz(e){var t=Wz(e[0])+Math.PI/2,n=Wz(e[1]),r=100+.4*Math.random(),i=r*Math.cos(n)*Math.cos(t);return[r*Math.cos(n)*Math.sin(t),r*Math.sin(n),i]}function Yz(e,t){var n=IT(),r=IT(),i=oA(0,1,0),a=oA(0,0,0);e=void 0!==e?e:1;for(var o=2+(void 0!==(t=t||{}).segments?t.segments:32),s=2*o,u=[],l=[],c=[],h=[],f=[],p=[],d=0;d<=o;d++){for(var v=d/o,g=v*Math.PI,m=0;m<=s;m++){var y=m/s,_=y*Math.PI*2;FT(r),HT(r,r,-g),FT(n),GT(n,n,_),yA(a,i,r),yA(a,a,n),cA(a,a,-e),c.push(a.slice()),h.push.apply(h,D(a.slice())),vA(a,a),f.push.apply(f,D(a.slice())),p.push([y,1-v]),h.push(y,1-v)}if(d>0)for(var b=c.length,x=b-2*(s+1);x+s+2<b;x++)u.push([x,x+1,x+s+1]),l.push(x,x+1,x+s+1),u.push([x+s+1,x+1,x+s+2]),l.push(x+s+1,x+1,x+s+2)}return{cells:u,positions:c,uvs:p,positionsArr:h,indicesArr:l,normalArr:f}}var Zz=LA(),qz=(LA(),LA()),Kz=LA(),Qz=LA();function Jz(e,t,n,r,i){return DA(e,n,r),BA(e,e),[i/UA(t=IA(-e[1],e[0]),IA(-n[1],n[0])),t]}function $z(e,t){return function(e,t,n){return e[0]=t,e[1]=n,e}(e,-t[1],t[0])}function ej(e,t,n){return XA(e,t,n),BA(e,e),e}function tj(e,t){return e[0]===t[0]&&e[1]===t[1]}var nj,rj,ij,aj=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_(this,e),E(this,"complex",void 0),E(this,"join",void 0),E(this,"cap",void 0),E(this,"miterLimit",void 0),E(this,"thickness",void 0),E(this,"normal",void 0),E(this,"lastFlip",-1),E(this,"miter",IA(0,0)),E(this,"started",!1),E(this,"dash",!1),E(this,"totalDistance",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return x(e,[{key:"extrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,a=1;a<r;a++){var o,s,u,l=e[a-1];l.push(null!==(o=t[a-1][2])&&void 0!==o?o:0);var c=t[a-1],h=e[a];h.push(null!==(s=t[a][2])&&void 0!==s?s:0);var f=t[a],p=a<e.length-1?[].concat(D(e[a+1]),[null!==(u=t[a+1][2])&&void 0!==u?u:0]):null,d=a<t.length-1?t[a+1]:null;i+=this.segment_gaode2(n,i,l,h,p,c,f,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(e,t){var n=this.complex;if(e.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=e.length,i=n.startIndex,a=1;a<r;a++){var o,s,u,l=e[a-1];l.push(null!==(o=t[a-1][2])&&void 0!==o?o:0);var c=t[a-1],h=e[a];h.push(null!==(s=t[a][2])&&void 0!==s?s:0);var f=t[a],p=a<e.length-1?[].concat(D(e[a+1]),[null!==(u=t[a+1][2])&&void 0!==u?u:0]):null,d=a<t.length-1?t[a+1]:null;i+=this.simpleSegment(n,i,l,h,p,c,f,d)}if(this.dash)for(var v=0;v<n.positions.length/6;v++)n.positions[6*v+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var a=e[i-1],o=e[i],s=i<e.length-1?e[i+1]:null;r+=this.segment(t,r,a,o,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleExtrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var a=e[i-1],o=e[i],s=i<e.length-1?e[i+1]:null;r+=this.simpleSegment(t,r,a,o,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"segment_gaode2",value:function(e,t,n,r,i,a,o,s){var u=0,l=e.indices,c=e.positions,h=e.normals,f="square"===this.cap,p="bevel"===this.join,d=Mv([o[0],o[1]]),v=Mv([a[0],a[1]]);ej(qz,r,n);var g=0;if(this.dash&&(g=this.lineSegmentDistance(d,v),this.totalDistance+=g),this.normal||(this.normal=LA(),$z(this.normal,qz)),!this.started)if(this.started=!0,f){var m=LA(),y=LA();DA(m,this.normal,qz),DA(y,this.normal,qz),h.push(y[0],y[1],0),h.push(m[0],m[1],0),c.push(n[0],n[1],0|n[2],this.totalDistance-g,-this.thickness,0|n[2]),c.push(n[0],n[1],0|n[2],this.totalDistance-g,this.thickness,0|n[2])}else this.extrusions(c,h,n,this.normal,this.thickness,this.totalDistance-g);if(l.push(t+0,t+1,t+2),i){tj(r,i)&&DA(i,r,BA(i,FA(i,r,n))),ej(Kz,i,r);var _=N(Jz(Qz,LA(),qz,Kz,this.thickness),2),b=_[0],x=_[1],E=UA(Qz,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join)b>this.miterLimit&&(S=!0);S?(h.push(this.normal[0],this.normal[1],0),h.push(x[0],x[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*E,0|r[2]),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*E,0|r[2]),l.push.apply(l,D(this.lastFlip!==-E?[t,t+2,t+3]:[t+2,t+1,t+3])),l.push(t+2,t+3,t+4),$z(Zz,Kz),NA(this.normal,Zz),h.push(this.normal[0],this.normal[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*E,0|r[2]),u+=3):(this.extrusions(c,h,r,x,b,this.totalDistance),l.push.apply(l,D(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),E=-1,NA(this.normal,x),u+=2),this.lastFlip=E}else{if($z(this.normal,qz),f){var C=LA(),T=LA();XA(T,qz,this.normal),DA(C,qz,this.normal),h.push(T[0],T[1],0),h.push(C[0],C[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2])}else this.extrusions(c,h,r,this.normal,this.thickness,this.totalDistance);l.push.apply(l,D(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),u+=2}return u}},{key:"simpleSegment",value:function(e,t,n,r,i){var a=0,o=e.indices,s=e.positions,u=e.normals,l=Mv([r[0],r[1]]),c=Mv([n[0],n[1]]);ej(qz,l,c);var h=0;if(this.dash&&(h=this.lineSegmentDistance(l,c),this.totalDistance+=h),this.normal||(this.normal=LA(),$z(this.normal,qz)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-h)),o.push(t+0,t+1,t+2),i){var f=Mv([i[0],i[1]]);tj(l,f)&&DA(f,l,BA(f,FA(f,l,c))),ej(Kz,f,l);var p=N(Jz(Qz,LA(),qz,Kz,this.thickness),2),d=p[0],v=p[1];UA(Qz,this.normal);this.extrusions(s,u,r,v,d,this.totalDistance),o.push.apply(o,D(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),-1,NA(this.normal,v),a+=2,this.lastFlip=-1}else $z(this.normal,qz),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),o.push.apply(o,D(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),a+=2;return a}},{key:"segment",value:function(e,t,n,r,i){var a=0,o=e.indices,s=e.positions,u=e.normals,l="square"===this.cap,c="bevel"===this.join,h=Mv([r[0],r[1]]),f=Mv([n[0],n[1]]);ej(qz,h,f);var p=0;if(this.dash&&(p=this.lineSegmentDistance(h,f),this.totalDistance+=p),this.normal||(this.normal=LA(),$z(this.normal,qz)),!this.started)if(this.started=!0,l){var d=LA(),v=LA();DA(d,this.normal,qz),DA(v,this.normal,qz),u.push(v[0],v[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-p,-this.thickness,0|n[2]),s.push(n[0],n[1],0|n[2],this.totalDistance-p,this.thickness,0|n[2])}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-p);if(o.push(t+0,t+1,t+2),i){var g=Mv([i[0],i[1]]);tj(h,g)&&DA(g,h,BA(g,FA(g,h,f))),ej(Kz,g,h);var m=N(Jz(Qz,LA(),qz,Kz,this.thickness),2),y=m[0],_=m[1],b=UA(Qz,this.normal)<0?-1:1,x=c;if(!x&&"miter"===this.join)y>this.miterLimit&&(x=!0);x?(u.push(this.normal[0],this.normal[1],0),u.push(_[0],_[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*b,0|r[2]),o.push.apply(o,D(this.lastFlip!==-b?[t,t+2,t+3]:[t+2,t+1,t+3])),o.push(t+2,t+3,t+4),$z(Zz,Kz),NA(this.normal,Zz),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),a+=3):(this.extrusions(s,u,r,_,y,this.totalDistance),o.push.apply(o,D(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),b=-1,NA(this.normal,_),a+=2),this.lastFlip=b}else{if($z(this.normal,qz),l){var E=LA(),S=LA();XA(S,qz,this.normal),DA(E,qz,this.normal),u.push(S[0],S[1],0),u.push(E[0],E[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2])}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);o.push.apply(o,D(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),a+=2}return a}},{key:"extrusions",value:function(e,t,n,r,i,a){t.push(r[0],r[1],0),t.push(r[0],r[1],0),e.push(n[0],n[1],0|n[2],a,-i,0|n[2]),e.push(n[0],n[1],0|n[2],a,i,0|n[2])}},{key:"lineSegmentDistance",value:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}}]),e}();function oj(e){if(PU(e[0]))return e;if(PU(e[0][0]))throw new Error("当前数据不支持标注");if(PU(e[0][0][0])){var t=0,n=0,r=0;return e.forEach((function(e){e.forEach((function(e){t+=e[0],n+=e[1],r++}))})),[t/r,n/r,0]}throw new Error("当前数据不支持标注")}function sj(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e[0][0],r=e[0][e[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,a=mz.flatten(e),o=a.vertices,s=a.dimensions,u=[],l=[],c=[],h=0;h<o.length/s;h++)2===s?u.push(o[2*h],o[2*h+1],1,-1,-1):u.push(o[3*h],o[3*h+1],1,-1,-1),c.push(0,0,1);var f=mz(a.vertices,a.holes,a.dimensions);l.push.apply(l,D(f));for(var p=function(e){var n=a.vertices.slice(e*s,(e+1)*s),r=a.vertices.slice((e+1)*s,(e+2)*s);0===r.length&&(r=a.vertices.slice(0,s));var i=u.length/5;u.push(n[0],n[1],1,0,0,r[0],r[1],1,.1,0,n[0],n[1],0,0,.8,r[0],r[1],0,.1,.8);var o=uj([r[0],r[1],1],[n[0],n[1],0],[n[0],n[1],1],t);c.push.apply(c,D(o).concat(D(o),D(o),D(o))),l.push.apply(l,D([1,2,0,3,2,1].map((function(e){return e+i}))))},d=0;d<i;d++)p(d);return{positions:u,index:l,normals:c}}function uj(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=iA(),a=iA(),o=iA();r&&(e=Sv(e),t=Sv(t),n=Sv(n));var s=oA.apply(kA,D(e)),u=oA.apply(kA,D(t)),l=oA.apply(kA,D(n));xA(i,l,u),xA(a,s,u),mA(o,i,a);var c=iA();return vA(c,o),c}function lj(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2*Math.PI/e,r=[],i=0;i<e;i++)r.push(n*i+t*Math.PI/12);var a=r.map((function(e){return[Math.sin(e+Math.PI/4),Math.cos(e+Math.PI/4),0]}));return a}function cj(){return lj(30)}function hj(){return lj(4)}function fj(){return lj(3)}function pj(){return lj(6,1)}function dj(){return lj(5)}!function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"}(rj||(rj={})),function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"}(ij||(ij={}));var vj=(E(nj={},ij.CIRCLE,cj),E(nj,ij.HEXAGON,pj),E(nj,ij.TRIANGLE,fj),E(nj,ij.SQUARE,hj),E(nj,ij.PENTAGON,dj),E(nj,rj.CYLINDER,cj),E(nj,rj.HEXAGONCOLUMN,pj),E(nj,rj.TRIANGLECOLUMN,fj),E(nj,rj.SQUARECOLUMN,hj),E(nj,rj.PENTAGONCOLUMN,dj),nj),gj={};function mj(e){var t=oj(e.coordinates);return{vertices:[].concat(D(t),D(t),D(t),D(t)),indices:[0,1,2,2,3,0],size:t.length}}function yj(e){var t=Xz(oj(e.coordinates));return{vertices:[].concat(D(t),D(t),D(t),D(t)),indices:[0,1,2,2,3,0],size:t.length}}function _j(e){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(gj&&gj[e])return gj[e];var n=vj[e]?vj[e]():vj.cylinder(),r=sj([n],t);return gj[e]=r,r}(e.shape,!1);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function bj(e){var t=oj(e.coordinates);return{vertices:D(t),indices:[0],size:t.length}}function xj(e){var t=e.coordinates,n=e.originCoordinates,r=e.version,i=new aj({dash:!0,join:"bevel"});if("GAODE2.x"===r){var a=t;Array.isArray(a[0][0])||(a=[t]);var o=n;Array.isArray(o[0][0])||(o=[n]);for(var s=0;s<a.length;s++){var u=a[s],l=o[s];i.extrude_gaode2(u,l)}}else{var c=t;c[0]&&!Array.isArray(c[0][0])&&(c=[t]),c.forEach((function(e){i.extrude(e)}))}var h=i.complex;return{vertices:h.positions,indices:h.indices,normals:h.normals,size:6}}function Ej(e){var t=e.coordinates,n=e.originCoordinates,r=e.version,i=new aj({dash:!0,join:"bevel"});if("GAODE2.x"===r){var a=t;Array.isArray(a[0][0])||(a=[t]);var o=n;Array.isArray(o[0][0])||(o=[n]);for(var s=0;s<a.length;s++){var u=a[s],l=o[s];i.simpleExtrude_gaode2(u,l)}}else{var c=t;c[0]&&!Array.isArray(c[0][0])&&(c=[t]),c.forEach((function(e){i.simpleExtrude(e)}))}var h=i.complex;return{vertices:h.positions,indices:h.indices,normals:h.normals,size:6}}function Sj(e){var t=e.coordinates,n=mz.flatten(t),r=n.vertices,i=n.dimensions,a=n.holes;return{indices:mz(r,a,i),vertices:r,size:i}}function Cj(e){var t=e.coordinates,n=mz.flatten(t),r=n.vertices,i=n.dimensions,a=n.holes;return{indices:mz(r,a,i),vertices:Tj(r),size:i+4}}function Tj(e){for(var t=[],n=function(e){for(var t=e[0],n=e[1],r=e[0],i=e[1],a=0,o=0,s=0,u=0;u<e.length;u+=2){var l=e[u],c=e[u+1];l&&c&&(t=Math.max(l,t),n=Math.max(c,n),r=Math.min(l,r),i=Math.min(c,i),a+=l,o+=c,s++)}return{center:[a/s,o/s],radius:Math.sqrt(Math.pow(t-r,2)+Math.pow(n-i,2))/2}}(e),r=n.center,i=n.radius,a=0;a<e.length;a+=2){var o=e[a],s=e[a+1];t.push.apply(t,[o,s,0].concat(D(r),[i]))}return t}function Aj(e){var t=sj(e.coordinates,!0);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function Mj(e){var t=function(e){var t=vj[e]?vj[e]():vj.circle();return-1===["cylinder","triangleColumn","hexagonColumn","squareColumn"].indexOf(e)?(n=[t],r=mz.flatten(n),i=mz(r.vertices,r.holes,r.dimensions),{positions:r.vertices,index:i}):function(e){var t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,i=mz.flatten(e),a=i.vertices,o=i.dimensions,s=[],u=[],l=0;l<a.length/o;l++)2===o?s.push(a[2*l],a[2*l+1],1):s.push(a[3*l],a[3*l+1],1);var c=mz(i.vertices,i.holes,i.dimensions);u.push.apply(u,D(c));for(var h=function(e){var t=i.vertices.slice(e*o,(e+1)*o),n=i.vertices.slice((e+1)*o,(e+2)*o);0===n.length&&(n=i.vertices.slice(0,o));var r=s.length/3;s.push(t[0],t[1],1,n[0],n[1],1,t[0],t[1],0,n[0],n[1],0),u.push.apply(u,D([0,2,1,2,3,1].map((function(e){return e+r}))))},f=0;f<r;f++)h(f);return{positions:s,index:u}}([t]);var n,r,i}(e.shape);return{vertices:t.positions,indices:t.index,size:3}}function wj(e){var t=e.coordinates;return{vertices:[].concat(D(t[0]),[0,0,1,t[1][0],t[0][1],0,1,1],D(t[1]),[0,1,0],D(t[0]),[0,0,1],D(t[1]),[0,1,0,t[0][0],t[1][1],0,0,0]),indices:[0,1,2,3,4,5],size:5}}function kj(e,t){for(var n=t||30,r=e.coordinates,i=[],a=[],o=function(e){i.push(e,1,e,r[0][0],r[0][1],r[1][0],r[1][1],e,-1,e,r[0][0],r[0][1],r[1][0],r[1][1]),e!==n-1&&a.push.apply(a,D([0,1,2,1,3,2].map((function(t){return 2*e+t}))))},s=0;s<n;s++)o(s);return{vertices:i,indices:a,size:7}}function Oj(e){var t=e.coordinates;2===t.length&&t.push(0);e.size;var n=Pj(-1,1),r=Pj(1,1),i=Pj(-1,-1),a=Pj(1,-1);return{vertices:[].concat(D(t),D(n),D(t),D(i),D(t),D(a),D(t),D(r)),indices:[0,1,2,3,0,2],size:5}}function Pj(e,t){return[(e+1)/2,(t+1)/2]}function Rj(){var e=Yz(100,{segments:36});return{vertices:e.positionsArr,indices:e.indicesArr,size:5,normals:e.normalArr}}function Lj(){var e=Yz(140,{segments:36});return{vertices:e.positionsArr,indices:e.indicesArr,size:5,normals:e.normalArr}}var Ij,Nj=function(t){S(r,t);var n=R(r);function r(){var e;_(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return E(O(e=n.call.apply(n,[this].concat(i))),"cityCenter",void 0),E(O(e),"cityMinSize",void 0),e}return x(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.baseColor,i=void 0===r?"rgb(16,16,16)":r,a=e.brightColor,o=void 0===a?"rgb(255,176,38)":a,s=e.windowColor,u=void 0===s?"rgb(30,60,89)":s,l=e.time,c=void 0===l?0:l,h=e.sweep,f=void 0===h?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:h;return{u_cityCenter:f.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*f.sweepRadius,u_circleSweep:f.enable?1:0,u_circleSweepColor:vg(f.sweepColor).slice(0,3),u_circleSweepSpeed:f.sweepSpeed,u_opacity:n,u_baseColor:vg(i),u_brightColor:vg(o),u_windowColor:vg(u),u_time:this.layer.getLayerAnimateTime()||c}}},{key:"calCityGeo",value:function(){var e=N(this.layer.getSource().extent,4),t=e[0],n=e[1],r=e[2],i=e[3];if("GAODE2.x"===this.mapService.version){this.cityCenter=this.mapService.lngLatToCoord([(r+t)/2,(i+n)/2]);var a=this.mapService.lngLatToCoord([r,i]),o=this.mapService.lngLatToCoord([t,n]);this.cityMinSize=Math.sqrt(Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2))/4}else{var s=r-t,u=i-n;this.cityCenter=[(r+t)/2,(i+n)/2],this.cityMinSize=Math.sqrt(Math.pow(s,2)+Math.pow(u,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:'precision highp float;\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\nvarying vec4 v_Color;\nuniform mat4 u_Mvp;\nuniform float u_circleSweep;\nuniform vec2 u_cityCenter;\nvarying float v_worldDis;\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nvec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\nvec4 project_pos = project_position(pos);\nv_texCoord = a_Uv;\nif(u_circleSweep > 0.0) {\nvec2 lnglatscale = vec2(0.0);\nif(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {\nlnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);\n}\nv_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nfloat lightWeight = calc_lighting(pos);\nv_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_opacity: 1.0;\nuniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];\nuniform float u_near : 0;\nuniform float u_far : 1;\nvarying vec4 v_Color;\nvarying vec2 v_texCoord;\nuniform float u_Zoom : 1;\nuniform float u_time;\nuniform float u_circleSweep;\nuniform float u_cityMinSize;\nuniform vec3 u_circleSweepColor;\nuniform float u_circleSweepSpeed;\nvarying float v_worldDis;\n#pragma include "picking"\nvec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {\nfloat s = step(hot, n);\nvec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);\nreturn mix(darkColor, color, s);\n}\nfloat random (vec2 st) {\nreturn fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);\n}\nfloat LinearizeDepth()\n{\nfloat z = gl_FragCoord.z * 2.0 - 1.0;\nreturn (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));\n}\nvec3 fog(vec3 color, vec3 fogColor, float depth){\nfloat fogFactor=clamp(depth,0.0,1.0);\nvec3 output_color=mix(fogColor,color,fogFactor);\nreturn output_color;\n}\nfloat sdRect(vec2 p, vec2 sz) {\nvec2 d = abs(p) - sz;\nfloat outside = length(max(d, 0.));\nfloat inside = min(max(d.x, d.y), 0.);\nreturn outside + inside;\n}\nvoid main() {\ngl_FragColor = v_Color;\nvec3 baseColor = u_baseColor.xyz;\nvec3 brightColor = u_brightColor.xyz;\nvec3 windowColor = u_windowColor.xyz;\nfloat targetColId = 5.;\nfloat depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;\nvec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);\nif(v_texCoord.x < 0.) {\nvec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);\ngl_FragColor = vec4( foggedColor, v_Color.w);\n}else {\nvec2 st = v_texCoord;\nvec2  UvScale = v_texCoord;\nfloat tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));\nfloat tStart = 0.25 * tStep;\nfloat tEnd = 0.75 * tStep;\nfloat u = mod(UvScale.x, tStep);\nfloat v = mod(UvScale.y, tStep);\nfloat ux = floor(UvScale.x/tStep);\nfloat uy = floor(UvScale.y/tStep);\nfloat n = random(vec2(ux,uy));\nfloat lightP = u_time;\nfloat head = 1.0- step(0.005,st.y);\nfloat sU = step(tStart, u) - step(tEnd, u);\nfloat sV = step(tStart, v) - step(tEnd, v);\nvec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));\nfloat dist = sdRect(vec2(u,v), windowSize);\nfloat s = sU * sV;\nfloat curColId = floor(UvScale.x / tStep);\nfloat sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);\nfloat mLightP = mod(lightP, 2.);\nfloat sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);\nif(ux == targetColId){\nn =0.;\n}\nfloat timeP = min(0.75, abs ( sin(u_time/3.0) ) );\nfloat hot = smoothstep(1.0,0.0,timeP);\nvec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);\nfloat sFinal = s * sCol * sRow;\ncolor += mix(baseColor, brightColor, sFinal*n);\nif (st.y<0.01){\ncolor = baseColor;\n}\nif(head ==1.0) {\ncolor = brightColor;\n}\ncolor = color * v_Color.rgb;\nvec3 foggedColor = fog(color,fogColor,depth);\ngl_FragColor = vec4(foggedColor,1.0);\n}\nif(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {\nfloat r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);\ngl_FragColor.rgb += r * r * u_circleSweepColor;\n}\ngl_FragColor.a *= u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:Aj})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,a=void 0===i?10:i;return Array.isArray(a)?[a[0]]:[a]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){e.size;return[n[3],n[4]]}}})}}]),r}(dz),Dj=function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"type","PolygonLayer"),e}return x(n,[{key:"buildModels",value:function(){this.layerModel=new Nj(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(e){this.updateLayerConfig({time:e})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),n}(KU),Fj='uniform sampler2D u_texture;\nuniform float u_mapFlag;\nuniform float u_opacity;\nvarying vec3 v_Color;\nvarying vec2 v_uv;\nvarying float v_clip;\n#pragma include "picking"\nvoid main() {\nif(u_mapFlag > 0.0) {\ngl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));\ngl_FragColor.a *= u_opacity;\n} else {\ngl_FragColor = vec4(v_Color, u_opacity);\n}\ngl_FragColor.a *= v_clip;\ngl_FragColor = filterColor(gl_FragColor);\n}',Bj='precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform float u_terrainClipHeight;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nattribute vec3 a_Color;\nvarying vec3 v_Color;\nvarying vec2 v_uv;\nvarying float v_clip;\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nv_Color = a_Color;\nv_uv = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nv_clip = 1.0;\nif(a_Position.z < u_terrainClipHeight) {\nv_clip = 0.0;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',Uj={plane:function(t){S(r,t);var n=R(r);function r(){var e;_(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return E(O(e=n.call.apply(n,[this].concat(i))),"texture",void 0),E(O(e),"mapTexture",void 0),E(O(e),"positions",void 0),E(O(e),"indices",void 0),E(O(e),"planeGeometryTriangulation",(function(){var t,n=e.layer.getLayerConfig(),r=n.width,i=void 0===r?1:r,a=n.height,o=void 0===a?1:a,s=n.widthSegments,u=void 0===s?1:s,l=n.heightSegments,c=void 0===l?1:l,h=n.center,f=void 0===h?[120,30]:h,p=n.terrainTexture,d=(t=e).initPlane.apply(t,[i,o,u,c].concat(D(f))),v=d.indices,g=d.positions;return e.positions=g,e.indices=v,p&&e.loadTerrainTexture(),{vertices:g,indices:v,size:5}})),E(O(e),"planeGeometryUpdateTriangulation",(function(){return{vertices:e.positions,indices:e.indices,size:5}})),e}return x(r,[{key:"initPlane",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:120,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,s=t/2,u=n/2,l=Math.floor(r),c=Math.floor(i),h=l+1,f=c+1,p=t/l,d=n/c,v=[],g=[],m=0;m<f;m++)for(var y=m*d-u,_=0;_<h;_++){var b=_*p-s;if(this.mapService.version===e.Version["GAODE2.x"]){var x=this.mapService.lngLatToCoord([b+a,-y+o]),E=N(x,2),S=E[0],C=E[1];g.push(S,C,0)}else g.push(b+a,-y+o,0);g.push(_/l),g.push(1-m/c)}for(var T=0;T<c;T++)for(var A=0;A<l;A++){var M=A+h*T,w=A+h*(T+1),k=A+1+h*(T+1),O=A+1+h*T;v.push(M,w,O),v.push(w,k,O)}return{indices:v,positions:g}}},{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.mapTexture,r=e.terrainClipHeight,i=void 0===r?0:r,a=e.terrainTexture;return this.mapTexture!==n&&(this.mapTexture=n,this.texture.destroy(),this.updateTexture(n)),{u_opacity:t||1,u_mapFlag:n?1:0,u_terrainClipHeight:a?i:-1,u_texture:this.texture}}},{key:"clearModels",value:function(){this.texture.destroy()}},{key:"initModels",value:function(){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,a=void 0===i||i,o=t.mapTexture;this.mapTexture=o;var s=this.rendererService.createTexture2D;return this.texture=s({height:0,width:0}),this.updateTexture(o),[this.layer.buildLayerModel({moduleName:"geometry_plane",vertexShader:Bj,fragmentShader:Fj,triangulation:this.planeGeometryTriangulation,primitive:e.gl.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:xg(r,a)})]}},{key:"getImageData",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=e.width,i=e.height;return t.width=r,t.height=i,n.drawImage(e,0,0,r,i),n.getImageData(0,0,r,i)}},{key:"loadTerrainTexture",value:function(){var t=this,n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,a=n.maskInside,o=void 0===a||a,s=n.widthSegments,u=void 0===s?1:s,l=n.heightSegments,c=void 0===l?1:l,h=n.terrainTexture,f=n.rgb2height,p=void 0===f?function(e,t,n){return e+t+n}:f,d=new Image;d.crossOrigin="anonymous",d.onload=function(){for(var n=d.width,r=d.height,a=t.getImageData(d).data,s=Math.floor(u),l=Math.floor(c),h=s+1,f=l+1,v=n/s,g=r/l,m=0;m<f;m++)for(var y=Math.floor(m*g)*n,_=0;_<h;_++){var b=4*(y+Math.floor(_*v)),x=a[b],E=a[b+1],S=a[b+2],C=5*(m*h+_)+2;t.positions[C]=p(x,E,S)}t.layer.models=[t.layer.buildLayerModel({moduleName:"geometry_plane",vertexShader:Bj,fragmentShader:Fj,triangulation:t.planeGeometryUpdateTriangulation,primitive:e.gl.TRIANGLES,depth:{enable:!0},blend:t.getBlend(),stencil:xg(i,o)})],t.layerService.renderLayers()},d.src=h}},{key:"buildModels",value:function(){return this.initModels()}},{key:"updateTexture",value:function(t){var n=this,r=this.rendererService.createTexture2D;if(t){var i=new Image;i.crossOrigin="anonymous",i.onload=function(){n.texture=r({data:i,width:i.width,height:i.height,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE}),n.layerService.updateLayerRenderList(),n.layerService.renderLayers()},i.src=t}else this.texture=r({width:0,height:0})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[3],n[4]]}}})}}]),r}(dz)},zj=function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"type","GeometryLayer"),e}return x(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new Uj[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{plane:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"plane"}}]),n}(KU),jj='precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n#pragma include "picking"\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor.a *= u_opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',Vj=function(t){S(r,t);var n=R(r);function r(){return _(this,r),n.apply(this,arguments)}return x(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||.9,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,a=void 0===i||i;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\r\nattribute float a_Size;\r\nattribute vec4 a_Color;\r\nuniform vec2 u_radius;\r\nuniform float u_coverage: 0.9;\r\nuniform float u_angle: 0;\r\nuniform mat4 u_ModelMatrix;\r\nuniform mat4 u_Mvp;\r\nvarying vec4 v_color;\r\nuniform vec2 u_SceneCenterMKT;\r\n#pragma include "projection"\r\n#pragma include "project"\r\n#pragma include "picking"\r\nvoid main() {\r\nv_color = a_Color;\r\nmat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r\nvec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\nvec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;\nvec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r\ngl_Position = u_Mvp * (project_pos);\r\n} else {\r\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\nvec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\ngl_Position = project_common_position_to_clipspace(project_pos);\r\n}\r\nsetPickingColor(a_PickingColor);\r\n}',fragmentShader:jj,triangulation:Mj,depth:{enable:!1},primitive:e.gl.TRIANGLES,blend:this.getBlend(),stencil:xg(r,a)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:e.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t){var n="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[n[0],n[1],0]}}})}}]),r}(dz),Gj=function(t){S(r,t);var n=R(r);function r(){return _(this,r),n.apply(this,arguments)}return x(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||1,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var e=this.layer.getLayerConfig(),t=e.mask,n=void 0!==t&&t,r=e.maskInside,i=void 0===r||r;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nuniform vec2 u_SceneCenterMKT;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nmat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\nvec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\nvec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;\nvec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));\nfloat lightWeight = calc_lighting(project_pos);\nv_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\ngl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);\n} else {\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\nvec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\nfloat lightWeight = calc_lighting(project_pos);\nv_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\ngl_Position = project_common_position_to_clipspace(project_pos);\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:jj,triangulation:_j,depth:{enable:!0},blend:this.getBlend(),stencil:xg(n,i)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size;return Array.isArray(i)?[i[0]]:[i]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:e.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t){var n="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[n[0],n[1],0]}}})}}]),r}(dz);var Hj=Qx()(Ij=function(t){S(r,t);var n=R(r);function r(){var e;_(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return E(O(e=n.call.apply(n,[this].concat(i))),"texture",void 0),E(O(e),"colorTexture",void 0),E(O(e),"heatmapFramerBuffer",void 0),E(O(e),"intensityModel",void 0),E(O(e),"colorModel",void 0),E(O(e),"shapeType",void 0),e}return x(r,[{key:"render",value:function(){var e=this,t=this.rendererService,n=t.clear;(0,t.useFramebuffer)(this.heatmapFramerBuffer,(function(){n({color:[0,0,0,0],depth:1,stencil:0,framebuffer:e.heatmapFramerBuffer}),e.drawIntensityMode()})),this.layer.styleNeedUpdate&&this.updateColorTexture(),"heatmap"===this.shapeType?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var t,n=this.rendererService,r=n.createFramebuffer,i=(n.clear,n.getViewportSize),a=n.createTexture2D,o=(n.useFramebuffer,this.styleAttributeService.getLayerStyleAttribute("shape")),s=(null==o||null===(t=o.scale)||void 0===t?void 0:t.field)||"heatmap";this.shapeType=s,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel="heatmap"===s?this.buildHeatmapColor():this.build3dHeatMap();var u=i(),l=u.width,c=u.height;return this.heatmapFramerBuffer=r({color:a({width:Math.floor(l/4),height:Math.floor(c/4),wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE,min:e.gl.LINEAR,mag:e.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:e.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size;return[void 0===i?1:i]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute float a_Size;\nattribute vec2 a_Dir;\nuniform float u_intensity;\nuniform float u_radius;\nvarying vec2 v_extrude;\nvarying float v_weight;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n#define GAUSS_COEF  0.3989422804014327\n#pragma include "projection"\nvoid main(){\nv_weight = a_Size;\nfloat ZERO = 1.0 / 255.0 / 16.0;\nfloat extrude_x = a_Dir.x * 2.0 -1.0;\nfloat extrude_y = a_Dir.y * 2.0 -1.0;\nvec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));\nfloat S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;\nv_extrude = extrude_dir * S;\nvec2 offset = project_pixel(v_extrude * u_radius);\nvec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n}\n}',fragmentShader:"precision highp float;\nuniform float u_intensity;\nvarying float v_weight;\nvarying vec2 v_extrude;\n#define GAUSS_COEF  0.3989422804014327\nvoid main(){\nfloat d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\nfloat val = v_weight * u_intensity * GAUSS_COEF * exp(d);\ngl_FragColor = vec4(val, 1., 1., 1.);\n}",triangulation:Oj,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:e.gl.ONE,srcAlpha:1,dstRGB:e.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,a=void 0===i||i;this.shaderModuleService.registerModule("heatmapColor",{vs:"precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\nvoid main() {\nv_texCoord = a_Uv;\ngl_Position = vec4(a_Position.xy, 0, 1.);\n}",fs:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nfloat getBlurIndusty() {\nfloat h = 2.0/512.0;\nvec2 vUv = v_texCoord;\nfloat i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y + 1.0 * h) ).r;\nfloat i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y + 1.0 * h) ).r;\nfloat i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y + 1.0 * h) ).r;\nfloat i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y) ).r;\nfloat i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;\nfloat i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y) ).r;\nfloat i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y-1.0*h) ).r;\nfloat i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y-1.0*h) ).r;\nfloat i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y-1.0*h) ).r;\nreturn(\ni11 + \ni12 + \ni13 + \ni21 + \ni21 + \ni22 + \ni23 + \ni31 + \ni32 + \ni33\n)/9.0;\n}\nvoid main(){\nfloat intensity = getBlurIndusty();\nvec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));\ngl_FragColor =color;\ngl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}"});var o=this.shaderModuleService.getModule("heatmapColor"),s=o.vs,u=o.fs,l=o.uniforms,c=this.rendererService,h=c.createAttribute,f=c.createElements,p=c.createBuffer;return(0,c.createModel)({vs:s,fs:u,attributes:{a_Position:h({buffer:p({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:e.gl.FLOAT}),size:3}),a_Uv:h({buffer:p({data:[0,1,1,1,0,0,1,0],type:e.gl.FLOAT}),size:2})},uniforms:v({},l),depth:{enable:!1},blend:this.getBlend(),count:6,elements:f({data:[0,2,1,2,3,1],type:e.gl.UNSIGNED_INT,count:6}),stencil:xg(r,a)})}},{key:"drawIntensityMode",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.intensity,r=void 0===n?10:n,i=e.radius,a=void 0===i?5:i;this.intensityModel.draw({uniforms:{u_opacity:t||1,u_radius:a,u_intensity:r}})}},{key:"drawColorMode",value:function(){var e=this.layer.getLayerConfig().opacity;this.colorModel.draw({uniforms:{u_opacity:e||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var e=this.layer.getLayerConfig().opacity,t=IT();BT(t,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:e||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:D(t)}})}},{key:"build3dHeatMap",value:function(){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,a=void 0===i||i,o=(0,this.rendererService.getViewportSize)(),s=function(e,t){for(var n=[],r=[],i=[],a=e+1,o=t+1,s=e/2,u=t/2,l=0;l<o;l++)for(var c=l-u,h=0;h<a;h++){var f=h-s;r.push(f/s,-c/u,0),i.push(h/e),i.push(1-l/t)}for(var p=0;p<t;p++)for(var d=0;d<e;d++){var v=d+a*p,g=d+a*(p+1),m=d+1+a*(p+1),y=d+1+a*p;n.push(v,g,y),n.push(g,m,y)}return{vertices:r,indices:n,uvs:i}}(o.width/4,o.height/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:'precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_InverseViewProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrixUncentered;\nvarying float v_intensity;\nvec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\nfloat t2 = t * t;\nfloat one_minus_t = 1.0 - t;\nfloat one_minus_t2 = one_minus_t * one_minus_t;\nreturn (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);\n}\nvec2 toBezier(float t, vec4 p){\nreturn toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n}\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec2 pos = a_Uv * vec2(2.0) - vec2(1.0);\nvec4 p1 = vec4(pos, 0.0, 1.0);\nvec4 p2 = vec4(pos, 1.0, 1.0);\nvec4 inverseP1 = u_InverseViewProjectionMatrix * p1;\nvec4 inverseP2 = u_InverseViewProjectionMatrix * p2;\ninverseP1 = inverseP1 / inverseP1.w;\ninverseP2 = inverseP2 / inverseP2.w;\nfloat zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z);\nvec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);\nvec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);\nfloat fh;\nv_intensity = texture2D(u_texture, v_texCoord).r;\nfh = toBezier(v_intensity, b).y;\ngl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);\n}',fs:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\nvoid main(){\nfloat intensity = texture2D(u_texture, v_texCoord).r;\nvec4 color = texture2D(u_colorTexture,vec2(intensity, 0));\ngl_FragColor = color;\ngl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}"});var u=this.shaderModuleService.getModule("heatmap3dColor"),l=u.vs,c=u.fs,h=u.uniforms,f=this.rendererService,p=f.createAttribute,d=f.createElements,g=f.createBuffer;return(0,f.createModel)({vs:l,fs:c,attributes:{a_Position:p({buffer:g({data:s.vertices,type:e.gl.FLOAT}),size:3}),a_Uv:p({buffer:g({data:s.uvs,type:e.gl.FLOAT}),size:2})},primitive:e.gl.TRIANGLES,uniforms:v({},h),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:e.gl.SRC_ALPHA,srcAlpha:1,dstRGB:e.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:d({data:s.indices,type:e.gl.UNSIGNED_INT,count:s.indices.length}),stencil:xg(r,a)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var n=yg(this.layer.getLayerConfig().rampColors);this.colorTexture=t({data:new Uint8Array(n.data),width:n.width,height:n.height,wrapS:e.gl.CLAMP_TO_EDGE,wrapT:e.gl.CLAMP_TO_EDGE,min:e.gl.NEAREST,mag:e.gl.NEAREST,flipY:!1})}}]),r}(dz))||Ij,Wj={heatmap:Hj,heatmap3d:Hj,grid:Vj,grid3d:Gj,hexagon:function(t){S(r,t);var n=R(r);function r(){return _(this,r),n.apply(this,arguments)}return x(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig();return{u_opacity:e.opacity||1,u_coverage:e.coverage||.9,u_angle:e.angle||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,a=void 0===i||i;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:'precision highp float;\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nuniform vec2 u_SceneCenterMKT;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nvoid main() {\nv_color = a_Color;\nmat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\nvec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\nvec2 lnglat = unProjectFlat(a_Pos.xy + offset);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nvec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;\nvec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\ngl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);\n} else {\nvec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:jj,triangulation:Mj,depth:{enable:!1},primitive:e.gl.TRIANGLES,blend:this.getBlend(),stencil:xg(r,a)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:e.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t){var n="GAODE2.x"===e.version?e.originCoordinates:e.coordinates;return[n[0],n[1],0]}}})}}]),r}(dz)},Xj=function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"type","HeatMapLayer"),e}return x(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new Wj[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var e=this;return"heatmap"===this.getModelType()?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach((function(t){return t.draw({uniforms:e.layerModel.getUninforms()})})),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=this.getLayerConfig().shape3d,r=this.getSource().data.type,i=(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"heatmap";return"heatmap"===i||"heatmap3d"===i?"heatmap":"hexagon"===r?-1===(null==n?void 0:n.indexOf(i))?"hexagon":"grid3d":"grid"===r?-1===(null==n?void 0:n.indexOf(i))?"grid":"grid3d":"heatmap"}}]),n}(KU),Yj={image:function(t){S(r,t);var n=R(r);function r(){var e;_(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return E(O(e=n.call.apply(n,[this].concat(i))),"texture",void 0),e}return x(r,[{key:"getUninforms",value:function(){return{u_opacity:this.layer.getLayerConfig().opacity||1,u_texture:this.texture}}},{key:"initModels",value:function(){var t=this,n=this.layer.getLayerConfig(),r=n.mask,i=void 0!==r&&r,a=n.maskInside,o=void 0===a||a,s=this.layer.getSource(),u=this.rendererService.createTexture2D;if(this.texture=u({height:0,width:0}),bd){var l=this.layerService.sceneService.getSceneConfig().canvas.createImage();l.crossOrigin="anonymous",l.src=s.data.originData,l.onload=function(){t.texture=u({data:l,width:l.width,height:l.height}),t.layerService.updateLayerRenderList(),t.layerService.renderLayers()}}else s.data.images.then((function(e){t.texture=u({data:e[0],width:e[0].width,height:e[0].height}),t.layerService.updateLayerRenderList(),t.layerService.renderLayers()}));return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n}\n}',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\nvec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\ngl_FragColor = color;\ngl_FragColor.a *= u_opacity;\n}",triangulation:wj,primitive:e.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:xg(i,o)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[3],n[4]]}}})}}]),r}(dz)},Zj=function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"type","ImageLayer"),e}return x(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new Yj[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{image:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"image"}}]),n}(KU),qj=function(e,t){return(qj=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var Kj=function(){return(Kj=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};var Qj=Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]};function Jj(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function $j(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function eV(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r}function tV(e){return this instanceof tV?(this.v=e,this):new tV(e)}var nV=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};var rV=Object.freeze({__proto__:null,__extends:function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}qj(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},get __assign(){return Kj},__rest:function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n},__decorate:function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},__param:function(e,t){return function(n,r){t(n,r,e)}},__metadata:function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__awaiter:function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},__generator:function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},__createBinding:Qj,__exportStar:function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||Qj(t,e,n)},__values:Jj,__read:$j,__spread:function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat($j(arguments[t]));return e},__spreadArrays:eV,__spreadArray:function(e,t,n){if(n||2===arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},__await:tV,__asyncGenerator:function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),a=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){a.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{(n=i[e](t)).value instanceof tV?Promise.resolve(n.value.v).then(u,l):c(a[0][2],n)}catch(e){c(a[0][3],e)}var n}function u(e){s("next",e)}function l(e){s("throw",e)}function c(e,t){e(t),a.shift(),a.length&&s(a[0][0],a[0][1])}},__asyncDelegator:function(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,i){t[r]=e[r]?function(t){return(n=!n)?{value:tV(e[r](t)),done:"return"===r}:i?i(t):t}:i}},__asyncValues:function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Jj(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}},__makeTemplateObject:function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},__importStar:function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&Qj(t,e,n);return nV(t,e),t},__importDefault:function(e){return e&&e.__esModule?e:{default:e}},__classPrivateFieldGet:function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},__classPrivateFieldSet:function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n}}),iV=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.setMatrixArrayType=function(e){t.ARRAY_TYPE=e},t.toRadian=function(e){return e*r},t.equals=function(e,t){return Math.abs(e-t)<=n*Math.max(1,Math.abs(e),Math.abs(t))};var n=t.EPSILON=1e-6;t.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,t.RANDOM=Math.random;var r=Math.PI/180}));G(iV);iV.setMatrixArrayType,iV.toRadian,iV.equals,iV.EPSILON,iV.ARRAY_TYPE,iV.RANDOM;var aV=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new n.ARRAY_TYPE(9);n.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0);return e[0]=1,e[4]=1,e[8]=1,e},t.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},t.clone=function(e){var t=new n.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.fromValues=function(e,t,r,i,a,o,s,u,l){var c=new n.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=i,c[4]=a,c[5]=o,c[6]=s,c[7]=u,c[8]=l,c},t.set=function(e,t,n,r,i,a,o,s,u,l){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e[8]=l,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},t.invert=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=c*o-s*l,f=-c*a+s*u,p=l*a-o*u,d=n*h+r*f+i*p;if(!d)return null;return d=1/d,e[0]=h*d,e[1]=(-c*r+i*l)*d,e[2]=(s*r-i*o)*d,e[3]=f*d,e[4]=(c*n-i*u)*d,e[5]=(-s*n+i*a)*d,e[6]=p*d,e[7]=(-l*n+r*u)*d,e[8]=(o*n-r*a)*d,e},t.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8];return e[0]=o*c-s*l,e[1]=i*l-r*c,e[2]=r*s-i*o,e[3]=s*u-a*c,e[4]=n*c-i*u,e[5]=i*a-n*s,e[6]=a*l-o*u,e[7]=r*u-n*l,e[8]=n*o-r*a,e},t.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8];return t*(l*a-o*u)+n*(-l*i+o*s)+r*(u*i-a*s)},t.multiply=r,t.translate=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=n[0],p=n[1];return e[0]=r,e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=u,e[6]=f*r+p*o+l,e[7]=f*i+p*s+c,e[8]=f*a+p*u+h,e},t.rotate=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=Math.sin(n),p=Math.cos(n);return e[0]=p*r+f*o,e[1]=p*i+f*s,e[2]=p*a+f*u,e[3]=p*o-f*r,e[4]=p*s-f*i,e[5]=p*u-f*a,e[6]=l,e[7]=c,e[8]=h,e},t.scale=function(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},t.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},t.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n+n,s=r+r,u=i+i,l=n*o,c=r*o,h=r*s,f=i*o,p=i*s,d=i*u,v=a*o,g=a*s,m=a*u;return e[0]=1-h-d,e[3]=c-m,e[6]=f+g,e[1]=c+m,e[4]=1-l-d,e[7]=p-v,e[2]=f-g,e[5]=p+v,e[8]=1-l-h,e},t.normalFromMat4=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],p=t[11],d=t[12],v=t[13],g=t[14],m=t[15],y=n*s-r*o,_=n*u-i*o,b=n*l-a*o,x=r*u-i*s,E=r*l-a*s,S=i*l-a*u,C=c*v-h*d,T=c*g-f*d,A=c*m-p*d,M=h*g-f*v,w=h*m-p*v,k=f*m-p*g,O=y*k-_*w+b*M+x*A-E*T+S*C;if(!O)return null;return O=1/O,e[0]=(s*k-u*w+l*M)*O,e[1]=(u*A-o*k-l*T)*O,e[2]=(o*w-s*A+l*C)*O,e[3]=(i*w-r*k-a*M)*O,e[4]=(n*k-i*A+a*T)*O,e[5]=(r*A-n*w-a*C)*O,e[6]=(v*S-g*E+m*x)*O,e[7]=(g*b-d*S-m*_)*O,e[8]=(d*E-v*b+m*y)*O,e},t.projection=function(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},t.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},t.subtract=i,t.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},t.multiplyScalarAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},t.equals=function(e,t){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=t[0],p=t[1],d=t[2],v=t[3],g=t[4],m=t[5],y=t[6],_=t[7],b=t[8];return Math.abs(r-f)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-p)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(a-d)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(o-v)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-g)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(u-m)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(l-y)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(c-_)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(h-b)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))};var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(iV);function r(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=n[0],p=n[1],d=n[2],v=n[3],g=n[4],m=n[5],y=n[6],_=n[7],b=n[8];return e[0]=f*r+p*o+d*l,e[1]=f*i+p*s+d*c,e[2]=f*a+p*u+d*h,e[3]=v*r+g*o+m*l,e[4]=v*i+g*s+m*c,e[5]=v*a+g*u+m*h,e[6]=y*r+_*o+b*l,e[7]=y*i+_*s+b*c,e[8]=y*a+_*u+b*h,e}function i(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}t.mul=r,t.sub=i}));G(aV);aV.sub,aV.mul,aV.create,aV.fromMat4,aV.clone,aV.copy,aV.fromValues,aV.set,aV.identity,aV.transpose,aV.invert,aV.adjoint,aV.determinant,aV.multiply,aV.translate,aV.rotate,aV.scale,aV.fromTranslation,aV.fromRotation,aV.fromScaling,aV.fromMat2d,aV.fromQuat,aV.normalFromMat4,aV.projection,aV.str,aV.frob,aV.add,aV.subtract,aV.multiplyScalar,aV.multiplyScalarAndAdd,aV.exactEquals,aV.equals;var oV=H((function(e,t){t.__esModule=!0,aV.translate=function(e,t,n){var r=Array(9);return aV.fromTranslation(r,n),aV.multiply(e,r,t)},aV.rotate=function(e,t,n){var r=Array(9);return aV.fromRotation(r,n),aV.multiply(e,r,t)},aV.scale=function(e,t,n){var r=Array(9);return aV.fromScaling(r,n),aV.multiply(e,r,t)},aV.transform=function(e,t){for(var n=[].concat(e),r=0,i=t.length;r<i;r+=1){var a=t[r];switch(a[0]){case"t":aV.translate(n,n,[a[1],a[2]]);break;case"s":aV.scale(n,n,[a[1],a[2]]);break;case"r":aV.rotate(n,n,a[1])}}return n},t.default=aV}));G(oV);var sV=H((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.len=t.sqrDist=t.dist=t.div=t.mul=t.sub=void 0,t.create=r,t.clone=function(e){var t=new n.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.length=i,t.fromValues=a,t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.set=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},t.subtract=o,t.multiply=s,t.divide=u,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},t.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},t.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},t.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},t.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},t.distance=l,t.squaredDistance=c,t.squaredLength=h,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},t.normalize=f,t.dot=p,t.cross=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],u=n[2];return e[0]=i*u-a*s,e[1]=a*o-r*u,e[2]=r*s-i*o,e},t.lerp=function(e,t,n,r){var i=t[0],a=t[1],o=t[2];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=o+r*(n[2]-o),e},t.hermite=function(e,t,n,r,i,a){var o=a*a,s=o*(2*a-3)+1,u=o*(a-2)+a,l=o*(a-1),c=o*(3-2*a);return e[0]=t[0]*s+n[0]*u+r[0]*l+i[0]*c,e[1]=t[1]*s+n[1]*u+r[1]*l+i[1]*c,e[2]=t[2]*s+n[2]*u+r[2]*l+i[2]*c,e},t.bezier=function(e,t,n,r,i,a){var o=1-a,s=o*o,u=a*a,l=s*o,c=3*a*s,h=3*u*o,f=u*a;return e[0]=t[0]*l+n[0]*c+r[0]*h+i[0]*f,e[1]=t[1]*l+n[1]*c+r[1]*h+i[1]*f,e[2]=t[2]*l+n[2]*c+r[2]*h+i[2]*f,e},t.random=function(e,t){t=t||1;var r=2*n.RANDOM()*Math.PI,i=2*n.RANDOM()-1,a=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*a,e[1]=Math.sin(r)*a,e[2]=i*t,e},t.transformMat4=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return o=o||1,e[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/o,e[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,e[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,e},t.transformMat3=function(e,t,n){var r=t[0],i=t[1],a=t[2];return e[0]=r*n[0]+i*n[3]+a*n[6],e[1]=r*n[1]+i*n[4]+a*n[7],e[2]=r*n[2]+i*n[5]+a*n[8],e},t.transformQuat=function(e,t,n){var r=n[0],i=n[1],a=n[2],o=n[3],s=t[0],u=t[1],l=t[2],c=i*l-a*u,h=a*s-r*l,f=r*u-i*s,p=i*f-a*h,d=a*c-r*f,v=r*h-i*c,g=2*o;return c*=g,h*=g,f*=g,p*=2,d*=2,v*=2,e[0]=s+c+p,e[1]=u+h+d,e[2]=l+f+v,e},t.rotateX=function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0],a[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),a[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},t.rotateY=function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),a[1]=i[1],a[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},t.rotateZ=function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),a[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),a[2]=i[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},t.angle=function(e,t){var n=a(e[0],e[1],e[2]),r=a(t[0],t[1],t[2]);f(n,n),f(r,r);var i=p(n,r);return i>1?0:i<-1?Math.PI:Math.acos(i)},t.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},t.equals=function(e,t){var r=e[0],i=e[1],a=e[2],o=t[0],s=t[1],u=t[2];return Math.abs(r-o)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(a-u)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))};var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(iV);function r(){var e=new n.ARRAY_TYPE(3);return n.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function i(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}function a(e,t,r){var i=new n.ARRAY_TYPE(3);return i[0]=e,i[1]=t,i[2]=r,i}function o(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function s(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function u(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function l(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)}function c(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function h(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function f(e,t){var n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function p(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}t.sub=o,t.mul=s,t.div=u,t.dist=l,t.sqrDist=c,t.len=i,t.sqrLen=h,t.forEach=function(){var e=r();return function(t,n,r,i,a,o){var s=void 0,u=void 0;for(n||(n=3),r||(r=0),u=i?Math.min(i*n+r,t.length):t.length,s=r;s<u;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}()}));G(sV);sV.forEach,sV.sqrLen,sV.len,sV.sqrDist,sV.dist,sV.div,sV.mul,sV.sub,sV.create,sV.clone,sV.length,sV.fromValues,sV.copy,sV.set,sV.add,sV.subtract,sV.multiply,sV.divide,sV.ceil,sV.floor,sV.min,sV.max,sV.round,sV.scale,sV.scaleAndAdd,sV.distance,sV.squaredDistance,sV.squaredLength,sV.negate,sV.inverse,sV.normalize,sV.dot,sV.cross,sV.lerp,sV.hermite,sV.bezier,sV.random,sV.transformMat4,sV.transformMat3,sV.transformQuat,sV.rotateX,sV.rotateY,sV.rotateZ,sV.angle,sV.str,sV.exactEquals,sV.equals;var uV=H((function(e,t){t.__esModule=!0;var n=function(){function e(e){void 0===e&&(e={}),this.matrix=[1,0,0,0,1,0,0,0,1],this.isTransposed=!1,Object.assign(this,e),this.init()}return e.prototype.init=function(){var e=this.start,t=this.end,n={x:(e.x+t.x)/2,y:(e.y+t.y)/2};this.center=n,this.width=Math.abs(t.x-e.x),this.height=Math.abs(t.y-e.y)},e.prototype._swapDim=function(e){var t=this[e];if(t){var n=t.start;t.start=t.end,t.end=n}},e.prototype.getCenter=function(){return this.center},e.prototype.getWidth=function(){return this.width},e.prototype.getHeight=function(){return this.height},e.prototype.convertDim=function(e,t){var n=this[t],r=n.start;return r+e*(n.end-r)},e.prototype.invertDim=function(e,t){var n=this[t],r=n.start;return(e-r)/(n.end-r)},e.prototype.convertPoint=function(e){return e},e.prototype.invertPoint=function(e){return e},e.prototype.applyMatrix=function(e,t,n){void 0===n&&(n=0);var r=this.matrix,i=[e,t,n];return sV.transformMat3(i,i,r),i},e.prototype.invertMatrix=function(e,t,n){void 0===n&&(n=0);var r=this.matrix,i=oV.default.invert([],r),a=[e,t,n];return sV.transformMat3(a,a,i),a},e.prototype.convert=function(e){var t=this.convertPoint(e),n=t.x,r=t.y,i=this.applyMatrix(n,r,1);return{x:i[0],y:i[1]}},e.prototype.invert=function(e){var t=this.invertMatrix(e.x,e.y,1);return this.invertPoint({x:t[0],y:t[1]})},e.prototype.rotate=function(e){var t=this.matrix,n=this.center;return oV.default.translate(t,t,[-n.x,-n.y]),oV.default.rotate(t,t,e),oV.default.translate(t,t,[n.x,n.y]),this},e.prototype.reflect=function(e){switch(e){case"x":this._swapDim("x");break;case"y":this._swapDim("y");break;default:this._swapDim("y")}return this},e.prototype.scale=function(e,t){var n=this.matrix,r=this.center;return oV.default.translate(n,n,[-r.x,-r.y]),oV.default.scale(n,n,[e,t]),oV.default.translate(n,n,[r.x,r.y]),this},e.prototype.translate=function(e,t){var n=this.matrix;return oV.default.translate(n,n,[e,t]),this},e.prototype.transpose=function(){return this.isTransposed=!this.isTransposed,this},e}();t.default=n}));G(uV);var lV=H((function(e,t){t.__esModule=!0;t.trunc=function(e){return e>0?Math.floor(e):Math.ceil(e)},t.formatNum=function(e,t){var n=Math.pow(10,void 0===t?6:t);return Math.round(e*n)/n},t.wrapNum=function(e,t,n){var r=t[1],i=t[0],a=r-i;return e===r&&n?e:((e-i)%a+a)%a+i}}));G(lV);lV.trunc,lV.formatNum,lV.wrapNum;var cV=H((function(e,t){t.__esModule=!0;var n=function(){function e(e,t,n){this.x=n?Math.round(e):e,this.y=n?Math.round(t):t}return e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.add=function(e,t,n){return this.clone()._add(r(e,t,n))},e.prototype._add=function(e){return this.x+=e.x,this.y+=e.y,this},e.prototype.subtract=function(e,t,n){return this.clone()._subtract(r(e,t,n))},e.prototype._subtract=function(e){return this.x-=e.x,this.y-=e.y,this},e.prototype.divideBy=function(e){return this.clone()._divideBy(e)},e.prototype._divideBy=function(e){return this.x/=e,this.y/=e,this},e.prototype.multiplyBy=function(e){return this.clone()._multiplyBy(e)},e.prototype._multiplyBy=function(e){return this.x*=e,this.y*=e,this},e.prototype.scaleBy=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.unscaleBy=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.round=function(){return this.clone()._round()},e.prototype._round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},e.prototype.floor=function(){return this.clone()._floor()},e.prototype._floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},e.prototype.ceil=function(){return this.clone()._ceil()},e.prototype._ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},e.prototype.trunc=function(){return this.clone()._trunc()},e.prototype._trunc=function(){return this.x=lV.trunc(this.x),this.y=lV.trunc(this.y),this},e.prototype.distanceTo=function(e){var t=r(e),n=t.x-this.x,i=t.y-this.y;return Math.sqrt(n*n+i*i)},e.prototype.equals=function(e,t){var n=r(e);return Math.max(Math.abs(this.x-n.x),Math.abs(this.y-n.y))<=(void 0===t?1e-9:t)},e.prototype.contains=function(e){var t=r(e);return Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},e.prototype.toString=function(){return"Point("+lV.formatNum(this.x)+", "+lV.formatNum(this.y)+")"},e}();function r(e,t,r){return e instanceof n?e:Array.isArray(e)?new n(e[0],e[1]):null==e?e:"object"==typeof e&&"x"in e&&"y"in e?new n(e.x,e.y):new n(e,t,r)}t.Point=n,t.toPoint=r}));G(cV);cV.Point,cV.toPoint;var hV=H((function(e,t){t.__esModule=!0;var n=function(){function e(e,t){if(e){var n=t?[e,t]:e;if(Array.isArray(n))for(var r=0,i=n.length;r<i;r+=1)this.extend(n[r])}}return e.prototype.extend=function(e){var t=cV.toPoint(e);return this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},e.prototype.getCenter=function(e){return new cV.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},e.prototype.getBottomLeft=function(){return new cV.Point(this.min.x,this.max.y)},e.prototype.getTopRight=function(){return new cV.Point(this.max.x,this.min.y)},e.prototype.getBottomRight=function(){return this.max},e.prototype.getTopLeft=function(){return this.min},e.prototype.getSize=function(){return this.max.subtract(this.min)},e.prototype.contains=function(t){var n,i,a=t;return(a=a instanceof cV.Point||"number"==typeof a[0]?cV.toPoint(a):r(a))instanceof e?(n=a.min,i=a.max):n=i=t,n.x>=this.min.x&&i.x<=this.max.x&&n.y>=this.min.y&&i.y<=this.max.y},e.prototype.intersect=function(e){var t=r(e),n=this.min,i=this.max,a=t.min,o=t.max,s=o.x>=n.x&&a.x<=i.x,u=o.y>=n.y&&a.y<=i.y;return s&&u},e.prototype.overlaps=function(e){var t=r(e),n=this.min,i=this.max,a=t.min,o=t.max,s=o.x>n.x&&a.x<i.x,u=o.y>n.y&&a.y<i.y;return s&&u},e.prototype.isValid=function(){return!(!this.min||!this.max)},e}();function r(e,t){return!e||e instanceof n?e:new n(e,t)}t.Bounds=n,t.toBounds=r}));G(hV);hV.Bounds,hV.toBounds;var fV=H((function(e,t){t.__esModule=!0;var n=function(){function e(e,t){if(e){var n=t?[e,t]:e;if(Array.isArray(n))for(var r=0,i=n.length;r<i;r+=1)this.extend(n[r])}}return e.prototype.extend=function(t){var n,i,a=this.southWest,o=this.northEast;if(t instanceof pV.LngLat)n=t,i=t;else{if(!(t instanceof e))return t&&Array.isArray(t)?Array.isArray(t[0])?this.extend(r(t)):this.extend(pV.toLngLat(t)):this;if(n=t.southWest,i=t.northEast,!n||!i)return this}return a||o?(a.lat=Math.min(n.lat,a.lat),a.lng=Math.min(n.lng,a.lng),o.lat=Math.max(i.lat,o.lat),o.lng=Math.max(i.lng,o.lng)):(this.southWest=new pV.LngLat(n.lng,n.lat),this.northEast=new pV.LngLat(i.lng,i.lat)),this},e.prototype.pad=function(t){var n=this.southWest,r=this.northEast,i=Math.abs(n.lat-r.lat)*t,a=Math.abs(n.lng-r.lng)*t;return new e(new pV.LngLat(n.lng-a,n.lat-i),new pV.LngLat(r.lng+a,r.lat+i))},e.prototype.getCenter=function(){return new pV.LngLat((this.southWest.lng+this.northEast.lng)/2,(this.southWest.lat+this.northEast.lat)/2)},e.prototype.getSouthWest=function(){return this.southWest},e.prototype.getNorthEast=function(){return this.northEast},e.prototype.getNorthWest=function(){return new pV.LngLat(this.getWest(),this.getNorth())},e.prototype.getSouthEast=function(){return new pV.LngLat(this.getEast(),this.getSouth())},e.prototype.getWest=function(){return this.southWest.lng},e.prototype.getSouth=function(){return this.southWest.lat},e.prototype.getNorth=function(){return this.northEast.lat},e.prototype.getEast=function(){return this.northEast.lng},e.prototype.contains=function(t){var n=t;n=Array.isArray(n)&&"number"==typeof n[0]||n instanceof pV.LngLat||"lat"in n?pV.toLngLat(n):r(n);var i,a,o=this.southWest,s=this.northEast;return n instanceof e?(i=n.getSouthWest(),a=n.getNorthEast()):i=a=n,i.lat>=o.lat&&a.lat<=s.lat&&i.lng>=o.lng&&a.lng<=s.lng},e.prototype.intersects=function(e){var t=r(e),n=this.southWest,i=this.northEast,a=t.getSouthWest(),o=t.getNorthEast(),s=o.lat>=n.lat&&a.lat<=i.lat,u=o.lng>=n.lng&&a.lng<=i.lng;return s&&u},e.prototype.overlaps=function(e){var t=r(e),n=this.southWest,i=this.northEast,a=t.getSouthWest(),o=t.getNorthEast(),s=o.lat>n.lat&&a.lat<i.lat,u=o.lng>n.lng&&a.lng<i.lng;return s&&u},e.prototype.toBBoxString=function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},e.prototype.equals=function(e,t){if(!e)return!1;var n=r(e);return this.southWest.equals(n.getSouthWest(),t)&&this.northEast.equals(n.getNorthEast(),t)},e.prototype.isValid=function(){return!(!this.southWest||!this.northEast)},e}();function r(e,t){return e instanceof n?e:void 0!==t?new n(e,t):new n(e)}t.LngLatBounds=n,t.toLngLatBounds=r}));G(fV);fV.LngLatBounds,fV.toLngLatBounds;var pV=H((function(e,t){t.__esModule=!0;var n=function(){function e(e,t,n){if(isNaN(t)||isNaN(e))throw new Error("无效的经纬度参数: ("+e+",' "+t);this.lat=+t,this.lng=+e,void 0!==n&&(this.alt=+n)}return e.prototype.equals=function(e,t){if(!e)return!1;var n=r(e);return void 0!==n&&Math.max(Math.abs(this.lat-n.lat),Math.abs(this.lng-n.lng))<=(void 0===t?1e-9:t)},e.prototype.toString=function(e){return"LngLat("+lV.formatNum(this.lng,e)+", "+lV.formatNum(this.lat,e)+")"},e.prototype.distanceTo=function(e){return mG.earth.distance(this,r(e))},e.prototype.wrap=function(){return mG.earth.wrapLngLat(this)},e.prototype.toBounds=function(e){var t=180*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return fV.toLngLatBounds([this.lng-n,this.lat-t],[this.lng+n,this.lat+t])},e.prototype.clone=function(){return new e(this.lng,this.lat,this.alt)},e}();function r(e,t,r){if(e instanceof n)return e;if(Array.isArray(e)&&"object"!=typeof e[0]){if(3===e.length)return new n(e[0],e[1],e[2]);if(2===e.length)return new n(e[0],e[1])}if(null==e)throw new Error("无效的经纬度参数: ("+e+", "+t+")");if("object"==typeof e&&"lat"in e)return new n(e.lng,"lng"in e?e.lat:0,e.alt);if(void 0===t)throw new Error("无效的经纬度参数: ("+e+", "+t+")");return new n(Number(e),t,r)}t.LngLat=n,t.toLngLat=r}));G(pV);pV.LngLat,pV.toLngLat;var dV=H((function(e,t){var n;t.__esModule=!0,t.sphericalMercator={R:6378137,MAX_LATITUDE:85.0511287798,project:function(e){var t=Math.PI/180,n=this.MAX_LATITUDE,r=Math.max(Math.min(n,e.lat),-n),i=Math.sin(r*t);return new cV.Point(this.R*e.lng*t,this.R*Math.log((1+i)/(1-i))/2)},unproject:function(e){var t=180/Math.PI;return new pV.LngLat(e.x*t/this.R,(2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*t)},bounds:(n=6378137*Math.PI,new hV.Bounds([-n,-n],[n,n]))}}));G(dV);dV.sphericalMercator;var vV=H((function(e,t){t.__esModule=!0;var n=function(){function e(e,t,n,r){if(Array.isArray(e))return this.a=e[0],this.b=e[1],this.c=e[2],void(this.d=e[3]);this.a=e,this.b=t,this.c=n,this.d=r}return e.prototype.transform=function(e,t){return this._transform(e.clone(),t)},e.prototype._transform=function(e,t){var n=t||1;return e.x=n*(this.a*e.x+this.b),e.y=n*(this.c*e.y+this.d),e},e.prototype.untransform=function(e,t){var n=t||1;return new cV.Point((e.x/n-this.b)/this.a,(e.y/n-this.d)/this.c)},e}();t.Transformation=n}));G(vV);vV.Transformation;var gV=H((function(e,t){t.__esModule=!0;var n=.5/(Math.PI*dV.sphericalMercator.R),r=new vV.Transformation(n,.5,-n,.5);t.CRS={wrapLng:[-180,180],wrapLat:null,projection:dV.sphericalMercator,transformation:r,lngLatToPoint:function(e,t){var n=this.projection.project(e),r=this.scale(t);return this.transformation.transform(n,r)},pointToLngLat:function(e,t){var n=this.scale(t),r=this.transformation.untransform(e,n);return this.projection.unproject(r)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},zoom:function(e){return Math.log(e/256)/Math.LN2},scale:function(e){return 256*Math.pow(2,e)},getProjectedBounds:function(e){if(this.infinite)return new hV.Bounds([[1/0,1/0],[1/0,1/0]]);var t=this.projection.bounds,n=this.scale(e),r=this.transformation.transform(t.min,n),i=this.transformation.transform(t.max,n);return new hV.Bounds(r,i)},infinite:!1,wrapLngLat:function(e){var t=Array.isArray(this.wrapLng)?lV.wrapNum(e.lng,this.wrapLng,!0):e.lng,n=Array.isArray(this.wrapLat)?lV.wrapNum(e.lat,this.wrapLat,!0):e.lat,r=e.alt;return new pV.LngLat(t,n,r)},wrapLngLatBounds:function(e){var t=e.getCenter(),n=this.wrapLngLat(t),r=t.lat-n.lat,i=t.lng-n.lng;if(0===r&&0===i)return e;var a=e.getSouthWest(),o=e.getNorthEast(),s=new pV.LngLat(a.lng-i,a.lat-r),u=new pV.LngLat(o.lng-i,o.lat-r);return new fV.LngLatBounds(s,u)}}}));G(gV);gV.CRS;var mV=function(e){return null!==e&&"function"!=typeof e&&isFinite(e.length)},yV=function(e,t){return!!mV(e)&&e.indexOf(t)>-1},_V=function(e,t){if(!mV(e))return e;for(var n=[],r=0;r<e.length;r++){var i=e[r];t(i,r)&&n.push(i)}return n},bV={}.toString,xV=function(e,t){return bV.call(e)==="[object "+t+"]"},EV=function(e){return xV(e,"Function")},SV=function(e){return null==e},CV=function(e){return Array.isArray?Array.isArray(e):xV(e,"Array")},TV=function(e){var t=typeof e;return null!==e&&"object"===t||"function"===t};function AV(e,t){if(e)if(CV(e))for(var n=0,r=e.length;n<r&&!1!==t(e[n],n);n++);else if(TV(e))for(var i in e)if(e.hasOwnProperty(i)&&!1===t(e[i],i))break}var MV=Object.keys?function(e){return Object.keys(e)}:function(e){var t=[];return AV(e,(function(n,r){EV(e)&&"prototype"===r||t.push(r)})),t};function wV(e,t){var n=MV(t),r=n.length;if(SV(e))return!r;for(var i=0;i<r;i+=1){var a=n[i];if(t[a]!==e[a]||!(a in e))return!1}return!0}var kV=function(e){return"object"==typeof e&&null!==e},OV=function(e){if(!kV(e)||!xV(e,"Object"))return!1;if(null===Object.getPrototypeOf(e))return!0;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t};var PV=function(e,t){if(void 0===t&&(t=[]),CV(e))for(var n=0;n<e.length;n+=1)PV(e[n],t);else t.push(e);return t},RV=function(e){if(CV(e))return e.reduce((function(e,t){return Math.max(e,t)}),e[0])},LV=function(e){if(CV(e))return e.reduce((function(e,t){return Math.min(e,t)}),e[0])},IV=Array.prototype,NV=IV.splice,DV=IV.indexOf,FV=Array.prototype.splice,BV=function(e,t){if(!mV(e))return[];for(var n=e?t.length:0,r=n-1;n--;){var i=void 0,a=t[n];n!==r&&a===i||(i=a,FV.call(e,a,1))}return e},UV=function(e,t,n){if(!CV(e)&&!OV(e))return e;var r=n;return AV(e,(function(e,n){r=t(r,e,n)})),r},zV=function(e){return xV(e,"String")};function jV(e,t){void 0===t&&(t=new Map);var n=[];if(Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var a=e[r];t.has(a)||(n.push(a),t.set(a,!0))}return n}var VV=Object.prototype.hasOwnProperty;function GV(e,t){if(!t||!CV(e))return{};for(var n,r={},i=EV(t)?t:function(e){return e[t]},a=0;a<e.length;a++){var o=e[a];n=i(o),VV.call(r,n)?r[n].push(o):r[n]=[o]}return r}function HV(e,t){if(!t)return{0:e};if(!EV(t)){var n=CV(t)?t:t.replace(/\s+/g,"").split("*");t=function(e){for(var t="_",r=0,i=n.length;r<i;r++)t+=e[n[r]]&&e[n[r]].toString();return t}}return GV(e,t)}var WV={};var XV=function(e){return xV(e,"Number")},YV=Number.isInteger?Number.isInteger:function(e){return XV(e)&&e%1==0};var ZV=180/Math.PI,qV=Math.PI/180,KV=function(e,t){return e.hasOwnProperty(t)},QV=Object.values?function(e){return Object.values(e)}:function(e){var t=[];return AV(e,(function(n,r){EV(e)&&"prototype"===r||t.push(n)})),t},JV=function(e){return SV(e)?"":e.toString()};var $V={}.toString,eG=function(e){return $V.call(e).replace(/^\[object /,"").replace(/]$/,"")};var tG=Object.prototype,nG=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||tG)};function rG(e,t){for(var n in t)t.hasOwnProperty(n)&&"constructor"!==n&&void 0!==t[n]&&(e[n]=t[n])}function iG(e,t,n,r){return t&&rG(e,t),n&&rG(e,n),r&&rG(e,r),e}var aG=function(e){if("object"!=typeof e||null===e)return e;var t;if(CV(e)){t=[];for(var n=0,r=e.length;n<r;n++)"object"==typeof e[n]&&null!=e[n]?t[n]=aG(e[n]):t[n]=e[n]}else for(var i in t={},e)"object"==typeof e[i]&&null!=e[i]?t[i]=aG(e[i]):t[i]=e[i];return t};var oG=function(e,t){if(!EV(e))throw new TypeError("Expected a function");var n=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var a=t?t.apply(this,r):r[0],o=n.cache;if(o.has(a))return o.get(a);var s=e.apply(this,r);return o.set(a,s),s};return n.cache=new Map,n};function sG(e,t,n,r){for(var i in n=n||0,r=r||5,t)if(t.hasOwnProperty(i)){var a=t[i];null!==a&&OV(a)?(OV(e[i])||(e[i]={}),n<r?sG(e[i],a,n+1,r):e[i]=t[i]):CV(a)?(e[i]=[],e[i]=e[i].concat(a)):void 0!==a&&(e[i]=a)}}var uG=Object.prototype.hasOwnProperty;var lG,cG=function(e,t){if(e===t)return!0;if(!e||!t)return!1;if(zV(e)||zV(t))return!1;if(mV(e)||mV(t)){if(e.length!==t.length)return!1;for(var n=!0,r=0;r<e.length&&(n=cG(e[r],t[r]));r++);return n}if(kV(e)||kV(t)){var i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(n=!0,r=0;r<i.length&&(n=cG(e[i[r]],t[i[r]]));r++);return n}return!1},hG=function(e){return e},fG=Object.prototype.hasOwnProperty,pG={};var dG=oG((function(e,t){void 0===t&&(t={});var n=t.fontSize,r=t.fontFamily,i=t.fontWeight,a=t.fontStyle,o=t.fontVariant;return lG||(lG=document.createElement("canvas").getContext("2d")),lG.font=[a,o,i,n+"px",r].join(" "),lG.measureText(zV(e)?e:"").width}),(function(e,t){return void 0===t&&(t={}),eV([e],QV(t)).join("")})),vG=function(){function e(){this.map={}}return e.prototype.has=function(e){return void 0!==this.map[e]},e.prototype.get=function(e,t){var n=this.map[e];return void 0===n?t:n},e.prototype.set=function(e,t){this.map[e]=t},e.prototype.clear=function(){this.map={}},e.prototype.delete=function(e){delete this.map[e]},e.prototype.size=function(){return Object.keys(this.map).length},e}(),gG=Object.freeze({__proto__:null,contains:yV,includes:yV,difference:function(e,t){return void 0===t&&(t=[]),_V(e,(function(e){return!yV(t,e)}))},find:function(e,t){if(!CV(e))return null;var n;if(EV(t)&&(n=t),OV(t)&&(n=function(e){return wV(e,t)}),n)for(var r=0;r<e.length;r+=1)if(n(e[r]))return e[r];return null},findIndex:function(e,t,n){void 0===n&&(n=0);for(var r=n;r<e.length;r++)if(t(e[r],r))return r;return-1},firstValue:function(e,t){for(var n=null,r=0;r<e.length;r++){var i=e[r][t];if(!SV(i)){n=CV(i)?i[0]:i;break}}return n},flatten:function(e){if(!CV(e))return[];for(var t=[],n=0;n<e.length;n++)t=t.concat(e[n]);return t},flattenDeep:PV,getRange:function(e){var t=e.filter((function(e){return!isNaN(e)}));if(!t.length)return{min:0,max:0};if(CV(e[0])){for(var n=[],r=0;r<e.length;r++)n=n.concat(e[r]);t=n}var i=RV(t);return{min:LV(t),max:i}},pull:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0;r<t.length;r++)for(var i=t[r],a=-1;(a=DV.call(e,i))>-1;)NV.call(e,a,1);return e},pullAt:BV,reduce:UV,remove:function(e,t){var n=[];if(!mV(e))return n;for(var r=-1,i=[],a=e.length;++r<a;){var o=e[r];t(o,r,e)&&(n.push(o),i.push(r))}return BV(e,i),n},sortBy:function(e,t){var n;if(EV(t))n=function(e,n){return t(e)-t(n)};else{var r=[];zV(t)?r.push(t):CV(t)&&(r=t),n=function(e,t){for(var n=0;n<r.length;n+=1){var i=r[n];if(e[i]>t[i])return 1;if(e[i]<t[i])return-1}return 0}}return e.sort(n),e},union:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return jV([].concat.apply([],e))},uniq:jV,valuesOfKey:function(e,t){for(var n=[],r={},i=0;i<e.length;i++){var a=e[i][t];if(!SV(a)){CV(a)||(a=[a]);for(var o=0;o<a.length;o++){var s=a[o];r[s]||(n.push(s),r[s]=!0)}}}return n},head:function(e){if(mV(e))return e[0]},last:function(e){if(mV(e)){return e[e.length-1]}},startsWith:function(e,t){return!(!CV(e)&&!zV(e))&&e[0]===t},endsWith:function(e,t){return!(!CV(e)&&!zV(e))&&e[e.length-1]===t},filter:_V,every:function(e,t){for(var n=0;n<e.length;n++)if(!t(e[n],n))return!1;return!0},some:function(e,t){for(var n=0;n<e.length;n++)if(t(e[n],n))return!0;return!1},group:function(e,t){if(!t)return[e];var n=HV(e,t),r=[];for(var i in n)r.push(n[i]);return r},groupBy:GV,groupToMap:HV,getWrapBehavior:function(e,t){return e["_wrap_"+t]},wrapBehavior:function(e,t){if(e["_wrap_"+t])return e["_wrap_"+t];var n=function(n){e[t](n)};return e["_wrap_"+t]=n,n},number2color:function(e){var t=WV[e];if(!t){for(var n=e.toString(16),r=n.length;r<6;r++)n="0"+n;t="#"+n,WV[e]=t}return t},parseRadius:function(e){var t=0,n=0,r=0,i=0;return CV(e)?1===e.length?t=n=r=i=e[0]:2===e.length?(t=r=e[0],n=i=e[1]):3===e.length?(t=e[0],n=i=e[1],r=e[2]):(t=e[0],n=e[1],r=e[2],i=e[3]):t=n=r=i=e,{r1:t,r2:n,r3:r,r4:i}},clamp:function(e,t,n){return e<t?t:e>n?n:e},fixedBase:function(e,t){var n=t.toString(),r=n.indexOf(".");if(-1===r)return Math.round(e);var i=n.substr(r+1).length;return i>20&&(i=20),parseFloat(e.toFixed(i))},isDecimal:function(e){return XV(e)&&e%1!=0},isEven:function(e){return XV(e)&&e%2==0},isInteger:YV,isNegative:function(e){return XV(e)&&e<0},isNumberEqual:function(e,t,n){return void 0===n&&(n=1e-5),Math.abs(e-t)<n},isOdd:function(e){return XV(e)&&e%2!=0},isPositive:function(e){return XV(e)&&e>0},max:RV,maxBy:function(e,t){if(CV(e)){for(var n,r=-1/0,i=0;i<e.length;i++){var a=e[i],o=EV(t)?t(a):a[t];o>r&&(n=a,r=o)}return n}},min:LV,minBy:function(e,t){if(CV(e)){for(var n,r=1/0,i=0;i<e.length;i++){var a=e[i],o=EV(t)?t(a):a[t];o<r&&(n=a,r=o)}return n}},mod:function(e,t){return(e%t+t)%t},toDegree:function(e){return ZV*e},toInteger:parseInt,toRadian:function(e){return qV*e},forIn:AV,has:KV,hasKey:KV,hasValue:function(e,t){return yV(QV(e),t)},keys:MV,isMatch:wV,values:QV,lowerCase:function(e){return JV(e).toLowerCase()},lowerFirst:function(e){var t=JV(e);return t.charAt(0).toLowerCase()+t.substring(1)},substitute:function(e,t){return e&&t?e.replace(/\\?\{([^{}]+)\}/g,(function(e,n){return"\\"===e.charAt(0)?e.slice(1):void 0===t[n]?"":t[n]})):e},upperCase:function(e){return JV(e).toUpperCase()},upperFirst:function(e){var t=JV(e);return t.charAt(0).toUpperCase()+t.substring(1)},getType:eG,isArguments:function(e){return xV(e,"Arguments")},isArray:CV,isArrayLike:mV,isBoolean:function(e){return xV(e,"Boolean")},isDate:function(e){return xV(e,"Date")},isError:function(e){return xV(e,"Error")},isFunction:EV,isFinite:function(e){return XV(e)&&isFinite(e)},isNil:SV,isNull:function(e){return null===e},isNumber:XV,isObject:TV,isObjectLike:kV,isPlainObject:OV,isPrototype:nG,isRegExp:function(e){return xV(e,"RegExp")},isString:zV,isType:xV,isUndefined:function(e){return void 0===e},isElement:function(e){return e instanceof Element||e instanceof HTMLDocument},requestAnimationFrame:function(e){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,16)})(e)},clearAnimationFrame:function(e){(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout)(e)},augment:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=e[0],r=1;r<e.length;r++){var i=e[r];EV(i)&&(i=i.prototype),iG(n.prototype,i)}},clone:aG,debounce:function(e,t,n){var r;return function(){var i=this,a=arguments,o=function(){r=null,n||e.apply(i,a)},s=n&&!r;clearTimeout(r),r=setTimeout(o,t),s&&e.apply(i,a)}},memoize:oG,deepMix:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0;r<t.length;r+=1)sG(e,t[r]);return e},each:AV,extend:function(e,t,n,r){EV(t)||(n=t,t=e,e=function(){});var i=Object.create?function(e,t){return Object.create(e,{constructor:{value:t}})}:function(e,t){function n(){}n.prototype=e;var r=new n;return r.constructor=t,r},a=i(t.prototype,e);return e.prototype=iG(a,e.prototype),e.superclass=i(t.prototype,t),iG(a,n),iG(e,r),e},indexOf:function(e,t){if(!mV(e))return-1;var n=Array.prototype.indexOf;if(n)return n.call(e,t);for(var r=-1,i=0;i<e.length;i++)if(e[i]===t){r=i;break}return r},isEmpty:function(e){if(SV(e))return!0;if(mV(e))return!e.length;var t=eG(e);if("Map"===t||"Set"===t)return!e.size;if(nG(e))return!Object.keys(e).length;for(var n in e)if(uG.call(e,n))return!1;return!0},isEqual:cG,isEqualWith:function(e,t,n){return EV(n)?!!n(e,t):cG(e,t)},map:function(e,t){if(!mV(e))return e;for(var n=[],r=0;r<e.length;r++){var i=e[r];n.push(t(i,r))}return n},mapValues:function(e,t){void 0===t&&(t=hG);var n={};return TV(e)&&!SV(e)&&Object.keys(e).forEach((function(r){n[r]=t(e[r],r)})),n},mix:iG,assign:iG,get:function(e,t,n){for(var r=0,i=zV(t)?t.split("."):t;e&&r<i.length;)e=e[i[r++]];return void 0===e||r<i.length?n:e},set:function(e,t,n){var r=e,i=zV(t)?t.split("."):t;return i.forEach((function(e,t){t<i.length-1?(TV(r[e])||(r[e]=XV(i[t+1])?[]:{}),r=r[e]):r[e]=n})),e},pick:function(e,t){if(null===e||!OV(e))return{};var n={};return AV(t,(function(t){fG.call(e,t)&&(n[t]=e[t])})),n},omit:function(e,t){return UV(e,(function(e,n,r){return t.includes(r)||(e[r]=n),e}),{})},throttle:function(e,t,n){var r,i,a,o,s=0;n||(n={});var u=function(){s=!1===n.leading?0:Date.now(),r=null,o=e.apply(i,a),r||(i=a=null)},l=function(){var l=Date.now();s||!1!==n.leading||(s=l);var c=t-(l-s);return i=this,a=arguments,c<=0||c>t?(r&&(clearTimeout(r),r=null),s=l,o=e.apply(i,a),r||(i=a=null)):r||!1===n.trailing||(r=setTimeout(u,c)),o};return l.cancel=function(){clearTimeout(r),s=0,r=i=a=null},l},toArray:function(e){return mV(e)?Array.prototype.slice.call(e):[]},toString:JV,uniqueId:function(e){return pG[e=e||"g"]?pG[e]+=1:pG[e]=1,e+pG[e]},noop:function(){},identity:function(e){return e},size:function(e){return SV(e)?0:mV(e)?e.length:Object.keys(e).length},measureTextWidth:dG,getEllipsisText:function(e,t,n,r){void 0===r&&(r="...");var i,a,o=dG(r,n),s=zV(e)?e:JV(e),u=t,l=[];if(dG(e,n)<=t)return e;for(;i=s.substr(0,16),!((a=dG(i,n))+o>u&&a>u);)if(l.push(i),u-=a,!(s=s.substr(16)))return l.join("");for(;i=s.substr(0,1),!((a=dG(i,n))+o>u);)if(l.push(i),u-=a,!(s=s.substr(1)))return l.join("");return""+l.join("")+r},Cache:vG}),mG=H((function(e,t){t.__esModule=!0,t.earth=gG.mix({},gV.CRS,{wrapLng:[-180,180],R:6371e3,distance:function(e,t){var n=Math.PI/180,r=e.lat*n,i=t.lat*n,a=Math.sin((t.lat-e.lat)*n/2),o=Math.sin((t.lng-e.lng)*n/2),s=a*a+Math.cos(r)*Math.cos(i)*o*o,u=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return this.R*u}})}));G(mG);mG.earth;var yG=H((function(e,t){t.__esModule=!0;var n=.5/(Math.PI*dV.sphericalMercator.R),r=new vV.Transformation(n,.5,-n,.5);t.epsg3857=gG.mix({},mG.earth,{code:"EPSG:3857",projection:dV.sphericalMercator,transformation:r}),t.epsg900913=gG.mix({},t.epsg3857,{code:"EPSG:900913"})}));G(yG);yG.epsg3857,yG.epsg900913;var _G=H((function(e,t){t.__esModule=!0,t.lngLatProjection={project:function(e){return new cV.Point(e.lng,e.lat)},unproject:function(e){return new pV.LngLat(e.x,e.y)},bounds:new hV.Bounds([-180,-90],[180,90])}}));G(_G);_G.lngLatProjection;var bG=H((function(e,t){t.__esModule=!0;var n=new vV.Transformation(1/180,1,-1/180,.5);t.epsg4326=gG.mix({},mG.earth,{code:"EPSG:4326",projection:_G.lngLatProjection,transformation:n})}));G(bG);bG.epsg4326;var xG=H((function(e,t){t.__esModule=!0;var n=new vV.Transformation(1,0,-1,0);t.simple=gG.mix({},gV.CRS,{projection:_G.lngLatProjection,transformation:n,scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,t){var n=t.lng-e.lng,r=t.lat-e.lat;return Math.sqrt(n*n+r*r)},infinite:!0})}));G(xG);xG.simple;var EG=H((function(e,t){t.__esModule=!0;var n={epsg3857:yG.epsg3857,epsg4326:bG.epsg4326,simple:xG.simple,earth:mG.earth,epsg900913:yG.epsg900913};t.getCRS=function(e){return n[e.toLowerCase()]}}));G(EG);EG.getCRS;var SG=H((function(e,t){t.__esModule=!0;var n=function(e){function t(t){var n=e.call(this,rV.__assign({projection:"EPSG3857",zoom:7,mapCenter:[116.400146,39.926588]},t))||this;return n.type="geo",n.isGeo=!0,t.center?n.center=t.center:n.center=n.mapCenter,n._init(),n}return rV.__extends(t,e),t.prototype._init=function(){var e=this.start,t=this.end;this.center=pV.toLngLat(this.center),this.width=Math.abs(t.x-e.x),this.height=Math.abs(t.y-e.y),this.crs=EG.getCRS(this.projection)},t.prototype.getZoom=function(){return this.zoom},t.prototype.setZoom=function(e){this.zoom=e},t.prototype.setCenter=function(e){this.center=pV.toLngLat(e)},t.prototype.getCenter=function(){return this.center},t.prototype.convertPoint=function(e){var t=[e.x,e.y],n=this.project(pV.toLngLat(t),this.zoom).round(),r=this.getPixelOrigin(),i=n.subtract(r);return{x:i.x,y:i.y}},t.prototype.invertPoint=function(e){var t=cV.toPoint(e),n=this.getPixelOrigin(),r=t.add(n),i=this.unproject(r,this.zoom);return{x:i.lng,y:i.lat}},t.prototype.layerPointToLatLng=function(e){var t=this.getPixelOrigin(),n=e.add(t);return this.unproject(n,this.zoom)},t.prototype.latLngToLayerPoint=function(e){var t=this.project(pV.toLngLat(e),this.zoom).round(),n=this.getPixelOrigin();return t.subtract(n)},t.prototype.getPixelOrigin=function(){var e=this.width/2,t=this.height/2;return this.crs.lngLatToPoint(pV.toLngLat(this.center),this.zoom).subtract({y:t,x:e})},t.prototype.project=function(e,t){var n=void 0===t?this.zoom:t;return this.crs.lngLatToPoint(pV.toLngLat(e),n)},t.prototype.unproject=function(e,t){var n=void 0===t?this.zoom:t;return this.crs.pointToLngLat(cV.toPoint(e),n)},t.prototype.distance=function(e,t){return this.crs.distance(pV.toLngLat(e),pV.toLngLat(t))},t}(uV.default);t.default=n}));G(SG);var CG=H((function(e,t){t.__esModule=!0,t.GeoCoordinates=SG,t.Bounds=hV.Bounds,t.toBounds=hV.toBounds,t.LngLat=pV.LngLat,t.toLngLat=pV.toLngLat,t.LngLatBounds=fV.LngLatBounds,t.toLngLatBounds=fV.toLngLatBounds,t.Point=cV.Point,t.toPoint=cV.toPoint}));G(CG);var TG=CG.GeoCoordinates,AG=CG.Bounds,MG=(CG.toBounds,CG.LngLat,CG.toLngLat),wG=(CG.LngLatBounds,CG.toLngLatBounds),kG=CG.Point,OG=(CG.toPoint,180/Math.PI),PG=/\{([zxy])\}/g,RG=function(){function e(t,n,r,i){_(this,e),E(this,"tile",void 0),E(this,"name",void 0),E(this,"imageLayer",void 0),this.name=t,this.tile=t.split("_").map((function(e){return Number(e)}));var a={x:this.tile[0],y:this.tile[1],z:this.tile[2]},o=this.getTileURL(a,n),s=this.tileLnglatBounds(this.tile),u=s.getWest(),l=s.getSouth(),c=s.getEast(),h=s.getNorth(),f=new Zj({zIndex:-999});f.source(o,{parser:{type:"image",extent:[u,l,c,h]}}),f.setContainer(r,i),f.init(),this.imageLayer=f}return x(e,[{key:"destroy",value:function(){this.imageLayer.clearModels(),this.imageLayer.destroy()}},{key:"getTileURL",value:function(e,t){return e.s||(e.s=String.fromCharCode(97+Math.floor(3*Math.random()))),PG.lastIndex=0,t.replace(PG,(function(t,n){return e[n]}))}},{key:"tileLnglatBounds",value:function(e){var t=this.tile2lng(e[0]+1,e[2]),n=this.tile2lng(e[0],e[2]),r=this.tile2lat(e[1]+1,e[2]),i=this.tile2lat(e[1],e[2]);return wG([n,i],[t,r])}},{key:"tile2lng",value:function(e,t){return e/Math.pow(2,t)*360-180}},{key:"tile2lat",value:function(e,t){var n=Math.PI-2*Math.PI*e/Math.pow(2,t);return OG*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))}}]),e}(),LG=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return""};_(this,e),E(this,"limit",void 0),E(this,"order",void 0),E(this,"cache",void 0),E(this,"destroy",void 0),this.limit=t,this.destroy=n,this.order=[],this.clear()}return x(e,[{key:"clear",value:function(){var e=this;this.order.forEach((function(t){e.delete(t)})),this.cache={},this.order=[]}},{key:"get",value:function(e){var t=this.cache[e];return t&&(this.deleteOrder(e),this.appendOrder(e)),t}},{key:"set",value:function(e,t){this.cache[e]?(this.delete(e),this.cache[e]=t,this.appendOrder(e)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[e]=t,this.appendOrder(e))}},{key:"delete",value:function(e){var t=this.cache[e];t&&(this.deleteCache(e),this.deleteOrder(e),this.destroy(t,e))}},{key:"deleteCache",value:function(e){delete this.cache[e]}},{key:"deleteOrder",value:function(e){var t=this.order.findIndex((function(t){return t===e}));t>=0&&this.order.splice(t,1)}},{key:"appendOrder",value:function(e){this.order.push(e)}}]),e}(),IG=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;_(this,e),E(this,"cache",void 0),this.cache=new LG(t,n)}return x(e,[{key:"getTile",value:function(e){return this.cache.get(e)}},{key:"setTile",value:function(e,t){this.cache.set(t,e)}},{key:"destory",value:function(){this.cache.clear()}},{key:"setNeedUpdate",value:function(){var e=this;this.cache.order.forEach((function(t){e.cache.get(t).needUpdate=!0}))}}]),e}(),NG=function(){function e(t){_(this,e),E(this,"tileList",{}),E(this,"tileCache",void 0),E(this,"updateTileList",void 0),E(this,"tileZoom",void 0),E(this,"noPruneRange",void 0),E(this,"url",void 0),E(this,"resolution",void 0),E(this,"maxSourceZoom",void 0),E(this,"crstype",void 0),E(this,"currentCrs",void 0),E(this,"layerService",void 0),E(this,"layer",void 0),this.layerService=t.layerService,this.layer=t.layer,this.url=t.url,this.resolution="low"===t.resolution?-1:0,this.maxSourceZoom=t.maxSourceZoom,this.crstype=t.crstype,this.currentCrs=new TG.default({start:{x:0,y:0},end:{x:0,y:0},projection:this.crstype}).crs,this.destroyTile=this.destroyTile.bind(this),this.tileCache=new IG(30,this.destroyTile),this.updateTileList=[],this.removeTiles=this.removeTiles.bind(this)}return x(e,[{key:"calCurrentTiles",value:function(e){var t=this,n=e.NE,r=e.SW,i=e.tileCenter,a=e.currentZoom,o=e.minSourceZoom,s=e.minZoom,u=e.maxZoom;if(!(a>=this.maxSourceZoom)){var l=Math.floor(a)+this.resolution;if(this.tileZoom=l>this.maxSourceZoom?this.maxSourceZoom:l,a<s||a>=u||a<o)this.removeTiles();else{this.updateTileList=[];var c=this.currentCrs.lngLatToPoint(MG(i.lng,i.lat),this.tileZoom).divideBy(256).floor(),h=this.getPixelBounds(n,r,i,this.tileZoom,this.currentCrs),f=this.pxBoundsToTileRange(h);if(this.noPruneRange=new AG(f.getBottomLeft().subtract([4,-4]),f.getTopRight().add([4,-4])),!(isFinite(f.min.x)&&isFinite(f.min.y)&&isFinite(f.max.x)&&isFinite(f.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var p=f.min.y;p<=f.max.y;p++)for(var d=f.min.x;d<=f.max.x;d++){var v=[d,p,this.tileZoom],g=this.tileList[v.join("_")];g?g.current=!0:(this.tileList[v.join("_")]={current:!0,coords:v},this.updateTileList.push(v))}this.updateTileList.sort((function(e,t){var n=e,r=t;return Math.pow(1*n[0]-c.x,2)+Math.pow(1*n[1]-c.y,2)-(Math.pow(1*r[0]-c.x,2)+Math.pow(1*r[1]-c.y,2))})),this.pruneTiles(),this.updateTileList.forEach((function(e){var n=e.join("_");t.tileList[n].current&&t.requestTile(n)}))}}}},{key:"pxBoundsToTileRange",value:function(e){return new AG(e.min.divideBy(256).floor(),e.max.divideBy(256).ceil().subtract([1,1]))}},{key:"getPixelBounds",value:function(e,t,n,r,i){var a,o,s=r,u=i.lngLatToPoint(MG(e.lng,e.lat),s),l=i.lngLatToPoint(MG(t.lng,t.lat),s),c=i.lngLatToPoint(MG(n.lng,n.lat),s),h=c.y-u.y,f=l.y-c.y;if(n.lng-e.lng>0||n.lng-t.lng<0){var p=256*Math.pow(2,s)/360*(180-e.lng)+256*Math.pow(2,s)/360*(t.lng+180);n.lng-e.lng>0?o=p-(a=256*Math.pow(2,s)/360*(n.lng-e.lng)):a=p-(o=256*Math.pow(2,s)/360*(t.lng-n.lng))}else a=256*Math.pow(2,s)/360*(n.lng-t.lng),o=256*Math.pow(2,s)/360*(e.lng-n.lng);return new AG(c.subtract(a,h),c.add(o,f))}},{key:"pruneTiles",value:function(){var e=this;Object.keys(this.tileList).map((function(t){var n=e.tileList[t].coords;n[2]===e.tileZoom&&e.noPruneRange.contains(new kG(n[0],n[1]))||(e.tileList[t].current=!1)})),Object.keys(this.tileList).map((function(t){var n=e.tileList[t];n.retain=n.current})),Object.keys(this.tileList).map((function(t){var n=e.tileList[t];if(n.current&&!n.active){var r=N(t.split("_").map((function(e){return Number(e)})),3),i=r[0],a=r[1],o=r[2];e.retainParent(i,a,o,o-5)||e.retainChildren(i,a,o,o+2)}})),this.removeOutTiles()}},{key:"requestTile",value:function(e){var t=this.tileList[e];if(t){var n=this.tileCache.getTile(e);if(n)n.imageLayer.show(),t.current=!0,t.retain=!0,t.active=!0,this.pruneTiles();else{var r=kP(this.layer.sceneContainer);(n=new RG(e,this.url,r,this.layer.sceneContainer)).name=e,t.current=!0,t.retain=!0,t.active=!0,this.layer.layerChildren.push(n.imageLayer),this.tileCache.setTile(n,e),this.pruneTiles(),this.layerService.updateLayerRenderList(),this.layerService.renderLayers()}}}},{key:"retainParent",value:function(e,t,n,r){var i=Math.floor(e/2),a=Math.floor(t/2),o=n-1,s=this.tileList[[i,a,o].join("_")];return s&&s.active?(s.retain=!0,!0):(s&&s.loaded&&(s.retain=!0),o>r&&this.retainParent(i,a,o,r))}},{key:"retainChildren",value:function(e,t,n,r){for(var i=2*e;i<2*e+2;i++)for(var a=2*t;a<2*t+2;a++){var o=[i,a,n+1].join("_"),s=this.tileList[o];s&&s.active?s.retain=!0:(s&&s.loaded&&(s.retain=!0),n+1<r&&this.retainChildren(i,a,n+1,r))}}},{key:"destroyTile",value:function(e){var t=this.layer.layerChildren.indexOf(e.imageLayer);t>-1&&this.layer.layerChildren.splice(t,1),e.imageLayer.destroy(),this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),e=null}},{key:"removeOutTiles",value:function(){for(var e in this.tileList)if(!this.tileList[e].retain){var t=this.tileCache.getTile(e);t&&t.imageLayer.hide(),delete this.tileList[e]}}},{key:"removeTiles",value:function(){this.layer.layerChildren.forEach((function(e){e.destroy()})),this.layer.layerChildren=[],this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.tileList={},this.tileCache.destory()}}]),e}(),DG={imageTile:function(t){S(r,t);var n=R(r);function r(){var e;_(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return E(O(e=n.call.apply(n,[this].concat(i))),"tileLayer",void 0),E(O(e),"timestamp",void 0),e}return x(r,[{key:"getUninforms",value:function(){return{}}},{key:"tile",value:function(){var e=N(this.mapService.getBounds(),2),t=e[0],n=e[1],r={lng:n[0],lat:n[1]},i={lng:t[0],lat:t[1]};this.tileLayer.calCurrentTiles({NE:r,SW:i,tileCenter:this.mapService.getCenter(),currentZoom:this.mapService.getZoom(),minSourceZoom:this.mapService.getMinZoom(),minZoom:this.mapService.getMinZoom(),maxZoom:this.mapService.getMaxZoom()})}},{key:"initModels",value:function(){var t=this;this.layer.zIndex=-999;var n=this.layer.getLayerConfig(),r=n.resolution,i=void 0===r?"low":r,a=n.maxSourceZoom,o=void 0===a?17:a,s=this.layer.getSource();return s.data.tileurl&&(this.tileLayer=new NG({url:s.data.tileurl,layerService:this.layerService,layer:this.layer,resolution:i,maxSourceZoom:o,crstype:"epsg3857"}),this.tile(),this.mapService.on("mapchange",(function(e){t.timestamp&&(clearTimeout(t.timestamp),t.timestamp=null),t.timestamp=setTimeout((function(){t.mapService.getZoom()>=2&&t.tile()}),500)}))),[this.layer.buildLayerModel({moduleName:"ImageTileLayer",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\n#pragma include "projection"\nvoid main() {\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n}\n}',fragmentShader:"precision mediump float;\nvoid main() {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}",triangulation:wj,primitive:e.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){this.tileLayer.removeTiles()}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){}}]),r}(dz)},FG=function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"type","ImageTileLayer"),e}return x(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new DG[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{imageTile:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"imageTile"}}]),n}(KU),BG={solid:0,dash:1},UG=function(t){S(r,t);var n=R(r);function r(){var t;_(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return E(O(t=n.call.apply(n,[this].concat(a))),"texture",void 0),E(O(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.NEAREST,min:e.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return x(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=t.sourceColor,i=t.targetColor,a=t.textureBlend,o=void 0===a?"normal":a,s=t.lineType,u=void 0===s?"solid":s,l=t.dashArray,c=void 0===l?[10,5]:l,h=t.forward,f=void 0===h||h,p=t.lineTexture,d=void 0!==p&&p,v=t.iconStep,g=void 0===v?100:v,m=t.segmentNumber,y=void 0===m?30:m,_=t.thetaOffset,b=void 0===_?.314:_;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,thetaOffset:b})){this.judgeStyleAttributes({opacity:n,thetaOffset:b});var x=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,x,this.cellProperties),S=E.data,C=E.width,T=E.height;this.rowCount=T,this.dataTexture=this.cellLength>0&&S.length>0?this.createTexture2D({flipY:!0,data:S,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:C,height:T}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}2===c.length&&c.push(0,0);var A=0,M=[0,0,0,0],w=[0,0,0,0];return r&&i&&(M=vg(r),w=vg(i),A=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:PU(b)?b:0,u_opacity:PU(n)?n:1,u_textureBlend:"normal"===o?0:1,segmentNumber:y,u_line_type:BG[u||"solid"],u_dash_array:c,u_blur:.9,u_lineDir:f?1:-1,u_texture:this.texture,u_line_texture:d?1:0,u_icon_step:g,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:A,u_sourceColor:M,u_targetColor:w}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return"dash"===e.lineType?{frag:'uniform float u_opacity;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nuniform float segmentNumber;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat d_distance_ratio = styleMappingMat[3].b;\ngl_FragColor = v_color;\ngl_FragColor.a *= opacity;\nfloat flag = 0.;\nfloat dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\nif(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\nflag = 1.;\n}\ngl_FragColor.a *=flag;\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_lineDir: 1.0;\nvarying vec4 v_dash_array;\nuniform float u_thetaOffset: 0.314;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalThetaOffset"\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat bezier3(vec3 arr, float t) {\nfloat ut = 1. - t;\nreturn (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\nvec2 center = target - source;\nfloat r = length(center);\nfloat theta = atan(center.y, center.x);\nfloat thetaOffset = arcThetaOffset;\nfloat r2 = r / 2.0 / cos(thetaOffset);\nfloat theta2 = theta + thetaOffset;\nvec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\nif(u_lineDir == 1.0) {\nreturn mid;\n} else {\nvec2 vmid = source + target - mid;\nreturn vmid;\n}\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\nvec2 mid = midPoint(source, target, arcThetaOffset);\nvec3 x = vec3(source.x, mid.x, target.x);\nvec3 y = vec3(source.y, mid.y, target.y);\nreturn vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nvoid main() {\nv_color = a_Color;\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][1] = thetaOffsetAndOffset.r;\ntextureOffset = thetaOffsetAndOffset.g;\nvec2 source = a_Instance.rg;\nvec2 target =  a_Instance.ba;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nvec2 s = source;\nvec2 t = target;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ns = unProjCustomCoord(source);\nt = unProjCustomCoord(target);\n}\nfloat total_Distance = pixelDistance(s, t) / 2.0 * PI;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\nstyleMappingMat[3].b = segmentIndex / segmentNumber;\nvec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\nvec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\nvec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',type:"dash"}:t&&n?{frag:'#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\nvarying mat4 styleMappingMat;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat d_segmentIndex = styleMappingMat[3].r;\ngl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\nuniform float u_lineDir: 1.0;\nuniform float u_thetaOffset: 0.314;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalThetaOffset"\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat bezier3(vec3 arr, float t) {\nfloat ut = 1. - t;\nreturn (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\nvec2 center = target - source;\nfloat r = length(center);\nfloat theta = atan(center.y, center.x);\nfloat thetaOffset = arcThetaOffset;\nfloat r2 = r / 2.0 / cos(thetaOffset);\nfloat theta2 = theta + thetaOffset;\nvec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\nif(u_lineDir == 1.0) {\nreturn mid;\n} else {\nvec2 vmid = source + target - mid;\nreturn vmid;\n}\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\nvec2 mid = midPoint(source, target, arcThetaOffset);\nvec3 x = vec3(source.x, mid.x, target.x);\nvec3 y = vec3(source.y, mid.y, target.y);\nreturn vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nvoid main() {\nv_color = a_Color;\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][1] = thetaOffsetAndOffset.r;\ntextureOffset = thetaOffsetAndOffset.g;\nvec2 source = a_Instance.rg;\nvec2 target =  a_Instance.ba;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nfloat d_distance_ratio;\nstyleMappingMat[3].b = d_distance_ratio;\nvec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\nvec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\nvec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\nfloat d_segmentIndex = a_Position.x + 1.0;\nstyleMappingMat[3].r = d_segmentIndex;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',type:"linear"}:{frag:'#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat animateSpeed = 0.0;\nfloat d_segmentIndex = styleMappingMat[3].r;\nfloat d_distance_ratio = styleMappingMat[3].b;\ngl_FragColor = v_color;\ngl_FragColor.a *= opacity;\nif(u_aimate.x == Animate && u_line_texture != LineTexture) {\nanimateSpeed = u_time / u_aimate.y;\nfloat alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\nalpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\nalpha = clamp(alpha, 0.0, 1.0);\ngl_FragColor.a *= alpha;\n}\nif(u_line_texture == LineTexture) {\nfloat arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));\nfloat count = styleMappingMat[3].g;\nfloat time = 0.0;\nif(u_aimate.x == Animate) {\ntime = u_time / u_aimate.y;\n}\nfloat redioCount = arcRadio * count;\nfloat u = fract(redioCount - time);\nfloat v = styleMappingMat[3].a;\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(u_aimate.x == Animate) {\nfloat currentPlane = floor(redioCount - time);\nfloat textureStep = floor(count * u_aimate.z);\nfloat a = mod(currentPlane, textureStep);\nif(a < textureStep - 1.0) {\npattern = vec4(0.0);\n}\n}\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor = filterColor(gl_FragColor + pattern);\n} else {\npattern.a *= opacity;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\n}\ngl_FragColor = filterColor(pattern);\n}\n} else {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',vert:'#define Animate 0.0\n#define LineTexture 1.0\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\nuniform float u_lineDir: 1.0;\nuniform float u_thetaOffset: 0.314;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalThetaOffset"\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat bezier3(vec3 arr, float t) {\nfloat ut = 1. - t;\nreturn (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\nvec2 center = target - source;\nfloat r = length(center);\nfloat theta = atan(center.y, center.x);\nfloat thetaOffset = arcThetaOffset;\nfloat r2 = r / 2.0 / cos(thetaOffset);\nfloat theta2 = theta + thetaOffset;\nvec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\nif(u_lineDir == 1.0) {\nreturn mid;\n} else {\nvec2 vmid = source + target - mid;\nreturn vmid;\n}\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\nvec2 mid = midPoint(source, target, arcThetaOffset);\nvec3 x = vec3(source.x, mid.x, target.x);\nvec3 y = vec3(source.y, mid.y, target.y);\nreturn vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nvoid main() {\nv_color = a_Color;\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][1] = thetaOffsetAndOffset.r;\ntextureOffset = thetaOffsetAndOffset.g;\nvec2 source = a_Instance.rg;\nvec2 target =  a_Instance.ba;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nfloat d_distance_ratio;\nif(u_aimate.x == Animate) {\nd_distance_ratio = segmentIndex / segmentNumber;\nif(u_lineDir != 1.0) {\nd_distance_ratio = 1.0 - d_distance_ratio;\n}\n}\nstyleMappingMat[3].b = d_distance_ratio;\nvec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\nvec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));\nvec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\nfloat d_segmentIndex = a_Position.x + 1.0;\nstyleMappingMat[3].r = d_segmentIndex;\nif(LineTexture == u_line_texture) {\nfloat arcDistrance = length(source - target);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\narcDistrance *= 1000000.0;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\narcDistrance = project_pixel_allmap(arcDistrance);\n}\nv_iconMapUV = a_iconMapUV;\nfloat pixelLen = project_pixel_texture(u_icon_step);\nfloat texCount = floor(arcDistrance/pixelLen);\nstyleMappingMat[3].g = texCount;\nfloat lineOffsetWidth = length(offset + offset * sign(a_Position.y));\nfloat linePixelSize = project_pixel(a_Size);\nstyleMappingMat[3].a = lineOffsetWidth/linePixelSize;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',type:"normal"}}},{key:"buildModels",value:function(){var e=this.layer.getLayerConfig(),t=e.segmentNumber,n=void 0===t?30:t,r=e.mask,i=void 0!==r&&r,a=e.maskInside,o=void 0===a||a,s=this.getShaders(),u=s.frag,l=s.vert,c=s.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+c,vertexShader:l,fragmentShader:u,triangulation:kj,depth:{enable:!1},blend:this.getBlend(),segmentNumber:n,stencil:xg(i,o)})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,a=void 0===i?1:i;return Array.isArray(a)?[a[0]]:[a]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:e.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e,t,n,r){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,n,r,i){var a=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[a.x,a.y]}}})}}]),r}(dz),zG={solid:0,dash:1},jG=function(t){S(r,t);var n=R(r);function r(){var t;_(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return E(O(t=n.call.apply(n,[this].concat(a))),"texture",void 0),E(O(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.NEAREST,min:e.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return x(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=t.sourceColor,i=t.targetColor,a=t.textureBlend,o=void 0===a?"normal":a,s=t.lineType,u=void 0===s?"solid":s,l=t.dashArray,c=void 0===l?[10,5]:l,h=t.lineTexture,f=void 0!==h&&h,p=t.iconStep,d=void 0===p?100:p,v=t.segmentNumber,g=void 0===v?30:v,m=t.globalArcHeight,y=void 0===m?10:m;2===c.length&&c.push(0,0);var _=0,b=[0,0,0,0],x=[0,0,0,0];if(r&&i&&(b=vg(r),x=vg(i),_=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var E=this.layer.getEncodedData(),S=this.calDataFrame(this.cellLength,E,this.cellProperties),C=S.data,T=S.width,A=S.height;this.rowCount=A,this.dataTexture=this.cellLength>0&&C.length>0?this.createTexture2D({flipY:!0,data:C,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:T,height:A}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_globel:"GLOBEL"===this.mapService.version?1:0,u_globel_radius:100,u_global_height:y,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:PU(n)?n:1,u_textureBlend:"normal"===o?0:1,segmentNumber:g,u_line_type:zG[u]||0,u_dash_array:c,u_texture:this.texture,u_line_texture:f?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:_,u_sourceColor:b,u_targetColor:x}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;e.lineType;return t&&n?{frag:'#define Animate 0.0\nuniform float u_opacity;\nuniform float u_blur : 0.9;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat animateSpeed = 0.0;\nfloat d_distance_ratio = styleMappingMat[3].g;\ngl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);\ngl_FragColor.a *= opacity;\nif(u_aimate.x == Animate) {\nanimateSpeed = u_time / u_aimate.y;\nfloat alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\nalpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\nalpha = clamp(alpha, 0.0, 1.0);\ngl_FragColor.a *= alpha;\n}\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\nreturn start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\nvec2 x = mix(source, target, ratio);\nvec2 center = mix(source, target, 0.5);\nfloat dSourceCenter = distance(source, center);\nfloat dXCenter = distance(x, center);\nreturn (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\nfloat vertex_height = paraboloid(source, target, segmentRatio);\nreturn vec3(\nmix(source, target, segmentRatio),\nsqrt(max(0.0, vertex_height))\n);\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat torad(float deg) {\nreturn (deg / 180.0) * acos(-1.0);\n}\nvec3 lglt2xyz(vec2 lnglat) {\nfloat pi = 3.1415926;\nfloat lng = torad(lnglat.x) + pi / 2.0;\nfloat lat = torad(lnglat.y);\nfloat radius = u_globel_radius;\nfloat z = radius * cos(lat) * cos(lng);\nfloat x = radius * cos(lat) * sin(lng);\nfloat y = radius * sin(lat);\nreturn vec3(x, y, z);\n}\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_color = a_Color;\nvec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\nvec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nfloat d_distance_ratio;\nif(u_line_type == LineTypeDash) {\nd_distance_ratio = segmentIndex / segmentNumber;\nvec2 s = source;\nvec2 t = target;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ns = unProjCustomCoord(source);\nt = unProjCustomCoord(target);\n}\nfloat total_Distance = pixelDistance(s, t) / 2.0 * PI;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n}\nif(u_aimate.x == Animate) {\nd_distance_ratio = segmentIndex / segmentNumber;\n}\nstyleMappingMat[3].g = d_distance_ratio;\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nvec3 curr = getPos(source, target, segmentRatio);\nvec3 next = getPos(source, target, nextSegmentRatio);\nvec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\nv_segmentIndex = a_Position.x;\nif(LineTexture == u_line_texture && u_line_type != LineTypeDash) {\nfloat arcDistrance = length(source - target);\nfloat pixelLen =  project_pixel_texture(u_icon_step);\nstyleMappingMat[3].b = floor(arcDistrance/pixelLen);\nvec2 projectOffset = project_pixel(offset);\nfloat lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y));\nfloat linePixelSize = project_pixel(a_Size);\nstyleMappingMat[3].a = lineOffsetWidth/linePixelSize;\nv_iconMapUV = a_iconMapUV;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n}\nif(u_globel > 0.0) {\nvec3 startLngLat = lglt2xyz(a_Instance.rg);\nvec3 endLngLat = lglt2xyz(a_Instance.ba);\nfloat globalRadius = length(startLngLat);\nvec3 lineDir = normalize(endLngLat - startLngLat);\nvec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\nvec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\nfloat lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\nfloat lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\nvec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\ngl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n}\nsetPickingColor(a_PickingColor);\n}',type:"linear"}:{frag:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat animateSpeed = 0.0;\nfloat d_distance_ratio = styleMappingMat[3].g;\ngl_FragColor = v_color;\ngl_FragColor.a *= opacity;\nif(u_line_type == LineTypeDash) {\nfloat flag = 0.;\nfloat dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\nif(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\nflag = 1.;\n}\ngl_FragColor.a *=flag;\n}\nif(u_aimate.x == Animate && u_line_texture != LineTexture) {\nanimateSpeed = u_time / u_aimate.y;\nfloat alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\nalpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\nalpha = clamp(alpha, 0.0, 1.0);\ngl_FragColor.a *= alpha;\n}\nif(u_line_texture == LineTexture && u_line_type != LineTypeDash) {\nfloat arcRadio = v_segmentIndex / (segmentNumber - 1.0);\nfloat count = styleMappingMat[3].b;\nfloat time = 0.0;\nif(u_aimate.x == Animate) {\ntime = u_time / u_aimate.y;\n}\nfloat redioCount = arcRadio * count;\nfloat u = fract(redioCount - time);\nfloat v = styleMappingMat[3].a;\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(u_aimate.x == Animate) {\nfloat currentPlane = floor(redioCount - time);\nfloat textureStep = floor(count * u_aimate.z);\nfloat a = mod(currentPlane, textureStep);\nif(a < textureStep - 1.0) {\npattern = vec4(0.0);\n}\n}\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor = filterColor(gl_FragColor + pattern);\n} else {\npattern.a *= opacity;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\ndiscard;\n} else {\ngl_FragColor = filterColor(pattern);\n}\n}\n} else {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\nreturn start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\nvec2 x = mix(source, target, ratio);\nvec2 center = mix(source, target, 0.5);\nfloat dSourceCenter = distance(source, center);\nfloat dXCenter = distance(x, center);\nreturn (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\nfloat vertex_height = paraboloid(source, target, segmentRatio);\nreturn vec3(\nmix(source, target, segmentRatio),\nsqrt(max(0.0, vertex_height))\n);\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat torad(float deg) {\nreturn (deg / 180.0) * acos(-1.0);\n}\nvec3 lglt2xyz(vec2 lnglat) {\nfloat pi = 3.1415926;\nfloat lng = torad(lnglat.x) + pi / 2.0;\nfloat lat = torad(lnglat.y);\nfloat radius = u_globel_radius;\nfloat z = radius * cos(lat) * cos(lng);\nfloat x = radius * cos(lat) * sin(lng);\nfloat y = radius * sin(lat);\nreturn vec3(x, y, z);\n}\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_color = a_Color;\nvec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\nvec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nfloat d_distance_ratio;\nif(u_line_type == LineTypeDash) {\nd_distance_ratio = segmentIndex / segmentNumber;\nvec2 s = source;\nvec2 t = target;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ns = unProjCustomCoord(source);\nt = unProjCustomCoord(target);\n}\nfloat total_Distance = pixelDistance(s, t) / 2.0 * PI;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n}\nif(u_aimate.x == Animate) {\nd_distance_ratio = segmentIndex / segmentNumber;\n}\nstyleMappingMat[3].g = d_distance_ratio;\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nvec3 curr = getPos(source, target, segmentRatio);\nvec3 next = getPos(source, target, nextSegmentRatio);\nvec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\nv_segmentIndex = a_Position.x;\nif(LineTexture == u_line_texture && u_line_type != LineTypeDash) {\nfloat arcDistrance = length(source - target);\nfloat pixelLen =  project_pixel_texture(u_icon_step);\nstyleMappingMat[3].b = floor(arcDistrance/pixelLen);\nvec2 projectOffset = project_pixel(offset);\nfloat lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y));\nfloat linePixelSize = project_pixel(a_Size);\nstyleMappingMat[3].a = lineOffsetWidth/linePixelSize;\nv_iconMapUV = a_iconMapUV;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n}\nif(u_globel > 0.0) {\nvec3 startLngLat = lglt2xyz(a_Instance.rg);\nvec3 endLngLat = lglt2xyz(a_Instance.ba);\nfloat globalRadius = length(startLngLat);\nvec3 lineDir = normalize(endLngLat - startLngLat);\nvec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\nvec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\nfloat lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\nfloat lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\nvec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\ngl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n}\nsetPickingColor(a_PickingColor);\n}',type:"normal"}}},{key:"buildModels",value:function(){var e=this.layer.getLayerConfig(),t=e.segmentNumber,n=void 0===t?30:t,r=e.mask,i=void 0!==r&&r,a=e.maskInside,o=void 0===a||a,s=this.getShaders(),u=s.frag,l=s.vert,c=s.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+c,vertexShader:l,fragmentShader:u,triangulation:kj,blend:this.getBlend(),segmentNumber:n,stencil:xg(i,o)})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,a=void 0===i?1:i;return Array.isArray(a)?[a[0]]:[a]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:e.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e,t,n,r){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,n,r,i){var a=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[a.x,a.y]}}})}}]),r}(dz),VG=function(t){S(r,t);var n=R(r);function r(){return _(this,r),n.apply(this,arguments)}return x(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.sourceColor,r=e.targetColor,i=e.forward,a=void 0===i||i,o=e.segmentNumber,s=void 0===o?30:o,u=e.thetaOffset,l=void 0===u?.314:u,c=0,h=[0,0,0,0],f=[0,0,0,0];return n&&r&&(h=vg(n),f=vg(r),c=1),{u_thetaOffset:l,u_opacity:PU(t)?t:1,segmentNumber:s,u_blur:.9,u_lineDir:a?1:-1,u_linearColor:c,u_sourceColor:h,u_targetColor:f}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var e=this.layer.getLayerConfig().segmentNumber,t=void 0===e?30:e;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\nuniform float u_lineDir: 1.0;\nuniform float u_thetaOffset: 0.314;\nuniform float u_opacity: 1.0;\nvarying float v_distance_ratio;\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat bezier3(vec3 arr, float t) {\nfloat ut = 1. - t;\nreturn (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target) {\nvec2 center = target - source;\nfloat r = length(center);\nfloat theta = atan(center.y, center.x);\nfloat thetaOffset = u_thetaOffset;\nfloat r2 = r / 2.0 / cos(thetaOffset);\nfloat theta2 = theta + thetaOffset;\nvec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\nif(u_lineDir == 1.0) {\nreturn mid;\n} else {\nvec2 vmid = source + target - mid;\nreturn vmid;\n}\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t) {\nvec2 mid = midPoint(source, target);\nvec3 x = vec3(source.x, mid.x, target.x);\nvec3 y = vec3(source.y, mid.y, target.y);\nreturn vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nvoid main() {\nv_color = a_Color;\nvec2 source = a_Instance.rg;\nvec2 target =  a_Instance.ba;\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nv_distance_ratio = segmentIndex / segmentNumber;\nif(u_aimate.x == Animate && u_lineDir != 1.0) {\nv_distance_ratio = 1.0 - v_distance_ratio;\n}\nvec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));\nvec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));\nvec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n}\n}',fragmentShader:'#define LineTypeSolid 0.0\n#define Animate 0.0\nuniform float u_opacity;\nuniform float u_blur : 0.9;\nvarying vec4 v_color;\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nuniform float segmentNumber;\nvarying float v_distance_ratio;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n#pragma include "picking"\nvoid main() {\nif(u_linearColor == 1.0) {\ngl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= u_opacity;\nif(u_aimate.x == Animate) {\nfloat animateSpeed = u_time / u_aimate.y;\nfloat alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\nalpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\nalpha = clamp(alpha, 0.0, 1.0);\ngl_FragColor.a *= alpha;\n}\n}',triangulation:kj,depth:{enable:!1},blend:this.getBlend(),segmentNumber:t})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,a=void 0===i?1:i;return Array.isArray(a)?[a[0]]:[a]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:e.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e,t,n,r){return[n[3],n[4],n[5],n[6]]}}})}}]),r}(dz),GG={solid:0,dash:1},HG=function(t){S(r,t);var n=R(r);function r(){var t;_(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return E(O(t=n.call.apply(n,[this].concat(a))),"texture",void 0),E(O(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.NEAREST,min:e.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return x(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=t.sourceColor,i=t.targetColor,a=t.textureBlend,o=void 0===a?"normal":a,s=t.lineType,u=void 0===s?"solid":s,l=t.dashArray,c=void 0===l?[10,5]:l,h=t.lineTexture,f=void 0!==h&&h,p=t.iconStep,d=void 0===p?100:p,v=t.segmentNumber,g=void 0===v?30:v;2===c.length&&c.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var m=0,y=[0,0,0,0],_=[0,0,0,0];if(r&&i&&(y=vg(r),_=vg(i),m=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var b=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,b,this.cellProperties),E=x.data,S=x.width,C=x.height;this.rowCount=C,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:S,height:C}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:PU(n)?n:1,u_textureBlend:"normal"===o?0:1,segmentNumber:g,u_line_type:GG[u]||0,u_dash_array:c,u_texture:this.texture,u_line_texture:f?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:m,u_sourceColor:y,u_targetColor:_}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var e=this.layer.getLayerConfig(),t=e.mask,n=void 0!==t&&t,r=e.maskInside,i=void 0===r||r;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying vec4 v_color;\nvarying float v_distance_ratio;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\nreturn start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\nfloat getSegmentRatio(float index) {\nreturn smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\nvec2 x = mix(source, target, ratio);\nvec2 center = mix(source, target, 0.5);\nfloat dSourceCenter = distance(source, center);\nfloat dXCenter = distance(x, center);\nreturn (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\nfloat vertex_height = paraboloid(source, target, segmentRatio);\nreturn vec3(\nmix(source, target, segmentRatio),\nsqrt(max(0.0, vertex_height))\n);\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nvec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;\nreturn offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\nvec2 dir_screenspace = normalize(line_clipspace);\ndir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\nreturn reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\nvec2 delta = source - target;\nvec2 sin_half_delta = sin(delta / 2.0);\nfloat a =\nsin_half_delta.y * sin_half_delta.y +\ncos(source.y) * cos(target.y) *\nsin_half_delta.x * sin_half_delta.x;\nreturn 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\nvec2 midPoint(vec2 source, vec2 target) {\nvec2 center = target - source;\nfloat r = length(center);\nfloat theta = atan(center.y, center.x);\nfloat thetaOffset = 0.314;\nfloat r2 = r / 2.0 / cos(thetaOffset);\nfloat theta2 = theta + thetaOffset;\nvec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\nreturn mid;\n}\nfloat bezier3(vec3 arr, float t) {\nfloat ut = 1. - t;\nreturn (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nvec2 mid = midPoint(source, target);\nvec3 x = vec3(source.x, mid.x, target.x);\nvec3 y = vec3(source.y, mid.y, target.y);\nreturn vec2(bezier3(x ,t), bezier3(y,t));\n}else {\nif(abs(angularDist - PI) < 0.001) {\nreturn (1.0 - t) * source + t * target;\n}\nfloat a = sin((1.0 - t) * angularDist) / sin(angularDist);\nfloat b = sin(t * angularDist) / sin(angularDist);\nvec2 sin_source = sin(source);\nvec2 cos_source = cos(source);\nvec2 sin_target = sin(target);\nvec2 cos_target = cos(target);\nfloat x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\nfloat y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\nfloat z = a * sin_source.y + b * sin_target.y;\nreturn vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n}\n}\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_color = a_Color;\nvec2 source = radians(a_Instance.rg);\nvec2 target = radians(a_Instance.ba);\nfloat angularDist = getAngularDist(source, target);\nfloat segmentIndex = a_Position.x;\nfloat segmentRatio = getSegmentRatio(segmentIndex);\nfloat indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\nif(u_line_type == LineTypeDash) {\nv_distance_ratio = segmentIndex / segmentNumber;\nvec2 s = source;\nvec2 t = target;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ns = unProjCustomCoord(source);\nt = unProjCustomCoord(target);\n}\nfloat total_Distance = pixelDistance(s, t) / 2.0 * PI;\ntotal_Distance = total_Distance*8.0;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n}\nif(u_aimate.x == Animate) {\nv_distance_ratio = segmentIndex / segmentNumber;\n}\nfloat nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\nv_distance_ratio = segmentIndex / segmentNumber;\nvec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));\nvec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));\nvec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\nstyleMappingMat[3].g = a_Position.x;\nif(LineTexture == u_line_texture) {\nfloat d_arcDistrance = length(source - target);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\nd_arcDistrance = d_arcDistrance * 1000000.0;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nd_arcDistrance = project_pixel_allmap(d_arcDistrance);\n}\nfloat d_pixelLen = project_pixel(u_icon_step)/8.0;\nstyleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen);\nfloat lineOffsetWidth = length(offset + offset * sign(a_Position.y));\nfloat linePixelSize = project_pixel(a_Size);\nstyleMappingMat[3].a = lineOffsetWidth/linePixelSize;\nv_iconMapUV = a_iconMapUV;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\nvarying vec4 v_color;\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\n#pragma include "project"\n#pragma include "projection"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat animateSpeed = 0.0;\nfloat d_segmentIndex = styleMappingMat[3].g;\nif(u_linearColor == 1.0) {\ngl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= opacity;\nif(u_line_type == LineTypeDash) {\nfloat flag = 0.;\nfloat dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\nif(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\nflag = 1.;\n}\ngl_FragColor.a *=flag;\n}\nif(u_aimate.x == Animate) {\nanimateSpeed = u_time / u_aimate.y;\nfloat alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);\nalpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\nalpha = smoothstep(0., 1., alpha);\ngl_FragColor.a *= alpha;\n}\nif(LineTexture == u_line_texture && u_line_type != LineTypeDash) { \nfloat arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));\nfloat count = styleMappingMat[3].b;\nfloat u = fract(arcRadio * count - animateSpeed * count);\nif(u_aimate.x == Animate) {\nu = gl_FragColor.a/opacity;\n}\nfloat v = styleMappingMat[3].a;\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor = filterColor(gl_FragColor + pattern);\n} else {\npattern.a *= opacity;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\n}\ngl_FragColor = filterColor(pattern);\n}\n} else {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',triangulation:kj,depth:{enable:!1},blend:this.getBlend(),stencil:xg(n,i)})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,a=void 0===i?1:i;return Array.isArray(a)?[a[0]]:[a]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:e.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e,t,n,r){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,n,r,i){var a=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[a.x,a.y]}}})}}]),r}(dz),WG='#define Animate 0.0\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\nattribute float a_Total_Distance;\nattribute float a_Distance;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\nuniform float u_vertexScale: 1.0;\n#pragma include "projection"\n#pragma include "picking"\nvarying vec4 v_color;\nvarying vec2 v_iconMapUV;\nuniform float u_linearColor: 0;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nfloat d_texPixelLen;\nv_iconMapUV = a_iconMapUV;\nd_texPixelLen = project_float_pixel(u_icon_step);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nd_texPixelLen *= 10.0;\n}\nv_color = a_Color;\nvec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\nvec2 offset = project_pixel(size.xy);\nfloat lineOffsetWidth = length(offset + offset * sign(a_Miter));\nfloat linePixelSize = project_pixel(a_Size.x) * 2.0;\nfloat texV = lineOffsetWidth/linePixelSize;\nstyleMappingMat[3][0] = a_Distance / a_Total_Distance;;\nstyleMappingMat[3][1] = a_Distance;\nstyleMappingMat[3][2] = d_texPixelLen;\nstyleMappingMat[3][3] = texV;\nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nfloat h = float(a_Position.z) * u_vertexScale;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y) + h * 0.2, 1.0));\n} else {\nfloat lineHeight = a_Size.y;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nh *= 2.0/pow(2.0, 20.0 - u_Zoom);\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nlineHeight *= pow(2.0, 20.0 - u_Zoom);\n}\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',XG={solid:0,dash:1},YG=function(t){S(r,t);var n=R(r);function r(){var t;_(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return E(O(t=n.call.apply(n,[this].concat(a))),"texture",void 0),E(O(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.NEAREST,min:e.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return x(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=t.sourceColor,i=t.targetColor,a=t.textureBlend,o=void 0===a?"normal":a,s=t.lineType,u=void 0===s?"solid":s,l=t.dashArray,c=void 0===l?[10,5,0,0]:l,h=t.lineTexture,f=void 0!==h&&h,p=t.iconStep,d=void 0===p?100:p,v=t.vertexHeightScale,g=void 0===v?20:v,m=t.borderWidth,y=void 0===m?0:m,_=t.borderColor,b=void 0===_?"#ccc":_;2===c.length&&c.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var x=0,E=[0,0,0,0],S=[0,0,0,0];if(r&&i&&(E=vg(r),S=vg(i),x=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var C=this.layer.getEncodedData(),T=this.calDataFrame(this.cellLength,C,this.cellProperties),A=T.data,M=T.width,w=T.height;this.rowCount=w,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:M,height:w}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:PU(n)?n:1,u_textureBlend:"normal"===o?0:1,u_line_type:XG[u],u_dash_array:c,u_texture:this.texture,u_line_texture:f?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:y,u_borderColor:vg(b),u_linearColor:x,u_sourceColor:E,u_targetColor:S,u_vertexScale:g}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,a=void 0===i||i,o=this.getShaders(),s=o.frag,u=o.vert,l=o.type;return[this.layer.buildLayerModel({moduleName:"line"+l,vertexShader:u,fragmentShader:s,triangulation:xj,primitive:e.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1},stencil:xg(r,a)})]}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return"dash"===e.lineType?{frag:'#define LineTypeSolid 0.0\nuniform float u_opacity : 1.0;\nvarying vec4 v_color;\nvarying vec4 v_dash_array;\n#pragma include "picking"\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying mat4 styleMappingMat;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat d_distance_ratio = styleMappingMat[3].r;\ngl_FragColor = v_color;\ngl_FragColor.a *= opacity;\nfloat flag = 0.;\nfloat dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\nif(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\nflag = 1.;\n}\ngl_FragColor.a *=flag;\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\nattribute float a_Total_Distance;\nattribute float a_Distance;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_vertexScale: 1.0;\n#pragma include "projection"\n#pragma include "picking"\nvarying vec4 v_color;\nvarying vec4 v_dash_array;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;\nv_color = a_Color;\nvec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\nvec2 offset = project_pixel(size.xy);\nstyleMappingMat[3][0] = a_Distance / a_Total_Distance;\nstyleMappingMat[3][1] = a_Distance;\nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));\n} else {\nfloat lineHeight = a_Size.y;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nlineHeight *= pow(2.0, 20.0 - u_Zoom);\n}\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',type:"dash"}:t&&n?{frag:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_blur : 0.99;\nuniform float u_line_type: 0.0;\nuniform float u_opacity : 1.0;\nvarying vec4 v_color;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n#pragma include "picking"\nvarying mat4 styleMappingMat;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat d_distance_ratio = styleMappingMat[3].r;\nif(u_linearColor == 1.0) {\ngl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:WG,type:"linear"}:{frag:'#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_blur : 0.99;\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\nuniform float u_borderWidth: 0.0;\nuniform vec4 u_borderColor;\nvarying vec4 v_color;\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying vec2 v_iconMapUV;\n#pragma include "picking"\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying mat4 styleMappingMat;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat animateSpeed = 0.0;\nfloat d_distance_ratio = styleMappingMat[3].r;\ngl_FragColor = v_color;\ngl_FragColor.a *= opacity;\nif(u_aimate.x == Animate) {\nanimateSpeed = u_time / u_aimate.y;\nfloat alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);\nalpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\nalpha = smoothstep(0., 1., alpha);\ngl_FragColor.a *= alpha;\n}\nif(u_line_texture == LineTexture) {\nfloat aDistance = styleMappingMat[3].g;\nfloat d_texPixelLen = styleMappingMat[3].b;\nfloat u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\nfloat v = styleMappingMat[3].a;\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor += pattern;\n} else {\npattern.a *= opacity;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\n}\ngl_FragColor = pattern;\n}\n} \nfloat v = styleMappingMat[3].a;\nfloat borderWidth = min(0.5, u_borderWidth);\nif(borderWidth > 0.01) {\nfloat borderOuterWidth = borderWidth/2.0;\nif(v >= 1.0 - borderWidth || v <= borderWidth) {\nif(v > borderWidth) {\nfloat linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);\ngl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);\n} else if(v <= borderWidth) {\nfloat linear = smoothstep(0.0, 1.0, v/borderWidth);\ngl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);\n}\n}\nif(v < borderOuterWidth) {\ngl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);\n} else if(v > 1.0 - borderOuterWidth) {\ngl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);\n}\n}\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:WG,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:e.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:e.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){var i=e.size,a=void 0===i?1:i;return Array.isArray(a)?[a[0],a[1]]:[a,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:e.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,n,r,i){var a=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[a.x,a.y]}}})}}]),r}(dz),ZG='attribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Position;\nattribute float a_Total_Distance;\nattribute float a_Distance;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_opacity: 1.0;\nuniform float u_vertexScale: 1.0;\n#pragma include "projection"\nvarying vec4 v_color;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nfloat d_distance_ratio;\nv_color = a_Color;  \nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nfloat h = float(a_Position.z) * u_vertexScale;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));\n} else {\nfloat lineHeight = a_Size.y;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nh *= 2.0/pow(2.0, 20.0 - u_Zoom);\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\nlineHeight *= pow(2.0, 20.0 - u_Zoom);\n}\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));\n}\n}',qG=function(t){S(r,t);var n=R(r);function r(){return _(this,r),n.apply(this,arguments)}return x(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=t.sourceColor,i=t.targetColor,a=t.vertexHeightScale,o=void 0===a?20:a,s=0,u=[0,0,0,0],l=[0,0,0,0];if(r&&i&&(u=vg(r),l=vg(i),s=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var c=this.layer.getEncodedData(),h=this.calDataFrame(this.cellLength,c,this.cellProperties),f=h.data,p=h.width,d=h.height;this.rowCount=d,this.dataTexture=this.cellLength>0&&f.length>0?this.createTexture2D({flipY:!0,data:f,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:p,height:d}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:PU(n)?n:1,u_linearColor:s,u_sourceColor:u,u_targetColor:l,u_vertexScale:o}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor;return t&&n?{frag:"uniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nvarying mat4 styleMappingMat;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat d_distance_ratio = styleMappingMat[3].r;\ngl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);\ngl_FragColor.a *= opacity;\n}",vert:ZG,type:"linear"}:{frag:"varying vec4 v_color;\nvarying mat4 styleMappingMat;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat d_distance_ratio = styleMappingMat[3].r;\ngl_FragColor = v_color;\ngl_FragColor.a *= opacity;\n}",vert:ZG,type:"normal"}}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,a=void 0===i||i,o=this.getShaders(),s=o.frag,u=o.vert,l=o.type;return[this.layer.buildLayerModel({moduleName:"simpleline"+l,vertexShader:u,fragmentShader:s,triangulation:Ej,primitive:e.gl.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:xg(r,a)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:e.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:e.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){var i=e.size,a=void 0===i?1:i;return Array.isArray(a)?[a[0],a[1]]:[a,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:e.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){return[n[4]]}}})}}]),r}(dz),KG={arc:UG,arcmini:VG,arc3d:jG,greatcircle:HG,wall:function(t){S(r,t);var n=R(r);function r(){var t;_(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return E(O(t=n.call.apply(n,[this].concat(a))),"texture",void 0),E(O(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.NEAREST,min:e.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return x(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=t.sourceColor,i=t.targetColor,a=t.textureBlend,o=void 0===a?"normal":a,s=t.heightfixed,u=void 0!==s&&s,l=t.lineTexture,c=void 0!==l&&l,h=t.iconStep,f=void 0===h?100:h,p=t.iconStepCount,d=void 0===p?1:p;this.rendererService.getDirty()&&this.texture.bind();var v=0,g=[0,0,0,0],m=[0,0,0,0];if(r&&i&&(g=vg(r),m=vg(i),v=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n})){this.judgeStyleAttributes({opacity:n});var y=this.layer.getEncodedData(),_=this.calDataFrame(this.cellLength,y,this.cellProperties),b=_.data,x=_.width,E=_.height;this.rowCount=E,this.dataTexture=this.cellLength>0&&b.length>0?this.createTexture2D({flipY:!0,data:b,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:x,height:E}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_heightfixed:Number(u),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:PU(n)?n:1,u_textureBlend:"normal"===o?0:1,u_texture:this.texture,u_line_texture:c?1:0,u_iconStepCount:d,u_icon_step:f,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:v,u_sourceColor:g,u_targetColor:m}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption;return{u_aimate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\nattribute float a_Total_Distance;\nattribute float a_Distance;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\nuniform float u_heightfixed;\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvarying vec4 v_color;\nvarying float v_blur;\nvarying vec2 v_iconMapUV;\nuniform float u_linearColor: 0;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "light"\n#pragma include "styleMappingCalOpacity"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nfloat d_distance_ratio;\nfloat d_texPixelLen;\nv_iconMapUV = a_iconMapUV;\nif(u_heightfixed < 1.0) {\nd_texPixelLen = project_pixel(u_icon_step);\n} else {\nd_texPixelLen = u_icon_step;\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nd_texPixelLen *= 10.0;\n}\nif(u_aimate.x == Animate || u_linearColor == 1.0) {\nd_distance_ratio = a_Distance / a_Total_Distance;\n}\nfloat miter = (a_Miter + 1.0)/2.0;\nstyleMappingMat[3][0] = d_distance_ratio;\nstyleMappingMat[3][1] = a_Distance;\nstyleMappingMat[3][2] = d_texPixelLen;\nstyleMappingMat[3][3] = miter;\nvec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\nfloat originSize = a_Size.x;\nif(u_heightfixed < 1.0) {\noriginSize = project_float_pixel(a_Size.x);\n}\nfloat wallHeight = originSize * miter;\nfloat lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));\nv_blur = min(project_float_pixel(2.0) / originSize, 0.05);\nv_color = vec4(a_Color.rgb * lightWeight, a_Color.w);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'#define LineTypeSolid 0.0\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\nuniform float u_iconStepCount;\nvarying vec4 v_color;\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_dash_offset : 0.0;\nuniform float u_dash_ratio : 0.1;\nvarying vec2 v_iconMapUV;\nvarying float v_blur;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n#pragma include "picking"\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\nvarying mat4 styleMappingMat;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat animateSpeed = 0.0;\nfloat d_distance_ratio = styleMappingMat[3].r;\nfloat v = styleMappingMat[3].a;\nif(u_linearColor == 1.0) {\ngl_FragColor = mix(u_sourceColor, u_targetColor, v);\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= opacity;\nif(u_aimate.x == Animate) {\nanimateSpeed = u_time / u_aimate.y;\nfloat alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);\nalpha = (alpha + u_aimate.w -1.0) / u_aimate.w;\nalpha = smoothstep(0., 1., alpha);\ngl_FragColor.a *= alpha;\n}\nif(u_line_texture == LineTexture) {\nfloat aDistance = styleMappingMat[3].g;\nfloat d_texPixelLen = styleMappingMat[3].b;\nfloat u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\nfloat v = styleMappingMat[3].a;\nfloat flag = 0.0;\nif(u > 1.0/u_iconStepCount) {\nflag = 1.0;\n}\nu = fract(u*u_iconStepCount);\nvec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\nvec4 pattern = texture2D(u_texture, uv);\nif(flag > 0.0) {\npattern = vec4(0.0);\n}\nif(u_textureBlend == 0.0) {\npattern.a = 0.0;\ngl_FragColor = filterColor(gl_FragColor + pattern);\n} else {\npattern.a *= opacity;\nif(gl_FragColor.a <= 0.0) {\npattern.a = 0.0;\n}\ngl_FragColor = filterColor(pattern);\n}\n}\nif(v < v_blur) {\ngl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);\n} else if(v > 1.0 - v_blur) {\ngl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);\n}\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:xj,primitive:e.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.layer.getLayerConfig().lineType;this.styleAttributeService.registerStyleAttribute({name:"distance",type:e.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:e.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){var i=e.size,a=void 0===i?1:i;return Array.isArray(a)?[a[0],a[1]]:[a,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:e.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,n,r,i){var a=t.iconService.getIconMap()[e.texture]||{x:0,y:0};return[a.x,a.y]}}})}}]),r}(dz),line:YG,simple:qG},QG=function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"type","LineLayer"),e}return x(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new KG[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{line:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}}[this.getModelType()]}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape");return(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"line"}}]),n}(KU);er({target:"String",proto:!0},{repeat:lv});var JG=function(t){S(r,t);var n=R(r);function r(){var e;_(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return E(O(e=n.call.apply(n,[this].concat(i))),"raiseCount",0),E(O(e),"raiserepeat",0),e}return x(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.animateOption,r=void 0===n?{enable:!1,speed:.01,repeat:!1}:n,i=t.opacity,a=void 0===i?1:i,o=t.sourceColor,s=t.targetColor,u=t.pickLight,l=void 0!==u&&u,c=t.heightfixed,h=void 0!==c&&c,f=t.opacityLinear,p=void 0===f?{enable:!1,dir:"up"}:f,d=t.lightEnable,v=void 0===d||d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:a})){this.judgeStyleAttributes({opacity:a});var g=this.layer.getEncodedData(),m=this.calDataFrame(this.cellLength,g,this.cellProperties),y=m.data,_=m.width,b=m.height;this.rowCount=b,this.dataTexture=this.cellLength>0&&y.length>0?this.createTexture2D({flipY:!0,data:y,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:_,height:b}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}var x=0,E=[0,0,0,0],S=[0,0,0,0];if(o&&s&&(E=vg(o),S=vg(s),x=1),this.raiseCount<1&&this.raiserepeat>0&&r.enable){var C=r.speed,T=void 0===C?.01:C;r.repeat;this.raiseCount+=T,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(l),u_heightfixed:Number(h),u_r:r.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:"GLOBEL"===this.mapService.version?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:PU(a)?a:1,u_linearColor:x,u_sourceColor:E,u_targetColor:S,u_opacitylinear:Number(p.enable),u_opacitylinear_dir:"up"===p.dir?1:0,u_lightEnable:Number(v)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),n=t.depth,r=void 0===n||n,i=t.animateOption.repeat,a=void 0===i?1:i;return this.raiserepeat=a,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:'precision highp float;\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\nuniform float u_heightfixed: 0.0;\nuniform float u_globel;\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\nvarying mat4 styleMappingMat;\nvarying float v_z;\nvarying float v_lightWeight;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nfloat getYRadian(float x, float z) {\nif(x > 0.0 && z > 0.0) {\nreturn atan(x/z);\n} else if(x > 0.0 && z <= 0.0){\nreturn atan(-z/x) + pi/2.0;\n} else if(x <= 0.0 && z <= 0.0) {\nreturn  pi + atan(x/z);\n} else {\nreturn atan(z/-x) + pi*3.0/2.0;\n}\n}\nfloat getXRadian(float y, float r) {\nreturn atan(y/r);\n}\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec3 size = a_Size * a_Position;\nv_z = a_Position.z;\nvec3 offset = size;\nif(u_heightfixed < 1.0) {\nif (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\noffset = offset * pow(2.0, (19.0 - u_Zoom));\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\noffset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n}\n} else {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\noffset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n}\n}\nvec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\nvec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\nfloat lightWeight = 1.0;\nif(u_lightEnable > 0.0) {\nlightWeight = calc_lighting(pos);\n}\nv_lightWeight = lightWeight;\nv_color =vec4(a_Color.rgb * lightWeight, a_Color.w);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * pos;\n} else {\ngl_Position = project_common_position_to_clipspace(pos);\n}\nif(u_globel > 0.0) {\nfloat r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);\nfloat xRadian = getXRadian(a_Pos.y, r);\nfloat xcos = cos(xRadian);\nfloat xsin = sin(xRadian);\nmat4 mx = mat4(\n1,0,0,0,  \n0,xcos,-xsin,0,  \n0,xsin,xcos,0,  \n0,0,0,1);\nfloat yRadian = getYRadian(a_Pos.x, a_Pos.z);\nfloat ycos = cos(yRadian);\nfloat ysin = sin(yRadian);\nmat4 my = mat4(\nycos,0,-ysin,0,  \n0,1,0,0,  \nysin,0,ycos,0,  \n0,0,0,1);\ngl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'varying vec4 v_color;\nuniform float u_opacity: 1.0;\nvarying float v_z;\nvarying float v_lightWeight;\nuniform float u_pickLight: 0.0;\n#pragma include "picking"\nvarying mat4 styleMappingMat;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacitylinear: 0.0;\nuniform float u_opacitylinear_dir: 1.0;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nif(u_linearColor == 1.0) {\ngl_FragColor = mix(u_sourceColor, u_targetColor, v_z);\ngl_FragColor.rgb *= v_lightWeight;\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= opacity;\nif(u_opacitylinear > 0.0) {\ngl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;\n}\nif(u_pickLight > 0.0) {\ngl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);\n} else {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',triangulation:_j,blend:this.getBlend(),cull:{enable:!0,face:"MAPBOX"===this.mapService.version?e.gl.FRONT:e.gl.BACK},depth:{enable:r}})]}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t="GLOBEL"===this.mapService.version;this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r){var i=e.size;if(i){var a=[];return Array.isArray(i)&&(a=2===i.length?[i[0],i[0],i[1]]:i),Array.isArray(i)||(a=[i,i,i]),a}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:e.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,n){var r=oj(e.coordinates);return t?Xz([r[0],r[1]]):[r[0],r[1],0]}}})}}]),r}(dz),$G='uniform float u_additive;\nvarying mat4 styleMappingMat;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_time;\nuniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];\n#pragma include "sdf_2d"\n#pragma include "picking"\nvoid main() {\nvec4 textrueStroke = vec4(\nstyleMappingMat[1][0],\nstyleMappingMat[1][1],\nstyleMappingMat[1][2],\nstyleMappingMat[1][3]\n);\nfloat opacity = styleMappingMat[0][0];\nfloat stroke_opacity = styleMappingMat[0][1];\nfloat strokeWidth = styleMappingMat[0][2];\nvec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;\nfloat r = v_radius / (v_radius + strokeWidth);\nfloat outer_df = sdCircle(v_data.xy, 1.0);\nfloat inner_df = sdCircle(v_data.xy, r);\nfloat d = length(v_data.xy);\nif(d > 0.5) {\ndiscard;\n}\nfloat PI = 3.14159;\nfloat intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);\ngl_FragColor = vec4(v_color.xyz, v_color.a * opacity * intensity);\nif(u_additive > 0.0) {\ngl_FragColor *= gl_FragColor.a;\n}\nif(d < 0.5) {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',eH='attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\nvarying mat4 styleMappingMat;\nuniform float u_globel;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_isMeter;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nuniform vec2 u_offsets;\nuniform float u_blur : 0.0;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalStrokeOpacity"\n#pragma include "styleMappingCalStrokeWidth"\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nvec3 extrude = a_Extrude;\nfloat shape_type = a_Shape;\nfloat newSize = setPickingSize(a_Size);\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][1] = strokeOpacityAndOffset.r;\ntextureOffset = strokeOpacityAndOffset.g;\nvec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][2] = strokeWidthAndOffset.r;\ntextureOffset = strokeWidthAndOffset.g;\nvec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);\nif(hasStroke()) {\nvec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\nif(u_stroke_color == vec4(0.0)) {\nstyleMappingMat[1][0] = v_color.r;\nstyleMappingMat[1][1] = v_color.g;\nstyleMappingMat[1][2] = v_color.b;\nstyleMappingMat[1][3] = v_color.a;\n} else {\nstyleMappingMat[1][0] = u_stroke_color.r;\nstyleMappingMat[1][1] = u_stroke_color.g;\nstyleMappingMat[1][2] = u_stroke_color.b;\nstyleMappingMat[1][3] = u_stroke_color.a;\n}\n}\nvec2 textrueOffsets = vec2(0.0, 0.0);\nif(hasOffsets()) {\nvec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\ntextrueOffsets = u_offsets;\n}\nv_color = a_Color;\nv_radius = newSize;\nfloat antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);\nvec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);\nvec3 aPosition = a_Position;\nif(u_isMeter < 1.0) {\noffset = project_pixel(offset);\n} else {\nantialiasblur *= pow(19.0 - u_Zoom, 2.0);\nantialiasblur = max(antialiasblur, -0.01);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\naPosition.xy += offset;\noffset.x = 0.0;\noffset.y = 0.0;\n}\n}\nv_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\nvec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n}\nif(u_globel > 0.0) {\ngl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);\n}\nsetPickingColor(a_PickingColor);\n}',tH=function(t){S(r,t);var n=R(r);function r(){var e;_(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return E(O(e=n.call.apply(n,[this].concat(i))),"meter2coord",1),E(O(e),"isMeter",!1),e}return x(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.strokeOpacity,a=void 0===i?1:i,o=t.strokeWidth,s=void 0===o?0:o,u=t.stroke,l=void 0===u?"rgba(0,0,0,0)":u,c=t.offsets,h=void 0===c?[0,0]:c,f=t.blend;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r,strokeOpacity:a,strokeWidth:s,stroke:l,offsets:h})){this.judgeStyleAttributes({opacity:r,strokeOpacity:a,strokeWidth:s,stroke:l,offsets:h});var p=this.layer.getEncodedData(),d=this.calDataFrame(this.cellLength,p,this.cellProperties),v=d.data,g=d.width,m=d.height;this.rowCount=m,this.dataTexture=this.cellLength>0&&v.length>0?this.createTexture2D({flipY:!0,data:v,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:g,height:m}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_additive:"additive"===f?1:0,u_globel:this.mapService.version===e.Version.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:PU(r)?r:1,u_stroke_opacity:PU(a)?a:1,u_stroke_width:PU(s)?s:0,u_stroke_color:this.getStrokeColor(l),u_offsets:this.isOffsetStatic(h)?h:[0,0]}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_aimate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),mj)}},{key:"initModels",value:function(){var t=this.layer.getLayerConfig().unit,n=void 0===t?"l7size":t,r=this.mapService.version;return"meter"===n&&r!==e.Version.L7MAP&&r!==e.Version.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var t=N(this.layer.getSource().extent,4),n=t[0],r=t[1],i=t[2],a=t[3],o=[(n+i)/2,(r+a)/2];if(this.mapService.version===e.Version.MAPBOX&&window.mapboxgl.MercatorCoordinate){var s=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]},0),u=1*s.meterInMercatorCoordinateUnits(),l=new window.mapboxgl.MercatorCoordinate(s.x-u,s.y,s.z).toLngLat();this.meter2coord=o[0]-l.lng}else{var c=this.mapService.meterToCoord(o,[n,r]),h=this.mapService.meterToCoord(o,[i===n?i+.1:i,a===r?r+.1:a]);this.meter2coord=(c+h)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}}},{key:"buildModels",value:function(){var e=this.layer.getLayerConfig(),t=e.mask,n=void 0!==t&&t,r=e.maskInside,i=void 0===r||r,a=e.animateOption,o=void 0===a?{enable:!1}:a,s=this.getShaders(o),u=s.frag,l=s.vert,c=s.type,h="GLOBEL"===this.mapService.version;return[this.layer.buildLayerModel({moduleName:"pointfill-"+c,vertexShader:l,fragmentShader:u,triangulation:h?yj:mj,depth:{enable:h},blend:this.getBlend(),stencil:xg(n,i)})]}},{key:"getShaders",value:function(e){if(!e.enable)return{frag:'uniform float u_globel;\nuniform float u_additive;\nvarying mat4 styleMappingMat;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n#pragma include "sdf_2d"\n#pragma include "picking"\nvoid main() {\nint shape = int(floor(v_data.w + 0.5));\nvec4 textrueStroke = vec4(\nstyleMappingMat[1][0],\nstyleMappingMat[1][1],\nstyleMappingMat[1][2],\nstyleMappingMat[1][3]\n);\nfloat opacity = styleMappingMat[0][0];\nfloat stroke_opacity = styleMappingMat[0][1];\nfloat strokeWidth = styleMappingMat[0][2];\nvec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;\nlowp float antialiasblur = v_data.z;\nfloat r = v_radius / (v_radius + strokeWidth);\nfloat outer_df;\nfloat inner_df;\nif (shape == 0) {\nouter_df = sdCircle(v_data.xy, 1.0);\ninner_df = sdCircle(v_data.xy, r);\n} else if (shape == 1) {\nouter_df = sdEquilateralTriangle(1.1 * v_data.xy);\ninner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n} else if (shape == 2) {\nouter_df = sdBox(v_data.xy, vec2(1.));\ninner_df = sdBox(v_data.xy, vec2(r));\n} else if (shape == 3) {\nouter_df = sdPentagon(v_data.xy, 0.8);\ninner_df = sdPentagon(v_data.xy, r * 0.8);\n} else if (shape == 4) {\nouter_df = sdHexagon(v_data.xy, 0.8);\ninner_df = sdHexagon(v_data.xy, r * 0.8);\n} else if (shape == 5) {\nouter_df = sdOctogon(v_data.xy, 1.0);\ninner_df = sdOctogon(v_data.xy, r);\n} else if (shape == 6) {\nouter_df = sdHexagram(v_data.xy, 0.52);\ninner_df = sdHexagram(v_data.xy, r * 0.52);\n} else if (shape == 7) {\nouter_df = sdRhombus(v_data.xy, vec2(1.0));\ninner_df = sdRhombus(v_data.xy, vec2(r));\n} else if (shape == 8) {\nouter_df = sdVesica(v_data.xy, 1.1, 0.8);\ninner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n}\nif(u_globel > 0.0) {\nif(outer_df > antialiasblur + 0.018) discard;\n}\nfloat opacity_t = smoothstep(0.0, antialiasblur, outer_df);\nfloat color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(\nantialiasblur,\n0.0,\ninner_df\n);\nif(strokeWidth < 0.01) {\ngl_FragColor = vec4(v_color.rgb, v_color.a * opacity);\n} else {\ngl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);\n}\nif(u_additive > 0.0) {\ngl_FragColor *= opacity_t;\n} else {\ngl_FragColor.a *= opacity_t;\n}\nif(gl_FragColor.a > 0.0) {\ngl_FragColor = filterColor(gl_FragColor);\n}\n}',vert:eH,type:"normal"};switch(e.type){case"wave":default:return{frag:$G,vert:eH,type:"wave"}}}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this,n="GLOBEL"===this.mapService.version;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:e.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,r,i){var a;if(n){var o=N(r,3),s=o[0],u=o[1],l=o[2],c=oA(0,0,1),h=oA(s,0,l),f=s>=0?_A(c,h):2*Math.PI-_A(c,h),p=2*Math.PI-Math.asin(u/100),d=IT();GT(d,d,f),VT(d,d,p);var v=oA(1,1,0);yA(v,v,d),vA(v,v);var g=oA(-1,1,0);yA(g,g,d),vA(g,g);var m=oA(-1,-1,0);yA(m,m,d),vA(m,m);var y=oA(1,-1,0);yA(y,y,d),vA(y,y),a=[].concat(D(v),D(g),D(m),D(y))}else a=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var _=i%4*3;return[a[_],a[_+1],a[_+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,n,r,i){var a=e.size,o=void 0===a?5:a;return Array.isArray(o)?[o[0]*t.meter2coord]:[o*t.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:e.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,n,r,i){var a=e.shape,o=void 0===a?2:a;return[t.layer.getLayerConfig().shape2d.indexOf(o)]}}})}}]),r}(dz),nH=function(t){S(r,t);var n=R(r);function r(){var t;_(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return E(O(t=n.call.apply(n,[this].concat(a))),"meter2coord",1),E(O(t),"texture",void 0),E(O(t),"isMeter",!1),E(O(t),"radian",0),E(O(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void t.layer.renderLayers();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.LINEAR,min:e.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128,mipmap:!0})})),t}return x(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.strokeOpacity,a=void 0===i?1:i,o=t.strokeWidth,s=void 0===o?0:o,u=t.stroke,l=void 0===u?"rgba(0,0,0,0)":u,c=t.offsets,h=void 0===c?[0,0]:c,f=t.blend,p=t.rotation;this.rendererService.getDirty()&&this.texture.bind();var d=1;if("GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(d=-1),this.radian=p?d*Math.PI*p/180:d*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r,strokeOpacity:a,strokeWidth:s,stroke:l,offsets:h})){this.judgeStyleAttributes({opacity:r,strokeOpacity:a,strokeWidth:s,stroke:l,offsets:h});var v=this.layer.getEncodedData(),g=this.calDataFrame(this.cellLength,v,this.cellProperties),m=g.data,y=g.width,_=g.height;this.rowCount=_,this.dataTexture=this.cellLength>0&&m.length>0?this.createTexture2D({flipY:!0,data:m,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:y,height:_}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_additive:"additive"===f?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:PU(r)?r:1,u_offsets:this.isOffsetStatic(h)?h:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),mj)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var t=this.layer.getLayerConfig().unit,n=void 0===t?"l7size":t,r=this.mapService.version;return"meter"===n&&r!==e.Version.L7MAP&&r!==e.Version.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var t=N(this.layer.getSource().extent,4),n=t[0],r=t[1],i=t[2],a=t[3],o=[(n+i)/2,(r+a)/2];if(this.mapService.version===e.Version.MAPBOX&&window.mapboxgl.MercatorCoordinate){var s=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]},0),u=1*s.meterInMercatorCoordinateUnits(),l=new window.mapboxgl.MercatorCoordinate(s.x-u,s.y,s.z).toLngLat();this.meter2coord=o[0]-l.lng}else{var c=this.mapService.meterToCoord(o,[n,r]),h=this.mapService.meterToCoord(o,[i===n?i+.1:i,a===r?r+.1:a]);this.meter2coord=(c+h)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}}},{key:"buildModels",value:function(){var e=this.layer.getLayerConfig(),t=e.mask,n=void 0!==t&&t,r=e.maskInside,i=void 0===r||r,a=this.getShaders(),o=a.frag,s=a.vert,u=a.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+u,vertexShader:s,fragmentShader:o,triangulation:mj,depth:{enable:!1},blend:this.getBlend(),stencil:xg(n,i)})]}},{key:"getShaders",value:function(){return{frag:'uniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_additive;\nvarying mat4 styleMappingMat;\nvarying float v_radius;\n#pragma include "sdf_2d"\n#pragma include "picking"\nvarying vec2 v_uv;\nvarying vec2 v_Iconuv;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nvec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;\ngl_FragColor = texture2D(u_texture, pos);\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute vec2 a_Uv;\nvarying mat4 styleMappingMat;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform mat2 u_RotateMatrix;\nuniform float u_isMeter;\nvarying float v_radius;\nvarying vec2 v_uv;\nvarying vec2 v_Iconuv;\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nvec3 extrude = a_Extrude;\nv_uv = (a_Extrude.xy + 1.0)/2.0;\nv_uv.y = 1.0 - v_uv.y;\nv_Iconuv = a_Uv;\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 textrueOffsets = vec2(0.0, 0.0);\nif(hasOffsets()) {\nvec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\ntextrueOffsets = u_offsets;\n}\nv_radius = a_Size;\nvec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);\nvec3 aPosition = a_Position;\nif(u_isMeter < 1.0) {\noffset = project_pixel(offset);\n} else {\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\naPosition.xy += offset;\noffset.x = 0.0;\noffset.y = 0.0;\n}\n}\nvec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',type:"normal"}}},{key:"clearModels",value:function(){var e;this.iconService.off("imageUpdate",this.updateTexture),this.texture.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,n,r,i){var a=t.iconService.getIconMap()[e.shape]||{x:0,y:0};return[a.x,a.y]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:e.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],a=r%4*3;return[i[a],i[a+1],i[a+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,n,r,i){var a=e.size,o=void 0===a?5:a;return Array.isArray(o)?[o[0]*t.meter2coord]:[o*t.meter2coord]}}})}}]),r}(dz),rH='uniform sampler2D u_texture;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main(){\nfloat opacity = styleMappingMat[0][0];\nfloat size = styleMappingMat[1][0];\nvec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\nvec4 textureColor;\ntextureColor = texture2D(u_texture, pos);\nfloat fragmengTocenter = distance(vec2(0.5), gl_PointCoord);\nif(fragmengTocenter >= 0.5) {\nfloat luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;\ntextureColor.a *= luma;\n}\nif(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\ngl_FragColor= textureColor;\n}else {\ngl_FragColor= step(0.01, textureColor.z) * v_color;\n}\ngl_FragColor.a = gl_FragColor.a * opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',iH='precision highp float;\nattribute vec3 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Uv;\nattribute float a_Size;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_stroke_width : 1;\nuniform vec2 u_offsets;\nuniform float u_opacity : 1;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nstyleMappingMat[1][0] = a_Size;\nvec2 textrueOffsets = vec2(0.0, 0.0);\nif(hasOffsets()) {\nvec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\ntextrueOffsets = u_offsets;\n}\nv_color = a_Color;\nv_uv = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nvec2 offset = project_pixel(textrueOffsets);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));\n}\ngl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\nsetPickingColor(a_PickingColor);\n}',aH=function(t){S(r,t);var n=R(r);function r(){var e;_(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return E(O(e=n.call.apply(n,[this].concat(i))),"texture",void 0),e}return x(r,[{key:"getUninforms",value:function(){return{u_opacity:this.layer.getLayerConfig().opacity||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var t=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",(function(){t.updateTexture(),t.layer.render()})),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:iH,fragmentShader:rH,triangulation:bj,primitive:e.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size;return Array.isArray(i)?[i[0]]:[i]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,n,r,i){var a=t.fontService.mapping,o=e.shape,s=a[t.fontService.getGlyph(o)];return[s.x,s.y]}}})}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,n=this.fontService.canvas;this.texture=t({data:n,mag:e.gl.LINEAR,min:e.gl.LINEAR,width:n.width,height:n.height})}},{key:"initIconFontGlyphs",value:function(){var e=this,t=this.layer.getLayerConfig(),n=t.fontWeight,r=void 0===n?"normal":n,i=t.fontFamily,a=void 0===i?"sans-serif":i,o=this.layer.getEncodedData(),s=[];o.forEach((function(t){var n=t.shape,r=void 0===n?"":n;r=r.toString();var i=e.fontService.getGlyph(r);-1===s.indexOf(i)&&s.push(i)})),this.fontService.setFontOptions({characterSet:s,fontWeight:r,fontFamily:a,fontSize:48})}}]),r}(dz),oH=function(t){S(r,t);var n=R(r);function r(){var t;_(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return E(O(t=n.call.apply(n,[this].concat(a))),"texture",void 0),E(O(t),"updateTexture",(function(){var n=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void t.layer.renderLayers();t.texture=n({data:t.iconService.getCanvas(),mag:e.gl.LINEAR,min:e.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128,mipmap:!0})})),t}return x(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=t.offsets,i=void 0===r?[0,0]:r;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:n,offsets:i})){this.judgeStyleAttributes({opacity:n,offsets:i});var a=this.layer.getEncodedData(),o=this.calDataFrame(this.cellLength,a,this.cellProperties),s=o.data,u=o.width,l=o.height;this.rowCount=l,this.dataTexture=this.cellLength>0&&s.length>0?this.createTexture2D({flipY:!0,data:s,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:u,height:l}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:PU(n)?n:1,u_offsets:this.isOffsetStatic(i)?i:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.dataTexture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,a=void 0===i||i;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:iH,fragmentShader:rH,triangulation:bj,primitive:e.gl.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:xg(r,a)})]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,a=void 0===i?5:i;return Array.isArray(a)?[a[0]]:[a]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,n,r,i){var a=t.iconService.getIconMap()[e.shape]||{x:0,y:0};return[a.x,a.y]}}})}}]),r}(dz);function sH(e){var t=e.coordinates;return{vertices:D(t),indices:[0],size:t.length}}var uH=function(t){S(r,t);var n=R(r);function r(){return _(this,r),n.apply(this,arguments)}return x(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.offsets,a=void 0===i?[0,0]:i;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r,offsets:a})){this.judgeStyleAttributes({opacity:r,offsets:a});var o=this.layer.getEncodedData(),s=this.calDataFrame(this.cellLength,o,this.cellProperties),u=s.data,l=s.width,c=s.height;this.rowCount=c,this.dataTexture=this.cellLength>0&&u.length>0?this.createTexture2D({flipY:!0,data:u,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:l,height:c}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:PU(r)?r:1,u_offsets:this.isOffsetStatic(a)?a:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,a=void 0===i||i;return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:'attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\nv_color = a_Color;\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 textrueOffsets = vec2(0.0, 0.0);\nif(hasOffsets()) {\nvec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\ntextrueOffsets = u_offsets;\n}\nvec2 offset = project_pixel(textrueOffsets);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);\n} else {\nvec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\ngl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n}\ngl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_opacity : 1;\nuniform vec2 u_offsets;\nvarying vec4 v_color;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\ngl_FragColor = v_color;\ngl_FragColor.a =gl_FragColor.a * opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:sH,depth:{enable:!1},primitive:e.gl.POINTS,blend:this.getBlend(),stencil:xg(r,a)})]}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,a=void 0===i?1:i;return Array.isArray(a)?[a[0]]:[a]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:e.BlendType.additive}}}]),r}(dz),lH=function(t){S(r,t);var n=R(r);function r(){var e;_(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return E(O(e=n.call.apply(n,[this].concat(i))),"meter2coord",1),E(O(e),"isMeter",!1),e}return x(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.strokeOpacity,a=void 0===i?1:i,o=t.strokeWidth,s=void 0===o?0:o,u=t.stroke,l=void 0===u?"rgba(0,0,0,0)":u,c=t.offsets,h=void 0===c?[0,0]:c,f=t.blend,p=t.speed,d=void 0===p?1:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r,strokeOpacity:a,strokeWidth:s,stroke:l,offsets:h})){this.judgeStyleAttributes({opacity:r,strokeOpacity:a,strokeWidth:s,stroke:l,offsets:h});var v=this.layer.getEncodedData(),g=this.calDataFrame(this.cellLength,v,this.cellProperties),m=g.data,y=g.width,_=g.height;this.rowCount=_,this.dataTexture=this.cellLength>0&&m.length>0?this.createTexture2D({flipY:!0,data:m,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:y,height:_}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:d,u_additive:"additive"===f?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:PU(r)?r:1,u_offsets:this.isOffsetStatic(h)?h:[0,0]}}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_aimate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),mj)}},{key:"initModels",value:function(){var t=this.layer.getLayerConfig().unit,n=void 0===t?"l7size":t,r=this.mapService.version;return"meter"===n&&r!==e.Version.L7MAP&&r!==e.Version.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var t=N(this.layer.getSource().extent,4),n=t[0],r=t[1],i=t[2],a=t[3],o=[(n+i)/2,(r+a)/2];if(this.mapService.version===e.Version.MAPBOX&&window.mapboxgl.MercatorCoordinate){var s=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:o[0],lat:o[1]},0),u=1*s.meterInMercatorCoordinateUnits(),l=new window.mapboxgl.MercatorCoordinate(s.x-u,s.y,s.z).toLngLat();this.meter2coord=o[0]-l.lng}else{var c=this.mapService.meterToCoord(o,[n,r]),h=this.mapService.meterToCoord(o,[i===n?i+.1:i,a===r?r+.1:a]);this.meter2coord=(c+h)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}}},{key:"buildModels",value:function(){var e=this.layer.getLayerConfig(),t=e.mask,n=void 0!==t&&t,r=e.maskInside,i=void 0===r||r,a=this.getShaders(),o=a.frag,s=a.vert,u=a.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+u,vertexShader:s,fragmentShader:o,triangulation:mj,depth:{enable:!1},blend:this.getBlend(),stencil:xg(n,i)})]}},{key:"getShaders",value:function(){return{frag:'uniform float u_additive;\nvarying mat4 styleMappingMat;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n#pragma include "sdf_2d"\n#pragma include "picking"\nvoid main() {\nint shape = int(floor(v_data.w + 0.5));\nvec4 textrueStroke = vec4(\nstyleMappingMat[1][0],\nstyleMappingMat[1][1],\nstyleMappingMat[1][2],\nstyleMappingMat[1][3]\n);\nfloat opacity = styleMappingMat[0][0];\nlowp float antialiasblur = v_data.z;\nfloat r = v_radius / (v_radius);\nfloat outer_df = sdCircle(v_data.xy, 1.0);\nfloat inner_df = sdCircle(v_data.xy, r);\nfloat opacity_t = smoothstep(0.0, antialiasblur, outer_df);\ngl_FragColor = vec4(v_color.rgb, v_color.a * opacity);\nif(u_additive > 0.0) {\ngl_FragColor *= opacity_t;\n} else {\ngl_FragColor.a *= opacity_t;\n}\nif(gl_FragColor.a > 0.0) {\ngl_FragColor = filterColor(gl_FragColor);\n}\nvec2 extrude =  styleMappingMat[2].ba;\nvec2 dir = normalize(extrude);\nvec2 baseDir = vec2(1.0, 0.0);\nfloat pi = 3.14159265359;\nfloat flag = sign(dir.y);\nfloat rades = dot(dir, baseDir);\nfloat radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;\nif(radar_v > 0.99) {\nradar_v = 1.0 - (radar_v - 0.99)/0.01;\n}\ngl_FragColor.a *= radar_v;\n}',vert:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\nuniform float u_speed: 1.0;\nuniform float u_time;\nvarying mat4 styleMappingMat;\nuniform float u_globel;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_isMeter;\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nuniform vec2 u_offsets;\nuniform float u_blur : 0.0;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nvec3 extrude = a_Extrude;\nfloat shape_type = a_Shape;\nfloat newSize = setPickingSize(a_Size);\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat time = u_time * u_speed;\nmat2 rotateMatrix = mat2( \ncos(time), sin(time), \n-sin(time), cos(time)\n);\nstyleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 textrueOffsets = vec2(0.0, 0.0);\nif(hasOffsets()) {\nvec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\ntextrueOffsets = u_offsets;\n}\nv_color = a_Color;\nv_radius = newSize;\nfloat antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);\nvec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);\nvec3 aPosition = a_Position;\nif(u_isMeter < 1.0) {\noffset = project_pixel(offset);\n} else {\nantialiasblur *= pow(19.0 - u_Zoom, 2.0);\nantialiasblur = max(antialiasblur, -0.01);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\naPosition.xy += offset;\noffset.x = 0.0;\noffset.y = 0.0;\n}\n}\nv_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);\nvec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n}\nif(u_globel > 0.0) {\ngl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);\n}\nsetPickingColor(a_PickingColor);\n}',type:"radar"}}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:e.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r){var i,a=r%4*3;return[(i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0])[a],i[a+1],i[a+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,n,r,i){var a=e.size,o=void 0===a?5:a;return Array.isArray(o)?[o[0]*t.meter2coord]:[o*t.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:e.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,n,r,i){var a=e.shape,o=void 0===a?2:a;return[t.layer.getLayerConfig().shape2d.indexOf(o)]}}})}}]),r}(dz);function cH(e){var t=e.coordinates;return{vertices:D(t),indices:[0],size:t.length}}var hH=function(t){S(r,t);var n=R(r);function r(){return _(this,r),n.apply(this,arguments)}return x(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.offsets,a=void 0===i?[0,0]:i,o=t.blend,s=t.strokeOpacity,u=void 0===s?1:s,l=t.strokeWidth,c=void 0===l?0:l,h=t.stroke,f=void 0===h?"#fff":h;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r,offsets:a})){this.judgeStyleAttributes({opacity:r,offsets:a});var p=this.layer.getEncodedData(),d=this.calDataFrame(this.cellLength,p,this.cellProperties),v=d.data,g=d.width,m=d.height;this.rowCount=m,this.dataTexture=this.cellLength>0&&v.length>0?this.createTexture2D({flipY:!0,data:v,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:g,height:m}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_additive:"additive"===o?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:PU(r)?r:1,u_offsets:this.isOffsetStatic(a)?a:[0,0],u_stroke_opacity:PU(u)?u:1,u_stroke_width:PU(c)?c:0,u_stroke_color:this.getStrokeColor(f)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,a=void 0===i||i;return[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:'attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nuniform float u_stroke_width;\nvarying mat4 styleMappingMat;\nvarying float v_blur;\nvarying float v_innerRadius;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\nv_color = a_Color;\nv_blur = 1.0 - max(2.0/a_Size, 0.05);\nv_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 textrueOffsets = vec2(0.0, 0.0);\nif(hasOffsets()) {\nvec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\ntextrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\ntextrueOffsets = u_offsets;\n}\nvec2 offset = project_pixel(textrueOffsets);\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);\n} else {\nvec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\ngl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n}\ngl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_opacity : 1;\nuniform vec2 u_offsets;\nuniform float u_additive;\nuniform float u_stroke_opacity : 1;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nvarying vec4 v_color;\nvarying mat4 styleMappingMat;\nvarying float v_blur;\nvarying float v_innerRadius;\n#pragma include "picking"\nvoid main() {\nvec2 center = vec2(0.5);\nfloat opacity = styleMappingMat[0][0];\nfloat fragmengTocenter = distance(center, gl_PointCoord) * 2.0;\nfloat circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);\nif(v_innerRadius < 0.99) {\nfloat blurWidth = (1.0 - v_blur)/2.0;\nvec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);\nif(fragmengTocenter > v_innerRadius + blurWidth) {\ngl_FragColor = stroke;\n} else if(fragmengTocenter > v_innerRadius - blurWidth){\nfloat mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);\ngl_FragColor = mix(v_color, stroke, mixR);\n} else {\ngl_FragColor = v_color;\n}\n} else {\ngl_FragColor = v_color;\n}\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\nif(u_additive > 0.0) {\ngl_FragColor *= circleClipOpacity;\n} else {\ngl_FragColor.a *= circleClipOpacity;\n}\n}',triangulation:cH,depth:{enable:!1},primitive:e.gl.POINTS,blend:this.getBlend(),stencil:xg(r,a)})]}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,a=void 0===i?1:i;return Array.isArray(a)?[a[0]]:[a]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:e.BlendType.additive}}}]),r}(dz),fH=function(){function e(t,n,r){_(this,e),E(this,"boxCells",[]),E(this,"xCellCount",void 0),E(this,"yCellCount",void 0),E(this,"boxKeys",void 0),E(this,"bboxes",void 0),E(this,"width",void 0),E(this,"height",void 0),E(this,"xScale",void 0),E(this,"yScale",void 0),E(this,"boxUid",void 0);var i=this.boxCells;this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(n/r);for(var a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0}return x(e,[{key:"insert",value:function(e,t,n,r,i){this.forEachCell(t,n,r,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}},{key:"query",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!1,i)}},{key:"hitTest",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!0,i)}},{key:"insertBoxCell",value:function(e,t,n,r,i,a){this.boxCells[i].push(a)}},{key:"queryHitTest",value:function(e,t,n,r,i,a){if(n<0||e>this.width||r<0||t>this.height)return!i&&[];var o=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)o.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});return a?o.filter(a):o}var u={hitTest:i,seenUids:{box:{},circle:{}}};return this.forEachCell(e,t,n,r,this.queryCell,o,u,a),i?o.length>0:o}},{key:"queryCell",value:function(e,t,n,r,i,a,o,s){var u=o.seenUids,l=this.boxCells[i];if(null!==l){var c,h=this.bboxes,f=U(l);try{for(f.s();!(c=f.n()).done;){var p=c.value;if(!u.box[p]){u.box[p]=!0;var d=4*p;if(e<=h[d+2]&&t<=h[d+3]&&n>=h[d+0]&&r>=h[d+1]&&(!s||s(this.boxKeys[p]))){if(o.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[p],x1:h[d],y1:h[d+1],x2:h[d+2],y2:h[d+3]})}}}}catch(e){f.e(e)}finally{f.f()}}return!1}},{key:"forEachCell",value:function(e,t,n,r,i,a,o,s){for(var u=this.convertToXCellCoord(e),l=this.convertToYCellCoord(t),c=this.convertToXCellCoord(n),h=this.convertToYCellCoord(r),f=u;f<=c;f++)for(var p=l;p<=h;p++){var d=this.xCellCount*p+f;if(i.call(this,e,t,n,r,d,a,o,s))return}}},{key:"convertToXCellCoord",value:function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}},{key:"convertToYCellCoord",value:function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}}]),e}(),pH=function(){function e(t,n){_(this,e),E(this,"width",void 0),E(this,"height",void 0),E(this,"grid",void 0),E(this,"viewportPadding",100),E(this,"screenRightBoundary",void 0),E(this,"screenBottomBoundary",void 0),E(this,"gridRightBoundary",void 0),E(this,"gridBottomBoundary",void 0),this.width=t,this.height=n,this.viewportPadding=Math.max(t,n),this.grid=new fH(t+this.viewportPadding,n+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=n+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=n+2*this.viewportPadding}return x(e,[{key:"placeCollisionBox",value:function(e){var t=e.x1+e.anchorPointX+this.viewportPadding,n=e.y1+e.anchorPointY+this.viewportPadding,r=e.x2+e.anchorPointX+this.viewportPadding,i=e.y2+e.anchorPointY+this.viewportPadding;return!this.isInsideGrid(t,n,r,i)||this.grid.hitTest(t,n,r,i)?{box:[]}:{box:[t,n,r,i]}}},{key:"insertCollisionBox",value:function(e,t){var n={featureIndex:t};this.grid.insert(n,e[0],e[1],e[2],e[3])}},{key:"project",value:function(e,t,n){var r=PA(t,n,0,1),i=OA();return RA(i,r,DT.apply(rA,D(e))),{x:(i[0]/i[3]+1)/2*this.width+this.viewportPadding,y:(-i[1]/i[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}}]),e}();function dH(e){var t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0;break;default:n=.5}return{horizontalAlign:t,verticalAlign:n}}function vH(e,t,n,r,i){if(i){var a=e[r],o=a.glyph;if(o)for(var s=t[o].advance*a.scale,u=(e[r].x+s)*i,l=n;l<=r;l++)e[l].x-=u}}function gH(e,t,n,r,i,a,o){var s,u=(t-n)*i,l=(-r*o+.5)*a,c=U(e);try{for(c.s();!(s=c.n()).done;){var h=s.value;h.x+=u,h.y+=l}}catch(e){c.e(e)}finally{c.f()}}function mH(e,t,n,r,i,a,o){var s=0,u=-8,l=0,c=e.positionedGlyphs,h="right"===a?1:"left"===a?0:.5,f=c.length;n.forEach((function(e){if(e.split("").forEach((function(e){var n=t[e];n&&(c.push({glyph:e,x:s,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+o)})),c.length!==f){var n=s-o;l=Math.max(n,l),vH(c,t,f,c.length-1,h)}s=0,u-=r+5}));var p=dH(i),d=p.horizontalAlign,v=p.verticalAlign;gH(c,h,d,v,l,r,n.length);var g=u- -8;e.top+=-v*g,e.bottom=e.top-g,e.left+=-d*l,e.right=e.left+l}function yH(e,t,n,r,i,a,o){var s=0,u=-8,l=0,c=e.positionedGlyphs,h="right"===a?1:"left"===a?0:.5,f=c.length;n.forEach((function(e){var n=t[e];if(n&&(c.push({glyph:e,x:s,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+o),c.length!==f){var i=s-o;l=Math.max(i,l),vH(c,t,f,c.length-1,h)}s=0,u-=r+5}));var p=dH(i),d=p.horizontalAlign,v=p.verticalAlign;gH(c,h,d,v,l,r,n.length);var g=u- -8;e.top+=-v*g,e.bottom=e.top-g,e.left+=-d*l,e.right=e.left+l}var _H='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale : 0.5;\nuniform float u_opacity : 1.0;\nuniform vec4 u_stroke_color : [0, 0, 0, 1];\nuniform float u_stroke_width : 2.0;\nuniform float u_halo_blur : 0.5;\nuniform float u_DevicePixelRatio;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\nfloat strokeWidth = styleMappingMat[0][2];\nvec4 textrueStroke = vec4(\nstyleMappingMat[1][0],\nstyleMappingMat[1][1],\nstyleMappingMat[1][2],\nstyleMappingMat[1][3]\n);\nfloat dist = texture2D(u_sdf_map, v_uv).a;\nlowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;\nhighp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\nhighp float gamma_scaled = gamma * v_gamma_scale;\nhighp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\ngl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));\ngl_FragColor.a= gl_FragColor.a * alpha;\ngl_FragColor = filterColor(gl_FragColor);\n}',bH='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\nattribute vec3 a_Position;\nattribute vec2 a_tex;\nattribute vec2 a_textOffsets;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute float a_Rotate;\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying vec4 v_color;\nvarying float v_fontScale;\nvarying mat4 styleMappingMat;\nuniform float u_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "styleMappingCalStrokeWidth"\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][2] = strokeWidthAndOffset.r;\ntextureOffset = strokeWidthAndOffset.g;\nvec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);\nif(hasStroke()) {\nvec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\nvec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);\nstyleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight);\ntextureOffset += 1.0;\n} else {\nif(u_stroke_color == vec4(0.0)) {\nstyleMappingMat[1][0] = v_color.r;\nstyleMappingMat[1][1] = v_color.g;\nstyleMappingMat[1][2] = v_color.b;\nstyleMappingMat[1][3] = v_color.a;\n} else {\nstyleMappingMat[1][0] = u_stroke_color.r;\nstyleMappingMat[1][1] = u_stroke_color.g;\nstyleMappingMat[1][2] = u_stroke_color.b;\nstyleMappingMat[1][3] = u_stroke_color.a;\n}\n}\nv_color = a_Color;\nv_uv = a_tex / u_sdf_map_size;\nfloat fontScale = a_Size / FONT_SIZE;\nv_fontScale = fontScale;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nhighp float angle_sin = sin(a_Rotate);\nhighp float angle_cos = cos(a_Rotate);\nmat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\nvec4 projected_position;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\nprojected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));\n} else {\nprojected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\ngl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\nv_gamma_scale = gl_Position.w;\nsetPickingColor(a_PickingColor);\n}';function xH(e){var t=e.id,n=[],r=[];if(!this.glyphInfoMap||!this.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var i=this.glyphInfoMap[t].centroid,a=2===i.length?[i[0],i[1],0]:i;return this.glyphInfoMap[t].glyphQuads.forEach((function(e,t){n.push.apply(n,D(a).concat([e.tex.x,e.tex.y+e.tex.height,e.tl.x,e.tl.y],D(a),[e.tex.x+e.tex.width,e.tex.y+e.tex.height,e.tr.x,e.tr.y],D(a),[e.tex.x+e.tex.width,e.tex.y,e.br.x,e.br.y],D(a),[e.tex.x,e.tex.y,e.bl.x,e.bl.y])),r.push(0+4*t,1+4*t,2+4*t,2+4*t,3+4*t,0+4*t)})),{vertices:n,indices:r,size:7}}var EH=function(t){S(r,t);var n=R(r);function r(){var e;_(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return E(O(e=n.call.apply(n,[this].concat(i))),"glyphInfo",void 0),E(O(e),"glyphInfoMap",{}),E(O(e),"texture",void 0),E(O(e),"currentZoom",-1),E(O(e),"extent",void 0),E(O(e),"textureHeight",0),E(O(e),"textCount",0),E(O(e),"preTextStyle",{}),E(O(e),"buildModels",(function(){var t=e.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,a=void 0===i||i;return e.initGlyph(),e.updateTexture(),e.filterGlyphs(),e.reBuildModel(),[e.layer.buildLayerModel({moduleName:"pointText",vertexShader:bH,fragmentShader:_H,triangulation:xH.bind(O(e)),depth:{enable:!1},blend:e.getBlend(),stencil:xg(r,a)})]})),e}return x(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.stroke,a=void 0===i?"#fff":i,o=t.strokeWidth,s=void 0===o?0:o,u=t.textAnchor,l=void 0===u?"center":u,c=t.textAllowOverlap,h=void 0!==c&&c,f=t.halo,p=void 0===f?.5:f,d=t.gamma,v=void 0===d?2:d,g=this.fontService,m=g.canvas,y=g.mapping;if(Object.keys(y).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(y).length),this.preTextStyle={textAnchor:l,textAllowOverlap:h},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r,strokeWidth:s,stroke:a})){this.judgeStyleAttributes({opacity:r,strokeWidth:s,stroke:a});var _=this.layer.getEncodedData(),b=this.calDataFrame(this.cellLength,_,this.cellProperties),x=b.data,E=b.width,S=b.height;this.rowCount=S,this.dataTexture=this.cellLength>0&&x.length>0?this.createTexture2D({flipY:!0,data:x,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:E,height:S}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:PU(r)?r:1,u_stroke_width:PU(s)?s:0,u_stroke_color:this.getStrokeColor(a),u_sdf_map:this.texture,u_halo_blur:p,u_gamma_scale:v,u_sdf_map_size:[m.width,m.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var e=this.layer.getLayerConfig(),t=e.textAnchor,n=void 0===t?"center":t,r=e.textAllowOverlap,i=void 0===r||r;return this.preTextStyle={textAnchor:n,textAllowOverlap:i},this.buildModels()}},{key:"needUpdate",value:function(){var e=this.layer.getLayerConfig().textAllowOverlap,t=void 0!==e&&e,n=this.mapService.getZoom(),r=this.mapService.getBounds(),i=Ov(this.extent,r);return(!t&&(Math.abs(this.currentZoom-n)>1||!i)||t!==this.preTextStyle.textAllowOverlap)&&(this.reBuildModel(),!0)}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:e.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.rotate,a=void 0===i?0:i;return Array.isArray(a)?[a[0]]:[a]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:e.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,a=void 0===i?12:i;return Array.isArray(a)?[a[0]]:[a]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:e.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[3],n[4]]}}})}},{key:"textExtent",value:function(){return kv(this.mapService.getBounds(),.5)}},{key:"initTextFont",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r,a=this.layer.getEncodedData(),o=[];a.forEach((function(e){var t,n=e.shape,r=void 0===n?"":n,i=U(r=r.toString());try{for(i.s();!(t=i.n()).done;){var a=t.value;-1===o.indexOf(a)&&o.push(a)}}catch(e){i.e(e)}finally{i.f()}})),this.fontService.setFontOptions({characterSet:o,fontWeight:n,fontFamily:i,iconfont:!1})}},{key:"initIconFontTex",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r,a=this.layer.getEncodedData(),o=[];a.forEach((function(e){var t=e.shape,n=void 0===t?"":t;n="".concat(n),-1===o.indexOf(n)&&o.push(n)})),this.fontService.setFontOptions({characterSet:o,fontWeight:n,fontFamily:i,iconfont:!0})}},{key:"generateGlyphLayout",value:function(e){var t=this,n=this.fontService.mapping,r=this.layer.getLayerConfig(),i=r.spacing,a=void 0===i?2:i,o=r.textAnchor,s=void 0===o?"center":o,u=this.layer.getEncodedData();this.glyphInfo=u.map((function(r){var i=r.shape,o=void 0===i?"":i,u=r.id,l=r.size,c=void 0===l?1:l,h=r.textOffset,f=void 0===h?[0,0]:h,p=function(e,t,n,r,i,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],s=arguments.length>7?arguments[7]:void 0,u=e.split("\n"),l=[],c={positionedGlyphs:l,top:o[1],bottom:o[1],left:o[0],right:o[0],lineCount:u.length,text:e};return s?yH(c,t,u,n,r,i,a):mH(c,t,u,n,r,i,a),!!l.length&&c}(o.toString(),n,c,s,"left",a,f,e),d=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=e.positionedGlyphs,a=void 0===i?[]:i,o=[],s=U(a);try{for(s.s();!(t=s.n()).done;){var u=t.value,l=u.metrics,c=4,h=l.advance*u.scale/2,f=r?[u.x+h,u.y]:[0,0],p=r?[0,0]:[u.x+h+n[0],u.y+n[1]],d=(0-c)*u.scale-h+p[0],v=(0-c)*u.scale+p[1],g=d+l.width*u.scale,m=v+l.height*u.scale,y={x:d,y:v},_={x:g,y:v},b={x:d,y:m},x={x:g,y:m};o.push({tl:y,tr:_,bl:b,br:x,tex:l,glyphOffset:f})}}catch(e){s.e(e)}finally{s.f()}return o}(p,f,!1);return r.shaping=p,r.glyphQuads=d,r.centroid=oj(r.coordinates),r.originCentroid="GAODE2.x"===r.version?oj(r.originCoordinates):r.originCentroid=r.centroid,t.glyphInfoMap[u]={shaping:p,glyphQuads:d,centroid:oj(r.coordinates)},r}))}},{key:"filterGlyphs",value:function(){var e=this,t=this.layer.getLayerConfig(),n=t.padding,r=void 0===n?[4,4]:n,i=t.textAllowOverlap;if(!(void 0!==i&&i)){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var a=this.rendererService.getViewportSize(),o=a.width,s=a.height,u=new pH(o,s);this.glyphInfo.filter((function(t){var n=t.shaping,i=t.id,a=void 0===i?0:i,o="GAODE2.x"===t.version?t.originCentroid:t.centroid,s=t.size/24,l=e.mapService.lngLatToContainer(o),c=u.placeCollisionBox({x1:n.left*s-r[0],x2:n.right*s+r[0],y1:n.top*s-r[1],y2:n.bottom*s+r[1],anchorPointX:l.x,anchorPointY:l.y}).box;return!(!c||!c.length)&&(u.insertCollisionBox(c,a),!0)})).forEach((function(t){e.glyphInfoMap[t.id]=t}))}}},{key:"initGlyph",value:function(){var e=this.layer.getLayerConfig().iconfont,t=void 0!==e&&e;t?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(t)}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,n=this.fontService.canvas;this.textureHeight=n.height,this.texture&&this.texture.destroy(),this.texture=t({data:n,mag:e.gl.LINEAR,min:e.gl.LINEAR,width:n.width,height:n.height})}},{key:"reBuildModel",value:function(){var e=this.layer.getLayerConfig(),t=e.mask,n=void 0!==t&&t,r=e.maskInside,i=void 0===r||r;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:bH,fragmentShader:_H,triangulation:xH.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:xg(n,i)})]}}]),r}(dz),SH={fillImage:nH,fill:tH,radar:lH,image:oH,normal:uH,simplePoint:hH,extrude:JG,text:EH,icon:aH},CH=function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"type","PointLayer"),e}return x(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new SH[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var e=this.shapeOption,t=e.field,n=e.values,r=this.getLayerConfig(),i=r.shape2d,a=(r.shape3d,this.iconService.getIconMap());if(t&&-1!==(null==i?void 0:i.indexOf(t)))return"fill";if(n&&n instanceof Array){var o,s=U(n);try{for(s.s();!(o=s.n()).done;){var u=o.value;if("string"==typeof u&&a.hasOwnProperty(u))return"image"}}catch(e){s.e(e)}finally{s.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}}[this.getModelType()]}},{key:"getModelType",value:function(){if(this.layerType&&["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon"].includes(this.layerType))return this.layerType;var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),a=e.find((function(e){return e.hasOwnProperty("shape")}));if(a){var o=a.shape;return"dot"===o?"normal":"simple"===o?"simplePoint":"radar"===o?"radar":"fillImage"===o?"fillImage":-1!==(null==n?void 0:n.indexOf(o))?"fill":-1!==(null==r?void 0:r.indexOf(o))?"extrude":i.hasOwnProperty(o)?"image":""!==this.fontService.getGlyph(o)?"icon":"text"}return this.getModelTypeWillEmptyData()}}]),n}(KU),TH=function(t){S(r,t);var n=R(r);function r(){return _(this,r),n.apply(this,arguments)}return x(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.heightfixed,a=void 0!==i&&i;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r})){this.judgeStyleAttributes({opacity:r});var o=this.layer.getEncodedData(),s=this.calDataFrame(this.cellLength,o,this.cellProperties),u=s.data,l=s.width,c=s.height;this.rowCount=c,this.dataTexture=this.cellLength>0&&u.length>0?this.createTexture2D({flipY:!0,data:u,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:l,height:c}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_heightfixed:Number(a),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:PU(r)?r:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var e=this.layer.getLayerConfig(),t=e.pickLight,n=void 0!==t&&t,r=e.mask,i=void 0!==r&&r,a=e.maskInside,o=void 0===a||a;return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:n?'precision highp float;\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvarying float v_lightWeight;\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\nvec4 project_pos = project_position(pos);\nif(u_heightfixed > 0.0) {\nproject_pos.z = a_Position.z * a_Size;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nproject_pos.z *= 4.0/pow(2.0, 21.0 - u_Zoom);\n}\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nfloat lightWeight = calc_lighting(pos);\nv_lightWeight = lightWeight;\nv_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\nsetPickingColor(a_PickingColor);\n}':'precision highp float;\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nvec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\nvec4 project_pos = project_position(pos);\nif(u_heightfixed > 0.0) {\nproject_pos.z = a_Position.z * a_Size;\nif(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\nproject_pos.z *= 4.0/pow(2.0, 21.0 - u_Zoom);\n}\n}\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nfloat lightWeight = calc_lighting(pos);\nv_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\nsetPickingColor(a_PickingColor);\n}',fragmentShader:n?'uniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvarying float v_lightWeight;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\ngl_FragColor = v_Color;\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);\n}':'uniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\ngl_FragColor = v_Color;\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:Aj,stencil:xg(i,o)})]}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,a=void 0===i?10:i;return Array.isArray(a)?[a[0]]:[a]}}})}}]),r}(dz),AH=function(t){S(r,t);var n=R(r);function r(){return _(this,r),n.apply(this,arguments)}return x(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.opacityLinear,a=void 0===i?{enable:!1,dir:"in"}:i;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r})){this.judgeStyleAttributes({opacity:r});var o=this.layer.getEncodedData(),s=this.calDataFrame(this.cellLength,o,this.cellProperties),u=s.data,l=s.width,c=s.height;this.rowCount=c,this.dataTexture=this.cellLength>0&&u.length>0?this.createTexture2D({flipY:!0,data:u,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:l,height:c}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:PU(r)?r:1,u_opacitylinear:Number(a.enable),u_dir:"in"===a.dir?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var e=this.layer.getLayerConfig(),t=e.opacityLinear,n=void 0===t?{enable:!1,dir:"in"}:t,r=e.mask,i=void 0!==r&&r,a=e.maskInside,o=void 0===a||a;return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:n.enable?'attribute vec4 a_Color;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_Color;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "picking"\nuniform float u_opacitylinear: 0.0;\nattribute vec3 a_linear;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\nvoid main() {\nif(u_opacitylinear > 0.0) {\nv_linear = a_linear;\nv_pos = a_Position.xy;\n}\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_Color = a_Color;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}':'attribute vec4 a_Color;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_Color;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_Color = a_Color;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:n.enable?'uniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nuniform float u_opacitylinear: 0.0;\nuniform float u_dir: 1.0;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\ngl_FragColor = v_Color;\nif(u_opacitylinear > 0.0) {\ngl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;\n}\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}':'uniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\ngl_FragColor = v_Color;\ngl_FragColor.a *= opacity;\ngl_FragColor = filterColor(gl_FragColor);\n}',triangulation:n.enable?Cj:Sj,blend:this.getBlend(),depth:{enable:!1},stencil:xg(i,o)})]}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().opacityLinear;(void 0===t?{enable:!1,dir:"in"}:t).enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:e.AttributeType.Attribute,descriptor:{name:"a_linear",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return[n[3],n[4],n[5]]}}})}}]),r}(dz),MH=function(t){S(r,t);var n=R(r);function r(){var e;_(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return E(O(e=n.call.apply(n,[this].concat(i))),"texture1",void 0),E(O(e),"texture2",void 0),E(O(e),"texture3",void 0),e}return x(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.watercolor,a=void 0===i?"#6D99A8":i,o=t.watercolor2,s=void 0===o?"#0F121C":o;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r})){this.judgeStyleAttributes({opacity:r});var u=this.layer.getEncodedData(),l=this.calDataFrame(this.cellLength,u,this.cellProperties),c=l.data,h=l.width,f=l.height;this.rowCount=f,this.dataTexture=this.cellLength>0&&c.length>0?this.createTexture2D({flipY:!0,data:c,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:h,height:f}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:vg(a),u_watercolor2:vg(s),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:PU(r)?r:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var e=this.layer.getLayerConfig(),t=e.mask,n=void 0!==t&&t,r=e.maskInside,i=void 0===r||r;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:'attribute vec4 a_Color;\nattribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_Color;\nvarying vec2 v_uv;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nv_uv = a_uv;\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_Color = a_Color;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform float u_time;\nuniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying vec2 v_uv;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nfloat coast2water_fadedepth = 0.10;\nfloat large_waveheight      = .750;\nfloat large_wavesize        = 3.4;\nfloat small_waveheight      = 0.6;\nfloat small_wavesize        = 0.5;\nfloat water_softlight_fact  = 15.;\nfloat water_glossylight_fact= 120.;\nfloat particle_amount       = 70.;\nuniform vec4 u_watercolor;\nuniform vec4 u_watercolor2;\nvec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);\n#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8)\nuniform sampler2D u_texture1;\nuniform sampler2D u_texture2;\nuniform sampler2D u_texture3;\nfloat hash( float n ) {\nreturn fract(sin(n)*43758.5453123);\n}\nfloat noise1( in vec2 x ) {\nvec2 p  = floor(x);\nvec2 f  = smoothstep(0.0, 1.0, fract(x));\nfloat n = p.x + p.y*57.0;\nreturn mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\nmix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);\n}\nfloat noise(vec2 p) {\nreturn texture2D(u_texture2,p*vec2(1./256.)).x;\n}\nvec4 highness(vec2 p) {\nvec4 t = texture2D(u_texture1,fract(p));\nfloat clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;\nreturn clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);\n}\nfloat height_map( vec2 p ) {\nvec4 height=highness(p);\nmat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );\nfloat f = 0.6000*noise1( p ); p = m*p*1.1*6.;\nf += 0.2500*noise( p ); p = m*p*1.32;\nf += 0.1666*noise( p ); p = m*p*1.11;\nf += 0.0834*noise( p ); p = m*p*1.12;\nf += 0.0634*noise( p ); p = m*p*1.13;\nf += 0.0444*noise( p ); p = m*p*1.14;\nf += 0.0274*noise( p ); p = m*p*1.15;\nf += 0.0134*noise( p ); p = m*p*1.16;\nf += 0.0104*noise( p ); p = m*p*1.17;\nf += 0.0084*noise( p );\nf = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;\nconst float FLAT_LEVEL = 0.92525;\nif (f<FLAT_LEVEL)\nf = f;\nelse\nf = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL;\nreturn clamp(f, 0., 10.);\n}\nvec3 plasma_quintic( float x ) {\nx = clamp( x, 0.0, 1.0);\nvec4 x1 = vec4( 1.0, x, x * x, x * x * x );\nvec4 x2 = x1 * x1.w * x;\nreturn vec3(\ndot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),\ndot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),\ndot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );\n}\nvec4 color(vec2 p){\nvec4 c1 = vec4(1.7,1.6,.9,1);\nvec4 c2 = vec4(.2,.94,.1,1);\nvec4 c3 = vec4(.3,.2,.0,1);\nvec4 c4 = vec4(.99,.99,1.6,1);\nvec4 v = highness(p);\nfloat los = smoothstep(0.1,1.1,v.b);\nfloat his = smoothstep(3.5,6.5,v.b);\nfloat ces = smoothstep(1.,5.,v.a);\nvec4 lo = mix(c1,c2,los);\nvec4 hi = mix(c3,c4,his);\nvec4 ce = mix(lo,hi,ces);\nreturn vec4(plasma_quintic(ces),1).ragb;\n}\nvec3 terrain_map( vec2 p )\n{\nreturn color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5;\n}\nconst mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );\nfloat water_map( vec2 p, float height ) {\nvec2 p2 = p*large_wavesize;\nvec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );\nvec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );\nfloat f = 0.6000*noise( p );\nf += 0.2500*noise( p*m );\nf += 0.1666*noise( p*m*m );\nfloat wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;\np *= small_wavesize;\nf = 0.;\nfloat amp = 1.0, s = .5;\nfor (int i=0; i<9; i++)\n{ p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }\nreturn wave+f*small_waveheight;\n}\nfloat nautic(vec2 p) {\np *= 18.;\nfloat f = 0.;\nfloat amp = 1.0, s = .5;\nfor (int i=0; i<3; i++)\n{ p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }\nreturn pow(1.-f, 5.);\n}\nfloat particles(vec2 p) {\np *= 200.;\nfloat f = 0.;\nfloat amp = 1.0, s = 1.5;\nfor (int i=0; i<3; i++)\n{ p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }\nreturn pow(f*.35, 7.)*particle_amount;\n}\nfloat test_shadow( vec2 xy, float height) {\nvec3 r0 = vec3(xy, height);\nvec3 rd = normalize( light - r0 );\nfloat hit = 1.0;\nfloat t   = 0.001;\nfor (int j=1; j<25; j++)\n{\nvec3 p = r0 + t*rd;\nfloat h = height_map( p.xy );\nfloat height_diff = p.z - h;\nif (height_diff<0.0)\n{\nreturn 0.0;\n}\nt += 0.01+height_diff*.02;\nhit = min(hit, 2.*height_diff/t);\n}\nreturn hit;\n}\nvec3 CalcTerrain(vec2 uv, float height) {\nvec3 col = terrain_map( uv );\nvec2 iResolution = vec2(512.);\nfloat h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);\nfloat h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);\nfloat h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);\nfloat h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);\nvec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));\nvec3 r0 = vec3(uv, height);\nvec3 rd = normalize( light - r0 );\nfloat grad = dot(norm, rd);\ncol *= grad+pow(grad, 8.);\nfloat terrainshade = test_shadow( uv, height );\ncol = mix(col*.25, col, terrainshade);\nreturn col;\n}\nvoid main() {\nvec3 watercolor = u_watercolor.rgb;\nvec3 watercolor2 = u_watercolor2.rgb;\nvec2 uv = v_uv;\nfloat WATER_LEVEL = 0.84;\nfloat deepwater_fadedepth   = 0.4 + coast2water_fadedepth;\nfloat height = height_map( uv );\nvec3 col;\nfloat waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);\nfloat level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);\nif (height > level)\n{\ncol = CalcTerrain(uv, height);\n}\nif (height <= level)\n{\nvec2 dif = vec2(.0, .01);\nvec2 pos = uv*15. + vec2(u_time*.01);\nfloat h1 = water_map(pos-dif,waveheight);\nfloat h2 = water_map(pos+dif,waveheight);\nfloat h3 = water_map(pos-dif.yx,waveheight);\nfloat h4 = water_map(pos+dif.yx,waveheight);\nvec3 normwater = normalize(vec3(h3-h4, h1-h2, .125));\nuv += normwater.xy*.002*(level-height);\ncol = CalcTerrain(uv, height);\nfloat coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);\nfloat coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);\nfloat intensity = col.r*.2126+col.g*.7152+col.b*.0722;\nwatercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));\nvec3 r0 = vec3(uv, WATER_LEVEL);\nvec3 rd = normalize( light - r0 );\nfloat grad     = dot(normwater, rd);\nfloat specular = pow(grad, water_softlight_fact);\nfloat specular2= pow(grad, water_glossylight_fact);\nfloat gradpos  = dot(vec3(0., 0., 1.), rd);\nfloat specular1= smoothstep(0., 1., pow(gradpos, 5.));\nfloat watershade  = test_shadow( uv, level );\nwatercolor *= 2.2+watershade;\nwatercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;\nwatercolor /= (1.+specular1*1.25);\nwatercolor += watershade*specular2*water_specularcolor;\nwatercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));\ncol = mix(col, watercolor, coastfade);\n}\nfloat opacity = styleMappingMat[0][0];\ngl_FragColor = vec4(col, opacity);\n}',triangulation:Sj,depth:{enable:!1},stencil:xg(n,i)})]}},{key:"clearModels",value:function(){var e;this.texture1.destroy(),this.texture2.destroy(),this.texture3.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=N(this.layer.getSource().extent,4),n=t[0],r=t[1],i=t[2],a=t[3],o=i-n,s=a-r;this.styleAttributeService.registerStyleAttribute({name:"linear",type:e.AttributeType.Attribute,descriptor:{name:"a_uv",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,i,a,u){var l=N(i,2),c=l[0],h=l[1];return[(c-n)/o,(h-r)/s]}}})}},{key:"loadTexture",value:function(){var t,n,r,i=this,a=this.rendererService.createTexture2D,o={height:0,width:0};function s(t){return a({data:t,width:t.width,height:t.height,wrapS:e.gl.MIRRORED_REPEAT,wrapT:e.gl.MIRRORED_REPEAT,min:e.gl.LINEAR,mag:e.gl.LINEAR})}this.texture1=a(o),this.texture2=a(o),this.texture3=a(o),t=function(e){i.texture1=s(e[0]),i.texture2=s(e[1]),i.texture3=s(e[2]),i.layerService.updateLayerRenderList(),i.layerService.renderLayers()},n=0,r=[],["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map((function(e){var i=new Image;i.crossOrigin="",i.src=e,r.push(i),i.onload=function(){3==++n&&t(r)}}))}}]),r}(dz),wH={fill:AH,line:YG,extrude:TH,text:EH,point_fill:tH,point_image:oH,point_normal:uH,point_extrude:JG,water:function(t){S(r,t);var n=R(r);function r(){var e;_(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return E(O(e=n.call.apply(n,[this].concat(i))),"texture",void 0),e}return x(r,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),n=t.opacity,r=void 0===n?1:n,i=t.speed,a=void 0===i?.5:i;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:r})){this.judgeStyleAttributes({opacity:r});var o=this.layer.getEncodedData(),s=this.calDataFrame(this.cellLength,o,this.cellProperties),u=s.data,l=s.width,c=s.height;this.rowCount=c,this.dataTexture=this.cellLength>0&&u.length>0?this.createTexture2D({flipY:!0,data:u,format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:l,height:c}):this.createTexture2D({flipY:!0,data:[1],format:e.gl.LUMINANCE,type:e.gl.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:a,u_opacity:PU(r)?r:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var e=this.layer.getLayerConfig(),t=e.mask,n=void 0!==t&&t,r=e.maskInside,i=void 0===r||r;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:'attribute vec4 a_Color;\nattribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_Color;\nvarying vec2 v_uv;\nuniform float u_opacity: 1.0;\nvarying mat4 styleMappingMat;\n#pragma include "styleMapping"\n#pragma include "styleMappingCalOpacity"\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\nv_uv = a_uv;\nstyleMappingMat = mat4(\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0,\n0.0, 0.0, 0.0, 0.0\n);\nfloat rowCount = u_cellTypeLayout[0][0];\nfloat columnCount = u_cellTypeLayout[0][1];\nfloat columnWidth = 1.0/columnCount;\nfloat rowHeight = 1.0/rowCount;\nfloat cellCount = calCellCount();\nfloat id = a_vertexId;\nfloat cellCurrentRow = floor(id * cellCount / columnCount) + 1.0;\nfloat cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0;\nfloat textureOffset = 0.0;\nvec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);\nstyleMappingMat[0][0] = opacityAndOffset.r;\ntextureOffset = opacityAndOffset.g;\nv_Color = a_Color;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\nsetPickingColor(a_PickingColor);\n}',fragmentShader:'uniform sampler2D u_texture;\nuniform float u_time;\nuniform float u_speed: 1.0;\nuniform float u_opacity: 1.0;\nvarying vec4 v_Color;\nvarying vec2 v_uv;\nvarying mat4 styleMappingMat;\n#pragma include "picking"\nfloat rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }\nfloat water(vec3 p) {\nfloat t = u_time * u_speed;\np.z += t * 2.; p.x += t * 2.;\nvec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;\np.z += t * 3.; p.x += t * 0.52;\nvec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;\np.z += t * 4.; p.x += t * 0.8;\nvec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;\nc1 += c2 - c3;\nfloat z = (c1.x + c1.y + c1.z) / 3.;\nreturn p.y + z / 4.;\n}\nfloat map(vec3 p) {\nfloat d = 100.0;\nd = water(p);\nreturn d;\n}\nfloat intersect(vec3 ro, vec3 rd) {\nfloat d = 0.0;\nfor (int i = 0; i <= 100; i++) {\nfloat h = map(ro + rd * d);\nif (h < 0.1) return  d;\nd += h;\n}\nreturn 0.0;\n}\nvec3 norm(vec3 p) {\nfloat eps = .1;\nreturn normalize(vec3(\nmap(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),\nmap(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),\nmap(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))\n));\n} \nfloat calSpc() {\nvec3 l1 = normalize(vec3(1, 1, 1));\nvec3 ro = vec3(-3, 20, -8);\nvec3 rc = vec3(0, 0, 0);\nvec3 ww = normalize(rc - ro);\nvec3 uu = normalize(cross(vec3(0,1,0), ww));\nvec3 vv = normalize(cross(rc - ro, uu));\nvec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);\nfloat d = intersect(ro, rd);\nvec3 p = ro + rd * d;\nvec3 n = norm(p);\nfloat spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);\nreturn spc;\n}\nvoid main() {\nfloat opacity = styleMappingMat[0][0];\ngl_FragColor = v_Color;\ngl_FragColor.a *= opacity;\nfloat spc = calSpc();\ngl_FragColor += spc * 0.4;\n}',triangulation:Sj,depth:{enable:!1},stencil:xg(n,i)})]}},{key:"clearModels",value:function(){var e;this.texture.destroy(),null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=N(this.layer.getSource().extent,4),n=t[0],r=t[1],i=t[2],a=t[3],o=i-n,s=a-r;this.styleAttributeService.registerStyleAttribute({name:"linear",type:e.AttributeType.Attribute,descriptor:{name:"a_uv",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,i,a,u){var l=N(i,2),c=l[0],h=l[1];return[(c-n)/o,(h-r)/s]}}})}},{key:"loadTexture",value:function(){var t=this,n=this.layer.getLayerConfig().waterTexture,r=this.rendererService.createTexture2D;this.texture=r({height:0,width:0});var i=new Image;i.crossOrigin="",n?(console.warn("L7 recommend：https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),i.src=n):i.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",i.onload=function(){t.texture=r({data:i,width:i.width,height:i.height,wrapS:e.gl.MIRRORED_REPEAT,wrapT:e.gl.MIRRORED_REPEAT,min:e.gl.LINEAR,mag:e.gl.LINEAR}),t.layerService.updateLayerRenderList(),t.layerService.renderLayers()}}}]),r}(dz),ocean:MH},kH=function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"type","PolygonLayer"),e}return x(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new wH[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==t||null===(e=t.scale)||void 0===e?void 0:e.field;return"fill"===n?"fill":"extrude"===n?"extrude":"water"===n?"water":"ocean"===n?"ocean":"line"===n?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),a=e.find((function(e){return e.hasOwnProperty("shape")}));if(a){var o=a.shape;return"dot"===o?"point_normal":-1!==(null==n?void 0:n.indexOf(o))?"point_fill":-1!==(null==r?void 0:r.indexOf(o))?"point_extrude":i.hasOwnProperty(o)?"point_image":"text"}return"fill"}}]),n}(KU),OH=function(t){S(r,t);var n=R(r);function r(){var e;_(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return E(O(e=n.call.apply(n,[this].concat(i))),"texture",void 0),E(O(e),"colorTexture",void 0),e}return x(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.clampLow,i=void 0===r||r,a=e.clampHigh,o=void 0===a||a,s=e.noDataValue,u=void 0===s?-9999999:s,l=e.domain,c=void 0===l?[0,1]:l;return this.updateColorTexure(),{u_opacity:n||1,u_texture:this.texture,u_domain:c,u_clampLow:i,u_clampHigh:void 0!==o?o:i,u_noDataValue:u,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,a=void 0===i||i,o=this.layer.getSource(),s=this.rendererService.createTexture2D,u=o.data.dataArray[0];this.texture=s({data:u.data,width:u.width,height:u.height,format:e.gl.LUMINANCE,type:e.gl.FLOAT});var l=yg(this.layer.getLayerConfig().rampColors);return this.colorTexture=s({data:l.data,width:l.width,height:l.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n}\n}',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_min;\nuniform float u_max;\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nvarying vec2 v_texCoord;\nvoid main() {\nfloat value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;\nif (value == u_noDataValue)\ngl_FragColor = vec4(0.0, 0, 0, 0.0);\nelse if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))\ngl_FragColor = vec4(0, 0, 0, 0);\nelse {\nfloat normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);\nvec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));\ngl_FragColor = color;\ngl_FragColor.a =  gl_FragColor.a * u_opacity ;\n}\n}",triangulation:wj,primitive:e.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:xg(r,a)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[3],n[4]]}}})}},{key:"updateColorTexure",value:function(){var e=this.rendererService.createTexture2D,t=yg(this.layer.getLayerConfig().rampColors);this.colorTexture=e({data:t.data,width:t.width,height:t.height,flipY:!1})}}]),r}(dz),PH={raster:OH,raster3d:OH},RH=function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"type","RasterLayer"),e}return x(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new PH[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{raster:{},raster3d:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"raster"}}]),n}(KU),LH=function(t){S(r,t);var n=R(r);function r(){return _(this,r),n.apply(this,arguments)}return x(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?1:e;return{u_opacity:PU(t)?t:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(){return this.layer.zIndex=-997,[this.layer.buildLayerModel({moduleName:"earthAtmoSphere",vertexShader:"attribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nvarying float v_CamreaDistance;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\nvarying float v_offset;\nvoid main() {\nfloat EARTH_RADIUS = 100.0;\nv_Color = a_Color;\nv_offset = min(((length(u_CameraPosition) - EARTH_RADIUS)/600.0) * 0.5 + 0.4, 1.0);\nvVertexNormal = a_Normal;\ngl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}",fragmentShader:"uniform float u_opacity;\nuniform vec3 u_CameraPosition;\nvarying vec3 vVertexNormal;\nvarying float v_offset;\nvarying vec4 v_Color;\nvoid main() {\nfloat intensity = pow(v_offset + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\nif(intensity > 1.0) intensity = 0.0;\ngl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}",triangulation:Rj,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,a=void 0===i?1:i;return Array.isArray(a)?[a[0]]:[a]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[3],n[4]]}}})}}]),r}(dz),IH={base:function(t){S(r,t);var n=R(r);function r(){var e;_(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return E(O(e=n.call.apply(n,[this].concat(i))),"texture",void 0),E(O(e),"earthTime",3.4),E(O(e),"sunX",1e3),E(O(e),"sunY",1e3),E(O(e),"sunZ",1e3),E(O(e),"sunRadius",Math.sqrt(e.sunX*e.sunX+e.sunY*e.sunY+e.sunZ*e.sunZ)),e}return x(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=e.globelOtions;return null!=t&&t.enable&&(this.mapService.rotateY({reg:.002}),this.earthTime+=.02,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY)),{u_ambientRatio:(null==n?void 0:n.ambientRatio)||.6,u_diffuseRatio:(null==n?void 0:n.diffuseRatio)||.4,u_specularRatio:(null==n?void 0:n.specularRatio)||.1,u_sunLight:[this.sunX,this.sunY,this.sunZ],u_texture:this.texture}}},{key:"setEarthTime",value:function(e){this.earthTime=e,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY),this.layerService.renderLayers()}},{key:"initModels",value:function(){var e=this,t=this.layer.getLayerConfig().globelOtions;void 0!==(null==t?void 0:t.earthTime)&&this.setEarthTime(t.earthTime);var n=this.layer.getSource(),r=this.rendererService.createTexture2D;return this.texture=r({height:0,width:0}),n.data.images.then((function(t){e.texture=r({data:t[0],width:t[0].width,height:t[0].height}),e.layerService.updateLayerRenderList(),e.layerService.renderLayers()})),this.buildModels()}},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(){return this.layer.zIndex=-998,[this.layer.buildLayerModel({moduleName:"baseEarth",vertexShader:"\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform float u_ambientRatio : 0.5;\nuniform float u_diffuseRatio : 0.3;\nuniform float u_specularRatio : 0.2;\nuniform vec3 u_sunLight: [1.0, -10.5, 12.0];\nfloat calc_lighting(vec4 pos) {\nvec3 worldPos = vec3(pos * u_ModelMatrix);\nvec3 worldNormal = a_Normal;\nvec3 viewDir = normalize(u_CameraPosition - worldPos);\nvec3 lightDir = normalize(u_sunLight);\nvec3 halfDir = normalize(viewDir+lightDir);\nfloat lambert = dot(worldNormal, lightDir);\nfloat specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\nfloat lightWeight = u_ambientRatio + u_diffuseRatio * lambert + u_specularRatio * specular;\nreturn lightWeight;\n}\nvarying float v_lightWeight;\nvoid main() {\nv_texCoord = a_Uv;\nfloat lightWeight = calc_lighting(vec4(a_Position, 1.0));\nv_lightWeight = lightWeight;\ngl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}",fragmentShader:"uniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvarying float v_lightWeight;\nvoid main() {\nvec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\ncolor.xyz = color.xyz * v_lightWeight;\ngl_FragColor = color;\n}",triangulation:Rj,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,a=void 0===i?1:i;return Array.isArray(a)?[a[0]]:[a]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[3],n[4]]}}})}}]),r}(dz),atomSphere:LH,bloomSphere:function(t){S(r,t);var n=R(r);function r(){return _(this,r),n.apply(this,arguments)}return x(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?1:e;return{u_opacity:PU(t)?t:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(){return this.layer.zIndex=-999,[this.layer.buildLayerModel({moduleName:"earthBloomSphere",vertexShader:"attribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\nvoid main() {\nv_Color = a_Color;\nvVertexNormal = a_Normal;\ngl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}",fragmentShader:"uniform float u_opacity;\nuniform vec3 u_CameraPosition;\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\nvoid main() {\nfloat intensity =  - dot(normalize(vVertexNormal), normalize(u_CameraPosition));\nif(intensity > 1.0) intensity = 0.0;\ngl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}",triangulation:Lj,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:e.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){var i=e.size,a=void 0===i?1:i;return Array.isArray(a)?[a[0]]:[a]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:e.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:e.gl.STATIC_DRAW,data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[3],n[4]]}}})}}]),r}(dz)},NH=["base","atomSphere","bloomSphere"],DH=function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"type","EarthLayer"),e}return x(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new IH[e](this),this.models=this.layerModel.initModels()}},{key:"setEarthTime",value:function(e){this.layerModel&&this.layerModel.setEarthTime?this.layerModel.setEarthTime(e):console.error("请在 scene loaded 之后执行该方法！")}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"base";return NH.indexOf(n)<0&&(n="base"),n}}]),n}(KU),FH={fill:function(t){S(r,t);var n=R(r);function r(){return _(this,r),n.apply(this,arguments)}return x(r,[{key:"getUninforms",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?0:e;return{u_opacity:PU(t)?t:0}}},{key:"initModels",value:function(){return this.layer.zIndex=-1e3,this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"mask",vertexShader:'attribute vec4 a_Color;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_Color;\n#pragma include "projection"\nvoid main() {\nv_Color = a_Color;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\n}',fragmentShader:"uniform float u_opacity;\nvarying vec4 v_Color;\nvoid main() {\ngl_FragColor = v_Color;\ngl_FragColor.a *= u_opacity;\n}",triangulation:Sj,blend:this.getBlend(),depth:{enable:!1},stencil:{enable:!0,mask:255,func:{cmp:e.gl.ALWAYS,ref:1,mask:255},opFront:{fail:e.gl.REPLACE,zfail:e.gl.REPLACE,zpass:e.gl.REPLACE}}})]}},{key:"clearModels",value:function(){var e;null===(e=this.dataTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(dz)},BH=function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"type","MaskLayer"),e}return x(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new FH[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),n}(KU);function UH(e,t,n){var r=zH(e,e.VERTEX_SHADER,t),i=zH(e,e.FRAGMENT_SHADER,n);if(!r||!i)return null;var a=e.createProgram();if(!a)return null;if(e.attachShader(a,r),e.attachShader(a,i),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS)){var o=e.getProgramInfoLog(a);return console.warn("Failed to link program: "+o),e.deleteProgram(a),e.deleteShader(i),e.deleteShader(r),null}for(var s=e.getProgramParameter(a,e.ACTIVE_ATTRIBUTES),u=0;u<s;u++){var l=e.getActiveAttrib(a,u);a[l.name]=e.getAttribLocation(a,l.name)}for(var c=e.getProgramParameter(a,e.ACTIVE_UNIFORMS),h=0;h<c;h++){var f=e.getActiveUniform(a,h);a[f.name]=e.getUniformLocation(a,f.name)}return a.vertexShader=r,a.fragmentShader=i,a}function zH(e,t,n){var r=e.createShader(t);if(null==r)return console.warn("unable to create shader"),null;if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){var i=e.getShaderInfoLog(r);return console.warn("Failed to compile shader: "+i),e.deleteShader(r),null}return r}function jH(e,t,n,r,i){var a=e.createTexture();return e.bindTexture(e.TEXTURE_2D,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,i,0,e.RGBA,e.UNSIGNED_BYTE,n),e.bindTexture(e.TEXTURE_2D,null),a}function VH(e,t,n){e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,t)}function GH(e,t){var n=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),n}function HH(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r=n.createLinearGradient(0,0,256,0),i=0,a=Object.keys(e);i<a.length;i++){var o=a[i];r.addColorStop(+o,e[+o])}return n.fillStyle=r,n.fillRect(0,0,256,1),t=null,new Uint8Array(n.getImageData(0,0,256,1).data)}function WH(e,t,n,r){e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,r,e.FLOAT,!1,0,0)}function XH(e,t,n){e.bindFramebuffer(e.FRAMEBUFFER,t),n&&e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}var YH,ZH,qH,KH,QH,JH,$H,eW,tW,nW,rW=function(){function e(t){_(this,e),E(this,"width",512),E(this,"height",512),E(this,"pixels",void 0),E(this,"fadeOpacity",void 0),E(this,"speedFactor",void 0),E(this,"dropRate",void 0),E(this,"dropRateBump",void 0),E(this,"gl",void 0),E(this,"drawProgram",void 0),E(this,"fullScreenProgram",void 0),E(this,"updateProgram",void 0),E(this,"rampColors",void 0),E(this,"numParticles",65536),E(this,"numParticlesSize",void 0),E(this,"particleStateResolution",void 0),E(this,"quadBuffer",void 0),E(this,"particleIndexBuffer",void 0),E(this,"framebuffer",void 0),E(this,"colorRampTexture",void 0),E(this,"backgroundTexture",void 0),E(this,"screenTexture",void 0),E(this,"particleStateTexture0",void 0),E(this,"particleStateTexture1",void 0),E(this,"windTexture",void 0),E(this,"windData",void 0),this.gl=t.glContext,this.width=t.imageWidth,this.height=t.imageHeight,this.fadeOpacity=t.fadeOpacity,this.speedFactor=t.speedFactor,this.dropRate=t.dropRate,this.dropRateBump=t.dropRateBump,this.rampColors=t.rampColors,this.init()}return x(e,[{key:"init",value:function(){var e=this.gl;this.fadeOpacity=.996,this.speedFactor=.25,this.dropRate=.003,this.dropRateBump=.01,this.drawProgram=UH(e,"\n precision mediump float;\n \n attribute float a_index;\n \n uniform sampler2D u_particles;\n uniform float u_particles_res;\n \n varying vec2 v_particle_pos;\n \n void main() {\n     vec4 color = texture2D(u_particles, vec2(\n         fract(a_index / u_particles_res),\n         floor(a_index / u_particles_res) / u_particles_res)\n     );\n                \n     // decode current particle position from the pixel's RGBA value\n     v_particle_pos = vec2( color.r / 255.0 + color.b, color.g / 255.0 + color.a);\n                         \n     gl_PointSize = 1.0;\n     gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, 1.0 - 2.0 * v_particle_pos.y, 0, 1);\n }","\n precision mediump float;\n \n uniform sampler2D u_wind;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform sampler2D u_color_ramp;\n \n varying vec2 v_particle_pos;\n \n void main() {\n     vec2 velocity = mix(u_wind_min, u_wind_max, texture2D(u_wind, v_particle_pos).rg);\n     float speed_t = length(velocity) / length(u_wind_max);\n     \n     // color ramp is encoded in a 16x16 texture    \n     vec2 ramp_pos = vec2( fract(16.0 * speed_t), floor(16.0 * speed_t) / 16.0);  \n \n     gl_FragColor = texture2D(u_color_ramp, ramp_pos);\n }"),this.fullScreenProgram=UH(e,"\n     precision mediump float;\n     \n     attribute vec2 a_pos;\n     \n     varying vec2 v_tex_pos;\n     \n     void main() {\n         v_tex_pos = a_pos;\n         gl_Position = vec4(1.0 - 2.0 * a_pos, 0.0, 1.0);\n         gl_PointSize = 100.0;\n }","\n precision mediump float;\n \n uniform sampler2D u_screen;\n uniform float u_opacity;\n varying vec2 v_tex_pos;\n \n void main() {\n     vec4 color = texture2D(u_screen, 1.0 - v_tex_pos);\n     \n     // a hack to guarantee opacity fade out even with a value close to 1.0\n     gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n }"),this.updateProgram=UH(e,"\n precision mediump float;\n \n attribute vec2 a_pos;\n \n varying vec2 v_tex_pos;\n \n void main() {\n     v_tex_pos = a_pos;\n     gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n     // framebuffer 始终用铺满屏幕的 texture\n }","\n precision highp float;\n \n uniform sampler2D u_particles;\n uniform sampler2D u_wind;\n uniform vec2 u_wind_res;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform float u_rand_seed;\n uniform float u_speed_factor;\n uniform float u_drop_rate;\n uniform float u_drop_rate_bump;\n \n varying vec2 v_tex_pos;\n \n // pseudo-random generator\n const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\n float rand(const vec2 co) {\n float t = dot(rand_constants.xy, co);\n     return fract(sin(t) * (rand_constants.z + t));\n }\n     \n // wind speed lookup; use manual bilinear filtering based on 4 adjacent pixels for smooth interpolation\n vec2 lookup_wind(const vec2 uv) {\n     // return texture2D(u_wind, uv).rg; // lower-res hardware filtering\n     vec2 px = 1.0 / u_wind_res;\n     vec2 vc = (floor(uv * u_wind_res)) * px;\n     vec2 f = fract(uv * u_wind_res);\n     vec2 tl = texture2D(u_wind, vc).rg;\n     vec2 tr = texture2D(u_wind, vc + vec2(px.x, 0)).rg;\n     vec2 bl = texture2D(u_wind, vc + vec2(0, px.y)).rg;\n     vec2 br = texture2D(u_wind, vc + px).rg;\n     return mix(mix(tl, tr, f.x), mix(bl, br, f.x), f.y);\n }\n \n void main() {\n     vec4 color = texture2D(u_particles, v_tex_pos);\n     vec2 pos = vec2(\n         color.r / 255.0 + color.b,\n         color.g / 255.0 + color.a); // decode particle position from pixel RGBA\n     vec2 velocity = mix(u_wind_min, u_wind_max, lookup_wind(pos));\n     float speed_t = length(velocity) / length(u_wind_max);\n                 \n     // take EPSG:4236 distortion into account for calculating where the particle moved\n     float distortion = cos(radians(pos.y * 180.0 - 90.0));\n     vec2 offset = vec2(velocity.x / distortion, -velocity.y) * 0.0001 * u_speed_factor;\n \n     // update particle position, wrapping around the date line\n     pos = fract(1.0 + pos + offset);\n     \n     // a random seed to use for the particle drop\n     vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n     \n     // drop rate is a chance a particle will restart at random position, to avoid degeneration\n     float drop_rate = u_drop_rate + speed_t * u_drop_rate_bump;\n     float drop = step(1.0 - drop_rate, rand(seed));\n     \n     vec2 random_pos = vec2(\n         rand(seed + 1.3),\n         rand(seed + 2.1));\n         pos = mix(pos, random_pos, drop);\n         \n     // encode the new particle position back into RGBA\n     gl_FragColor = vec4(\n         fract(pos * 255.0),\n         floor(pos * 255.0) / 255.0);\n }"),this.quadBuffer=GH(e,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),this.framebuffer=e.createFramebuffer(),this.colorRampTexture=jH(this.gl,this.gl.LINEAR,HH(this.rampColors),16,16);var t=new Uint8Array(this.width*this.height*4);this.backgroundTexture=jH(e,e.NEAREST,t,this.width,this.height),this.screenTexture=jH(e,e.NEAREST,t,this.width,this.height);var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=jH(e,e.NEAREST,r,n,n),this.particleStateTexture1=jH(e,e.NEAREST,r,n,n);for(var a=new Float32Array(this.numParticlesSize),o=0;o<this.numParticlesSize;o++)a[o]=o;this.particleIndexBuffer=GH(e,a)}},{key:"setWind",value:function(e){this.windData=e,this.windTexture=function(e,t,n){var r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.bindTexture(e.TEXTURE_2D,null),r}(this.gl,this.gl.LINEAR,e.image)}},{key:"updateParticelNum",value:function(e){var t=this.gl;if(e!==this.numParticles){this.numParticles=e;var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=jH(t,t.NEAREST,r,n,n),this.particleStateTexture1=jH(t,t.NEAREST,r,n,n);for(var a=new Float32Array(this.numParticlesSize),o=0;o<this.numParticlesSize;o++)a[o]=o;this.particleIndexBuffer=GH(t,a)}}},{key:"updateWindDir",value:function(e,t,n,r){this.windData.uMin=e,this.windData.uMax=t,this.windData.vMin=n,this.windData.vMax=r}},{key:"updateColorRampTexture",value:function(e){if(this.isColorChanged(e)){this.rampColors=e;var t=this.gl;t.deleteTexture(this.colorRampTexture),this.colorRampTexture=jH(t,t.LINEAR,HH(e),16,16)}}},{key:"isColorChanged",value:function(e){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],i=Number(r);if(!this.rampColors[i])return!0;if(this.rampColors[i]&&this.rampColors[i]!==e[i])return!0}return!1}},{key:"reSize",value:function(e,t){if(e!==this.width||t!==this.height){var n=this.gl;n.deleteTexture(this.backgroundTexture),n.deleteTexture(this.screenTexture),this.width=e,this.height=t;var r=new Uint8Array(e*t*4);this.backgroundTexture=jH(n,n.NEAREST,r,e,t),this.screenTexture=jH(n,n.NEAREST,r,e,t)}}},{key:"draw",value:function(){var e;if(null!==(e=this.windData)&&void 0!==e&&e.image){var t=this.gl;return VH(t,this.windTexture,0),VH(t,this.particleStateTexture0,1),this.drawScreen(),this.updateParticles(),{d:this.pixels,w:this.width,h:this.height}}return{d:new Uint8Array([0,0,0,0]),w:1,h:1}}},{key:"drawScreen",value:function(){var e=this.gl;XH(e,this.framebuffer,this.screenTexture),e.viewport(0,0,this.width,this.height),this.drawFullTexture(this.backgroundTexture,this.fadeOpacity),this.drawParticles(),e.disable(e.BLEND),this.pixels=new Uint8Array(4*this.width*this.height),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.pixels),XH(e,null,null),e.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);var t=this.backgroundTexture;this.backgroundTexture=this.screenTexture,this.screenTexture=t}},{key:"drawFullTexture",value:function(e,t){var n=this.gl,r=this.fullScreenProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.quadBuffer),n.vertexAttribPointer(r.a_pos,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.a_pos),n.bindBuffer(n.ARRAY_BUFFER,null),VH(n,e,2),n.uniform1i(r.u_screen,2),n.uniform1f(r.u_opacity,t),n.drawArrays(n.TRIANGLES,0,6)}},{key:"drawParticles",value:function(){var e=this.gl,t=this.drawProgram;e.useProgram(t),WH(e,this.particleIndexBuffer,t.a_index,1),VH(e,this.colorRampTexture,2),e.uniform1i(t.u_wind,0),e.uniform1i(t.u_particles,1),e.uniform1i(t.u_color_ramp,2),e.uniform1f(t.u_particles_res,this.particleStateResolution),e.uniform2f(t.u_wind_min,this.windData.uMin,this.windData.vMin),e.uniform2f(t.u_wind_max,this.windData.uMax,this.windData.vMax),e.drawArrays(e.POINTS,0,this.numParticlesSize)}},{key:"updateParticles",value:function(){var e=this.gl;XH(e,this.framebuffer,this.particleStateTexture1),e.viewport(0,0,this.particleStateResolution,this.particleStateResolution);var t=this.updateProgram;e.useProgram(t),WH(e,this.quadBuffer,t.a_pos,2),e.uniform1i(t.u_wind,0),e.uniform1i(t.u_particles,1),e.uniform1f(t.u_rand_seed,Math.random()),e.uniform2f(t.u_wind_res,2*this.windData.image.width,2*this.windData.image.height),e.uniform2f(t.u_wind_min,this.windData.uMin,this.windData.vMin),e.uniform2f(t.u_wind_max,this.windData.uMax,this.windData.vMax),e.uniform1f(t.u_speed_factor,this.speedFactor),e.uniform1f(t.u_drop_rate,this.dropRate),e.uniform1f(t.u_drop_rate_bump,this.dropRateBump),e.drawArrays(e.TRIANGLES,0,6);var n=this.particleStateTexture0;this.particleStateTexture0=this.particleStateTexture1,this.particleStateTexture1=n,XH(e,null,null)}},{key:"destroy",value:function(){this.gl.deleteBuffer(this.quadBuffer),this.gl.deleteBuffer(this.particleIndexBuffer),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteShader(this.drawProgram.vertexShader),this.gl.deleteShader(this.drawProgram.fragmentShader),this.gl.deleteProgram(this.drawProgram),this.gl.deleteShader(this.fullScreenProgram.vertexShader),this.gl.deleteShader(this.fullScreenProgram.fragmentShader),this.gl.deleteProgram(this.fullScreenProgram),this.gl.deleteShader(this.updateProgram.vertexShader),this.gl.deleteShader(this.updateProgram.fragmentShader),this.gl.deleteProgram(this.updateProgram),this.gl.deleteTexture(this.colorRampTexture),this.gl.deleteTexture(this.backgroundTexture),this.gl.deleteTexture(this.screenTexture),this.gl.deleteTexture(this.particleStateTexture0),this.gl.deleteTexture(this.particleStateTexture1),this.gl.deleteTexture(this.windTexture)}}]),e}(),iW={0:"#3288bd",.1:"#66c2a5",.2:"#abdda4",.3:"#e6f598",.4:"#fee08b",.5:"#fdae61",.6:"#f46d43",1:"#d53e4f"},aW={wind:function(t){S(r,t);var n=R(r);function r(){var e;_(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return E(O(e=n.call.apply(n,[this].concat(i))),"texture",void 0),E(O(e),"colorModel",void 0),E(O(e),"wind",void 0),E(O(e),"imageCoords",void 0),E(O(e),"sizeScale",.5),E(O(e),"frequency",new Fv(7.2)),e}return x(r,[{key:"render",value:function(){var e=this;this.frequency.run((function(){e.drawWind()})),this.drawColorMode()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var t=this,n=this.rendererService.createTexture2D,r=this.layer.getSource();this.texture=n({height:0,width:0});var i=this.rendererService.getGLContext();return this.imageCoords=r.data.dataArray[0].coordinates,r.data.images.then((function(e){var r=t.layer.getLayerConfig(),a=r.uMin,o=void 0===a?-21.32:a,s=r.uMax,u=void 0===s?26.8:s,l=r.vMin,c=void 0===l?-21.57:l,h=r.vMax,f=void 0===h?21.42:h,p=r.fadeOpacity,d=void 0===p?.996:p,v=r.speedFactor,g=void 0===v?.25:v,m=r.dropRate,y=void 0===m?.003:m,_=r.dropRateBump,b=void 0===_?.01:_,x=r.rampColors,E=void 0===x?iW:x,S=r.sizeScale,C=void 0===S?.5:S;t.sizeScale=C;var T=t.getWindSize(),A=T.imageWidth,M=T.imageHeight,w={glContext:i,imageWidth:A,imageHeight:M,fadeOpacity:d,speedFactor:g,dropRate:y,dropRateBump:b,rampColors:E};t.wind=new rW(w),t.wind.setWind({uMin:o,uMax:u,vMin:c,vMax:f,image:e[0]}),t.texture=n({data:e[0],width:e[0].width,height:e[0].height}),t.layerService.updateLayerRenderList(),t.layerService.renderLayers()})),this.colorModel=this.layer.buildLayerModel({moduleName:"WindLayer",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\nv_texCoord = a_Uv;\nvec4 project_pos = project_position(vec4(a_Position, 1.0));\nif(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\ngl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n} else {\ngl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n}\n}',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\nvec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\ngl_FragColor = color;\ngl_FragColor.a *= u_opacity;\n}",triangulation:wj,primitive:e.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()}),[this.colorModel]}},{key:"getWindSize",value:function(){var e=this.mapService.lngLatToPixel(this.imageCoords[0]),t=this.mapService.lngLatToPixel(this.imageCoords[1]);return{imageWidth:Math.floor((t.x-e.x)*this.sizeScale),imageHeight:Math.floor((e.y-t.y)*this.sizeScale)}}},{key:"buildModels",value:function(){return this.initModels()}},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.wind)||void 0===t||t.destroy()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:e.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:2,update:function(e,t,n,r){return[n[3],n[4]]}}})}},{key:"drawWind",value:function(){if(this.wind){var e=this.layer.getLayerConfig(),t=e.uMin,n=void 0===t?-21.32:t,r=e.uMax,i=void 0===r?26.8:r,a=e.vMin,o=void 0===a?-21.57:a,s=e.vMax,u=void 0===s?21.42:s,l=e.numParticles,c=void 0===l?65535:l,h=e.fadeOpacity,f=void 0===h?.996:h,p=e.speedFactor,d=void 0===p?.25:p,v=e.dropRate,g=void 0===v?.003:v,m=e.dropRateBump,y=void 0===m?.01:m,_=e.rampColors,b=void 0===_?iW:_,x=e.sizeScale,E=void 0===x?.5:x;if("number"==typeof E&&E!==this.sizeScale){this.sizeScale=E;var S=this.getWindSize(),C=S.imageWidth,T=S.imageHeight;this.wind.reSize(C,T)}this.wind.updateWindDir(n,i,o,u),this.wind.updateParticelNum(c),this.wind.updateColorRampTexture(b),this.wind.fadeOpacity=f,this.wind.speedFactor=d,this.wind.dropRate=g,this.wind.dropRateBump=y;var A=this.wind.draw(),M=A.d,w=A.w,k=A.h;this.rendererService.setBaseState(),this.texture.update({data:M,width:w,height:k})}}},{key:"drawColorMode",value:function(){var e=this.layer.getLayerConfig().opacity;this.colorModel.draw({uniforms:{u_opacity:e||1,u_texture:this.texture}})}}]),r}(dz)},oW=function(e){S(n,e);var t=R(n);function n(){var e;_(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return E(O(e=t.call.apply(t,[this].concat(i))),"type","WindLayer"),e}return x(n,[{key:"buildModels",value:function(){var e=this.getModelType();this.layerModel=new aW[e](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){return this.layerModel&&this.layerModel.render(),this}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{wind:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"wind"}}]),n}(KU),sW=(YH=Qx(),ZH=Kx(YE.IGlobalConfigService),qH=Kx(YE.IMapService),KH=Kx(YE.IFontService),YH(($H=j((JH=function(){function t(){_(this,t),z(this,"configService",$H,this),z(this,"mapService",eW,this),z(this,"fontService",tW,this)}return x(t,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tap("DataMappingPlugin",(function(){n.generateMaping(e,{styleAttributeService:r})})),e.hooks.beforeRenderData.tap("DataMappingPlugin",(function(){return e.dataState.dataMappingNeedUpdate=!1,n.generateMaping(e,{styleAttributeService:r}),!0})),e.hooks.beforeRender.tap("DataMappingPlugin",(function(){if(!e.layerModelNeedUpdate){var t=e.getBottomColor(),i=r.getLayerStyleAttributes()||[],a=r.getLayerStyleAttribute("filter"),o=e.getSource().data.dataArray,s=i.filter((function(e){return e.needRemapping})),u=o;null!=a&&a.needRemapping&&null!=a&&a.scale&&(u=o.filter((function(e){return n.applyAttributeMapping(a,e,t)[0]}))),s.length&&(null!=a&&a.needRemapping?(e.setEncodedData(n.mapping(i,u,void 0,t)),a.needRemapping=!1):e.setEncodedData(n.mapping(s,u,e.getEncodedData(),t)),e.emit("remapping",null))}}))}},{key:"generateMaping",value:function(e,t){var n=this,r=t.styleAttributeService,i=e.getBottomColor(),a=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),s=e.getSource().data.dataArray,u=s;null!=o&&o.scale&&(u=s.filter((function(e){return n.applyAttributeMapping(o,e,i)[0]}))),e.setEncodedData(this.mapping(a,u,void 0,i))}},{key:"mapping",value:function(e,t,n,r){var i=this,a=t.map((function(t,a){var o=n?n[a]:{},s=v({id:t._id,coordinates:t.coordinates},o);return e.filter((function(e){return void 0!==e.scale})).forEach((function(e){var n=i.applyAttributeMapping(e,t,r);e.needRemapping=!1,"color"===e.name&&(n=n.map((function(e){return vg(e)}))),s[e.name]=Array.isArray(n)&&1===n.length?n[0]:n,"shape"===e.name&&(s.shape=i.fontService.getIconFontKey(s[e.name]))})),s}));return this.adjustData2Amap2Coordinates(a),this.adjustData2SimpleCoordinates(a),a}},{key:"adjustData2Amap2Coordinates",value:function(t){var n=this;t.length>0&&this.mapService.version===e.Version["GAODE2.x"]&&("number"==typeof t[0].coordinates[0]?t.filter((function(e){return!e.originCoordinates})).map((function(t){t.version=e.Version["GAODE2.x"],t.originCoordinates=cb(t.coordinates),t.coordinates=n.mapService.lngLatToCoord(t.coordinates)})):t.filter((function(e){return!e.originCoordinates})).map((function(t){t.version=e.Version["GAODE2.x"],t.originCoordinates=cb(t.coordinates),t.coordinates=n.mapService.lngLatToCoords(t.coordinates)})))}},{key:"adjustData2SimpleCoordinates",value:function(t){var n=this;t.length>0&&this.mapService.version===e.Version.SIMPLE&&t.map((function(e){e.simpleCoordinate||(e.coordinates=n.unProjectCoordinates(e.coordinates),e.simpleCoordinate=!0)}))}},{key:"unProjectCoordinates",value:function(e){var t=this;if("number"==typeof e[0])return this.mapService.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var n=[];return e.map((function(e){var r=[];e.map((function(e){r.push(t.mapService.simpleMapCoord.unproject(e))})),n.push(r)})),n}var r=[];return e.map((function(e){r.push(t.mapService.simpleMapCoord.unproject(e))})),r}},{key:"applyAttributeMapping",value:function(e,t,n){var r;if(!e.scale)return[];var i=(null==e||null===(r=e.scale)||void 0===r?void 0:r.scalers)||[],a=[];i.forEach((function(n){var r,i=n.field;(t.hasOwnProperty(i)||"variable"===(null===(r=e.scale)||void 0===r?void 0:r.type))&&a.push(t[i])}));var o=e.mapping?e.mapping(a):[];return"color"!==e.name||dg(o[0])?o:[n]}}]),t}()).prototype,"configService",[ZH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eW=j(JH.prototype,"mapService",[qH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tW=j(JH.prototype,"fontService",[KH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QH=JH))||QH),uW=Qx()(nW=function(){function e(){_(this,e),E(this,"mapService",void 0)}return x(e,[{key:"apply",value:function(e){var t=this;this.mapService=e.getContainer().get(YE.IMapService),e.hooks.init.tap("DataSourcePlugin",(function(){if(!e.getSource()){var n=e.sourceOption||{data:rx,options:ix},r=n.data,i=n.options;e.setSource(new Yb(r,i))}t.updateClusterData(e)})),e.hooks.beforeRenderData.tap("DataSourcePlugin",(function(){var n=t.updateClusterData(e),r=e.dataState.dataSourceNeedUpdate;return e.dataState.dataSourceNeedUpdate=!1,n||r}))}},{key:"updateClusterData",value:function(e){var t=e.getSource(),n=t.cluster,r=t.clusterOptions,i=r.zoom,a=void 0===i?0:i,o=(r.maxZoom,this.mapService.getZoom()-1),s=e.dataState.dataSourceNeedUpdate;return!(!n||!(s||Math.abs(e.clusterZoom-o)>=1))&&(a!==Math.floor(o)&&t.updateClusterData(Math.floor(o)),e.clusterZoom=o,!0)}}]),e}())||nW;function lW(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function cW(e){return 1===e.length&&(e=function(e){return function(t,n){return lW(e(t),n)}}(e)),{left:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var a=r+i>>>1;e(t[a],n)<0?r=a+1:i=a}return r},right:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var a=r+i>>>1;e(t[a],n)>0?i=a:r=a+1}return r}}}var hW=cW(lW).right;function fW(e){return null===e?NaN:+e}var pW=Math.sqrt(50),dW=Math.sqrt(10),vW=Math.sqrt(2);function gW(e,t,n){var r,i,a,o,s=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(o=mW(e,t,n))||!isFinite(o))return[];if(o>0)for(e=Math.ceil(e/o),t=Math.floor(t/o),a=new Array(i=Math.ceil(t-e+1));++s<i;)a[s]=(e+s)*o;else for(e=Math.floor(e*o),t=Math.ceil(t*o),a=new Array(i=Math.ceil(e-t+1));++s<i;)a[s]=(e-s)/o;return r&&a.reverse(),a}function mW(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/Math.pow(10,i);return i>=0?(a>=pW?10:a>=dW?5:a>=vW?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=pW?10:a>=dW?5:a>=vW?2:1)}function yW(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=pW?i*=10:a>=dW?i*=5:a>=vW&&(i*=2),t<e?-i:i}function _W(e,t,n){if(null==n&&(n=fW),r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,a=Math.floor(i),o=+n(e[a],a,e);return o+(+n(e[a+1],a+1,e)-o)*(i-a)}}function bW(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function xW(){}function EW(e,t){var n=new xW;if(e instanceof xW)e.each((function(e,t){n.set(t,e)}));else if(Array.isArray(e)){var r,i=-1,a=e.length;if(null==t)for(;++i<a;)n.set(i,e[i]);else for(;++i<a;)n.set(t(r=e[i],i,e),r)}else if(e)for(var o in e)n.set(o,e[o]);return n}function SW(){}xW.prototype=EW.prototype={constructor:xW,has:function(e){return"$"+e in this},get:function(e){return this["$"+e]},set:function(e,t){return this["$"+e]=t,this},remove:function(e){var t="$"+e;return t in this&&delete this[t]},clear:function(){for(var e in this)"$"===e[0]&&delete this[e]},keys:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)"$"===t[0]&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)"$"===t[0]&&++e;return e},empty:function(){for(var e in this)if("$"===e[0])return!1;return!0},each:function(e){for(var t in this)"$"===t[0]&&e(this[t],t.slice(1),this)}};var CW=EW.prototype;SW.prototype=function(e,t){var n=new SW;if(e instanceof SW)e.each((function(e){n.add(e)}));else if(e){var r=-1,i=e.length;if(null==t)for(;++r<i;)n.add(e[r]);else for(;++r<i;)n.add(t(e[r],r,e))}return n}.prototype={constructor:SW,has:CW.has,add:function(e){return this["$"+(e+="")]=e,this},remove:CW.remove,clear:CW.clear,values:CW.keys,size:CW.size,empty:CW.empty,each:CW.each};var TW=Array.prototype,AW=TW.map,MW=TW.slice,wW={name:"implicit"};function kW(){var e=EW(),t=[],n=[],r=wW;function i(i){var a=i+"",o=e.get(a);if(!o){if(r!==wW)return r;e.set(a,o=t.push(i))}return n[(o-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=EW();for(var r,a,o=-1,s=n.length;++o<s;)e.has(a=(r=n[o])+"")||e.set(a,t.push(r));return i},i.range=function(e){return arguments.length?(n=MW.call(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return kW(t,n).unknown(r)},bW.apply(i,arguments),i}function OW(e){return function(){return e}}function PW(e){return 1==(e=+e)?RW:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):OW(isNaN(t)?n:t)}}function RW(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):OW(isNaN(e)?t:e)}var LW=function e(t){var n=PW(t);function r(e,t){var r=n((e=ag(e)).r,(t=ag(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=RW(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);function IW(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}}function NW(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=VW(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}function DW(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function FW(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function BW(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=VW(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var UW=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,zW=new RegExp(UW.source,"g");function jW(e,t){var n,r,i,a=UW.lastIndex=zW.lastIndex=0,o=-1,s=[],u=[];for(e+="",t+="";(n=UW.exec(e))&&(r=zW.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,u.push({i:o,x:FW(n,r)})),a=zW.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})}function VW(e,t){var n,r,i=typeof t;return null==t||"boolean"===i?OW(t):("number"===i?FW:"string"===i?(n=tg(t))?(t=n,LW):jW:t instanceof tg?LW:t instanceof Date?DW:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?NW:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?BW:FW:IW))(e,t)}function GW(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function HW(e){return+e}var WW=[0,1];function XW(e){return e}function YW(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function ZW(e){var t,n=e[0],r=e[e.length-1];return n>r&&(t=n,n=r,r=t),function(e){return Math.max(n,Math.min(r,e))}}function qW(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];return i<r?(r=YW(i,r),a=n(o,a)):(r=YW(r,i),a=n(a,o)),function(e){return a(r(e))}}function KW(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=YW(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){var n=hW(e,t,1,r)-1;return a[n](i[n](t))}}function QW(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function JW(){var e,t,n,r,i,a,o=WW,s=WW,u=VW,l=XW;function c(){return r=Math.min(o.length,s.length)>2?KW:qW,i=a=null,h}function h(t){return isNaN(t=+t)?n:(i||(i=r(o.map(e),s,u)))(e(l(t)))}return h.invert=function(n){return l(t((a||(a=r(s,o.map(e),FW)))(n)))},h.domain=function(e){return arguments.length?(o=AW.call(e,HW),l===XW||(l=ZW(o)),c()):o.slice()},h.range=function(e){return arguments.length?(s=MW.call(e),c()):s.slice()},h.rangeRound=function(e){return s=MW.call(e),u=GW,c()},h.clamp=function(e){return arguments.length?(l=e?ZW(o):XW,h):l!==XW},h.interpolate=function(e){return arguments.length?(u=e,c()):u},h.unknown=function(e){return arguments.length?(n=e,h):n},function(n,r){return e=n,t=r,c()}}function $W(e,t){return JW()(e,t)}function eX(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function tX(e){return(e=eX(Math.abs(e)))?e[1]:NaN}var nX,rX=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function iX(e){if(!(t=rX.exec(e)))throw new Error("invalid format: "+e);var t;return new aX({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function aX(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function oX(e,t){var n=eX(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}iX.prototype=aX.prototype,aX.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var sX={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return oX(100*e,t)},r:oX,s:function(e,t){var n=eX(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(nX=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+eX(e,Math.max(0,t+a-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function uX(e){return e}var lX,cX,hX,fX=Array.prototype.map,pX=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function dX(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?uX:(t=fX.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,a=[],o=0,s=t[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),a.push(e.substring(i-=s,i+s)),!((u+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?uX:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(fX.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",l=void 0===e.minus?"-":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function h(e){var t=(e=iX(e)).fill,n=e.align,h=e.sign,f=e.symbol,p=e.zero,d=e.width,v=e.comma,g=e.precision,m=e.trim,y=e.type;"n"===y?(v=!0,y="g"):sX[y]||(void 0===g&&(g=12),m=!0,y="g"),(p||"0"===t&&"="===n)&&(p=!0,t="0",n="=");var _="$"===f?i:"#"===f&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",b="$"===f?a:/[%p]/.test(y)?u:"",x=sX[y],E=/[defgprs%]/.test(y);function S(e){var i,a,u,f=_,S=b;if("c"===y)S=x(e)+S,e="";else{var C=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:x(Math.abs(e),g),m&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),C&&0==+e&&"+"!==h&&(C=!1),f=(C?"("===h?h:l:"-"===h||"("===h?"":h)+f,S=("s"===y?pX[8+nX/3]:"")+S+(C&&"("===h?")":""),E)for(i=-1,a=e.length;++i<a;)if(48>(u=e.charCodeAt(i))||u>57){S=(46===u?o+e.slice(i+1):e.slice(i))+S,e=e.slice(0,i);break}}v&&!p&&(e=r(e,1/0));var T=f.length+e.length+S.length,A=T<d?new Array(d-T+1).join(t):"";switch(v&&p&&(e=r(A+e,A.length?d-S.length:1/0),A=""),n){case"<":e=f+e+S+A;break;case"=":e=f+A+e+S;break;case"^":e=A.slice(0,T=A.length>>1)+f+e+S+A.slice(T);break;default:e=A+f+e+S}return s(e)}return g=void 0===g?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),S.toString=function(){return e+""},S}return{format:h,formatPrefix:function(e,t){var n=h(((e=iX(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(tX(t)/3))),i=Math.pow(10,-r),a=pX[8+r/3];return function(e){return n(i*e)+a}}}}function vX(e,t,n,r){var i,a=yW(e,t,n);switch((r=iX(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(tX(t)/3)))-tX(Math.abs(e)))}(a,o))||(r.precision=i),hX(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,tX(t)-tX(e))+1}(a,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(e){return Math.max(0,-tX(Math.abs(e)))}(a))||(r.precision=i-2*("%"===r.type))}return cX(r)}function gX(e){var t=e.domain;return e.ticks=function(e){var n=t();return gW(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return vX(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i=t(),a=0,o=i.length-1,s=i[a],u=i[o];return u<s&&(r=s,s=u,u=r,r=a,a=o,o=r),(r=mW(s,u,n))>0?r=mW(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,n):r<0&&(r=mW(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,n)),r>0?(i[a]=Math.floor(s/r)*r,i[o]=Math.ceil(u/r)*r,t(i)):r<0&&(i[a]=Math.ceil(s*r)/r,i[o]=Math.floor(u*r)/r,t(i)),e},e}function mX(e,t){var n,r=0,i=(e=e.slice()).length-1,a=e[r],o=e[i];return o<a&&(n=r,r=i,i=n,n=a,a=o,o=n),e[r]=t.floor(a),e[i]=t.ceil(o),e}function yX(e){return Math.log(e)}function _X(e){return Math.exp(e)}function bX(e){return-Math.log(-e)}function xX(e){return-Math.exp(-e)}function EX(e){return isFinite(e)?+("1e"+e):e<0?0:e}function SX(e){return function(t){return-e(-t)}}function CX(e){var t,n,r=e(yX,_X),i=r.domain,a=10;function o(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(a),n=function(e){return 10===e?EX:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(a),i()[0]<0?(t=SX(t),n=SX(n),e(bX,xX)):e(yX,_X),r}return r.base=function(e){return arguments.length?(a=+e,o()):a},r.domain=function(e){return arguments.length?(i(e),o()):i()},r.ticks=function(e){var r,o=i(),s=o[0],u=o[o.length-1];(r=u<s)&&(f=s,s=u,u=f);var l,c,h,f=t(s),p=t(u),d=null==e?10:+e,v=[];if(!(a%1)&&p-f<d){if(f=Math.round(f)-1,p=Math.round(p)+1,s>0){for(;f<p;++f)for(c=1,l=n(f);c<a;++c)if(!((h=l*c)<s)){if(h>u)break;v.push(h)}}else for(;f<p;++f)for(c=a-1,l=n(f);c>=1;--c)if(!((h=l*c)<s)){if(h>u)break;v.push(h)}}else v=gW(f,p,Math.min(p-f,d)).map(n);return r?v.reverse():v},r.tickFormat=function(e,i){if(null==i&&(i=10===a?".0e":","),"function"!=typeof i&&(i=cX(i)),e===1/0)return i;null==e&&(e=10);var o=Math.max(1,a*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*a<a-.5&&(r*=a),r<=o?i(e):""}},r.nice=function(){return i(mX(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function TX(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function AX(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function MX(e){return e<0?-e*e:e*e}function wX(e){var t=e(XW,XW),n=1;function r(){return 1===n?e(XW,XW):.5===n?e(AX,MX):e(TX(n),TX(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},gX(t)}lX=dX({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),cX=lX.format,hX=lX.formatPrefix;var kX=new Date,OX=new Date;function PX(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,a){var o,s=[];if(n=i.ceil(n),a=null==a?1:Math.floor(a),!(n<r&&a>0))return s;do{s.push(o=new Date(+n)),t(n,a),e(n)}while(o<n&&n<r);return s},i.filter=function(n){return PX((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return kX.setTime(+t),OX.setTime(+r),e(kX),e(OX),Math.floor(n(kX,OX))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var RX=PX((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));RX.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?PX((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):RX:null};var LX=PX((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+1e3*t)}),(function(e,t){return(t-e)/1e3}),(function(e){return e.getUTCSeconds()})),IX=PX((function(e){e.setTime(e-e.getMilliseconds()-1e3*e.getSeconds())}),(function(e,t){e.setTime(+e+6e4*t)}),(function(e,t){return(t-e)/6e4}),(function(e){return e.getMinutes()})),NX=PX((function(e){e.setTime(e-e.getMilliseconds()-1e3*e.getSeconds()-6e4*e.getMinutes())}),(function(e,t){e.setTime(+e+36e5*t)}),(function(e,t){return(t-e)/36e5}),(function(e){return e.getHours()})),DX=PX((function(e){e.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5}),(function(e){return e.getDate()-1}));function FX(e){return PX((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5}))}var BX=FX(0),UX=FX(1),zX=(FX(2),FX(3),FX(4)),jX=(FX(5),FX(6),PX((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}))),VX=PX((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));VX.every=function(e){return isFinite(e=Math.floor(e))&&e>0?PX((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var GX=PX((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/864e5}),(function(e){return e.getUTCDate()-1}));function HX(e){return PX((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/6048e5}))}var WX=HX(0),XX=HX(1),YX=(HX(2),HX(3),HX(4)),ZX=(HX(5),HX(6),PX((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()})));function qX(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function KX(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function QX(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}ZX.every=function(e){return isFinite(e=Math.floor(e))&&e>0?PX((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};var JX,$X,eY={"-":"",_:" ",0:"0"},tY=/^\s*\d+/,nY=/^%/,rY=/[\\^$*+?|[\]().{}]/g;function iY(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function aY(e){return e.replace(rY,"\\$&")}function oY(e){return new RegExp("^(?:"+e.map(aY).join("|")+")","i")}function sY(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function uY(e,t,n){var r=tY.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function lY(e,t,n){var r=tY.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function cY(e,t,n){var r=tY.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function hY(e,t,n){var r=tY.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function fY(e,t,n){var r=tY.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function pY(e,t,n){var r=tY.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function dY(e,t,n){var r=tY.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function vY(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function gY(e,t,n){var r=tY.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function mY(e,t,n){var r=tY.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function yY(e,t,n){var r=tY.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function _Y(e,t,n){var r=tY.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function bY(e,t,n){var r=tY.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function xY(e,t,n){var r=tY.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function EY(e,t,n){var r=tY.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function SY(e,t,n){var r=tY.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function CY(e,t,n){var r=tY.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function TY(e,t,n){var r=nY.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function AY(e,t,n){var r=tY.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function MY(e,t,n){var r=tY.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function wY(e,t){return iY(e.getDate(),t,2)}function kY(e,t){return iY(e.getHours(),t,2)}function OY(e,t){return iY(e.getHours()%12||12,t,2)}function PY(e,t){return iY(1+DX.count(VX(e),e),t,3)}function RY(e,t){return iY(e.getMilliseconds(),t,3)}function LY(e,t){return RY(e,t)+"000"}function IY(e,t){return iY(e.getMonth()+1,t,2)}function NY(e,t){return iY(e.getMinutes(),t,2)}function DY(e,t){return iY(e.getSeconds(),t,2)}function FY(e){var t=e.getDay();return 0===t?7:t}function BY(e,t){return iY(BX.count(VX(e)-1,e),t,2)}function UY(e){var t=e.getDay();return t>=4||0===t?zX(e):zX.ceil(e)}function zY(e,t){return e=UY(e),iY(zX.count(VX(e),e)+(4===VX(e).getDay()),t,2)}function jY(e){return e.getDay()}function VY(e,t){return iY(UX.count(VX(e)-1,e),t,2)}function GY(e,t){return iY(e.getFullYear()%100,t,2)}function HY(e,t){return iY((e=UY(e)).getFullYear()%100,t,2)}function WY(e,t){return iY(e.getFullYear()%1e4,t,4)}function XY(e,t){var n=e.getDay();return iY((e=n>=4||0===n?zX(e):zX.ceil(e)).getFullYear()%1e4,t,4)}function YY(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+iY(t/60|0,"0",2)+iY(t%60,"0",2)}function ZY(e,t){return iY(e.getUTCDate(),t,2)}function qY(e,t){return iY(e.getUTCHours(),t,2)}function KY(e,t){return iY(e.getUTCHours()%12||12,t,2)}function QY(e,t){return iY(1+GX.count(ZX(e),e),t,3)}function JY(e,t){return iY(e.getUTCMilliseconds(),t,3)}function $Y(e,t){return JY(e,t)+"000"}function eZ(e,t){return iY(e.getUTCMonth()+1,t,2)}function tZ(e,t){return iY(e.getUTCMinutes(),t,2)}function nZ(e,t){return iY(e.getUTCSeconds(),t,2)}function rZ(e){var t=e.getUTCDay();return 0===t?7:t}function iZ(e,t){return iY(WX.count(ZX(e)-1,e),t,2)}function aZ(e){var t=e.getUTCDay();return t>=4||0===t?YX(e):YX.ceil(e)}function oZ(e,t){return e=aZ(e),iY(YX.count(ZX(e),e)+(4===ZX(e).getUTCDay()),t,2)}function sZ(e){return e.getUTCDay()}function uZ(e,t){return iY(XX.count(ZX(e)-1,e),t,2)}function lZ(e,t){return iY(e.getUTCFullYear()%100,t,2)}function cZ(e,t){return iY((e=aZ(e)).getUTCFullYear()%100,t,2)}function hZ(e,t){return iY(e.getUTCFullYear()%1e4,t,4)}function fZ(e,t){var n=e.getUTCDay();return iY((e=n>=4||0===n?YX(e):YX.ceil(e)).getUTCFullYear()%1e4,t,4)}function pZ(){return"+0000"}function dZ(){return"%"}function vZ(e){return+e}function gZ(e){return Math.floor(+e/1e3)}!function(e){JX=function(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,u=e.shortMonths,l=oY(i),c=sY(i),h=oY(a),f=sY(a),p=oY(o),d=sY(o),v=oY(s),g=sY(s),m=oY(u),y=sY(u),_={a:function(e){return o[e.getDay()]},A:function(e){return a[e.getDay()]},b:function(e){return u[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:wY,e:wY,f:LY,g:HY,G:XY,H:kY,I:OY,j:PY,L:RY,m:IY,M:NY,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:vZ,s:gZ,S:DY,u:FY,U:BY,V:zY,w:jY,W:VY,x:null,X:null,y:GY,Y:WY,Z:YY,"%":dZ},b={a:function(e){return o[e.getUTCDay()]},A:function(e){return a[e.getUTCDay()]},b:function(e){return u[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:ZY,e:ZY,f:$Y,g:cZ,G:fZ,H:qY,I:KY,j:QY,L:JY,m:eZ,M:tZ,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:vZ,s:gZ,S:nZ,u:rZ,U:iZ,V:oZ,w:sZ,W:uZ,x:null,X:null,y:lZ,Y:hZ,Z:pZ,"%":dZ},x={a:function(e,t,n){var r=p.exec(t.slice(n));return r?(e.w=d[r[0].toLowerCase()],n+r[0].length):-1},A:function(e,t,n){var r=h.exec(t.slice(n));return r?(e.w=f[r[0].toLowerCase()],n+r[0].length):-1},b:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=g[r[0].toLowerCase()],n+r[0].length):-1},c:function(e,n,r){return C(e,t,n,r)},d:yY,e:yY,f:CY,g:dY,G:pY,H:bY,I:bY,j:_Y,L:SY,m:mY,M:xY,p:function(e,t,n){var r=l.exec(t.slice(n));return r?(e.p=c[r[0].toLowerCase()],n+r[0].length):-1},q:gY,Q:AY,s:MY,S:EY,u:lY,U:cY,V:hY,w:uY,W:fY,x:function(e,t,r){return C(e,n,t,r)},X:function(e,t,n){return C(e,r,t,n)},y:dY,Y:pY,Z:vY,"%":TY};function E(e,t){return function(n){var r,i,a,o=[],s=-1,u=0,l=e.length;for(n instanceof Date||(n=new Date(+n));++s<l;)37===e.charCodeAt(s)&&(o.push(e.slice(u,s)),null!=(i=eY[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(a=t[r])&&(r=a(n,i)),o.push(r),u=s+1);return o.push(e.slice(u,s)),o.join("")}}function S(e,t){return function(n){var r,i,a=QX(1900,void 0,1);if(C(a,e,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(t&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(i=(r=KX(QX(a.y,0,1))).getUTCDay(),r=i>4||0===i?XX.ceil(r):XX(r),r=GX.offset(r,7*(a.V-1)),a.y=r.getUTCFullYear(),a.m=r.getUTCMonth(),a.d=r.getUTCDate()+(a.w+6)%7):(i=(r=qX(QX(a.y,0,1))).getDay(),r=i>4||0===i?UX.ceil(r):UX(r),r=DX.offset(r,7*(a.V-1)),a.y=r.getFullYear(),a.m=r.getMonth(),a.d=r.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),i="Z"in a?KX(QX(a.y,0,1)).getUTCDay():qX(QX(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(i+5)%7:a.w+7*a.U-(i+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,KX(a)):qX(a)}}function C(e,t,n,r){for(var i,a,o=0,s=t.length,u=n.length;o<s;){if(r>=u)return-1;if(37===(i=t.charCodeAt(o++))){if(i=t.charAt(o++),!(a=x[i in eY?t.charAt(o++):i])||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return _.x=E(n,_),_.X=E(r,_),_.c=E(t,_),b.x=E(n,b),b.X=E(r,b),b.c=E(t,b),{format:function(e){var t=E(e+="",_);return t.toString=function(){return e},t},parse:function(e){var t=S(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=E(e+="",b);return t.toString=function(){return e},t},utcParse:function(e){var t=S(e+="",!0);return t.toString=function(){return e},t}}}(e),$X=JX.format,JX.parse,JX.utcFormat,JX.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var mZ,yZ,_Z,bZ,xZ,EZ;function SZ(e){return new Date(e)}function CZ(e){return e instanceof Date?+e:+new Date(+e)}function TZ(e,t,n,r,i,a,o,s,u){var l=$W(XW,XW),c=l.invert,h=l.domain,f=u(".%L"),p=u(":%S"),d=u("%I:%M"),v=u("%I %p"),g=u("%a %d"),m=u("%b %d"),y=u("%B"),_=u("%Y"),b=[[o,1,1e3],[o,5,5e3],[o,15,15e3],[o,30,3e4],[a,1,6e4],[a,5,3e5],[a,15,9e5],[a,30,18e5],[i,1,36e5],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,864e5],[r,2,1728e5],[n,1,6048e5],[t,1,2592e6],[t,3,7776e6],[e,1,31536e6]];function x(s){return(o(s)<s?f:a(s)<s?p:i(s)<s?d:r(s)<s?v:t(s)<s?n(s)<s?g:m:e(s)<s?y:_)(s)}function E(t,n,r,i){if(null==t&&(t=10),"number"==typeof t){var a=Math.abs(r-n)/t,o=cW((function(e){return e[2]})).right(b,a);o===b.length?(i=yW(n/31536e6,r/31536e6,t),t=e):o?(i=(o=b[a/b[o-1][2]<b[o][2]/a?o-1:o])[1],t=o[0]):(i=Math.max(yW(n,r,t),1),t=s)}return null==i?t:t.every(i)}return l.invert=function(e){return new Date(c(e))},l.domain=function(e){return arguments.length?h(AW.call(e,CZ)):h().map(SZ)},l.ticks=function(e,t){var n,r=h(),i=r[0],a=r[r.length-1],o=a<i;return o&&(n=i,i=a,a=n),n=(n=E(e,i,a,t))?n.range(i,a+1):[],o?n.reverse():n},l.tickFormat=function(e,t){return null==t?x:u(t)},l.nice=function(e,t){var n=h();return(e=E(e,n[0],n[n.length-1],t))?h(mX(n,e)):l},l.copy=function(){return QW(l,TZ(e,t,n,r,i,a,o,s,u))},l}var AZ,MZ,wZ,kZ,OZ,PZ,RZ,LZ,IZ,NZ,DZ=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,FZ=(E(mZ={},e.ScaleTypes.LINEAR,(function e(){var t=$W(XW,XW);return t.copy=function(){return QW(t,e())},bW.apply(t,arguments),gX(t)})),E(mZ,e.ScaleTypes.POWER,(function e(){var t=wX(JW());return t.copy=function(){return QW(t,e()).exponent(t.exponent())},bW.apply(t,arguments),t})),E(mZ,e.ScaleTypes.LOG,(function e(){var t=CX(JW()).domain([1,10]);return t.copy=function(){return QW(t,e()).base(t.base())},bW.apply(t,arguments),t})),E(mZ,e.ScaleTypes.IDENTITY,(function e(t){var n;function r(e){return isNaN(e=+e)?n:e}return r.invert=r,r.domain=r.range=function(e){return arguments.length?(t=AW.call(e,HW),r):t.slice()},r.unknown=function(e){return arguments.length?(n=e,r):n},r.copy=function(){return e(t).unknown(n)},t=arguments.length?AW.call(t,HW):[0,1],gX(r)})),E(mZ,e.ScaleTypes.TIME,(function(){return bW.apply(TZ(VX,jX,BX,DX,NX,IX,LX,RX,$X).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)})),E(mZ,e.ScaleTypes.QUANTILE,(function e(){var t,n=[],r=[],i=[];function a(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=_W(n,e/t);return o}function o(e){return isNaN(e=+e)?t:r[hW(i,e)]}return o.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},o.domain=function(e){if(!arguments.length)return n.slice();n=[];for(var t,r=0,i=e.length;r<i;++r)null==(t=e[r])||isNaN(t=+t)||n.push(t);return n.sort(lW),a()},o.range=function(e){return arguments.length?(r=MW.call(e),a()):r.slice()},o.unknown=function(e){return arguments.length?(t=e,o):t},o.quantiles=function(){return i.slice()},o.copy=function(){return e().domain(n).range(r).unknown(t)},bW.apply(o,arguments)})),E(mZ,e.ScaleTypes.QUANTIZE,(function e(){var t,n=0,r=1,i=1,a=[.5],o=[0,1];function s(e){return e<=e?o[hW(a,e,0,i)]:t}function u(){var e=-1;for(a=new Array(i);++e<i;)a[e]=((e+1)*r-(e-i)*n)/(i+1);return s}return s.domain=function(e){return arguments.length?(n=+e[0],r=+e[1],u()):[n,r]},s.range=function(e){return arguments.length?(i=(o=MW.call(e)).length-1,u()):o.slice()},s.invertExtent=function(e){var t=o.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,a[0]]:t>=i?[a[i-1],r]:[a[t-1],a[t]]},s.unknown=function(e){return arguments.length?(t=e,s):s},s.thresholds=function(){return a.slice()},s.copy=function(){return e().domain([n,r]).range(o).unknown(t)},bW.apply(gX(s),arguments)})),E(mZ,e.ScaleTypes.THRESHOLD,(function e(){var t,n=[.5],r=[0,1],i=1;function a(e){return e<=e?r[hW(n,e,0,i)]:t}return a.domain=function(e){return arguments.length?(n=MW.call(e),i=Math.min(n.length,r.length-1),a):n.slice()},a.range=function(e){return arguments.length?(r=MW.call(e),i=Math.min(n.length,r.length-1),a):r.slice()},a.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},a.unknown=function(e){return arguments.length?(t=e,a):t},a.copy=function(){return e().domain(n).range(r).unknown(t)},bW.apply(a,arguments)})),E(mZ,e.ScaleTypes.CAT,kW),mZ),BZ=(yZ=Qx(),_Z=Kx(YE.IGlobalConfigService),yZ((EZ=j((xZ=function(){function t(){_(this,t),z(this,"configService",EZ,this),E(this,"scaleCache",{}),E(this,"scaleOptions",{})}return x(t,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tap("FeatureScalePlugin",(function(){n.scaleOptions=e.getScaleOptions();var t=r.getLayerStyleAttributes(),i=e.getSource().data.dataArray;0!==i.length&&n.caculateScalesForAttributes(t||[],i)})),e.hooks.beforeRenderData.tap("FeatureScalePlugin",(function(){n.scaleOptions=e.getScaleOptions();var t=r.getLayerStyleAttributes(),i=e.getSource().data.dataArray;return n.caculateScalesForAttributes(t||[],i),e.layerModelNeedUpdate=!0,!0})),e.hooks.beforeRender.tap("FeatureScalePlugin",(function(){if(!e.layerModelNeedUpdate){n.scaleOptions=e.getScaleOptions();var t=r.getLayerStyleAttributes();if(t){var i=e.getSource().data.dataArray;if(0===i.length)return;var a=t.filter((function(e){return e.needRescale}));a.length&&n.caculateScalesForAttributes(a,i)}}}))}},{key:"isNumber",value:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},{key:"caculateScalesForAttributes",value:function(t,n){var r=this;this.scaleCache={},t.forEach((function(t){if(t.scale){var i=t.scale,a=t.name;i.names=r.parseFields(t.scale.field||[]);var o=[];i.names.forEach((function(e){o.push(r.getOrCreateScale(e,t,n))})),o.some((function(t){return t.type===e.StyleScaleType.VARIABLE}))?(i.type=e.StyleScaleType.VARIABLE,o.forEach((function(e){var t;if(!i.callback)if(i.values&&"text"!==i.values){var n;if("linear"===(null===(n=e.option)||void 0===n?void 0:n.type)&&i.values.length>2){var r=e.scale.ticks(i.values.length);"color"===a&&e.scale.domain(r)}e.scale.range(i.values)}else"cat"===(null===(t=e.option)||void 0===t?void 0:t.type)&&e.scale.range(e.option.domain)}))):(i.type=e.StyleScaleType.CONSTANT,i.defaultValues=o.map((function(e,t){return e.scale(i.names[t])}))),i.scalers=o.map((function(e){return{field:e.field,func:e.scale,option:e.option}})),t.needRescale=!1}}))}},{key:"getOrCreateScale",value:function(e,t,n){[e,t.name].join("_");var r,i=null===(r=t.scale)||void 0===r?void 0:r.values;return this.createScale(e,t.name,i,n)}},{key:"parseFields",value:function(e){return Array.isArray(e)?e:g_(e)?e.split("*"):[e]}},{key:"createScale",value:function(t,n,r,i){var a,o,s=this.scaleOptions[n]&&(null===(a=this.scaleOptions[n])||void 0===a?void 0:a.field)===t?this.scaleOptions[n]:this.scaleOptions[t],u={field:t,scale:void 0,type:e.StyleScaleType.VARIABLE,option:s};if(!i||!i.length)return s&&s.type?u.scale=this.createDefaultScale(s):(u.scale=kW([t]),u.type=e.StyleScaleType.CONSTANT),u;var l=null===(o=i.find((function(e){return!uw(e[t])})))||void 0===o?void 0:o[t];if(this.isNumber(t)||uw(l)&&!s)u.scale=kW([t]),u.type=e.StyleScaleType.CONSTANT;else{var c=s&&s.type||this.getDefaultType(l);"text"===r&&(c=e.ScaleTypes.CAT);var h=this.createDefaultScaleConfig(c,t,i);Object.assign(h,s),u.scale=this.createDefaultScale(h),u.option=h}return u}},{key:"getDefaultType",value:function(t){var n=e.ScaleTypes.LINEAR;return"string"==typeof t&&(n=DZ.test(t)?e.ScaleTypes.TIME:e.ScaleTypes.CAT),n}},{key:"createDefaultScaleConfig",value:function(t,n,r){var i={type:t},a=(null==r?void 0:r.map((function(e){return e[n]})))||[];return t!==e.ScaleTypes.CAT&&t!==e.ScaleTypes.QUANTILE?i.domain=function(e,t){var n,r,i,a=e.length,o=-1;if(null==t){for(;++o<a;)if(null!=(n=e[o])&&n>=n)for(r=i=n;++o<a;)null!=(n=e[o])&&(r>n&&(r=n),i<n&&(i=n))}else for(;++o<a;)if(null!=(n=t(e[o],o,e))&&n>=n)for(r=i=n;++o<a;)null!=(n=t(e[o],o,e))&&(r>n&&(r=n),i<n&&(i=n));return[r,i]}(a):t===e.ScaleTypes.CAT?i.domain=fk(a):t===e.ScaleTypes.QUANTILE&&(i.domain=a),i}},{key:"createDefaultScale",value:function(e){var t=e.type,n=e.domain,r=FZ[t]();return n&&r.domain(n),r}}]),t}()).prototype,"configService",[_Z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bZ=xZ))||bZ),UZ=(AZ=Qx(),MZ=Kx(YE.ICameraService),wZ=Kx(YE.IRendererService),AZ((PZ=j((OZ=function(){function e(){_(this,e),z(this,"cameraService",PZ,this),z(this,"rendererService",RZ,this)}return x(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LayerAnimateStylePlugin",(function(){e.models.forEach((function(t){t.addUniforms(v({},e.layerModel.getAnimateUniforms()))}))}))}}]),e}()).prototype,"cameraService",[MZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RZ=j(OZ.prototype,"rendererService",[wZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kZ=OZ))||kZ),zZ=Qx()(LZ=function(){function e(){_(this,e)}return x(e,[{key:"apply",value:function(e){e.hooks.init.tap("LayerModelPlugin",(function(){e.prepareBuildModel(),e.buildModels(),e.styleNeedUpdate=!1})),e.hooks.beforeRenderData.tap("DataSourcePlugin",(function(){return e.prepareBuildModel(),e.clearModels(),e.buildModels(),e.layerModelNeedUpdate=!1,!1}))}}]),e}())||LZ,jZ=Qx()(IZ=function(){function e(){_(this,e)}return x(e,[{key:"apply",value:function(e){e.hooks.afterInit.tap("LayerStylePlugin",(function(){e.updateLayerConfig({});var t=e.getLayerConfig(),n=t.autoFit,r=t.fitBoundsOptions;n&&setTimeout((function(){e.fitBounds(r)}),100)}))}}]),e}())||IZ,VZ=["type"],GZ={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},HZ={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},WZ={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},XZ={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};var YZ,ZZ,qZ,KZ,QZ,JZ,$Z,eq,tq,nq,rq,iq,aq,oq,sq,uq,lq,cq,hq,fq,pq=Qx()(NZ=function(){function e(){_(this,e)}return x(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LightingPlugin",(function(){e.getLayerConfig().enableLighting&&e.models.forEach((function(e){return e.addUniforms(v({},(n={u_DirectionalLights:new Array(3).fill(v({},WZ)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(v({},XZ)),u_NumOfSpotLights:0},t&&t.length||(t=[HZ]),t.forEach((function(e,t){var r=e.type,i=void 0===r?"directional":r,a=k(e,VZ),o=GZ[i].lights,s=GZ[i].num,u=n[s];n[o][u]=v(v({},n[o][u]),a),n[s]++})),n)));var t,n}))}))}}]),e}())||NZ,dq=(YZ=Qx(),ZZ=Kx(YE.IGlobalConfigService),YZ((QZ=j((KZ=function(){function e(){_(this,e),z(this,"configService",QZ,this),E(this,"enabled",void 0)}return x(e,[{key:"apply",value:function(e,t){var n=this,r=t.rendererService,i=t.postProcessingPassFactory,a=t.normalPassFactory;e.hooks.init.tap("MultiPassRendererPlugin",(function(){var t=e.getLayerConfig(),r=t.enableMultiPassRenderer,o=t.passes,s=void 0===o?[]:o;n.enabled=!!r&&!1!==e.getLayerConfig().enableMultiPassRenderer,n.enabled&&(e.multiPassRenderer=FU(e,s,i,a),e.multiPassRenderer.setRenderFlag(!0))})),e.hooks.beforeRender.tap("MultiPassRendererPlugin",(function(){if(n.enabled){var t=r.getViewportSize(),i=t.width,a=t.height;e.multiPassRenderer.resize(i,a)}}))}}]),e}()).prototype,"configService",[ZZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qZ=KZ))||qZ),vq=1,gq=2,mq=Qx()(JZ=function(){function t(){_(this,t)}return x(t,[{key:"apply",value:function(t,n){n.rendererService;var r=n.styleAttributeService;t.hooks.init.tap("PixelPickingPlugin",(function(){r.registerStyleAttribute({name:"pickingColor",type:e.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:e.gl.FLOAT},size:3,update:function(e,t){return mg(e.id)}}})})),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",(function(){t.getLayerConfig().enablePicking&&t.isVisible()&&t.models.forEach((function(e){return e.addUniforms({u_PickingStage:vq})}))})),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",(function(){t.getLayerConfig().enablePicking&&t.isVisible()&&t.models.forEach((function(e){return e.addUniforms({u_PickingStage:gq})}))})),t.hooks.beforeHighlight.tap("PixelPickingPlugin",(function(e){var n=t.getLayerConfig(),r=n.highlightColor,i=n.activeMix,a=void 0===i?0:i,o="string"==typeof r?vg(r):r||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:gg(new Uint8Array(e))}),t.models.forEach((function(t){return t.addUniforms({u_PickingStage:gq,u_PickingColor:e,u_HighlightColor:o.map((function(e){return 255*e})),u_activeMix:a})}))})),t.hooks.beforeSelect.tap("PixelPickingPlugin",(function(e){var n=t.getLayerConfig(),r=n.selectColor,i=n.selectMix,a=void 0===i?0:i,o="string"==typeof r?vg(r):r||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:gg(new Uint8Array(e))}),t.models.forEach((function(t){return t.addUniforms({u_PickingStage:gq,u_PickingColor:e,u_HighlightColor:o.map((function(e){return 255*e})),u_activeMix:a,u_CurrentSelectedId:e,u_SelectColor:o.map((function(e){return 255*e})),u_EnableSelect:1})}))}))}}]),t}())||JZ,yq=Qx()($Z=function(){function t(){_(this,t)}return x(t,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tap("RegisterStyleAttributePlugin",(function(){n.registerBuiltinAttributes(r)}))}},{key:"registerBuiltinAttributes",value:function(t){t.registerStyleAttribute({name:"position",type:e.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:e.gl.FLOAT},size:3,update:function(e,t,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}}}),t.registerStyleAttribute({name:"filter",type:e.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t){return e.filter?[1]:[0]}}}),t.registerStyleAttribute({name:"color",type:e.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:4,update:function(e,t){var n=e.color;return n&&n.length?n:[1,1,1,1]}}}),t.registerStyleAttribute({name:"vertexId",type:e.AttributeType.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:e.gl.DYNAMIC_DRAW,data:[],type:e.gl.FLOAT},size:1,update:function(e,t,n,r){return[t]}}})}}]),t}())||$Z,_q=(eq=Qx(),tq=Kx(YE.ICameraService),nq=Kx(YE.ICoordinateSystemService),rq=Kx(YE.IRendererService),iq=Kx(YE.IMapService),eq((sq=j((oq=function(){function e(){_(this,e),z(this,"cameraService",sq,this),z(this,"coordinateSystemService",uq,this),z(this,"rendererService",lq,this),z(this,"mapService",cq,this)}return x(e,[{key:"apply",value:function(e){var t=this,n=this.mapService.version,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i=[0,0];e.hooks.beforeRender.tap("ShaderUniformPlugin",(function(){t.coordinateSystemService.refresh(),"GAODE2.x"===n&&(r=t.mapService.map.customCoords.getMVPMatrix(),i=t.mapService.getCustomCoordCenter());var a=t.rendererService.getViewportSize(),o=a.width,s=a.height;e.models.forEach((function(n){var a;n.addUniforms((E(a={},KP.ProjectionMatrix,t.cameraService.getProjectionMatrix()),E(a,KP.ViewMatrix,t.cameraService.getViewMatrix()),E(a,KP.ViewProjectionMatrix,t.cameraService.getViewProjectionMatrix()),E(a,KP.Zoom,t.cameraService.getZoom()),E(a,KP.ZoomScale,t.cameraService.getZoomScale()),E(a,KP.FocalDistance,t.cameraService.getFocalDistance()),E(a,KP.CameraPosition,t.cameraService.getCameraPosition()),E(a,CM.CoordinateSystem,t.coordinateSystemService.getCoordinateSystem()),E(a,CM.ViewportCenter,t.coordinateSystemService.getViewportCenter()),E(a,CM.ViewportCenterProjection,t.coordinateSystemService.getViewportCenterProjection()),E(a,CM.PixelsPerDegree,t.coordinateSystemService.getPixelsPerDegree()),E(a,CM.PixelsPerDegree2,t.coordinateSystemService.getPixelsPerDegree2()),E(a,CM.PixelsPerMeter,t.coordinateSystemService.getPixelsPerMeter()),E(a,CM.Mvp,r),E(a,"u_SceneCenterMKT",i),E(a,"u_ViewportSize",[o,s]),E(a,"u_ModelMatrix",t.cameraService.getModelMatrix()),E(a,"u_DevicePixelRatio",Ed.devicePixelRatio),E(a,"u_PickingBuffer",e.getLayerConfig().pickingBuffer||0),E(a,"u_shaderPick",Number(e.getShaderPickStat())),a))}))}))}}]),e}()).prototype,"cameraService",[tq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uq=j(oq.prototype,"coordinateSystemService",[nq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lq=j(oq.prototype,"rendererService",[rq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cq=j(oq.prototype,"mapService",[iq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aq=oq))||aq),bq=Qx()(hq=function(){function e(){_(this,e)}return x(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("UpdateModelPlugin",(function(){e.layerModel&&e.layerModel.needUpdate()}))}}]),e}())||hq,xq=Qx()(fq=function(){function e(){_(this,e)}return x(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tap("UpdateStyleAttributePlugin",(function(){n.initStyleAttribute(e,{styleAttributeService:r})})),e.hooks.beforeRender.tap("UpdateStyleAttributePlugin",(function(){e.layerModelNeedUpdate||n.updateStyleAtrribute(e,{styleAttributeService:r})}))}},{key:"updateStyleAtrribute",value:function(e,t){var n=t.styleAttributeService,r=n.getLayerStyleAttributes()||[],i=n.getLayerStyleAttribute("filter");n.getLayerStyleAttribute("shape");if(i&&i.needRegenerateVertices)return e.layerModelNeedUpdate=!0,void r.forEach((function(e){return e.needRegenerateVertices=!1}));r.filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex),t.needRegenerateVertices=!1}))}},{key:"initStyleAttribute",value:function(e,t){var n=t.styleAttributeService;(n.getLayerStyleAttributes()||[]).filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex),t.needRegenerateVertices=!1}))}}]),e}())||fq;CP.bind(YE.ILayerPlugin).to(uW).inRequestScope(),CP.bind(YE.ILayerPlugin).to(yq).inRequestScope(),CP.bind(YE.ILayerPlugin).to(BZ).inRequestScope(),CP.bind(YE.ILayerPlugin).to(sW).inRequestScope(),CP.bind(YE.ILayerPlugin).to(jZ).inRequestScope(),CP.bind(YE.ILayerPlugin).to(xq).inRequestScope(),CP.bind(YE.ILayerPlugin).to(bq).inRequestScope(),CP.bind(YE.ILayerPlugin).to(dq).inRequestScope(),CP.bind(YE.ILayerPlugin).to(_q).inRequestScope(),CP.bind(YE.ILayerPlugin).to(UZ).inRequestScope(),CP.bind(YE.ILayerPlugin).to(pq).inRequestScope(),CP.bind(YE.ILayerPlugin).to(mq).inRequestScope(),CP.bind(YE.ILayerPlugin).to(zZ).inRequestScope();e.$XMLHttpRequest=Sd,e.$location=Cd,e.$window=Ed,e.BKDRHash=function(e){var t=0;e+="x";for(var n=Math.floor(65745979961613.07),r=0;r<e.length;r++)t>n&&(t=Math.floor(t/137)),t=131*t+e.charCodeAt(r);return t},e.BaseLayer=KU,e.BasePostProcessingPass=$O,e.CameraUniform=KP,e.CanvasLayer=gz,e.CityBuildingLayer=Dj,e.Control=$P,e.CoordinateUniform=CM,e.DOM=jd,e.Earth=mB,e.EarthLayer=DH,e.FrequencyController=Fv,e.GaodeMap=nD,e.GaodeMapV2=cD,e.GeometryLayer=zj,e.HeatmapLayer=Xj,e.ImageLayer=Zj,e.ImageTileLayer=FG,e.LRUCache=Nv,e.Layers=eR,e.LineLayer=QG,e.Logo=tR,e.Map=uU,e.MapServiceEvent=qP,e.Mapbox=MU,e.Marker=uR,e.MarkerLayer=lR,e.MaskLayer=BH,e.PointLayer=CH,e.PolygonLayer=kH,e.Popup=cR,e.RasterLayer=RH,e.Satistics=Fg,e.Scale=nR,e.Scene=xN,e.SceneEventList=QP,e.Source=Yb,e.TYPES=YE,e.WindLayer=oW,e.Zoom=rR,e.aProjectFlat=Mv,e.anchorTranslate=_g,e.applyAnchorClass=bg,e.bBoxToBounds=Pv,e.bindAll=Dv,e.boundsContains=Ov,e.calAngle=function(e,t){return 180*Math.acos(function(e,t){return e[0]*t[0]+e[1]*t[1]}(e,t)/(Lv(e)*Lv(t)))/Math.PI},e.calDistance=Rv,e.container=CP,e.createLayerContainer=kP,e.createSceneContainer=wP,e.decodePickingColor=gg,e.dispatchMapCameraParams=nd,e.dispatchMouseDown=vd,e.dispatchMouseMove=gd,e.dispatchMouseUp=md,e.dispatchPointerDown=hd,e.dispatchPointerMove=fd,e.dispatchPointerUp=pd,e.dispatchTouchEnd=td,e.dispatchTouchMove=ed,e.dispatchTouchStart=$p,e.djb2hash=function(e){for(var t=5381,n=(e=e.toString()).length;n;)t=33*t^e.charCodeAt(--n);return t>>>0},e.encodePickingColor=mg,e.extent=Ev,e.flow=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;if(e&&!(e.length<2)){for(var n=0,r=[],i=0;i<e.length-1;i++){var a=e[i],o=e[i+1],s=Rv(a,o);n+=s;var u=[a[0]-o[0],a[1]-o[1]],l=Iv(0,u);if(i>0){var c=r[i-1].rotation;c-l>360-c+l&&(l+=360)}r.push({start:a,end:o,dis:s,rotation:l,duration:0})}return r.map((function(e){e.duration=t*(e.dis/n)})),r}},e.generateColorRamp=yg,e.getAngle=Iv,e.getArrayBuffer=Hd,e.getImage=Wd,e.getJSON=function(e,t){var n=Gd(e);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var r;try{r=JSON.parse(n.response)}catch(e){return t(e)}t(null,r)}else 401===n.status?t(new Vd("".concat(n.statusText),n.status,e.url)):t(new Vd(n.statusText,n.status,e.url))},n.send(),n},e.getMask=xg,e.isColor=dg,e.isMini=bd,e.isMiniAli=yd,e.isWeChatMiniProgram=_d,e.latitude=Tv,e.lazyInject=AP,e.lazyMultiInject=function(e){var t=TP.lazyMultiInject(e);return function(e,n,r){t.call(this,e,n),r&&(r.initializer=function(){return e[n]})}},e.lngLatToMeters=Sv,e.lnglatDistance=wv,e.longitude=Cv,e.metersToLngLat=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=e[0],r=e[1],i=n/xv*180,a=r/xv*180;return a=180/Math.PI*(2*Math.atan(Math.exp(a*Math.PI/180))-Math.PI/2),null!=t&&(i=Number(i.toFixed(t)),a=Number(a.toFixed(t))),3===e.length?[i,a,e[2]]:[i,a]},e.miniWindow=xd,e.packCircleVertex=function(e){var t=e.color,n=e.radius,r=e.tileX,i=e.tileY,a=e.shape,o=e.opacity,s=e.stroke,u=e.strokeWidth,l=e.strokeOpacity,c=[],h=[],f=[],p=[YP(t[0],t[1]),YP(t[2],t[3])],d=[YP(s[0],s[1]),YP(s[2],s[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach((function(e){var t=N(e,2),s=t[0],v=t[1];c.push([].concat(p,[8388608*(s+1)+2097152*(v+1)+131072*VP(a)+n,524288*(r+512)+64*(i+512)])),h.push([].concat(d,[u,l])),f.push([o,0,0,0])})),{packedBuffer:c,packedBuffer2:h,packedBuffer3:f}},e.padBounds=kv,e.project=function(e){var t=Math.PI/180,n=85.0511287798,r=Math.max(Math.min(n,e[1]),-n),i=Math.sin(r*t);return[6378137*e[0]*t,6378137*Math.log((1+i)/(1-i))/2]},e.rgb2arr=vg,e.tranfrormCoord=function(e,t){return function e(t,n){if(Array.isArray(t[0]))return t.map((function(t){return e(t,n)}));return n(t)}(e,t)},e.unProjectFlat=function(e){var t=.5/Math.PI,n=-.5/Math.PI,r=.5,i=N(e,2),a=i[0],o=i[1];return a=(a/(256<<20)-.5)/t,o=(o/(256<<20)-r)/n,o=2*(Math.atan(Math.pow(Math.E,o))-Math.PI/4),[a/(r=Math.PI/180),o/r]},e.validateLngLat=Av,e.version="2.8.12",Object.defineProperty(e,"__esModule",{value:!0})}));
