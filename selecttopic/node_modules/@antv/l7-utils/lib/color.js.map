{"version":3,"sources":["../src/color.ts"],"names":["isColor","str","d3","color","rgb2arr","arr","r","g","b","opacity","decodePickingColor","i1","i2","i3","index","encodePickingColor","featureIdx","generateColorRamp","colorRamp","canvas","$window","document","createElement","ctx","getContext","width","height","gradient","createLinearGradient","data","min","positions","max","length","i","colors","value","addColorStop","fillStyle","fillRect","isMini","getImageData","imageData","createImageData","Uint8ClampedArray"],"mappings":"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","sourcesContent":["import * as d3 from 'd3-color';\nimport { $window, isMini } from './mini-adapter';\nexport interface IColorRamp {\n  positions: number[];\n  colors: string[];\n}\n\nexport function isColor(str: any) {\n  if (typeof str === 'string') {\n    return !!(d3.color(str) as d3.RGBColor);\n  } else {\n    return false;\n  }\n}\n\nexport function rgb2arr(str: string) {\n  const color = d3.color(str) as d3.RGBColor;\n  const arr = [0, 0, 0, 0];\n  if (color != null) {\n    arr[0] = color.r / 255;\n    arr[1] = color.g / 255;\n    arr[2] = color.b / 255;\n    arr[3] = color.opacity;\n  }\n  return arr;\n}\n\nexport function decodePickingColor(color: Uint8Array): number {\n  const i1 = color && color[0];\n  const i2 = color && color[1];\n  const i3 = color && color[2];\n  // 1 was added to seperate from no selection\n  const index = i1 + i2 * 256 + i3 * 65536 - 1;\n  return index;\n}\n\nexport function encodePickingColor(\n  featureIdx: number,\n): [number, number, number] {\n  return [\n    (featureIdx + 1) & 255,\n    ((featureIdx + 1) >> 8) & 255,\n    (((featureIdx + 1) >> 8) >> 8) & 255,\n  ];\n}\n\nexport interface IImagedata {\n  data: Uint8ClampedArray;\n  width: number;\n  height: number;\n}\n\nexport function generateColorRamp(\n  colorRamp: IColorRamp,\n): ImageData | IImagedata {\n  const canvas = $window.document.createElement('canvas');\n  const ctx = canvas.getContext('2d') as CanvasRenderingContext2D;\n  canvas.width = 256;\n  canvas.height = 1;\n  const gradient = ctx.createLinearGradient(0, 0, 256, 1);\n  let data = null;\n  const min = colorRamp.positions[0];\n  const max = colorRamp.positions[colorRamp.positions.length - 1];\n  for (let i = 0; i < colorRamp.colors.length; ++i) {\n    const value = (colorRamp.positions[i] - min) / (max - min);\n    gradient.addColorStop(value, colorRamp.colors[i]);\n  }\n  ctx.fillStyle = gradient;\n  ctx.fillRect(0, 0, 256, 1);\n\n  // data = new Uint8ClampedArray(ctx.getImageData(0, 0, 256, 1).data);\n  // return !isMini\n  //   ? new ImageData(data, 256, 1)\n  //   : { data, width: 256, height: 1 };\n\n  if (!isMini) {\n    data = ctx.getImageData(0, 0, 256, 1).data;\n    // 使用 createImageData 替代 new ImageData、兼容 IE11\n    const imageData = ctx.createImageData(256, 1);\n    for (let i = 0; i < imageData.data.length; i += 4) {\n      imageData.data[i + 0] = data[i + 0];\n      imageData.data[i + 1] = data[i + 1];\n      imageData.data[i + 2] = data[i + 2];\n      imageData.data[i + 3] = data[i + 3];\n    }\n    return imageData;\n  } else {\n    data = new Uint8ClampedArray(ctx.getImageData(0, 0, 256, 1).data);\n    return { data, width: 256, height: 1 };\n  }\n}\n"],"file":"color.js"}