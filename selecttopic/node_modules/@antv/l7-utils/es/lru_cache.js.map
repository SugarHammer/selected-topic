{"version":3,"sources":["../src/lru_cache.ts"],"names":["LRUCache","limit","destroy","defaultDestroy","order","clear","forEach","key","delete","cache","value","deleteOrder","appendOrder","Object","keys","length","deleteCache","index","findIndex","o","splice","push"],"mappings":";;;AAUA,WAAaA,QAAb;AAKE,sBAA4C;AAAA,QAAhCC,KAAgC,uEAAxB,EAAwB;AAAA,QAApBC,OAAoB;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAC1C,SAAKD,KAAL,GAAaA,KAAb;AACA,SAAKC,OAAL,GAAeA,OAAO,IAAI,KAAKC,cAA/B;AACA,SAAKC,KAAL,GAAa,EAAb;AACA,SAAKC,KAAL;AACD;;AAVH;AAAA;AAAA,WAYE,iBAAe;AAAA;;AACb,WAAKD,KAAL,CAAWE,OAAX,CAAmB,UAACC,GAAD,EAAS;AAC1B,QAAA,KAAI,CAACC,MAAL,CAAYD,GAAZ;AACD,OAFD;AAGA,WAAKE,KAAL,GAAa,EAAb;AAEA,WAAKL,KAAL,GAAa,EAAb;AACD;AAnBH;AAAA;AAAA,WAqBE,aAAWG,GAAX,EAAwB;AACtB,UAAMG,KAAK,GAAG,KAAKD,KAAL,CAAWF,GAAX,CAAd;;AACA,UAAIG,KAAJ,EAAW;AAET,aAAKC,WAAL,CAAiBJ,GAAjB;AACA,aAAKK,WAAL,CAAiBL,GAAjB;AACD;;AACD,aAAOG,KAAP;AACD;AA7BH;AAAA;AAAA,WA+BE,aAAWH,GAAX,EAAwBG,KAAxB,EAAoC;AAClC,UAAI,CAAC,KAAKD,KAAL,CAAWF,GAAX,CAAL,EAAsB;AAEpB,YAAIM,MAAM,CAACC,IAAP,CAAY,KAAKL,KAAjB,EAAwBM,MAAxB,KAAmC,KAAKd,KAA5C,EAAmD;AACjD,eAAKO,MAAL,CAAY,KAAKJ,KAAL,CAAW,CAAX,CAAZ;AACD;;AAED,aAAKK,KAAL,CAAWF,GAAX,IAAkBG,KAAlB;AACA,aAAKE,WAAL,CAAiBL,GAAjB;AACD,OARD,MAQO;AAEL,aAAKC,MAAL,CAAYD,GAAZ;AAEA,aAAKE,KAAL,CAAWF,GAAX,IAAkBG,KAAlB;AACA,aAAKE,WAAL,CAAiBL,GAAjB;AACD;AACF;AA/CH;AAAA;AAAA,WAiDE,iBAAcA,GAAd,EAA2B;AACzB,UAAMG,KAAK,GAAG,KAAKD,KAAL,CAAWF,GAAX,CAAd;;AACA,UAAIG,KAAJ,EAAW;AACT,aAAKM,WAAL,CAAiBT,GAAjB;AACA,aAAKI,WAAL,CAAiBJ,GAAjB;AACA,aAAKL,OAAL,CAAaQ,KAAb,EAAoBH,GAApB;AACD;AACF;AAxDH;AAAA;AAAA,WA0DE,qBAAoBA,GAApB,EAAiC;AAC/B,aAAO,KAAKE,KAAL,CAAWF,GAAX,CAAP;AACD;AA5DH;AAAA;AAAA,WA8DE,qBAAoBA,GAApB,EAAiC;AAC/B,UAAMU,KAAK,GAAG,KAAKb,KAAL,CAAWc,SAAX,CAAqB,UAACC,CAAD;AAAA,eAAOA,CAAC,KAAKZ,GAAb;AAAA,OAArB,CAAd;;AACA,UAAIU,KAAK,IAAI,CAAb,EAAgB;AACd,aAAKb,KAAL,CAAWgB,MAAX,CAAkBH,KAAlB,EAAyB,CAAzB;AACD;AACF;AAnEH;AAAA;AAAA,WAqEE,qBAAoBV,GAApB,EAAiC;AAC/B,WAAKH,KAAL,CAAWiB,IAAX,CAAgBd,GAAhB;AACD;AAvEH;AAAA;AAAA,WAwEE,wBAAuBG,KAAvB,EAAmCH,GAAnC,EAAgD;AAC9C,aAAO,IAAP;AACD;AA1EH;;AAAA;AAAA","sourcesContent":["/**\n * LRU Cache class with limit\n *\n * Update order for each get/set operation\n * Delete oldest when reach given limit\n */\ntype callback = (...args: any[]) => void;\ninterface ICache {\n  [key: string]: any;\n}\nexport class LRUCache {\n  private limit: number;\n  private cache: ICache;\n  private destroy: (value: any, key: string) => void;\n  private order: any[];\n  constructor(limit = 50, destroy?: callback) {\n    this.limit = limit;\n    this.destroy = destroy || this.defaultDestroy;\n    this.order = [];\n    this.clear();\n  }\n\n  public clear() {\n    this.order.forEach((key) => {\n      this.delete(key);\n    });\n    this.cache = {};\n    // access/update order, first item is oldest, last item is newest\n    this.order = [];\n  }\n\n  public get(key: string) {\n    const value = this.cache[key];\n    if (value) {\n      // update order\n      this.deleteOrder(key);\n      this.appendOrder(key);\n    }\n    return value;\n  }\n\n  public set(key: string, value: any) {\n    if (!this.cache[key]) {\n      // if reach limit, delete the oldest\n      if (Object.keys(this.cache).length === this.limit) {\n        this.delete(this.order[0]);\n      }\n\n      this.cache[key] = value;\n      this.appendOrder(key);\n    } else {\n      // if found in cache, delete the old one, insert new one to the first of list\n      this.delete(key);\n\n      this.cache[key] = value;\n      this.appendOrder(key);\n    }\n  }\n\n  public delete(key: string) {\n    const value = this.cache[key];\n    if (value) {\n      this.deleteCache(key);\n      this.deleteOrder(key);\n      this.destroy(value, key);\n    }\n  }\n\n  private deleteCache(key: string) {\n    delete this.cache[key];\n  }\n\n  private deleteOrder(key: string) {\n    const index = this.order.findIndex((o) => o === key);\n    if (index >= 0) {\n      this.order.splice(index, 1);\n    }\n  }\n\n  private appendOrder(key: string) {\n    this.order.push(key);\n  }\n  private defaultDestroy(value: any, key: string) {\n    return null;\n  }\n}\n"],"file":"lru_cache.js"}