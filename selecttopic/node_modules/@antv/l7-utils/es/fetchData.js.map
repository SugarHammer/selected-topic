{"version":3,"sources":["../src/fetchData.ts"],"names":["$window","$XMLHttpRequest","AJAXError","message","status","url","name","constructor","Error","makeRequest","requestParameters","xhr","open","k","headers","hasOwnProperty","setRequestHeader","withCredentials","credentials","getJSON","callback","onerror","statusText","onload","response","data","JSON","parse","err","send","getArrayBuffer","responseType","byteLength","cacheControl","getResponseHeader","expires","sameOrigin","a","document","createElement","href","protocol","location","host","transparentPngUrl","getImage","imgData","img","Image","crossOrigin","URL","webkitURL","revokeObjectURL","src","blob","Blob","Uint8Array","type","createObjectURL"],"mappings":"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","sourcesContent":["import { $window, $XMLHttpRequest } from './mini-adapter';\nclass AJAXError extends Error {\n  private status: number;\n  private url: string;\n\n  constructor(message: string, status: number, url: string) {\n    super(message);\n    this.status = status;\n    this.url = url;\n\n    // work around for https://github.com/Rich-Harris/buble/issues/40\n    this.name = this.constructor.name;\n    this.message = message;\n  }\n\n  public toString() {\n    return `${this.name}: ${this.message} (${this.status}): ${this.url}`;\n  }\n}\n\nfunction makeRequest(requestParameters: any) {\n  const xhr = new $XMLHttpRequest();\n\n  xhr.open('GET', requestParameters.url, true);\n  for (const k in requestParameters.headers) {\n    if (requestParameters.headers.hasOwnProperty(k)) {\n      xhr.setRequestHeader(k, requestParameters.headers[k]);\n    }\n  }\n  xhr.withCredentials = requestParameters.credentials === 'include';\n  return xhr;\n}\n\nexport const getJSON = (requestParameters: any, callback: any) => {\n  const xhr = makeRequest(requestParameters);\n  xhr.setRequestHeader('Accept', 'application/json');\n  xhr.onerror = () => {\n    callback(new Error(xhr.statusText));\n  };\n  xhr.onload = () => {\n    if (xhr.status >= 200 && xhr.status < 300 && xhr.response) {\n      let data;\n      try {\n        data = JSON.parse(xhr.response);\n      } catch (err) {\n        return callback(err);\n      }\n      callback(null, data);\n    } else {\n      if (xhr.status === 401) {\n        callback(\n          new AJAXError(`${xhr.statusText}`, xhr.status, requestParameters.url),\n        );\n      } else {\n        callback(\n          new AJAXError(xhr.statusText, xhr.status, requestParameters.url),\n        );\n      }\n    }\n  };\n  xhr.send();\n  return xhr;\n};\n\nexport const getArrayBuffer = (requestParameters: any, callback: any) => {\n  const xhr = makeRequest(requestParameters);\n  xhr.responseType = 'arraybuffer';\n  xhr.onerror = () => {\n    callback(new Error(xhr.statusText));\n  };\n  xhr.onload = () => {\n    const response = xhr.response;\n    if (response.byteLength === 0 && xhr.status === 200) {\n      return callback(new Error('http status 200 returned without content.'));\n    }\n    if (xhr.status >= 200 && xhr.status < 300 && xhr.response) {\n      callback(null, {\n        data: response,\n        cacheControl: xhr.getResponseHeader('Cache-Control'),\n        expires: xhr.getResponseHeader('Expires'),\n      });\n    } else {\n      callback(\n        new AJAXError(xhr.statusText, xhr.status, requestParameters.url),\n      );\n    }\n  };\n  xhr.send();\n  return xhr;\n};\n\nfunction sameOrigin(url: string) {\n  const a = $window.document.createElement('a');\n  a.href = url;\n  return (\n    a.protocol === $window.document.location.protocol &&\n    a.host === $window.document.location.host\n  );\n}\n\nconst transparentPngUrl =\n  'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=';\n\nexport const getImage = (requestParameters: any, callback: any) => {\n  // request the image with XHR to work around caching issues\n  // see https://github.com/mapbox/mapbox-gl-js/issues/1470\n  return getArrayBuffer(requestParameters, (err: string, imgData: any) => {\n    if (err) {\n      callback(err);\n    } else if (imgData) {\n      const img = new $window.Image();\n      img.crossOrigin = 'anonymous';\n      const URL = $window.URL || $window.webkitURL;\n      // @ts-ignore\n      img.onload = () => {\n        callback(null, img);\n        URL.revokeObjectURL(img.src);\n      };\n      const blob = new $window.Blob([new Uint8Array(imgData.data)], {\n        type: 'image/png',\n      });\n      img.src = imgData.data.byteLength\n        ? URL.createObjectURL(blob)\n        : transparentPngUrl;\n    }\n  });\n};\n"],"file":"fetchData.js"}