{"version":3,"sources":["../../src/parser/image.ts"],"names":["getImage","image","data","cfg","extent","images","Promise","resolve","loadData","res","resultData","originData","_id","dataArray","coordinates","done","url","imageDatas","err","img","push","imageCount","length","imageindex","forEach","item"],"mappings":"AACA,SAASA,QAAT,QAAyB,gBAAzB;AAIA,eAAe,SAASC,KAAT,CACbC,IADa,EAEbC,GAFa,EAGA;AAEb,oBAA0DA,GAA1D,CAAQC,MAAR;AAAA,MAAQA,MAAR,4BAAiB,CAAC,OAAD,EAAU,OAAV,EAAmB,OAAnB,EAA4B,OAA5B,CAAjB;AACA,MAAMC,MAAM,GAAG,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAa;AACtCC,IAAAA,QAAQ,CAACN,IAAD,EAAO,UAACO,GAAD,EAAc;AAC3BF,MAAAA,OAAO,CAACE,GAAD,CAAP;AACD,KAFO,CAAR;AAGD,GAJc,CAAf;AAKA,MAAMC,UAAuB,GAAG;AAC9BC,IAAAA,UAAU,EAAET,IADkB;AAE9BG,IAAAA,MAAM,EAANA,MAF8B;AAG9BO,IAAAA,GAAG,EAAE,CAHyB;AAI9BC,IAAAA,SAAS,EAAE,CACT;AACED,MAAAA,GAAG,EAAE,CADP;AAEEE,MAAAA,WAAW,EAAE,CACX,CAACV,MAAM,CAAC,CAAD,CAAP,EAAYA,MAAM,CAAC,CAAD,CAAlB,CADW,EAEX,CAACA,MAAM,CAAC,CAAD,CAAP,EAAYA,MAAM,CAAC,CAAD,CAAlB,CAFW;AAFf,KADS;AAJmB,GAAhC;AAcA,SAAOM,UAAP;AACD;;AACD,SAASF,QAAT,CAAkBN,IAAlB,EAA2Ca,IAA3C,EAAsD;AACpD,MAAMC,GAAG,GAAGd,IAAZ;AACA,MAAMe,UAA8B,GAAG,EAAvC;;AACA,MAAI,OAAOD,GAAP,KAAe,QAAnB,EAA6B;AAC3BhB,IAAAA,QAAQ,CAAC;AAAEgB,MAAAA,GAAG,EAAHA;AAAF,KAAD,EAAU,UAACE,GAAD,EAAcC,GAAd,EAAwC;AACxDF,MAAAA,UAAU,CAACG,IAAX,CAAgBD,GAAhB;AACAJ,MAAAA,IAAI,CAACE,UAAD,CAAJ;AACD,KAHO,CAAR;AAID,GALD,MAKO;AACL,QAAMI,UAAU,GAAGL,GAAG,CAACM,MAAvB;AACA,QAAIC,UAAU,GAAG,CAAjB;AACAP,IAAAA,GAAG,CAACQ,OAAJ,CAAY,UAACC,IAAD,EAAU;AACpBzB,MAAAA,QAAQ,CAAC;AAAEgB,QAAAA,GAAG,EAAES;AAAP,OAAD,EAAgB,UAACP,GAAD,EAAWC,GAAX,EAAqC;AAC3DI,QAAAA,UAAU;AACVN,QAAAA,UAAU,CAACG,IAAX,CAAgBD,GAAhB;;AACA,YAAII,UAAU,KAAKF,UAAnB,EAA+B;AAC7BN,UAAAA,IAAI,CAACE,UAAD,CAAJ;AACD;AACF,OANO,CAAR;AAOD,KARD;AASD;;AACD,SAAOhB,KAAP;AACD","sourcesContent":["import { IParserData } from '@antv/l7-core';\nimport { getImage } from '@antv/l7-utils';\ninterface IImageCfg {\n  extent: [number, number, number, number];\n}\nexport default function image(\n  data: string | string[],\n  cfg: IImageCfg,\n): IParserData {\n  // TODO: 为 extent 赋默认值\n  const { extent = [121.168, 30.2828, 121.384, 30.4219] } = cfg;\n  const images = new Promise((resolve) => {\n    loadData(data, (res: any) => {\n      resolve(res);\n    });\n  });\n  const resultData: IParserData = {\n    originData: data,\n    images,\n    _id: 1,\n    dataArray: [\n      {\n        _id: 0,\n        coordinates: [\n          [extent[0], extent[1]],\n          [extent[2], extent[3]],\n        ],\n      },\n    ],\n  };\n  return resultData;\n}\nfunction loadData(data: string | string[], done: any) {\n  const url = data;\n  const imageDatas: HTMLImageElement[] = [];\n  if (typeof url === 'string') {\n    getImage({ url }, (err: string, img: HTMLImageElement) => {\n      imageDatas.push(img);\n      done(imageDatas);\n    });\n  } else {\n    const imageCount = url.length;\n    let imageindex = 0;\n    url.forEach((item) => {\n      getImage({ url: item }, (err: any, img: HTMLImageElement) => {\n        imageindex++;\n        imageDatas.push(img);\n        if (imageindex === imageCount) {\n          done(imageDatas);\n        }\n      });\n    });\n  }\n  return image;\n}\n"],"file":"image.js"}