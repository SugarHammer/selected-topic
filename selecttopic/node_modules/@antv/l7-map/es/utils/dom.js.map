{"version":3,"sources":["../../src/utils/dom.ts"],"names":["$window","isMini","Point","DOM","create","tagName","className","container","el","document","createElement","undefined","appendChild","createNS","namespaceURI","createElementNS","docStyle","documentElement","style","testProp","props","i","selectProp","userSelect","disableDrag","enableDrag","transformProp","setTransform","value","passiveSupported","options","Object","defineProperty","get","addEventListener","removeEventListener","err","target","type","callback","capture","suppressClick","e","preventDefault","stopPropagation","setTimeout","mousePos","rect","getBoundingClientRect","clientX","left","clientLeft","clientY","top","clientTop","touchPos","touches","points","touche","push","mouseButton","button","InstallTrigger","ctrlKey","navigator","platform","toUpperCase","indexOf","remove","node","parentNode","removeChild"],"mappings":"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","sourcesContent":["import { $window, isMini } from '@antv/l7-utils';\n// @ts-ignore\nimport Point from '../geo/point';\n\nconst DOM: {\n  [key: string]: (...arg: any[]) => any;\n} = {};\nexport default DOM;\n\nDOM.create = (tagName: string, className?: string, container?: HTMLElement) => {\n  const el = $window.document.createElement(tagName) as HTMLElement;\n  if (className !== undefined) {\n    el.className = className;\n  }\n  if (container) {\n    container.appendChild(el);\n  }\n  return el;\n};\n\nDOM.createNS = (namespaceURI: string, tagName: string) => {\n  const el = $window.document.createElementNS(\n    namespaceURI,\n    tagName,\n  ) as HTMLElement;\n  return el;\n};\n\nconst docStyle = $window.document && $window.document.documentElement.style;\n\nfunction testProp(props: any) {\n  if (!docStyle) {\n    return props[0];\n  }\n  for (const i of props) {\n    if (i in docStyle) {\n      return i;\n    }\n  }\n  return props[0];\n}\n\nconst selectProp = testProp([\n  'userSelect',\n  'MozUserSelect',\n  'WebkitUserSelect',\n  'msUserSelect',\n]);\nlet userSelect: any;\n\nDOM.disableDrag = () => {\n  if (docStyle && selectProp) {\n    userSelect = docStyle[selectProp];\n    docStyle[selectProp] = 'none';\n  }\n};\n\nDOM.enableDrag = () => {\n  if (docStyle && selectProp) {\n    docStyle[selectProp] = userSelect;\n  }\n};\n\nconst transformProp = testProp(['transform', 'WebkitTransform']);\n\nDOM.setTransform = (el: HTMLElement, value: string) => {\n  // https://github.com/facebook/flow/issues/7754\n  // $FlowFixMe\n  el.style[transformProp] = value;\n};\n\n// Feature detection for {passive: false} support in add/removeEventListener.\nlet passiveSupported = false;\n\ntry {\n  // https://github.com/facebook/flow/issues/285\n  // $FlowFixMe\n  const options = Object.defineProperty({}, 'passive', {\n    get() {\n      // eslint-disable-line\n      passiveSupported = true;\n    },\n  });\n  // @ts-ignore\n  $window.addEventListener('test', options, options);\n  // @ts-ignore\n  $window.removeEventListener('test', options, options);\n} catch (err) {\n  passiveSupported = false;\n}\n\nDOM.addEventListener = (\n  target: any,\n  type: any,\n  callback: any,\n  options: { passive?: boolean; capture?: boolean } = {},\n) => {\n  if ('passive' in options && passiveSupported) {\n    target.addEventListener(type, callback, options);\n  } else {\n    target.addEventListener(type, callback, options.capture);\n  }\n};\n\nDOM.removeEventListener = (\n  target: any,\n  type: any,\n  callback: any,\n  options: { passive?: boolean; capture?: boolean } = {},\n) => {\n  if ('passive' in options && passiveSupported) {\n    target.removeEventListener(type, callback, options);\n  } else {\n    target.removeEventListener(type, callback, options.capture);\n  }\n};\n\n// Suppress the next click, but only if it's immediate.\nconst suppressClick = (e: MouseEvent) => {\n  e.preventDefault();\n  e.stopPropagation();\n  $window.removeEventListener('click', suppressClick, true);\n};\n\nDOM.suppressClick = () => {\n  if (isMini) {\n    return;\n  }\n  $window.addEventListener('click', suppressClick, true);\n  setTimeout(() => {\n    $window.removeEventListener('click', suppressClick, true);\n  }, 0);\n};\n\nDOM.mousePos = (el: HTMLElement, e: MouseEvent | Touch) => {\n  // 暂时从 el 上获取 top/left， 后面需要动态获取\n  if (!isMini) {\n    const rect = el.getBoundingClientRect();\n    return new Point(\n      e.clientX - rect.left - el.clientLeft,\n      e.clientY - rect.top - el.clientTop,\n    );\n  } else {\n    return new Point(\n      // @ts-ignore\n      e.clientX - el.left - 0,\n      // @ts-ignore\n      e.clientY - el.top - 0,\n    );\n  }\n};\n\nDOM.touchPos = (el: HTMLElement, touches: Touch[]) => {\n  // 暂时从 el 上获取 top/left， 后面需要动态获取\n  if (!isMini) {\n    const rect = el.getBoundingClientRect();\n    const points = [];\n    for (const touche of touches) {\n      points.push(\n        new Point(\n          touche.clientX - rect.left - el.clientLeft,\n          touche.clientY - rect.top - el.clientTop,\n        ),\n      );\n    }\n    return points;\n  } else {\n    const points = [];\n    for (const touche of touches) {\n      points.push(\n        new Point(\n          // @ts-ignore\n          touche.clientX - el.left,\n          // @ts-ignore\n          touche.clientY - el.top,\n        ),\n      );\n    }\n    return points;\n  }\n};\n\nDOM.mouseButton = (e: MouseEvent) => {\n  if (!isMini) {\n    return e.button;\n  }\n  if (\n    // @ts-ignore\n    typeof $window.InstallTrigger !== 'undefined' &&\n    e.button === 2 &&\n    e.ctrlKey &&\n    $window.navigator.platform.toUpperCase().indexOf('MAC') >= 0\n  ) {\n    // Fix for https://github.com/mapbox/mapbox-gl-js/issues/3131:\n    // Firefox (detected by InstallTrigger) on Mac determines e.button = 2 when\n    // using Control + left click\n    return 0;\n  }\n  return e.button;\n};\n\nDOM.remove = (node: HTMLElement) => {\n  if (node.parentNode) {\n    node.parentNode.removeChild(node);\n  }\n};\n"],"file":"dom.js"}