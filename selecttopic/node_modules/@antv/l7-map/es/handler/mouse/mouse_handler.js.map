{"version":3,"sources":["../../../src/handler/mouse/mouse_handler.ts"],"names":["DOM","buttonStillPressed","MouseHandler","options","reset","clickTolerance","active","moved","lastPoint","eventButton","e","point","mouseButton","correctButton","preventDefault","dist","move","suppressClick","enabled","button"],"mappings":";;;AAEA,OAAOA,GAAP,MAAgB,iBAAhB;AACA,SAASC,kBAAT,QAAmC,QAAnC;;IACqBC,Y;AAQnB,wBAAYC,OAAZ,EAAiD;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAC/C,SAAKC,KAAL;AACA,SAAKC,cAAL,GAAsBF,OAAO,CAACE,cAAR,IAA0B,CAAhD;AACD;;;;WAED,iBAAe;AACb,WAAKC,MAAL,GAAc,KAAd;AACA,WAAKC,KAAL,GAAa,KAAb;AACA,aAAO,KAAKC,SAAZ;AACA,aAAO,KAAKC,WAAZ;AACD;;;WAED,mBAAiBC,CAAjB,EAAgCC,KAAhC,EAA8C;AAC5C,UAAI,KAAKH,SAAT,EAAoB;AAClB;AACD;;AAED,UAAMC,WAAW,GAAGT,GAAG,CAACY,WAAJ,CAAgBF,CAAhB,CAApB;;AACA,UAAI,CAAC,KAAKG,aAAL,CAAmBH,CAAnB,EAAsBD,WAAtB,CAAL,EAAyC;AACvC;AACD;;AAED,WAAKD,SAAL,GAAiBG,KAAjB;AACA,WAAKF,WAAL,GAAmBA,WAAnB;AACD;;;WAED,yBAAuBC,CAAvB,EAAsCC,KAAtC,EAAoD;AAClD,UAAMH,SAAS,GAAG,KAAKA,SAAvB;;AACA,UAAI,CAACA,SAAL,EAAgB;AACd;AACD;;AACDE,MAAAA,CAAC,CAACI,cAAF;;AAEA,UAAIb,kBAAkB,CAACS,CAAD,EAAI,KAAKD,WAAT,CAAtB,EAA6C;AAO3C,aAAKL,KAAL;AACA;AACD;;AAED,UAAI,CAAC,KAAKG,KAAN,IAAeI,KAAK,CAACI,IAAN,CAAWP,SAAX,IAAwB,KAAKH,cAAhD,EAAgE;AAC9D;AACD;;AACD,WAAKE,KAAL,GAAa,IAAb;AACA,WAAKC,SAAL,GAAiBG,KAAjB;AAGA,aAAO,KAAKK,IAAL,CAAUR,SAAV,EAAqBG,KAArB,CAAP;AACD;;;WAED,uBAAqBD,CAArB,EAAoC;AAClC,UAAI,CAAC,KAAKF,SAAV,EAAqB;AACnB;AACD;;AACD,UAAMC,WAAW,GAAGT,GAAG,CAACY,WAAJ,CAAgBF,CAAhB,CAApB;;AACA,UAAID,WAAW,KAAK,KAAKA,WAAzB,EAAsC;AACpC;AACD;;AACD,UAAI,KAAKF,KAAT,EAAgB;AACdP,QAAAA,GAAG,CAACiB,aAAJ;AACD;;AACD,WAAKb,KAAL;AACD;;;WAED,kBAAgB;AACd,WAAKc,OAAL,GAAe,IAAf;AACD;;;WAED,mBAAiB;AACf,WAAKA,OAAL,GAAe,KAAf;AACA,WAAKd,KAAL;AACD;;;WAED,qBAAmB;AACjB,aAAO,KAAKc,OAAZ;AACD;;;WAED,oBAAkB;AAChB,aAAO,KAAKZ,MAAZ;AACD;;;WAED,uBAAwBI,CAAxB,EAAuCS,MAAvC,EAAuD;AAErD,aAAO,KAAP;AACD;;;WAED,cAAeX,SAAf,EAAiCG,KAAjC,EAA+C;AAE7C;AACD;;;;;;SArGkBT,Y","sourcesContent":["// @ts-ignore\nimport Point from '../../geo/point';\nimport DOM from '../../utils/dom';\nimport { buttonStillPressed } from './util';\nexport default class MouseHandler {\n  protected enabled: boolean;\n  protected active: boolean;\n  protected lastPoint: Point;\n  protected eventButton: 1 | 2;\n  protected moved: boolean;\n  protected clickTolerance: number;\n\n  constructor(options: { clickTolerance: number }) {\n    this.reset();\n    this.clickTolerance = options.clickTolerance || 1;\n  }\n\n  public reset() {\n    this.active = false;\n    this.moved = false;\n    delete this.lastPoint;\n    delete this.eventButton;\n  }\n\n  public mousedown(e: MouseEvent, point: Point) {\n    if (this.lastPoint) {\n      return;\n    }\n\n    const eventButton = DOM.mouseButton(e);\n    if (!this.correctButton(e, eventButton)) {\n      return;\n    }\n\n    this.lastPoint = point;\n    this.eventButton = eventButton;\n  }\n\n  public mousemoveWindow(e: MouseEvent, point: Point) {\n    const lastPoint = this.lastPoint;\n    if (!lastPoint) {\n      return;\n    }\n    e.preventDefault();\n\n    if (buttonStillPressed(e, this.eventButton)) {\n      // Some browsers don't fire a `mouseup` when the mouseup occurs outside\n      // the window or iframe:\n      // https://github.com/mapbox/mapbox-gl-js/issues/4622\n      //\n      // If the button is no longer pressed during this `mousemove` it may have\n      // been released outside of the window or iframe.\n      this.reset();\n      return;\n    }\n\n    if (!this.moved && point.dist(lastPoint) < this.clickTolerance) {\n      return;\n    }\n    this.moved = true;\n    this.lastPoint = point;\n\n    // implemented by child class\n    return this.move(lastPoint, point);\n  }\n\n  public mouseupWindow(e: MouseEvent) {\n    if (!this.lastPoint) {\n      return;\n    }\n    const eventButton = DOM.mouseButton(e);\n    if (eventButton !== this.eventButton) {\n      return;\n    }\n    if (this.moved) {\n      DOM.suppressClick();\n    }\n    this.reset();\n  }\n\n  public enable() {\n    this.enabled = true;\n  }\n\n  public disable() {\n    this.enabled = false;\n    this.reset();\n  }\n\n  public isEnabled() {\n    return this.enabled;\n  }\n\n  public isActive() {\n    return this.active;\n  }\n\n  protected correctButton(e: MouseEvent, button: number) {\n    // eslint-disable-line\n    return false; // implemented by child\n  }\n\n  protected move(lastPoint: Point, point: Point) {\n    // eslint-disable-line\n    return; // implemented by child\n  }\n}\n"],"file":"mouse_handler.js"}