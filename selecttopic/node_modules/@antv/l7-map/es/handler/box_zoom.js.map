{"version":3,"sources":["../../src/handler/box_zoom.ts"],"names":["DOM","Event","BoxZoomHandler","map","options","el","getCanvasContainer","container","getContainer","clickTolerance","enabled","active","isEnabled","e","point","shiftKey","button","disableDrag","startPos","lastPos","pos","equals","box","dist","p0","create","classList","add","fireEvent","minX","Math","min","x","maxX","max","minY","y","maxY","setTransform","style","width","height","p1","reset","suppressClick","emit","originalEvent","cameraAnimation","fitScreenCoordinates","getBearing","linear","keyCode","remove","enableDrag","type"],"mappings":"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","sourcesContent":["// @ts-ignore\nimport { EarthMap } from '../earthmap';\nimport Point from '../geo/point';\nimport { Map } from '../map';\nimport DOM from '../utils/dom';\nimport { Event } from './events/event';\n\n/**\n * The `BoxZoomHandler` allows the user to zoom the map to fit within a bounding box.\n * The bounding box is defined by clicking and holding `shift` while dragging the cursor.\n */\nclass BoxZoomHandler {\n  private map: Map | EarthMap;\n  private el: HTMLElement;\n  private container: HTMLElement;\n  private enabled: boolean;\n  private active: boolean;\n  private startPos: Point;\n  private lastPos: Point;\n  private box: HTMLElement | null;\n  private clickTolerance: number;\n\n  /**\n   * @private\n   */\n  constructor(\n    map: Map | EarthMap,\n    options: {\n      clickTolerance: number;\n    },\n  ) {\n    this.map = map;\n    this.el = map.getCanvasContainer();\n    this.container = map.getContainer();\n    this.clickTolerance = options.clickTolerance || 1;\n  }\n\n  /**\n   * Returns a Boolean indicating whether the \"box zoom\" interaction is enabled.\n   *\n   * @returns {boolean} `true` if the \"box zoom\" interaction is enabled.\n   */\n  public isEnabled() {\n    return !!this.enabled;\n  }\n\n  /**\n   * Returns a Boolean indicating whether the \"box zoom\" interaction is active, i.e. currently being used.\n   *\n   * @returns {boolean} `true` if the \"box zoom\" interaction is active.\n   */\n  public isActive() {\n    return !!this.active;\n  }\n\n  /**\n   * Enables the \"box zoom\" interaction.\n   *\n   * @example\n   *   map.boxZoom.enable();\n   */\n  public enable() {\n    if (this.isEnabled()) {\n      return;\n    }\n    this.enabled = true;\n  }\n\n  /**\n   * Disables the \"box zoom\" interaction.\n   *\n   * @example\n   *   map.boxZoom.disable();\n   */\n  public disable() {\n    if (!this.isEnabled()) {\n      return;\n    }\n    this.enabled = false;\n  }\n\n  public mousedown(e: MouseEvent, point: Point) {\n    if (!this.isEnabled()) {\n      return;\n    }\n    if (!(e.shiftKey && e.button === 0)) {\n      return;\n    }\n\n    DOM.disableDrag();\n    this.startPos = this.lastPos = point;\n    this.active = true;\n  }\n\n  public mousemoveWindow(e: MouseEvent, point: Point) {\n    if (!this.active) {\n      return;\n    }\n\n    const pos = point;\n\n    if (\n      this.lastPos.equals(pos) ||\n      (!this.box && pos.dist(this.startPos) < this.clickTolerance)\n    ) {\n      return;\n    }\n\n    const p0 = this.startPos;\n    this.lastPos = pos;\n\n    if (!this.box) {\n      this.box = DOM.create('div', 'l7-boxzoom', this.container);\n      this.container.classList.add('l7-crosshair');\n      this.fireEvent('boxzoomstart', e);\n    }\n    const minX = Math.min(p0.x, pos.x);\n    const maxX = Math.max(p0.x, pos.x);\n    const minY = Math.min(p0.y, pos.y);\n    const maxY = Math.max(p0.y, pos.y);\n\n    DOM.setTransform(this.box, `translate(${minX}px,${minY}px)`);\n    if (this.box) {\n      this.box.style.width = `${maxX - minX}px`;\n      this.box.style.height = `${maxY - minY}px`;\n    }\n  }\n\n  public mouseupWindow(e: MouseEvent, point: Point) {\n    if (!this.active) {\n      return;\n    }\n\n    if (e.button !== 0) {\n      return;\n    }\n\n    const p0 = this.startPos;\n    const p1 = point;\n\n    this.reset();\n\n    DOM.suppressClick();\n\n    if (p0.x === p1.x && p0.y === p1.y) {\n      this.fireEvent('boxzoomcancel', e);\n    } else {\n      this.map.emit(\n        'boxzoomend',\n        new Event('boxzoomend', { originalEvent: e }),\n      );\n      return {\n        cameraAnimation: (map: Map) =>\n          map.fitScreenCoordinates(p0, p1, this.map.getBearing(), {\n            linear: true,\n          }),\n      };\n    }\n  }\n\n  public keydown(e: KeyboardEvent) {\n    if (!this.active) {\n      return;\n    }\n\n    if (e.keyCode === 27) {\n      this.reset();\n      this.fireEvent('boxzoomcancel', e);\n    }\n  }\n\n  public reset() {\n    this.active = false;\n\n    this.container.classList.remove('l7-crosshair');\n\n    if (this.box) {\n      DOM.remove(this.box);\n      this.box = null;\n    }\n\n    DOM.enableDrag();\n    // @ts-ignore\n    delete this.startPos;\n    // @ts-ignore\n    delete this.lastPos;\n  }\n\n  public fireEvent(type: string, e: any) {\n    return this.map.emit(type, new Event(type, { originalEvent: e }));\n  }\n}\n\nexport default BoxZoomHandler;\n"],"file":"box_zoom.js"}