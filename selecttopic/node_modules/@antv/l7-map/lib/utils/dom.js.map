{"version":3,"sources":["../../src/utils/dom.ts"],"names":["DOM","create","tagName","className","container","el","$window","document","createElement","undefined","appendChild","createNS","namespaceURI","createElementNS","docStyle","documentElement","style","testProp","props","i","selectProp","userSelect","disableDrag","enableDrag","transformProp","setTransform","value","passiveSupported","options","Object","defineProperty","get","addEventListener","removeEventListener","err","target","type","callback","capture","suppressClick","e","preventDefault","stopPropagation","isMini","setTimeout","mousePos","rect","getBoundingClientRect","Point","clientX","left","clientLeft","clientY","top","clientTop","touchPos","touches","points","touche","push","mouseButton","button","InstallTrigger","ctrlKey","navigator","platform","toUpperCase","indexOf","remove","node","parentNode","removeChild"],"mappings":"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","sourcesContent":["import { $window, isMini } from '@antv/l7-utils';\n// @ts-ignore\nimport Point from '../geo/point';\n\nconst DOM: {\n  [key: string]: (...arg: any[]) => any;\n} = {};\nexport default DOM;\n\nDOM.create = (tagName: string, className?: string, container?: HTMLElement) => {\n  const el = $window.document.createElement(tagName) as HTMLElement;\n  if (className !== undefined) {\n    el.className = className;\n  }\n  if (container) {\n    container.appendChild(el);\n  }\n  return el;\n};\n\nDOM.createNS = (namespaceURI: string, tagName: string) => {\n  const el = $window.document.createElementNS(\n    namespaceURI,\n    tagName,\n  ) as HTMLElement;\n  return el;\n};\n\nconst docStyle = $window.document && $window.document.documentElement.style;\n\nfunction testProp(props: any) {\n  if (!docStyle) {\n    return props[0];\n  }\n  for (const i of props) {\n    if (i in docStyle) {\n      return i;\n    }\n  }\n  return props[0];\n}\n\nconst selectProp = testProp([\n  'userSelect',\n  'MozUserSelect',\n  'WebkitUserSelect',\n  'msUserSelect',\n]);\nlet userSelect: any;\n\nDOM.disableDrag = () => {\n  if (docStyle && selectProp) {\n    userSelect = docStyle[selectProp];\n    docStyle[selectProp] = 'none';\n  }\n};\n\nDOM.enableDrag = () => {\n  if (docStyle && selectProp) {\n    docStyle[selectProp] = userSelect;\n  }\n};\n\nconst transformProp = testProp(['transform', 'WebkitTransform']);\n\nDOM.setTransform = (el: HTMLElement, value: string) => {\n  // https://github.com/facebook/flow/issues/7754\n  // $FlowFixMe\n  el.style[transformProp] = value;\n};\n\n// Feature detection for {passive: false} support in add/removeEventListener.\nlet passiveSupported = false;\n\ntry {\n  // https://github.com/facebook/flow/issues/285\n  // $FlowFixMe\n  const options = Object.defineProperty({}, 'passive', {\n    get() {\n      // eslint-disable-line\n      passiveSupported = true;\n    },\n  });\n  // @ts-ignore\n  $window.addEventListener('test', options, options);\n  // @ts-ignore\n  $window.removeEventListener('test', options, options);\n} catch (err) {\n  passiveSupported = false;\n}\n\nDOM.addEventListener = (\n  target: any,\n  type: any,\n  callback: any,\n  options: { passive?: boolean; capture?: boolean } = {},\n) => {\n  if ('passive' in options && passiveSupported) {\n    target.addEventListener(type, callback, options);\n  } else {\n    target.addEventListener(type, callback, options.capture);\n  }\n};\n\nDOM.removeEventListener = (\n  target: any,\n  type: any,\n  callback: any,\n  options: { passive?: boolean; capture?: boolean } = {},\n) => {\n  if ('passive' in options && passiveSupported) {\n    target.removeEventListener(type, callback, options);\n  } else {\n    target.removeEventListener(type, callback, options.capture);\n  }\n};\n\n// Suppress the next click, but only if it's immediate.\nconst suppressClick = (e: MouseEvent) => {\n  e.preventDefault();\n  e.stopPropagation();\n  $window.removeEventListener('click', suppressClick, true);\n};\n\nDOM.suppressClick = () => {\n  if (isMini) {\n    return;\n  }\n  $window.addEventListener('click', suppressClick, true);\n  setTimeout(() => {\n    $window.removeEventListener('click', suppressClick, true);\n  }, 0);\n};\n\nDOM.mousePos = (el: HTMLElement, e: MouseEvent | Touch) => {\n  // 暂时从 el 上获取 top/left， 后面需要动态获取\n  if (!isMini) {\n    const rect = el.getBoundingClientRect();\n    return new Point(\n      e.clientX - rect.left - el.clientLeft,\n      e.clientY - rect.top - el.clientTop,\n    );\n  } else {\n    return new Point(\n      // @ts-ignore\n      e.clientX - el.left - 0,\n      // @ts-ignore\n      e.clientY - el.top - 0,\n    );\n  }\n};\n\nDOM.touchPos = (el: HTMLElement, touches: Touch[]) => {\n  // 暂时从 el 上获取 top/left， 后面需要动态获取\n  if (!isMini) {\n    const rect = el.getBoundingClientRect();\n    const points = [];\n    for (const touche of touches) {\n      points.push(\n        new Point(\n          touche.clientX - rect.left - el.clientLeft,\n          touche.clientY - rect.top - el.clientTop,\n        ),\n      );\n    }\n    return points;\n  } else {\n    const points = [];\n    for (const touche of touches) {\n      points.push(\n        new Point(\n          // @ts-ignore\n          touche.clientX - el.left,\n          // @ts-ignore\n          touche.clientY - el.top,\n        ),\n      );\n    }\n    return points;\n  }\n};\n\nDOM.mouseButton = (e: MouseEvent) => {\n  if (!isMini) {\n    return e.button;\n  }\n  if (\n    // @ts-ignore\n    typeof $window.InstallTrigger !== 'undefined' &&\n    e.button === 2 &&\n    e.ctrlKey &&\n    $window.navigator.platform.toUpperCase().indexOf('MAC') >= 0\n  ) {\n    // Fix for https://github.com/mapbox/mapbox-gl-js/issues/3131:\n    // Firefox (detected by InstallTrigger) on Mac determines e.button = 2 when\n    // using Control + left click\n    return 0;\n  }\n  return e.button;\n};\n\nDOM.remove = (node: HTMLElement) => {\n  if (node.parentNode) {\n    node.parentNode.removeChild(node);\n  }\n};\n"],"file":"dom.js"}