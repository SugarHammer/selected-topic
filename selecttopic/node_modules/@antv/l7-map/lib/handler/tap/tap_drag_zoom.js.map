{"version":3,"sources":["../../../src/handler/tap/tap_drag_zoom.ts"],"names":["TapDragZoomHandler","tap","TapRecognizer","numTouches","numTaps","reset","active","swipePoint","swipeTouch","tapTime","e","points","mapTouches","timeStamp","MAX_TAP_INTERVAL","touchstart","length","identifier","touchmove","newSwipePoint","dist","y","preventDefault","zoomDelta","point","touchend","enabled"],"mappings":";;;;;;;;;;;;;;;AAEA;;AACA;;IAEqBA,kB;AAQnB,gCAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACZ,SAAKC,GAAL,GAAW,IAAIC,uBAAJ,CAAkB;AAC3BC,MAAAA,UAAU,EAAE,CADe;AAE3BC,MAAAA,OAAO,EAAE;AAFkB,KAAlB,CAAX;AAKA,SAAKC,KAAL;AACD;;;;WAED,iBAAe;AACb,WAAKC,MAAL,GAAc,KAAd;AACA,aAAO,KAAKC,UAAZ;AACA,aAAO,KAAKC,UAAZ;AACA,aAAO,KAAKC,OAAZ;AACA,WAAKR,GAAL,CAASI,KAAT;AACD;;;WAED,oBAAkBK,CAAlB,EAAiCC,MAAjC,EAAkDC,UAAlD,EAAuE;AACrE,UAAI,KAAKL,UAAT,EAAqB;AACnB;AACD;;AAED,UAAI,KAAKE,OAAL,IAAgBC,CAAC,CAACG,SAAF,GAAc,KAAKJ,OAAnB,GAA6BK,uCAAjD,EAAmE;AACjE,aAAKT,KAAL;AACD;;AAED,UAAI,CAAC,KAAKI,OAAV,EAAmB;AACjB,aAAKR,GAAL,CAASc,UAAT,CAAoBL,CAApB,EAAuBC,MAAvB,EAA+BC,UAA/B;AACD,OAFD,MAEO,IAAIA,UAAU,CAACI,MAAX,GAAoB,CAAxB,EAA2B;AAChC,aAAKT,UAAL,GAAkBI,MAAM,CAAC,CAAD,CAAxB;AACA,aAAKH,UAAL,GAAkBI,UAAU,CAAC,CAAD,CAAV,CAAcK,UAAhC;AACD;AACF;;;WAED,mBAAiBP,CAAjB,EAAgCC,MAAhC,EAAiDC,UAAjD,EAAsE;AACpE,UAAI,CAAC,KAAKH,OAAV,EAAmB;AACjB,aAAKR,GAAL,CAASiB,SAAT,CAAmBR,CAAnB,EAAsBC,MAAtB,EAA8BC,UAA9B;AACD,OAFD,MAEO,IAAI,KAAKL,UAAT,EAAqB;AAC1B,YAAIK,UAAU,CAAC,CAAD,CAAV,CAAcK,UAAd,KAA6B,KAAKT,UAAtC,EAAkD;AAChD;AACD;;AAED,YAAMW,aAAa,GAAGR,MAAM,CAAC,CAAD,CAA5B;AACA,YAAMS,IAAI,GAAGD,aAAa,CAACE,CAAd,GAAkB,KAAKd,UAAL,CAAgBc,CAA/C;AACA,aAAKd,UAAL,GAAkBY,aAAlB;AAEAT,QAAAA,CAAC,CAACY,cAAF;AACA,aAAKhB,MAAL,GAAc,IAAd;AAEA,eAAO;AACLiB,UAAAA,SAAS,EAAEH,IAAI,GAAG;AADb,SAAP;AAGD;AACF;;;WAED,kBAAgBV,CAAhB,EAA+BC,MAA/B,EAAgDC,UAAhD,EAAqE;AACnE,UAAI,CAAC,KAAKH,OAAV,EAAmB;AACjB,YAAMe,KAAK,GAAG,KAAKvB,GAAL,CAASwB,QAAT,CAAkBf,CAAlB,EAAqBC,MAArB,EAA6BC,UAA7B,CAAd;;AACA,YAAIY,KAAJ,EAAW;AACT,eAAKf,OAAL,GAAeC,CAAC,CAACG,SAAjB;AACD;AACF,OALD,MAKO,IAAI,KAAKN,UAAT,EAAqB;AAC1B,YAAIK,UAAU,CAACI,MAAX,KAAsB,CAA1B,EAA6B;AAC3B,eAAKX,KAAL;AACD;AACF;AACF;;;WAED,uBAAqB;AACnB,WAAKA,KAAL;AACD;;;WAED,kBAAgB;AACd,WAAKqB,OAAL,GAAe,IAAf;AACD;;;WAED,mBAAiB;AACf,WAAKA,OAAL,GAAe,KAAf;AACA,WAAKrB,KAAL;AACD;;;WAED,qBAAmB;AACjB,aAAO,KAAKqB,OAAZ;AACD;;;WAED,oBAAkB;AAChB,aAAO,KAAKpB,MAAZ;AACD","sourcesContent":["// @ts-ignore\nimport Point from '../../geo/point';\nimport { MAX_TAP_INTERVAL } from './single_tap_recognizer';\nimport TapRecognizer from './tap_recognizer';\n\nexport default class TapDragZoomHandler {\n  public enabled: boolean;\n  public active: boolean;\n  public swipePoint: Point;\n  public swipeTouch: number;\n  public tapTime: number;\n  public tap: TapRecognizer;\n\n  constructor() {\n    this.tap = new TapRecognizer({\n      numTouches: 1,\n      numTaps: 1,\n    });\n\n    this.reset();\n  }\n\n  public reset() {\n    this.active = false;\n    delete this.swipePoint;\n    delete this.swipeTouch;\n    delete this.tapTime;\n    this.tap.reset();\n  }\n\n  public touchstart(e: TouchEvent, points: Point[], mapTouches: Touch[]) {\n    if (this.swipePoint) {\n      return;\n    }\n\n    if (this.tapTime && e.timeStamp - this.tapTime > MAX_TAP_INTERVAL) {\n      this.reset();\n    }\n\n    if (!this.tapTime) {\n      this.tap.touchstart(e, points, mapTouches);\n    } else if (mapTouches.length > 0) {\n      this.swipePoint = points[0];\n      this.swipeTouch = mapTouches[0].identifier;\n    }\n  }\n\n  public touchmove(e: TouchEvent, points: Point[], mapTouches: Touch[]) {\n    if (!this.tapTime) {\n      this.tap.touchmove(e, points, mapTouches);\n    } else if (this.swipePoint) {\n      if (mapTouches[0].identifier !== this.swipeTouch) {\n        return;\n      }\n\n      const newSwipePoint = points[0];\n      const dist = newSwipePoint.y - this.swipePoint.y;\n      this.swipePoint = newSwipePoint;\n\n      e.preventDefault();\n      this.active = true;\n\n      return {\n        zoomDelta: dist / 128,\n      };\n    }\n  }\n\n  public touchend(e: TouchEvent, points: Point[], mapTouches: Touch[]) {\n    if (!this.tapTime) {\n      const point = this.tap.touchend(e, points, mapTouches);\n      if (point) {\n        this.tapTime = e.timeStamp;\n      }\n    } else if (this.swipePoint) {\n      if (mapTouches.length === 0) {\n        this.reset();\n      }\n    }\n  }\n\n  public touchcancel() {\n    this.reset();\n  }\n\n  public enable() {\n    this.enabled = true;\n  }\n\n  public disable() {\n    this.enabled = false;\n    this.reset();\n  }\n\n  public isEnabled() {\n    return this.enabled;\n  }\n\n  public isActive() {\n    return this.active;\n  }\n}\n"],"file":"tap_drag_zoom.js"}