{"version":3,"sources":["../../../src/services/interaction/InteractionService.ts"],"names":["$window","isMini","EventEmitter","inject","injectable","Hammer","TYPES","InteractionEvent","DragEventMap","panstart","panmove","panend","pancancel","InteractionService","IMapService","target","interactionTarget","interactionEvent","type","indragging","emit","Drag","srcEvent","stopPropagation","Hover","touch","touches","onHover","x","pageX","y","pageY","event","clientX","clientY","$containter","mapService","getMapContainer","left","top","getBoundingClientRect","clientLeft","clientTop","lngLat","containerToLngLat","document","documentElement","isDoubleTap","addEventListenerOnMap","hammertime","destroy","removeEventListenerOnMap","off","id","Select","featureId","Active","e","addEventListener","handleMiniEvent","bind","Manager","add","Tap","taps","Pan","threshold","pointers","Press","on","onHammer","onDrag","removeEventListener","pointerType","Math","floor","nowTime","Date","getTime","lastClickTime","abs","lastClickXY","clickTimer","clearTimeout","setTimeout"],"mappings":";;;;;;;;;;;;;;;;;AAAA,SAASA,OAAT,EAAkBC,MAAlB,QAAgC,gBAAhC;AACA,OAAOC,YAAP,MAAyB,eAAzB;AACA,SAASC,MAAT,EAAiBC,UAAjB,QAAmC,WAAnC;AACA,OAAOC,MAAP,MAAmB,YAAnB;AACA,OAAO,kBAAP;AAEA,SAASC,KAAT,QAAsB,aAAtB;AAEA,SAA8BC,gBAA9B,QAAsD,uBAAtD;AACA,IAAMC,YAAuC,GAAG;AAC9CC,EAAAA,QAAQ,EAAE,WADoC;AAE9CC,EAAAA,OAAO,EAAE,UAFqC;AAG9CC,EAAAA,MAAM,EAAE,SAHsC;AAI9CC,EAAAA,SAAS,EAAE;AAJmC,CAAhD;IAWqBC,kB,WADpBT,UAAU,E,UAIRD,MAAM,CAACG,KAAK,CAACQ,WAAP,C;;;;;;;;;;;;;;;;iEADsB,K;;;;;;oEAOG,C;;kEAEA,CAAC,CAAC,CAAF,EAAK,CAAC,CAAN,C;;;;;;6DAuGf,UAACC,MAAD,EAAiB;AAChC,UAAMC,iBAAiB,GAAG,MAAKC,gBAAL,CAAsBF,MAAtB,CAA1B;;AACAC,MAAAA,iBAAiB,CAACE,IAAlB,GAAyBV,YAAY,CAACQ,iBAAiB,CAACE,IAAnB,CAArC;AACAF,MAAAA,iBAAiB,CAACE,IAAlB,KAA2B,UAA3B,GACK,MAAKC,UAAL,GAAkB,IADvB,GAEK,MAAKA,UAAL,GAAkB,KAFvB;;AAGA,YAAKC,IAAL,CAAUb,gBAAgB,CAACc,IAA3B,EAAiCL,iBAAjC;AACD,K;;+DAEkB,UAACD,MAAD,EAAiB;AAClCA,MAAAA,MAAM,CAACO,QAAP,CAAgBC,eAAhB;;AACA,UAAMP,iBAAiB,GAAG,MAAKC,gBAAL,CAAsBF,MAAtB,CAA1B;;AACA,YAAKK,IAAL,CAAUb,gBAAgB,CAACiB,KAA3B,EAAkCR,iBAAlC;AACD,K;;8DACiB,UAACD,MAAD,EAAwB;AACxC,UAAMU,KAAK,GAAGV,MAAM,CAACW,OAAP,CAAe,CAAf,CAAd;;AAEA,YAAKC,OAAL,CAAa;AACXC,QAAAA,CAAC,EAAEH,KAAK,CAACI,KADE;AAEXC,QAAAA,CAAC,EAAEL,KAAK,CAACM,KAFE;AAGXb,QAAAA,IAAI,EAAE;AAHK,OAAb;AAKD,K;;8DAuBiB,UAACc,KAAD,EAAuB;AACvC,UAAQC,OAAR,GAA6BD,KAA7B,CAAQC,OAAR;AAAA,UAAiBC,OAAjB,GAA6BF,KAA7B,CAAiBE,OAAjB;AACA,UAAIN,CAAC,GAAGK,OAAR;AACA,UAAIH,CAAC,GAAGI,OAAR;AACA,UAAMhB,IAAI,GAAGc,KAAK,CAACd,IAAnB;;AACA,UAAMiB,WAAW,GAAG,MAAKC,UAAL,CAAgBC,eAAhB,EAApB;;AACA,UAAIF,WAAJ,EAAiB;AACf,YAAIlC,MAAJ,EAAY;AAGV2B,UAAAA,CAAC,GAAGA,CAAC,GAAGO,WAAW,CAACG,IAAhB,GAAuB,CAA3B;AAEAR,UAAAA,CAAC,GAAGA,CAAC,GAAGK,WAAW,CAACI,GAAhB,GAAsB,CAA1B;AACD,SAND,MAMO;AACL,sCAAsBJ,WAAW,CAACK,qBAAZ,EAAtB;AAAA,cAAQD,GAAR,yBAAQA,GAAR;AAAA,cAAaD,IAAb,yBAAaA,IAAb;;AACAV,UAAAA,CAAC,GAAGA,CAAC,GAAGU,IAAJ,GAAWH,WAAW,CAACM,UAA3B;AACAX,UAAAA,CAAC,GAAGA,CAAC,GAAGS,GAAJ,GAAUJ,WAAW,CAACO,SAA1B;AACD;AACF;;AACD,UAAMC,MAAM,GAAG,MAAKP,UAAL,CAAgBQ,iBAAhB,CAAkC,CAAChB,CAAD,EAAIE,CAAJ,CAAlC,CAAf;;AAEA,UAAIZ,IAAI,KAAK,OAAb,EAAsB;AACpB,YAAI,CAACjB,MAAL,EAAa;AAEX,cAAI,kBAAkB4C,QAAQ,CAACC,eAA3B,KAA+C,IAAnD,EAAyD;AACvD;AACD;AACF;;AACD,cAAKC,WAAL,CAAiBnB,CAAjB,EAAoBE,CAApB,EAAuBa,MAAvB;;AACA;AACD;;AACD,UAAIzB,IAAI,KAAK,OAAb,EAAsB;AACpB,cAAK6B,WAAL,CAAiBnB,CAAjB,EAAoBE,CAApB,EAAuBa,MAAvB;;AACA;AACD;;AACD,UAAIzB,IAAI,KAAK,OAAT,IAAoBA,IAAI,KAAK,UAAjC,EAA6C;AAC3C,cAAKE,IAAL,CAAUb,gBAAgB,CAACiB,KAA3B,EAAkC;AAChCI,UAAAA,CAAC,EAADA,CADgC;AAEhCE,UAAAA,CAAC,EAADA,CAFgC;AAGhCa,UAAAA,MAAM,EAANA,MAHgC;AAIhCzB,UAAAA,IAAI,EAAJA,IAJgC;AAKhCH,UAAAA,MAAM,EAAEiB;AALwB,SAAlC;AAOD;AACF,K;;;;;;;WA1LD,gBAAc;AAEZ,WAAKgB,qBAAL;AACA,WAAKb,WAAL,GAAmB,KAAKC,UAAL,CAAgBC,eAAhB,EAAnB;AACD;;;WAED,mBAAiB;AACf,UAAI,KAAKY,UAAT,EAAqB;AACnB,aAAKA,UAAL,CAAgBC,OAAhB;AACD;;AACD,WAAKC,wBAAL;AACA,WAAKC,GAAL,CAAS7C,gBAAgB,CAACiB,KAA1B;AACD;;;WAED,4BAAwD;AAAA,UAAlCI,CAAkC,QAAlCA,CAAkC;AAAA,UAA/BE,CAA+B,QAA/BA,CAA+B;AACtD,WAAKV,IAAL,CAAUb,gBAAgB,CAACiB,KAA3B,EAAkC;AAAEI,QAAAA,CAAC,EAADA,CAAF;AAAKE,QAAAA,CAAC,EAADA;AAAL,OAAlC;AACD;;;WACD,uBAAqBuB,EAArB,EAAuC;AACrC,WAAKjC,IAAL,CAAUb,gBAAgB,CAAC+C,MAA3B,EAAmC;AAAEC,QAAAA,SAAS,EAAEF;AAAb,OAAnC;AACD;;;WAED,uBAAqBA,EAArB,EAAuC;AACrC,WAAKjC,IAAL,CAAUb,gBAAgB,CAACiD,MAA3B,EAAmC;AAAED,QAAAA,SAAS,EAAEF;AAAb,OAAnC;AACD;;;WAED,yBAAuBI,CAAvB,EAA+B;AAE7B,WAAK9B,OAAL,CAAa;AACXM,QAAAA,OAAO,EAAEwB,CAAC,CAAC/B,OAAF,CAAU,CAAV,EAAaG,KADX;AAEXK,QAAAA,OAAO,EAAEuB,CAAC,CAAC/B,OAAF,CAAU,CAAV,EAAaK,KAFX;AAGXb,QAAAA,IAAI,EAAE;AAHK,OAAb;AAKD;;;WAED,iCAAgC;AAC9B,UAAMiB,WAAW,GAAG,KAAKC,UAAL,CAAgBC,eAAhB,EAApB;;AACA,UAAIF,WAAJ,EAAiB;AACf,YAAIlC,MAAJ,EAAY;AACVD,UAAAA,OAAO,CAAC6C,QAAR,CAAiBa,gBAAjB,CACE,YADF,EAEE,KAAKC,eAAL,CAAqBC,IAArB,CAA0B,IAA1B,CAFF;AAID,SALD,MAKO;AACL,cAAMX,UAAU,GAAG,IAAI5C,MAAM,CAACwD,OAAX,CAAmB1B,WAAnB,CAAnB;AAGAc,UAAAA,UAAU,CAACa,GAAX,CACE,IAAIzD,MAAM,CAAC0D,GAAX,CAAe;AACb/B,YAAAA,KAAK,EAAE,UADM;AAEbgC,YAAAA,IAAI,EAAE;AAFO,WAAf,CADF;AAMAf,UAAAA,UAAU,CAACa,GAAX,CACE,IAAIzD,MAAM,CAAC0D,GAAX,CAAe;AACb/B,YAAAA,KAAK,EAAE;AADM,WAAf,CADF;AAKAiB,UAAAA,UAAU,CAACa,GAAX,CAAe,IAAIzD,MAAM,CAAC4D,GAAX,CAAe;AAAEC,YAAAA,SAAS,EAAE,CAAb;AAAgBC,YAAAA,QAAQ,EAAE;AAA1B,WAAf,CAAf;AACAlB,UAAAA,UAAU,CAACa,GAAX,CAAe,IAAIzD,MAAM,CAAC+D,KAAX,CAAiB,EAAjB,CAAf;AAGAnB,UAAAA,UAAU,CAACoB,EAAX,CAAc,gBAAd,EAAgC,KAAKC,QAArC;AACArB,UAAAA,UAAU,CAACoB,EAAX,CAAc,mCAAd,EAAmD,KAAKE,MAAxD;AAEApC,UAAAA,WAAW,CAACuB,gBAAZ,CAA6B,WAA7B,EAA0C,KAAK/B,OAA/C;AAEAQ,UAAAA,WAAW,CAACuB,gBAAZ,CAA6B,WAA7B,EAA0C,KAAK/B,OAA/C,EAAwD,IAAxD;AACAQ,UAAAA,WAAW,CAACuB,gBAAZ,CAA6B,SAA7B,EAAwC,KAAK/B,OAA7C;AACAQ,UAAAA,WAAW,CAACuB,gBAAZ,CAA6B,aAA7B,EAA4C,KAAK/B,OAAjD;AACA,eAAKsB,UAAL,GAAkBA,UAAlB;AACD;AAGF;AACF;;;WACD,oCAAmC;AACjC,UAAIhD,MAAJ,EAAY;AACVD,QAAAA,OAAO,CAAC6C,QAAR,CAAiB2B,mBAAjB,CACE,YADF,EAEE,KAAKb,eAAL,CAAqBC,IAArB,CAA0B,IAA1B,CAFF;AAID,OALD,MAKO;AACL,YAAMzB,WAAW,GAAG,KAAKC,UAAL,CAAgBC,eAAhB,EAApB;;AACA,YAAIF,WAAJ,EAAiB;AACfA,UAAAA,WAAW,CAACqC,mBAAZ,CAAgC,WAAhC,EAA6C,KAAK7C,OAAlD;AAEA,eAAKsB,UAAL,CAAgBG,GAAhB,CAAoB,mCAApB,EAAyD,KAAKmB,MAA9D;AAGApC,UAAAA,WAAW,CAACqC,mBAAZ,CAAgC,WAAhC,EAA6C,KAAK7C,OAAlD;AACAQ,UAAAA,WAAW,CAACqC,mBAAZ,CAAgC,SAAhC,EAA2C,KAAK7C,OAAhD;AAEAQ,UAAAA,WAAW,CAACqC,mBAAZ,CAAgC,aAAhC,EAA+C,KAAK7C,OAApD;AACD;AACF;AACF;;;WA0BD,0BAAyBZ,MAAzB,EAAsC;AACpC,UAAQG,IAAR,GAA8BH,MAA9B,CAAQG,IAAR;AAAA,UAAcuD,WAAd,GAA8B1D,MAA9B,CAAc0D,WAAd;AACA,UAAIxC,OAAJ;AACA,UAAIC,OAAJ;;AACA,UAAIuC,WAAW,KAAK,OAApB,EAA6B;AAC3BvC,QAAAA,OAAO,GAAGwC,IAAI,CAACC,KAAL,CAAW5D,MAAM,CAACoD,QAAP,CAAgB,CAAhB,EAAmBjC,OAA9B,CAAV;AACAD,QAAAA,OAAO,GAAGyC,IAAI,CAACC,KAAL,CAAW5D,MAAM,CAACoD,QAAP,CAAgB,CAAhB,EAAmBlC,OAA9B,CAAV;AACD,OAHD,MAGO;AACLC,QAAAA,OAAO,GAAGwC,IAAI,CAACC,KAAL,CAAY5D,MAAM,CAACO,QAAR,CAAgCQ,CAA3C,CAAV;AACAG,QAAAA,OAAO,GAAGyC,IAAI,CAACC,KAAL,CAAY5D,MAAM,CAACO,QAAR,CAAgCM,CAA3C,CAAV;AACD;;AAED,UAAMO,WAAW,GAAG,KAAKC,UAAL,CAAgBC,eAAhB,EAApB;;AACA,UAAIF,WAAJ,EAAiB;AACf,qCAAsBA,WAAW,CAACK,qBAAZ,EAAtB;AAAA,YAAQD,GAAR,0BAAQA,GAAR;AAAA,YAAaD,IAAb,0BAAaA,IAAb;;AACAL,QAAAA,OAAO,IAAIK,IAAX;AACAJ,QAAAA,OAAO,IAAIK,GAAX;AACD;;AACD,UAAMI,MAAM,GAAG,KAAKP,UAAL,CAAgBQ,iBAAhB,CAAkC,CAACX,OAAD,EAAUC,OAAV,CAAlC,CAAf;AACA,aAAO;AAAEN,QAAAA,CAAC,EAAEK,OAAL;AAAcH,QAAAA,CAAC,EAAEI,OAAjB;AAA0BS,QAAAA,MAAM,EAANA,MAA1B;AAAkCzB,QAAAA,IAAI,EAAJA,IAAlC;AAAwCH,QAAAA,MAAM,EAAEA,MAAM,CAACO;AAAvD,OAAP;AACD;;;WA+CD,qBAAoBM,CAApB,EAA+BE,CAA/B,EAA0Ca,MAA1C,EAA2D;AAAA;;AACzD,UAAMiC,OAAO,GAAG,IAAIC,IAAJ,GAAWC,OAAX,EAAhB;AACA,UAAI5D,IAAI,GAAG,OAAX;;AACA,UACE0D,OAAO,GAAG,KAAKG,aAAf,GAA+B,GAA/B,IACAL,IAAI,CAACM,GAAL,CAAS,KAAKC,WAAL,CAAiB,CAAjB,IAAsBrD,CAA/B,IAAoC,EADpC,IAEA8C,IAAI,CAACM,GAAL,CAAS,KAAKC,WAAL,CAAiB,CAAjB,IAAsBnD,CAA/B,IAAoC,EAHtC,EAIE;AACA,aAAKiD,aAAL,GAAqB,CAArB;AACA,aAAKE,WAAL,GAAmB,CAAC,CAAC,CAAF,EAAK,CAAC,CAAN,CAAnB;;AACA,YAAI,KAAKC,UAAT,EAAqB;AACnBC,UAAAA,YAAY,CAAC,KAAKD,UAAN,CAAZ;AACD;;AACDhE,QAAAA,IAAI,GAAG,UAAP;AACA,aAAKE,IAAL,CAAUb,gBAAgB,CAACiB,KAA3B,EAAkC;AAAEI,UAAAA,CAAC,EAADA,CAAF;AAAKE,UAAAA,CAAC,EAADA,CAAL;AAAQa,UAAAA,MAAM,EAANA,MAAR;AAAgBzB,UAAAA,IAAI,EAAJA;AAAhB,SAAlC;AACD,OAZD,MAYO;AACL,aAAK6D,aAAL,GAAqBH,OAArB;AACA,aAAKK,WAAL,GAAmB,CAACrD,CAAD,EAAIE,CAAJ,CAAnB;AAEA,aAAKoD,UAAL,GAAkBE,UAAU,CAAC,YAAM;AACjClE,UAAAA,IAAI,GAAG,OAAP;;AACA,UAAA,MAAI,CAACE,IAAL,CAAUb,gBAAgB,CAACiB,KAA3B,EAAkC;AAAEI,YAAAA,CAAC,EAADA,CAAF;AAAKE,YAAAA,CAAC,EAADA,CAAL;AAAQa,YAAAA,MAAM,EAANA,MAAR;AAAgBzB,YAAAA,IAAI,EAAJA;AAAhB,WAAlC;AACD,SAH2B,EAGzB,GAHyB,CAA5B;AAID;AACF;;;;EArO6ChB,Y;;;;;;SAA3BW,kB","sourcesContent":["import { $window, isMini } from '@antv/l7-utils';\nimport EventEmitter from 'eventemitter3';\nimport { inject, injectable } from 'inversify';\nimport Hammer from 'l7hammerjs';\nimport 'reflect-metadata';\n// @ts-ignore\nimport { TYPES } from '../../types';\nimport { ILngLat, IMapService } from '../map/IMapService';\nimport { IInteractionService, InteractionEvent } from './IInteractionService';\nconst DragEventMap: { [key: string]: string } = {\n  panstart: 'dragstart',\n  panmove: 'dragging',\n  panend: 'dragend',\n  pancancel: 'dragcancel',\n};\n/**\n * 由于目前 L7 与地图结合的方案为双 canvas 而非共享 WebGL Context，事件监听注册在地图底图上。\n * 除此之外，后续如果支持非地图场景，事件监听就需要注册在 L7 canvas 上。\n */\n@injectable()\nexport default class InteractionService extends EventEmitter\n  implements IInteractionService {\n  public indragging: boolean = false;\n  @inject(TYPES.IMapService)\n  private readonly mapService: IMapService;\n  // @ts-ignore\n  // private hammertime: HammerManager;\n  private hammertime: any;\n\n  private lastClickTime: number = 0;\n\n  private lastClickXY: number[] = [-1, -1];\n\n  private clickTimer: number;\n\n  private $containter: HTMLElement;\n\n  public init() {\n    // 注册事件在地图底图上\n    this.addEventListenerOnMap();\n    this.$containter = this.mapService.getMapContainer() as HTMLElement;\n  }\n\n  public destroy() {\n    if (this.hammertime) {\n      this.hammertime.destroy();\n    }\n    this.removeEventListenerOnMap();\n    this.off(InteractionEvent.Hover);\n  }\n\n  public triggerHover({ x, y }: { x: number; y: number }) {\n    this.emit(InteractionEvent.Hover, { x, y });\n  }\n  public triggerSelect(id: number): void {\n    this.emit(InteractionEvent.Select, { featureId: id });\n  }\n\n  public triggerActive(id: number): void {\n    this.emit(InteractionEvent.Active, { featureId: id });\n  }\n\n  public handleMiniEvent(e: any) {\n    // @ts-ignore\n    this.onHover({\n      clientX: e.touches[0].pageX,\n      clientY: e.touches[0].pageY,\n      type: 'touch',\n    });\n  }\n\n  private addEventListenerOnMap() {\n    const $containter = this.mapService.getMapContainer();\n    if ($containter) {\n      if (isMini) {\n        $window.document.addEventListener(\n          'touchstart',\n          this.handleMiniEvent.bind(this),\n        );\n      } else {\n        const hammertime = new Hammer.Manager($containter);\n        // $containter.addEventListener('mousemove', this.onHover);\n        // $containter.addEventListener('click', this.onHover);\n        hammertime.add(\n          new Hammer.Tap({\n            event: 'dblclick',\n            taps: 2,\n          }),\n        );\n        hammertime.add(\n          new Hammer.Tap({\n            event: 'click',\n          }),\n        );\n        hammertime.add(new Hammer.Pan({ threshold: 0, pointers: 0 }));\n        hammertime.add(new Hammer.Press({}));\n        // hammertime.get('pan').set({ direction: Hammer.DIRECTION_ALL });\n        // hammertime.get('pinch').set({ enable: true });\n        hammertime.on('dblclick click', this.onHammer);\n        hammertime.on('panstart panmove panend pancancel', this.onDrag);\n        // $containter.addEventListener('touchstart', this.onTouch);\n        $containter.addEventListener('mousemove', this.onHover);\n        // $containter.addEventListener('click', this.onHover);\n        $containter.addEventListener('mousedown', this.onHover, true);\n        $containter.addEventListener('mouseup', this.onHover);\n        $containter.addEventListener('contextmenu', this.onHover);\n        this.hammertime = hammertime;\n      }\n\n      // // TODO: 根据场景注册事件到 L7 canvas 上\n    }\n  }\n  private removeEventListenerOnMap() {\n    if (isMini) {\n      $window.document.removeEventListener(\n        'touchstart',\n        this.handleMiniEvent.bind(this),\n      );\n    } else {\n      const $containter = this.mapService.getMapContainer();\n      if ($containter) {\n        $containter.removeEventListener('mousemove', this.onHover);\n        // this.hammertime.off('dblclick click', this.onHammer);\n        this.hammertime.off('panstart panmove panend pancancel', this.onDrag);\n        // $containter.removeEventListener('touchstart', this.onTouch);\n        // $containter.removeEventListener('click', this.onHover);\n        $containter.removeEventListener('mousedown', this.onHover);\n        $containter.removeEventListener('mouseup', this.onHover);\n        // $containter.removeEventListener('dblclick', this.onHover);\n        $containter.removeEventListener('contextmenu', this.onHover);\n      }\n    }\n  }\n\n  private onDrag = (target: any) => {\n    const interactionTarget = this.interactionEvent(target);\n    interactionTarget.type = DragEventMap[interactionTarget.type];\n    interactionTarget.type === 'dragging'\n      ? (this.indragging = true)\n      : (this.indragging = false);\n    this.emit(InteractionEvent.Drag, interactionTarget);\n  };\n\n  private onHammer = (target: any) => {\n    target.srcEvent.stopPropagation();\n    const interactionTarget = this.interactionEvent(target);\n    this.emit(InteractionEvent.Hover, interactionTarget);\n  };\n  private onTouch = (target: TouchEvent) => {\n    const touch = target.touches[0];\n    // @ts-ignore\n    this.onHover({\n      x: touch.pageX,\n      y: touch.pageY,\n      type: 'touch',\n    });\n  };\n\n  private interactionEvent(target: any) {\n    const { type, pointerType } = target;\n    let clientX;\n    let clientY;\n    if (pointerType === 'touch') {\n      clientY = Math.floor(target.pointers[0].clientY);\n      clientX = Math.floor(target.pointers[0].clientX);\n    } else {\n      clientY = Math.floor((target.srcEvent as MouseEvent).y);\n      clientX = Math.floor((target.srcEvent as MouseEvent).x);\n    }\n\n    const $containter = this.mapService.getMapContainer();\n    if ($containter) {\n      const { top, left } = $containter.getBoundingClientRect();\n      clientX -= left;\n      clientY -= top;\n    }\n    const lngLat = this.mapService.containerToLngLat([clientX, clientY]);\n    return { x: clientX, y: clientY, lngLat, type, target: target.srcEvent };\n  }\n  private onHover = (event: MouseEvent) => {\n    const { clientX, clientY } = event;\n    let x = clientX;\n    let y = clientY;\n    const type = event.type;\n    const $containter = this.mapService.getMapContainer();\n    if ($containter) {\n      if (isMini) {\n        // l7 - mini\n        // @ts-ignore\n        x = x - $containter.left - 0;\n        // @ts-ignore\n        y = y - $containter.top - 0;\n      } else {\n        const { top, left } = $containter.getBoundingClientRect();\n        x = x - left - $containter.clientLeft;\n        y = y - top - $containter.clientTop;\n      }\n    }\n    const lngLat = this.mapService.containerToLngLat([x, y]);\n\n    if (type === 'click') {\n      if (!isMini) {\n        // l7 - mini\n        if ('ontouchstart' in document.documentElement === true) {\n          return;\n        }\n      }\n      this.isDoubleTap(x, y, lngLat);\n      return;\n    }\n    if (type === 'touch') {\n      this.isDoubleTap(x, y, lngLat);\n      return;\n    }\n    if (type !== 'click' && type !== 'dblclick') {\n      this.emit(InteractionEvent.Hover, {\n        x,\n        y,\n        lngLat,\n        type,\n        target: event,\n      });\n    }\n  };\n\n  private isDoubleTap(x: number, y: number, lngLat: ILngLat) {\n    const nowTime = new Date().getTime();\n    let type = 'click';\n    if (\n      nowTime - this.lastClickTime < 400 &&\n      Math.abs(this.lastClickXY[0] - x) < 10 &&\n      Math.abs(this.lastClickXY[1] - y) < 10\n    ) {\n      this.lastClickTime = 0;\n      this.lastClickXY = [-1, -1];\n      if (this.clickTimer) {\n        clearTimeout(this.clickTimer);\n      }\n      type = 'dblclick';\n      this.emit(InteractionEvent.Hover, { x, y, lngLat, type });\n    } else {\n      this.lastClickTime = nowTime;\n      this.lastClickXY = [x, y];\n      // @ts-ignore\n      this.clickTimer = setTimeout(() => {\n        type = 'click';\n        this.emit(InteractionEvent.Hover, { x, y, lngLat, type });\n      }, 400);\n    }\n  }\n}\n"],"file":"InteractionService.js"}