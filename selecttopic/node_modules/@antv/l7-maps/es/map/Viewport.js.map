{"version":3,"sources":["../../src/map/Viewport.ts"],"names":["WebMercatorViewport","Viewport","mapCamera","center","zoom","pitch","bearing","viewportHeight","viewportWidth","viewport","width","height","longitude","latitude","Math","pow","getZoom","projectionMatrix","viewMatrix","viewMatrixUncentered","viewProjectionMatrix","lngLat","scale","projectFlat"],"mappings":";;;AACA,OAAOA,mBAAP,MAAgC,2BAAhC;;IAEqBC,Q;;;;;;;;;WAGnB,2BAAyBC,SAAzB,EAAyD;AACvD,UACEC,MADF,GAOID,SAPJ,CACEC,MADF;AAAA,UAEEC,IAFF,GAOIF,SAPJ,CAEEE,IAFF;AAAA,UAGEC,KAHF,GAOIH,SAPJ,CAGEG,KAHF;AAAA,UAIEC,OAJF,GAOIJ,SAPJ,CAIEI,OAJF;AAAA,UAKEC,cALF,GAOIL,SAPJ,CAKEK,cALF;AAAA,UAMEC,aANF,GAOIN,SAPJ,CAMEM,aANF;AAaA,WAAKC,QAAL,GAAgB,IAAIT,mBAAJ,CAAwB;AACtCU,QAAAA,KAAK,EAAEF,aAD+B;AAEtCG,QAAAA,MAAM,EAAEJ,cAF8B;AAGtCK,QAAAA,SAAS,EAAET,MAAM,IAAIA,MAAM,CAAC,CAAD,CAHW;AAItCU,QAAAA,QAAQ,EAAEV,MAAM,IAAIA,MAAM,CAAC,CAAD,CAJY;AAKtCC,QAAAA,IAAI,EAAJA,IALsC;AAMtCC,QAAAA,KAAK,EAALA,KANsC;AAOtCC,QAAAA,OAAO,EAAPA;AAPsC,OAAxB,CAAhB;AASD;;;WAED,mBAAyB;AACvB,aAAO,KAAKG,QAAL,CAAcL,IAArB;AACD;;;WAED,wBAA8B;AAC5B,aAAOU,IAAI,CAACC,GAAL,CAAS,CAAT,EAAY,KAAKC,OAAL,EAAZ,CAAP;AACD;;;WAED,qBAAqC;AACnC,aAAO,CAAC,KAAKP,QAAL,CAAcG,SAAf,EAA0B,KAAKH,QAAL,CAAcI,QAAxC,CAAP;AACD;;;WAED,+BAAuC;AACrC,aAAO,KAAKJ,QAAL,CAAcQ,gBAArB;AACD;;;WAED,0BAAkC;AAChC,aAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B,EAA+B,CAA/B,EAAkC,CAAlC,EAAqC,CAArC,EAAwC,CAAxC,EAA2C,CAA3C,EAA8C,CAA9C,CAAP;AACD;;;WAED,yBAAiC;AAC/B,aAAO,KAAKR,QAAL,CAAcS,UAArB;AACD;;;WAED,mCAA2C;AAEzC,aAAO,KAAKT,QAAL,CAAcU,oBAArB;AACD;;;WACD,mCAA2C;AAEzC,aAAO,KAAKV,QAAL,CAAcW,oBAArB;AACD;;;WAED,6CAAqD;AAEnD,aAAO,KAAKX,QAAL,CAAcW,oBAArB;AACD;;;WACD,4BAA0B;AACxB,aAAO,CAAP;AACD;;;WAMD,qBACEC,MADF,EAEEC,KAFF,EAGoB;AAClB,aAAO,KAAKb,QAAL,CAAcc,WAAd,CAA0BF,MAA1B,EAAkCC,KAAlC,CAAP;AACD;;;;;;SA9EkBrB,Q","sourcesContent":["import { IMapCamera, IViewport } from '@antv/l7-core';\nimport WebMercatorViewport from 'viewport-mercator-project';\n\nexport default class Viewport implements IViewport {\n  private viewport: WebMercatorViewport;\n\n  public syncWithMapCamera(mapCamera: Partial<IMapCamera>) {\n    const {\n      center,\n      zoom,\n      pitch,\n      bearing,\n      viewportHeight,\n      viewportWidth,\n    } = mapCamera;\n\n    /**\n     * Deck.gl 使用的也是 Mapbox 同步相机，相机参数保持一致\n     * 例如相机高度固定为 height * 1.5，因此不需要传\n     */\n    this.viewport = new WebMercatorViewport({\n      width: viewportWidth,\n      height: viewportHeight,\n      longitude: center && center[0],\n      latitude: center && center[1],\n      zoom,\n      pitch,\n      bearing,\n    });\n  }\n\n  public getZoom(): number {\n    return this.viewport.zoom;\n  }\n\n  public getZoomScale(): number {\n    return Math.pow(2, this.getZoom());\n  }\n\n  public getCenter(): [number, number] {\n    return [this.viewport.longitude, this.viewport.latitude];\n  }\n\n  public getProjectionMatrix(): number[] {\n    return this.viewport.projectionMatrix;\n  }\n\n  public getModelMatrix(): number[] {\n    return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n  }\n\n  public getViewMatrix(): number[] {\n    return this.viewport.viewMatrix;\n  }\n\n  public getViewMatrixUncentered(): number[] {\n    // @ts-ignore\n    return this.viewport.viewMatrixUncentered;\n  }\n  public getViewProjectionMatrix(): number[] {\n    // @ts-ignore\n    return this.viewport.viewProjectionMatrix;\n  }\n\n  public getViewProjectionMatrixUncentered(): number[] {\n    // @ts-ignore\n    return this.viewport.viewProjectionMatrix;\n  }\n  public getFocalDistance() {\n    return 1;\n  }\n\n  /**\n   * P20 坐标系，固定 scale\n   */\n\n  public projectFlat(\n    lngLat: [number, number],\n    scale?: number | undefined,\n  ): [number, number] {\n    return this.viewport.projectFlat(lngLat, scale);\n  }\n}\n"],"file":"Viewport.js"}