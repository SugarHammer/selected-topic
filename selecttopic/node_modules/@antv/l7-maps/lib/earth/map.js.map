{"version":3,"sources":["../../src/earth/map.ts"],"names":["EventMap","mapmove","camerachange","zoomchange","dragging","LNGLAT_OFFSET_ZOOM_THRESHOLD","L7EarthService","TYPES","MapConfig","IGlobalConfigService","ICoordinateSystemService","IEventEmitter","Version","GLOBEL","SimpleMapCoord","e","emit","DELAY_TIME","handleCameraChanging","handleCameraTimer","clearTimeout","setTimeout","rotateStep","type","originalEvent","viewport","scaleZoom","Math","sign","wheelDelta","abs","movementX","movementY","rotateY","rotateX","config","offsetCoordinate","syncWithMapCamera","viewportHeight","map","transform","height","viewportWidth","width","getZoom","coordinateSystemService","setCoordinateSystem","CoordinateSystem","LNGLAT_OFFSET","LNGLAT","cameraChangedCallback","color","bgColor","container","getCanvasContainer","markerContainer","DOM","create","setAttribute","handle","MapServiceEvent","indexOf","eventEmitter","on","off","getContainer","size","zoom","setZoom","getCenter","lnglat","setCenter","getPitch","getBearing","getBounds","toArray","getMinZoom","getMaxZoom","rotation","setBearing","option","eventData","zoomIn","zoomOut","pitch","setPitch","p","panTo","x","y","bound","fitBoundsOptions","fitBounds","max","setMaxZoom","min","setMinZoom","doubleClickZoom","enable","disable","dragEnable","dragPan","rotateEnable","dragRotate","keyboardEnable","keyboard","zoomEnable","scrollZoom","center","flyTo","style","setStyle","getMapStyle","pixel","unproject","project","altitude","Error","rotate","scale","origin","z","id","attributionControl","mapInstance","rest","Viewport","$mapContainer","creatAmapContainer","EarthMap","bearing","handleCameraChanged","parentNode","removeChild","removeAllListeners","remove","name","args","once","renderCanvas","getCanvas","layersPng","toDataURL","callback","force","reg","$wrapper","document","getElementById","MapTheme"],"mappings":"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","sourcesContent":["/**\n * MapboxService\n */\nimport {\n  Bounds,\n  CoordinateSystem,\n  ICoordinateSystemService,\n  IEarthService,\n  IGlobalConfigService,\n  ILngLat,\n  IMapConfig,\n  IMercator,\n  IPoint,\n  IStatusOptions,\n  IViewport,\n  MapServiceEvent,\n  MapStyle,\n  TYPES,\n} from '@antv/l7-core';\nimport { EarthMap, Map } from '@antv/l7-map';\nimport { DOM } from '@antv/l7-utils';\nimport { inject, injectable } from 'inversify';\nimport 'reflect-metadata';\nimport { Version } from '../version';\nimport Viewport from './Viewport';\nconst EventMap: {\n  [key: string]: any;\n} = {\n  mapmove: 'move',\n  camerachange: 'move',\n  zoomchange: 'zoom',\n  dragging: 'drag',\n};\nimport { ISimpleMapCoord, SimpleMapCoord } from '../simpleMapCoord';\nimport { MapTheme } from './theme';\n\nconst LNGLAT_OFFSET_ZOOM_THRESHOLD = 12;\n/**\n * AMapService\n */\n@injectable()\nexport default class L7EarthService implements IEarthService<Map> {\n  public version: string = Version.GLOBEL;\n  public map: Map;\n  public simpleMapCoord: ISimpleMapCoord = new SimpleMapCoord();\n\n  // TODO: 判断地图是否正在拖拽\n  public dragging: boolean = false;\n\n  // 背景色\n  public bgColor: string = '#000';\n\n  @inject(TYPES.MapConfig)\n  private readonly config: Partial<IMapConfig>;\n\n  @inject(TYPES.IGlobalConfigService)\n  private readonly configService: IGlobalConfigService;\n\n  @inject(TYPES.ICoordinateSystemService)\n  private readonly coordinateSystemService: ICoordinateSystemService;\n\n  @inject(TYPES.IEventEmitter)\n  private eventEmitter: any;\n  private viewport: Viewport;\n  private markerContainer: HTMLElement;\n  private cameraChangedCallback: (viewport: IViewport) => void;\n  private $mapContainer: HTMLElement | null;\n  // T: 用于记录鼠标对相机的控制\n  private handleCameraChanging: boolean;\n  private handleCameraTimer: any;\n  public setBgColor(color: string) {\n    this.bgColor = color;\n  }\n  // init\n  public addMarkerContainer(): void {\n    const container = this.map.getCanvasContainer();\n    this.markerContainer = DOM.create('div', 'l7-marker-container', container);\n    this.markerContainer.setAttribute('tabindex', '-1');\n  }\n\n  public getMarkerContainer(): HTMLElement {\n    return this.markerContainer;\n  }\n\n  //  map event\n  public on(type: string, handle: (...args: any[]) => void): void {\n    if (MapServiceEvent.indexOf(type) !== -1) {\n      this.eventEmitter.on(type, handle);\n    } else {\n      // 统一事件名称\n      this.map.on(EventMap[type] || type, handle);\n    }\n  }\n  public off(type: string, handle: (...args: any[]) => void): void {\n    this.map.off(EventMap[type] || type, handle);\n    this.eventEmitter.off(type, handle);\n  }\n\n  public getContainer(): HTMLElement | null {\n    return this.map.getContainer();\n  }\n\n  public getMapCanvasContainer(): HTMLElement {\n    return this.map.getCanvasContainer() as HTMLElement;\n  }\n\n  public getSize(): [number, number] {\n    const size = this.map.transform;\n    return [size.width, size.height];\n  }\n  // get mapStatus method\n\n  public getType() {\n    return 'default';\n  }\n\n  public getZoom(): number {\n    return this.map.getZoom();\n  }\n\n  public setZoom(zoom: number) {\n    return this.map.setZoom(zoom);\n  }\n\n  public getCenter(): ILngLat {\n    return this.map.getCenter();\n  }\n\n  public setCenter(lnglat: [number, number]): void {\n    this.map.setCenter(lnglat);\n  }\n\n  public getPitch(): number {\n    return this.map.getPitch();\n  }\n\n  public getRotation(): number {\n    return this.map.getBearing();\n  }\n\n  public getBounds(): Bounds {\n    return this.map.getBounds().toArray() as Bounds;\n  }\n\n  public getMinZoom(): number {\n    return this.map.getMinZoom();\n  }\n\n  public getMaxZoom(): number {\n    return this.map.getMaxZoom();\n  }\n\n  public setRotation(rotation: number): void {\n    this.map.setBearing(rotation);\n  }\n\n  public zoomIn(option?: any, eventData?: any): void {\n    this.map.zoomIn(option, eventData);\n  }\n  public zoomOut(option?: any, eventData?: any): void {\n    this.map.zoomOut(option, eventData);\n  }\n  public setPitch(pitch: number) {\n    return this.map.setPitch(pitch);\n  }\n\n  public panTo(p: [number, number]): void {\n    this.map.panTo(p);\n  }\n\n  public panBy(x: number = 0, y: number = 0): void {\n    this.panTo([x, y]);\n  }\n\n  public fitBounds(bound: Bounds, fitBoundsOptions?: any): void {\n    this.map.fitBounds(bound, fitBoundsOptions);\n  }\n\n  public setMaxZoom(max: number): void {\n    this.map.setMaxZoom(max);\n  }\n\n  public setMinZoom(min: number): void {\n    this.map.setMinZoom(min);\n  }\n  public setMapStatus(option: Partial<IStatusOptions>): void {\n    if (option.doubleClickZoom === true) {\n      this.map.doubleClickZoom.enable();\n    }\n    if (option.doubleClickZoom === false) {\n      this.map.doubleClickZoom.disable();\n    }\n    if (option.dragEnable === false) {\n      this.map.dragPan.disable();\n    }\n    if (option.dragEnable === true) {\n      this.map.dragPan.enable();\n    }\n    if (option.rotateEnable === false) {\n      this.map.dragRotate.disable();\n    }\n    if (option.dragEnable === true) {\n      this.map.dragRotate.enable();\n    }\n    if (option.keyboardEnable === false) {\n      this.map.keyboard.disable();\n    }\n    if (option.keyboardEnable === true) {\n      this.map.keyboard.enable();\n    }\n    if (option.zoomEnable === false) {\n      this.map.scrollZoom.disable();\n    }\n    if (option.zoomEnable === true) {\n      this.map.scrollZoom.enable();\n    }\n  }\n\n  public setZoomAndCenter(zoom: number, center: [number, number]): void {\n    this.map.flyTo({\n      zoom,\n      center,\n    });\n  }\n\n  public setMapStyle(style: any): void {\n    this.map.setStyle(this.getMapStyle(style));\n  }\n  // TODO: 计算像素坐标\n  public pixelToLngLat(pixel: [number, number]): ILngLat {\n    return this.map.unproject(pixel);\n  }\n\n  public lngLatToPixel(lnglat: [number, number]): IPoint {\n    return this.map.project(lnglat);\n  }\n\n  public containerToLngLat(pixel: [number, number]): ILngLat {\n    return this.map.unproject(pixel);\n  }\n\n  public lngLatToContainer(lnglat: [number, number]): IPoint {\n    return this.map.project(lnglat);\n  }\n  public lngLatToMercator(\n    lnglat: [number, number],\n    altitude: number,\n  ): IMercator {\n    throw new Error('not implement');\n  }\n  public getModelMatrix(\n    lnglat: [number, number],\n    altitude: number,\n    rotate: [number, number, number],\n    scale: [number, number, number] = [1, 1, 1],\n    origin: IMercator = { x: 0, y: 0, z: 0 },\n  ): number[] {\n    throw new Error('not implement');\n  }\n\n  public async init(): Promise<void> {\n    const {\n      id = 'map',\n      attributionControl = false,\n      style = 'light',\n      rotation = 0,\n      mapInstance,\n      ...rest\n    } = this.config;\n\n    this.viewport = new Viewport();\n\n    this.$mapContainer = this.creatAmapContainer(id);\n    // @ts-ignore\n    this.map = new EarthMap({\n      container: this.$mapContainer,\n      style: this.getMapStyle(style),\n      bearing: rotation,\n      ...rest,\n    });\n\n    this.map.on('load', this.handleCameraChanged);\n    this.map.on('move', this.handleCameraChanged);\n\n    // 不同于高德地图，需要手动触发首次渲染\n    this.handleCameraChanged({});\n  }\n\n  public destroy() {\n    // TODO: 销毁地图可视化层的容器\n    this.$mapContainer?.parentNode?.removeChild(this.$mapContainer);\n\n    this.eventEmitter.removeAllListeners();\n    if (this.map) {\n      this.map.remove();\n      this.$mapContainer = null;\n    }\n  }\n  public emit(name: string, ...args: any[]) {\n    this.eventEmitter.emit(name, ...args);\n  }\n  public once(name: string, ...args: any[]) {\n    this.eventEmitter.once(name, ...args);\n  }\n\n  public getMapContainer() {\n    return this.$mapContainer;\n  }\n\n  public exportMap(type: 'jpg' | 'png'): string {\n    const renderCanvas = this.map.getCanvas();\n    const layersPng =\n      type === 'jpg'\n        ? (renderCanvas?.toDataURL('image/jpeg') as string)\n        : (renderCanvas?.toDataURL('image/png') as string);\n    return layersPng;\n  }\n  public onCameraChanged(callback: (viewport: IViewport) => void): void {\n    this.cameraChangedCallback = callback;\n  }\n\n  /**\n   * 地球模式向外暴露的 Y 轴旋转方法\n   * @returns\n   */\n  public rotateY(option: { force: boolean; reg: number }) {\n    const { force = false, reg = 0.01 } = option || {};\n    // TODO: 让旋转方法与\n    if (this.handleCameraChanging && !force) {\n      return;\n    }\n\n    if (this.viewport) {\n      this.viewport.rotateY(reg);\n\n      this.viewport.syncWithMapCamera({\n        viewportHeight: this.map.transform.height,\n        viewportWidth: this.map.transform.width,\n      });\n\n      this.cameraChangedCallback(this.viewport);\n    }\n  }\n\n  private handleCameraChanged = (e: any) => {\n    // Tip: 统一触发地图变化事件\n    this.emit('mapchange');\n    const DELAY_TIME = 2000;\n    this.handleCameraChanging = true;\n    if (this.handleCameraTimer) {\n      clearTimeout(this.handleCameraTimer);\n    }\n    this.handleCameraTimer = setTimeout(() => {\n      this.handleCameraChanging = false;\n    }, DELAY_TIME);\n    // 定义鼠标相机控制\n    const rotateStep = 0.02;\n    if (e.type && e.originalEvent) {\n      if (e.originalEvent.type === 'wheel') {\n        this.viewport.scaleZoom(\n          0.01 * Math.sign(e.originalEvent.wheelDelta) * -1,\n        );\n      }\n\n      if (\n        Math.abs(e.originalEvent.movementX) >\n        Math.abs(e.originalEvent.movementY)\n      ) {\n        if (e.originalEvent.movementX > 0) {\n          this.viewport.rotateY(rotateStep);\n        } else if (e.originalEvent.movementX < 0) {\n          this.viewport.rotateY(-rotateStep);\n        }\n      } else {\n        if (e.originalEvent.movementY > 0) {\n          this.viewport.rotateX(rotateStep);\n        } else if (e.originalEvent.movementY < 0) {\n          this.viewport.rotateX(-rotateStep);\n        }\n      }\n    }\n\n    const { offsetCoordinate = true } = this.config;\n\n    // resync\n    this.viewport.syncWithMapCamera({\n      viewportHeight: this.map.transform.height,\n      viewportWidth: this.map.transform.width,\n    });\n    // set coordinate system\n    if (\n      this.viewport.getZoom() > LNGLAT_OFFSET_ZOOM_THRESHOLD &&\n      offsetCoordinate\n    ) {\n      this.coordinateSystemService.setCoordinateSystem(\n        CoordinateSystem.LNGLAT_OFFSET,\n      );\n    } else {\n      this.coordinateSystemService.setCoordinateSystem(CoordinateSystem.LNGLAT);\n    }\n\n    this.cameraChangedCallback(this.viewport);\n  };\n\n  private creatAmapContainer(id: string | HTMLDivElement) {\n    let $wrapper = id as HTMLDivElement;\n    if (typeof id === 'string') {\n      $wrapper = document.getElementById(id) as HTMLDivElement;\n    }\n    return $wrapper;\n  }\n  private getMapStyle(name: MapStyle) {\n    if (typeof name !== 'string') {\n      return name;\n    }\n    return MapTheme[name] ? MapTheme[name] : name;\n  }\n}\n"],"file":"map.js"}